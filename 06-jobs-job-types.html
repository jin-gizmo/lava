
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="AWS based distributed scheduler and job runner">
      
      
        <meta name="author" content="Murray Andrews">
      
      
      
        <link rel="prev" href="05-job-dispatch.html">
      
      
        <link rel="next" href="07-connectors.html">
      
      
      <link rel="icon" href="img/lava-icons/png/256/lava-icon-256-transparent.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.23">
    
    
      
        <title>Jobs & Job Types - Lava User Guide</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.84d31ad4.min.css">
      
        
        <link rel="stylesheet" href="assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="css/extra.css">
    
    <script>__md_scope=new URL(".",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#jobs-and-job-types" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="." title="Lava User Guide" class="md-header__button md-logo" aria-label="Lava User Guide" data-md-component="logo">
      
  <img src="img/lava-icons/svg/256/lava-icon-256-opaque.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Lava User Guide
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Jobs & Job Types
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="custom" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        

<a href="https://github.com/jin-gizmo/lava" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    Lava on GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="." title="Lava User Guide" class="md-nav__button md-logo" aria-label="Lava User Guide" data-md-component="logo">
      
  <img src="img/lava-icons/svg/256/lava-icon-256-opaque.svg" alt="logo">

    </a>
    Lava User Guide
  </label>
  
    <div class="md-nav__source">
      

<a href="https://github.com/jin-gizmo/lava" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    Lava on GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="01-about-lava.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    About Lava
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="02-concepts.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Concepts
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="03-architecture.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Architecture
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="04-dynamodb-tables.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    DynamoDB Tables
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="05-job-dispatch.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Job Dispatch
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Jobs & Job Types
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="06-jobs-job-types.html" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Jobs & Job Types
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#job-families" class="md-nav__link">
    <span class="md-ellipsis">
      Job Families
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#job-payloads" class="md-nav__link">
    <span class="md-ellipsis">
      Job Payloads
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Job Payloads">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#s3-payloads" class="md-nav__link">
    <span class="md-ellipsis">
      S3 Payloads
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#job-retries" class="md-nav__link">
    <span class="md-ellipsis">
      Job Retries
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Job Retries">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#job-actions-for-retries" class="md-nav__link">
    <span class="md-ellipsis">
      Job Actions for Retries
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lava-job-retries-iterations-vs-sqs-resubmissions" class="md-nav__link">
    <span class="md-ellipsis">
      Retries vs Resubmissions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#choosing-an-sql-job-type" class="md-nav__link">
    <span class="md-ellipsis">
      Choosing an SQL Job Type
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#job-type-chain" class="md-nav__link">
    <span class="md-ellipsis">
      Job type: chain
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Job type: chain">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#payload" class="md-nav__link">
    <span class="md-ellipsis">
      Payload
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#allowing-child-jobs-to-fail" class="md-nav__link">
    <span class="md-ellipsis">
      Allowing Child Jobs to Fail
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#handling-of-globals" class="md-nav__link">
    <span class="md-ellipsis">
      Handling of Globals
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dev-mode-behaviour" class="md-nav__link">
    <span class="md-ellipsis">
      Dev Mode Behaviour
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#examples" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#job-type-cmd" class="md-nav__link">
    <span class="md-ellipsis">
      Job type: cmd
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Job type: cmd">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#payload_1" class="md-nav__link">
    <span class="md-ellipsis">
      Payload
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#environment" class="md-nav__link">
    <span class="md-ellipsis">
      Environment
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parameters_1" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jinja-rendering-of-the-payload-and-environment" class="md-nav__link">
    <span class="md-ellipsis">
      Jinja Rendering of the Payload and Environment
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dev-mode-behaviour_1" class="md-nav__link">
    <span class="md-ellipsis">
      Dev Mode Behaviour
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#examples_1" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#job-type-dag" class="md-nav__link">
    <span class="md-ellipsis">
      Job type: dag
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Job type: dag">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#payload_2" class="md-nav__link">
    <span class="md-ellipsis">
      Payload
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parameters_2" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#allowing-child-jobs-to-fail_1" class="md-nav__link">
    <span class="md-ellipsis">
      Allowing Child Jobs to Fail
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#handling-of-globals_1" class="md-nav__link">
    <span class="md-ellipsis">
      Handling of Globals
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dev-mode-behaviour_2" class="md-nav__link">
    <span class="md-ellipsis">
      Dev Mode Behaviour
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#examples_2" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#job-type-db_from_s3" class="md-nav__link">
    <span class="md-ellipsis">
      Job type: db_from_s3
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Job type: db_from_s3">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#payload_3" class="md-nav__link">
    <span class="md-ellipsis">
      Payload
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parameters_3" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jinja-rendering-of-the-bucket-key-schema-and-table" class="md-nav__link">
    <span class="md-ellipsis">
      Jinja Rendering of the Bucket, Key, Schema and Table
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriving-target-schema-and-table-name-from-the-s3-key" class="md-nav__link">
    <span class="md-ellipsis">
      Deriving Target Schema and Table Name from the S3 Key
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#copy-modes" class="md-nav__link">
    <span class="md-ellipsis">
      Copy Modes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#event-driven-loading" class="md-nav__link">
    <span class="md-ellipsis">
      Event Driven Loading
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dev-mode-behaviour_3" class="md-nav__link">
    <span class="md-ellipsis">
      Dev Mode Behaviour
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#moving-data-from-redshift-to-other-databases" class="md-nav__link">
    <span class="md-ellipsis">
      Moving Data from Redshift to Other Databases
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#loading-data-to-aurora-mysql" class="md-nav__link">
    <span class="md-ellipsis">
      Loading Data to Aurora MySQL
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#loading-data-to-aurora-postgres" class="md-nav__link">
    <span class="md-ellipsis">
      Loading Data to Aurora Postgres
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#loading-data-to-oracle" class="md-nav__link">
    <span class="md-ellipsis">
      Loading Data to Oracle
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#loading-data-to-postgres" class="md-nav__link">
    <span class="md-ellipsis">
      Loading Data to Postgres
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#loading-data-to-postgres-rds" class="md-nav__link">
    <span class="md-ellipsis">
      Loading Data to Postgres RDS
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#loading-data-to-redshift" class="md-nav__link">
    <span class="md-ellipsis">
      Loading Data to Redshift
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#loading-data-to-sqlite3" class="md-nav__link">
    <span class="md-ellipsis">
      Loading Data to SQLite3
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#job-type-dispatch" class="md-nav__link">
    <span class="md-ellipsis">
      Job type: dispatch
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Job type: dispatch">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#payload_4" class="md-nav__link">
    <span class="md-ellipsis">
      Payload
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parameters_4" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#handling-of-globals_2" class="md-nav__link">
    <span class="md-ellipsis">
      Handling of Globals
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jinja-rendering-of-the-payload" class="md-nav__link">
    <span class="md-ellipsis">
      Jinja Rendering of the Payload
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dev-mode-behaviour_4" class="md-nav__link">
    <span class="md-ellipsis">
      Dev Mode Behaviour
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#examples_3" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#job-type-docker" class="md-nav__link">
    <span class="md-ellipsis">
      Job type: docker
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Job type: docker">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#payload_5" class="md-nav__link">
    <span class="md-ellipsis">
      Payload
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#environment_1" class="md-nav__link">
    <span class="md-ellipsis">
      Environment
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#docker-runtime-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Docker Runtime Configuration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parameters_5" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#connecting-to-docker" class="md-nav__link">
    <span class="md-ellipsis">
      Connecting to Docker
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#container-host-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Container Host Configuration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jinja-rendering-of-the-arguments-and-environment" class="md-nav__link">
    <span class="md-ellipsis">
      Jinja Rendering of the Arguments and Environment
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#connection-handling" class="md-nav__link">
    <span class="md-ellipsis">
      Connection Handling
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dev-mode-behaviour_5" class="md-nav__link">
    <span class="md-ellipsis">
      Dev Mode Behaviour
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#examples_4" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#job-type-exe" class="md-nav__link">
    <span class="md-ellipsis">
      Job type: exe
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Job type: exe">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#payload_6" class="md-nav__link">
    <span class="md-ellipsis">
      Payload
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#environment_2" class="md-nav__link">
    <span class="md-ellipsis">
      Environment
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parameters_6" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jinja-rendering-of-the-arguments-and-environment_1" class="md-nav__link">
    <span class="md-ellipsis">
      Jinja Rendering of the Arguments and Environment
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#connection-handling_1" class="md-nav__link">
    <span class="md-ellipsis">
      Connection Handling
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dev-mode-behaviour_6" class="md-nav__link">
    <span class="md-ellipsis">
      Dev Mode Behaviour
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#examples_5" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#job-type-foreach" class="md-nav__link">
    <span class="md-ellipsis">
      Job type: foreach
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Job type: foreach">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#payload_7" class="md-nav__link">
    <span class="md-ellipsis">
      Payload
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parameters_7" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#foreach-value-generators" class="md-nav__link">
    <span class="md-ellipsis">
      Foreach Value Generators
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#allowing-foreach-child-jobs-to-fail" class="md-nav__link">
    <span class="md-ellipsis">
      Allowing Child Jobs to Fail
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#handling-of-globals_3" class="md-nav__link">
    <span class="md-ellipsis">
      Handling of Globals
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dev-mode-behaviour_7" class="md-nav__link">
    <span class="md-ellipsis">
      Dev Mode Behaviour
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#job-type-lavasched" class="md-nav__link">
    <span class="md-ellipsis">
      Job type: lavasched
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Job type: lavasched">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#payload_8" class="md-nav__link">
    <span class="md-ellipsis">
      Payload
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parameters_8" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cron-and-path" class="md-nav__link">
    <span class="md-ellipsis">
      Cron and PATH
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dev-mode-behaviour_8" class="md-nav__link">
    <span class="md-ellipsis">
      Dev Mode Behaviour
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#examples_6" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#job-type-log" class="md-nav__link">
    <span class="md-ellipsis">
      Job type: log
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Job type: log">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dev-mode-behaviour_9" class="md-nav__link">
    <span class="md-ellipsis">
      Dev Mode Behaviour
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#job-type-pkg" class="md-nav__link">
    <span class="md-ellipsis">
      Job type: pkg
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Job type: pkg">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#payload_9" class="md-nav__link">
    <span class="md-ellipsis">
      Payload
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#environment_3" class="md-nav__link">
    <span class="md-ellipsis">
      Environment
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parameters_9" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jinja-rendering-of-the-arguments-and-environment_2" class="md-nav__link">
    <span class="md-ellipsis">
      Jinja Rendering of the Arguments and Environment
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#connection-handling_2" class="md-nav__link">
    <span class="md-ellipsis">
      Connection Handling
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dev-mode-behaviour_10" class="md-nav__link">
    <span class="md-ellipsis">
      Dev Mode Behaviour
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#examples_7" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#job-type-redshift_unload" class="md-nav__link">
    <span class="md-ellipsis">
      Job type: redshift_unload
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Job type: redshift_unload">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#payload_10" class="md-nav__link">
    <span class="md-ellipsis">
      Payload
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parameters_10" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#handling-of-redshift-unload-options" class="md-nav__link">
    <span class="md-ellipsis">
      Redshift Unload Options
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#date-formatting" class="md-nav__link">
    <span class="md-ellipsis">
      Date Formatting
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jinja-rendering-of-the-s3-target-key" class="md-nav__link">
    <span class="md-ellipsis">
      Jinja Rendering of the S3 Key
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#s3-bucket-security-checks" class="md-nav__link">
    <span class="md-ellipsis">
      S3 Bucket Security Checks
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dev-mode-behaviour_11" class="md-nav__link">
    <span class="md-ellipsis">
      Dev Mode Behaviour
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#examples_8" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#job-type-sharepoint_get_doc" class="md-nav__link">
    <span class="md-ellipsis">
      Job type: sharepoint_get_doc
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Job type: sharepoint_get_doc">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#payload_11" class="md-nav__link">
    <span class="md-ellipsis">
      Payload
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parameters_11" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jinja-rendering-of-parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Jinja Rendering of Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dev-mode-behaviour_12" class="md-nav__link">
    <span class="md-ellipsis">
      Dev Mode Behaviour
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#examples_9" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#job-type-sharepoint_get_list" class="md-nav__link">
    <span class="md-ellipsis">
      Job type: sharepoint_get_list
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Job type: sharepoint_get_list">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#payload_12" class="md-nav__link">
    <span class="md-ellipsis">
      Payload
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parameters_12" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#handling-of-personorgroup-columns" class="md-nav__link">
    <span class="md-ellipsis">
      Person-Or-Group Columns
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jinja-rendering-of-parameters_1" class="md-nav__link">
    <span class="md-ellipsis">
      Jinja Rendering of Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dev-mode-behaviour_13" class="md-nav__link">
    <span class="md-ellipsis">
      Dev Mode Behaviour
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#examples_10" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#job-type-sharepoint_get_multi_doc" class="md-nav__link">
    <span class="md-ellipsis">
      Job type: sharepoint_get_multi_doc
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Job type: sharepoint_get_multi_doc">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#payload_13" class="md-nav__link">
    <span class="md-ellipsis">
      Payload
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parameters_13" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jinja-rendering-of-parameters_2" class="md-nav__link">
    <span class="md-ellipsis">
      Jinja Rendering of Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dev-mode-behaviour_14" class="md-nav__link">
    <span class="md-ellipsis">
      Dev Mode Behaviour
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#examples_11" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#job-type-sharepoint_put_doc" class="md-nav__link">
    <span class="md-ellipsis">
      Job type: sharepoint_put_doc
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Job type: sharepoint_put_doc">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#payload_14" class="md-nav__link">
    <span class="md-ellipsis">
      Payload
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parameters_14" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jinja-rendering-of-parameters_3" class="md-nav__link">
    <span class="md-ellipsis">
      Jinja Rendering of Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dev-mode-behaviour_15" class="md-nav__link">
    <span class="md-ellipsis">
      Dev Mode Behaviour
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#examples_12" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#job-type-sharepoint_put_list" class="md-nav__link">
    <span class="md-ellipsis">
      Job type: sharepoint_put_list
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Job type: sharepoint_put_list">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#payload_15" class="md-nav__link">
    <span class="md-ellipsis">
      Payload
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parameters_15" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#handling-of-personorgroup-columns_1" class="md-nav__link">
    <span class="md-ellipsis">
      Person-Or-Group Columns
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jinja-rendering-of-parameters_4" class="md-nav__link">
    <span class="md-ellipsis">
      Jinja Rendering of Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dev-mode-behaviour_16" class="md-nav__link">
    <span class="md-ellipsis">
      Dev Mode Behaviour
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#examples_13" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#job-type-smb_get" class="md-nav__link">
    <span class="md-ellipsis">
      Job type: smb_get
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Job type: smb_get">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#payload_16" class="md-nav__link">
    <span class="md-ellipsis">
      Payload
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parameters_16" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jinja-rendering-of-parameters_5" class="md-nav__link">
    <span class="md-ellipsis">
      Jinja Rendering of Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dev-mode-behaviour_17" class="md-nav__link">
    <span class="md-ellipsis">
      Dev Mode Behaviour
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#examples_14" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#job-type-smb_put" class="md-nav__link">
    <span class="md-ellipsis">
      Job type: smb_put
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Job type: smb_put">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#payload_17" class="md-nav__link">
    <span class="md-ellipsis">
      Payload
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parameters_17" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jinja-rendering-of-parameters_6" class="md-nav__link">
    <span class="md-ellipsis">
      Jinja Rendering of Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dev-mode-behaviour_18" class="md-nav__link">
    <span class="md-ellipsis">
      Dev Mode Behaviour
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#examples_15" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#job-type-sql" class="md-nav__link">
    <span class="md-ellipsis">
      Job type: sql
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Job type: sql">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#payload_18" class="md-nav__link">
    <span class="md-ellipsis">
      Payload
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parameters_18" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jinja-rendering-of-the-payload_1" class="md-nav__link">
    <span class="md-ellipsis">
      Jinja Rendering of the Payload
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#output-data" class="md-nav__link">
    <span class="md-ellipsis">
      Output Data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dev-mode-behaviour_19" class="md-nav__link">
    <span class="md-ellipsis">
      Dev Mode Behaviour
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#examples_16" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#job-type-sqlc" class="md-nav__link">
    <span class="md-ellipsis">
      Job type: sqlc
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Job type: sqlc">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#payload_19" class="md-nav__link">
    <span class="md-ellipsis">
      Payload
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parameters_19" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jinja-rendering-of-the-payload_2" class="md-nav__link">
    <span class="md-ellipsis">
      Jinja Rendering of the Payload
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dev-mode-behaviour_20" class="md-nav__link">
    <span class="md-ellipsis">
      Dev Mode Behaviour
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#examples_17" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#job-type-sqli" class="md-nav__link">
    <span class="md-ellipsis">
      Job type: sqli
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Job type: sqli">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#payload_20" class="md-nav__link">
    <span class="md-ellipsis">
      Payload
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parameters_20" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#output-data_1" class="md-nav__link">
    <span class="md-ellipsis">
      Output Data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jinja-rendering-of-the-payload_3" class="md-nav__link">
    <span class="md-ellipsis">
      Jinja Rendering of the Payload
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dev-mode-behaviour_21" class="md-nav__link">
    <span class="md-ellipsis">
      Dev Mode Behaviour
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#examples_18" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#job-type-sqlv" class="md-nav__link">
    <span class="md-ellipsis">
      Job type: sqlv
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Job type: sqlv">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#payload_21" class="md-nav__link">
    <span class="md-ellipsis">
      Payload
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parameters_21" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jinja-rendering-of-the-payload_4" class="md-nav__link">
    <span class="md-ellipsis">
      Jinja Rendering of the Payload
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dev-mode-behaviour_22" class="md-nav__link">
    <span class="md-ellipsis">
      Dev Mode Behaviour
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#examples_19" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="07-connectors.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Connectors
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="08-job-actions.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Job Actions
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="09-lava-state-manager.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lava State Manager
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="10-installation-operation.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Installation & Operation
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="11-lava-job-framework.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lava Job Framework
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="12-developing-lava-jobs.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Developing Lava Jobs
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="13-jinja-rendering-in-lava.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Jinja Rendering in Lava
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="14-enhancing-lava.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Enhancing Lava
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="15-lava-and-docker.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lava and Docker
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="16-commands-utilities.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Commands & Utilities
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="17-job-framework-samples.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Job Framework Samples
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="18-api.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    API
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="19-cloudformation-templates.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CloudFormation Templates
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="20-faq.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    FAQ
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="21-release-notes.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Release Notes
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="22-credits.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Credits
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="23-known-issues.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Known Issues
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#job-families" class="md-nav__link">
    <span class="md-ellipsis">
      Job Families
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#job-payloads" class="md-nav__link">
    <span class="md-ellipsis">
      Job Payloads
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Job Payloads">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#s3-payloads" class="md-nav__link">
    <span class="md-ellipsis">
      S3 Payloads
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#job-retries" class="md-nav__link">
    <span class="md-ellipsis">
      Job Retries
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Job Retries">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#job-actions-for-retries" class="md-nav__link">
    <span class="md-ellipsis">
      Job Actions for Retries
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lava-job-retries-iterations-vs-sqs-resubmissions" class="md-nav__link">
    <span class="md-ellipsis">
      Retries vs Resubmissions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#choosing-an-sql-job-type" class="md-nav__link">
    <span class="md-ellipsis">
      Choosing an SQL Job Type
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#job-type-chain" class="md-nav__link">
    <span class="md-ellipsis">
      Job type: chain
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Job type: chain">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#payload" class="md-nav__link">
    <span class="md-ellipsis">
      Payload
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#allowing-child-jobs-to-fail" class="md-nav__link">
    <span class="md-ellipsis">
      Allowing Child Jobs to Fail
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#handling-of-globals" class="md-nav__link">
    <span class="md-ellipsis">
      Handling of Globals
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dev-mode-behaviour" class="md-nav__link">
    <span class="md-ellipsis">
      Dev Mode Behaviour
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#examples" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#job-type-cmd" class="md-nav__link">
    <span class="md-ellipsis">
      Job type: cmd
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Job type: cmd">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#payload_1" class="md-nav__link">
    <span class="md-ellipsis">
      Payload
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#environment" class="md-nav__link">
    <span class="md-ellipsis">
      Environment
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parameters_1" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jinja-rendering-of-the-payload-and-environment" class="md-nav__link">
    <span class="md-ellipsis">
      Jinja Rendering of the Payload and Environment
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dev-mode-behaviour_1" class="md-nav__link">
    <span class="md-ellipsis">
      Dev Mode Behaviour
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#examples_1" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#job-type-dag" class="md-nav__link">
    <span class="md-ellipsis">
      Job type: dag
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Job type: dag">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#payload_2" class="md-nav__link">
    <span class="md-ellipsis">
      Payload
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parameters_2" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#allowing-child-jobs-to-fail_1" class="md-nav__link">
    <span class="md-ellipsis">
      Allowing Child Jobs to Fail
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#handling-of-globals_1" class="md-nav__link">
    <span class="md-ellipsis">
      Handling of Globals
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dev-mode-behaviour_2" class="md-nav__link">
    <span class="md-ellipsis">
      Dev Mode Behaviour
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#examples_2" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#job-type-db_from_s3" class="md-nav__link">
    <span class="md-ellipsis">
      Job type: db_from_s3
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Job type: db_from_s3">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#payload_3" class="md-nav__link">
    <span class="md-ellipsis">
      Payload
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parameters_3" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jinja-rendering-of-the-bucket-key-schema-and-table" class="md-nav__link">
    <span class="md-ellipsis">
      Jinja Rendering of the Bucket, Key, Schema and Table
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriving-target-schema-and-table-name-from-the-s3-key" class="md-nav__link">
    <span class="md-ellipsis">
      Deriving Target Schema and Table Name from the S3 Key
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#copy-modes" class="md-nav__link">
    <span class="md-ellipsis">
      Copy Modes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#event-driven-loading" class="md-nav__link">
    <span class="md-ellipsis">
      Event Driven Loading
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dev-mode-behaviour_3" class="md-nav__link">
    <span class="md-ellipsis">
      Dev Mode Behaviour
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#moving-data-from-redshift-to-other-databases" class="md-nav__link">
    <span class="md-ellipsis">
      Moving Data from Redshift to Other Databases
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#loading-data-to-aurora-mysql" class="md-nav__link">
    <span class="md-ellipsis">
      Loading Data to Aurora MySQL
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#loading-data-to-aurora-postgres" class="md-nav__link">
    <span class="md-ellipsis">
      Loading Data to Aurora Postgres
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#loading-data-to-oracle" class="md-nav__link">
    <span class="md-ellipsis">
      Loading Data to Oracle
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#loading-data-to-postgres" class="md-nav__link">
    <span class="md-ellipsis">
      Loading Data to Postgres
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#loading-data-to-postgres-rds" class="md-nav__link">
    <span class="md-ellipsis">
      Loading Data to Postgres RDS
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#loading-data-to-redshift" class="md-nav__link">
    <span class="md-ellipsis">
      Loading Data to Redshift
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#loading-data-to-sqlite3" class="md-nav__link">
    <span class="md-ellipsis">
      Loading Data to SQLite3
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#job-type-dispatch" class="md-nav__link">
    <span class="md-ellipsis">
      Job type: dispatch
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Job type: dispatch">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#payload_4" class="md-nav__link">
    <span class="md-ellipsis">
      Payload
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parameters_4" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#handling-of-globals_2" class="md-nav__link">
    <span class="md-ellipsis">
      Handling of Globals
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jinja-rendering-of-the-payload" class="md-nav__link">
    <span class="md-ellipsis">
      Jinja Rendering of the Payload
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dev-mode-behaviour_4" class="md-nav__link">
    <span class="md-ellipsis">
      Dev Mode Behaviour
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#examples_3" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#job-type-docker" class="md-nav__link">
    <span class="md-ellipsis">
      Job type: docker
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Job type: docker">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#payload_5" class="md-nav__link">
    <span class="md-ellipsis">
      Payload
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#environment_1" class="md-nav__link">
    <span class="md-ellipsis">
      Environment
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#docker-runtime-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Docker Runtime Configuration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parameters_5" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#connecting-to-docker" class="md-nav__link">
    <span class="md-ellipsis">
      Connecting to Docker
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#container-host-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Container Host Configuration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jinja-rendering-of-the-arguments-and-environment" class="md-nav__link">
    <span class="md-ellipsis">
      Jinja Rendering of the Arguments and Environment
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#connection-handling" class="md-nav__link">
    <span class="md-ellipsis">
      Connection Handling
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dev-mode-behaviour_5" class="md-nav__link">
    <span class="md-ellipsis">
      Dev Mode Behaviour
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#examples_4" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#job-type-exe" class="md-nav__link">
    <span class="md-ellipsis">
      Job type: exe
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Job type: exe">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#payload_6" class="md-nav__link">
    <span class="md-ellipsis">
      Payload
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#environment_2" class="md-nav__link">
    <span class="md-ellipsis">
      Environment
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parameters_6" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jinja-rendering-of-the-arguments-and-environment_1" class="md-nav__link">
    <span class="md-ellipsis">
      Jinja Rendering of the Arguments and Environment
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#connection-handling_1" class="md-nav__link">
    <span class="md-ellipsis">
      Connection Handling
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dev-mode-behaviour_6" class="md-nav__link">
    <span class="md-ellipsis">
      Dev Mode Behaviour
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#examples_5" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#job-type-foreach" class="md-nav__link">
    <span class="md-ellipsis">
      Job type: foreach
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Job type: foreach">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#payload_7" class="md-nav__link">
    <span class="md-ellipsis">
      Payload
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parameters_7" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#foreach-value-generators" class="md-nav__link">
    <span class="md-ellipsis">
      Foreach Value Generators
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#allowing-foreach-child-jobs-to-fail" class="md-nav__link">
    <span class="md-ellipsis">
      Allowing Child Jobs to Fail
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#handling-of-globals_3" class="md-nav__link">
    <span class="md-ellipsis">
      Handling of Globals
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dev-mode-behaviour_7" class="md-nav__link">
    <span class="md-ellipsis">
      Dev Mode Behaviour
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#job-type-lavasched" class="md-nav__link">
    <span class="md-ellipsis">
      Job type: lavasched
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Job type: lavasched">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#payload_8" class="md-nav__link">
    <span class="md-ellipsis">
      Payload
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parameters_8" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cron-and-path" class="md-nav__link">
    <span class="md-ellipsis">
      Cron and PATH
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dev-mode-behaviour_8" class="md-nav__link">
    <span class="md-ellipsis">
      Dev Mode Behaviour
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#examples_6" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#job-type-log" class="md-nav__link">
    <span class="md-ellipsis">
      Job type: log
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Job type: log">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dev-mode-behaviour_9" class="md-nav__link">
    <span class="md-ellipsis">
      Dev Mode Behaviour
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#job-type-pkg" class="md-nav__link">
    <span class="md-ellipsis">
      Job type: pkg
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Job type: pkg">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#payload_9" class="md-nav__link">
    <span class="md-ellipsis">
      Payload
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#environment_3" class="md-nav__link">
    <span class="md-ellipsis">
      Environment
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parameters_9" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jinja-rendering-of-the-arguments-and-environment_2" class="md-nav__link">
    <span class="md-ellipsis">
      Jinja Rendering of the Arguments and Environment
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#connection-handling_2" class="md-nav__link">
    <span class="md-ellipsis">
      Connection Handling
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dev-mode-behaviour_10" class="md-nav__link">
    <span class="md-ellipsis">
      Dev Mode Behaviour
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#examples_7" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#job-type-redshift_unload" class="md-nav__link">
    <span class="md-ellipsis">
      Job type: redshift_unload
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Job type: redshift_unload">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#payload_10" class="md-nav__link">
    <span class="md-ellipsis">
      Payload
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parameters_10" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#handling-of-redshift-unload-options" class="md-nav__link">
    <span class="md-ellipsis">
      Redshift Unload Options
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#date-formatting" class="md-nav__link">
    <span class="md-ellipsis">
      Date Formatting
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jinja-rendering-of-the-s3-target-key" class="md-nav__link">
    <span class="md-ellipsis">
      Jinja Rendering of the S3 Key
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#s3-bucket-security-checks" class="md-nav__link">
    <span class="md-ellipsis">
      S3 Bucket Security Checks
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dev-mode-behaviour_11" class="md-nav__link">
    <span class="md-ellipsis">
      Dev Mode Behaviour
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#examples_8" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#job-type-sharepoint_get_doc" class="md-nav__link">
    <span class="md-ellipsis">
      Job type: sharepoint_get_doc
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Job type: sharepoint_get_doc">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#payload_11" class="md-nav__link">
    <span class="md-ellipsis">
      Payload
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parameters_11" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jinja-rendering-of-parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Jinja Rendering of Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dev-mode-behaviour_12" class="md-nav__link">
    <span class="md-ellipsis">
      Dev Mode Behaviour
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#examples_9" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#job-type-sharepoint_get_list" class="md-nav__link">
    <span class="md-ellipsis">
      Job type: sharepoint_get_list
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Job type: sharepoint_get_list">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#payload_12" class="md-nav__link">
    <span class="md-ellipsis">
      Payload
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parameters_12" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#handling-of-personorgroup-columns" class="md-nav__link">
    <span class="md-ellipsis">
      Person-Or-Group Columns
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jinja-rendering-of-parameters_1" class="md-nav__link">
    <span class="md-ellipsis">
      Jinja Rendering of Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dev-mode-behaviour_13" class="md-nav__link">
    <span class="md-ellipsis">
      Dev Mode Behaviour
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#examples_10" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#job-type-sharepoint_get_multi_doc" class="md-nav__link">
    <span class="md-ellipsis">
      Job type: sharepoint_get_multi_doc
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Job type: sharepoint_get_multi_doc">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#payload_13" class="md-nav__link">
    <span class="md-ellipsis">
      Payload
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parameters_13" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jinja-rendering-of-parameters_2" class="md-nav__link">
    <span class="md-ellipsis">
      Jinja Rendering of Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dev-mode-behaviour_14" class="md-nav__link">
    <span class="md-ellipsis">
      Dev Mode Behaviour
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#examples_11" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#job-type-sharepoint_put_doc" class="md-nav__link">
    <span class="md-ellipsis">
      Job type: sharepoint_put_doc
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Job type: sharepoint_put_doc">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#payload_14" class="md-nav__link">
    <span class="md-ellipsis">
      Payload
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parameters_14" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jinja-rendering-of-parameters_3" class="md-nav__link">
    <span class="md-ellipsis">
      Jinja Rendering of Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dev-mode-behaviour_15" class="md-nav__link">
    <span class="md-ellipsis">
      Dev Mode Behaviour
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#examples_12" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#job-type-sharepoint_put_list" class="md-nav__link">
    <span class="md-ellipsis">
      Job type: sharepoint_put_list
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Job type: sharepoint_put_list">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#payload_15" class="md-nav__link">
    <span class="md-ellipsis">
      Payload
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parameters_15" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#handling-of-personorgroup-columns_1" class="md-nav__link">
    <span class="md-ellipsis">
      Person-Or-Group Columns
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jinja-rendering-of-parameters_4" class="md-nav__link">
    <span class="md-ellipsis">
      Jinja Rendering of Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dev-mode-behaviour_16" class="md-nav__link">
    <span class="md-ellipsis">
      Dev Mode Behaviour
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#examples_13" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#job-type-smb_get" class="md-nav__link">
    <span class="md-ellipsis">
      Job type: smb_get
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Job type: smb_get">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#payload_16" class="md-nav__link">
    <span class="md-ellipsis">
      Payload
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parameters_16" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jinja-rendering-of-parameters_5" class="md-nav__link">
    <span class="md-ellipsis">
      Jinja Rendering of Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dev-mode-behaviour_17" class="md-nav__link">
    <span class="md-ellipsis">
      Dev Mode Behaviour
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#examples_14" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#job-type-smb_put" class="md-nav__link">
    <span class="md-ellipsis">
      Job type: smb_put
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Job type: smb_put">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#payload_17" class="md-nav__link">
    <span class="md-ellipsis">
      Payload
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parameters_17" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jinja-rendering-of-parameters_6" class="md-nav__link">
    <span class="md-ellipsis">
      Jinja Rendering of Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dev-mode-behaviour_18" class="md-nav__link">
    <span class="md-ellipsis">
      Dev Mode Behaviour
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#examples_15" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#job-type-sql" class="md-nav__link">
    <span class="md-ellipsis">
      Job type: sql
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Job type: sql">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#payload_18" class="md-nav__link">
    <span class="md-ellipsis">
      Payload
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parameters_18" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jinja-rendering-of-the-payload_1" class="md-nav__link">
    <span class="md-ellipsis">
      Jinja Rendering of the Payload
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#output-data" class="md-nav__link">
    <span class="md-ellipsis">
      Output Data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dev-mode-behaviour_19" class="md-nav__link">
    <span class="md-ellipsis">
      Dev Mode Behaviour
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#examples_16" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#job-type-sqlc" class="md-nav__link">
    <span class="md-ellipsis">
      Job type: sqlc
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Job type: sqlc">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#payload_19" class="md-nav__link">
    <span class="md-ellipsis">
      Payload
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parameters_19" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jinja-rendering-of-the-payload_2" class="md-nav__link">
    <span class="md-ellipsis">
      Jinja Rendering of the Payload
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dev-mode-behaviour_20" class="md-nav__link">
    <span class="md-ellipsis">
      Dev Mode Behaviour
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#examples_17" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#job-type-sqli" class="md-nav__link">
    <span class="md-ellipsis">
      Job type: sqli
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Job type: sqli">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#payload_20" class="md-nav__link">
    <span class="md-ellipsis">
      Payload
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parameters_20" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#output-data_1" class="md-nav__link">
    <span class="md-ellipsis">
      Output Data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jinja-rendering-of-the-payload_3" class="md-nav__link">
    <span class="md-ellipsis">
      Jinja Rendering of the Payload
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dev-mode-behaviour_21" class="md-nav__link">
    <span class="md-ellipsis">
      Dev Mode Behaviour
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#examples_18" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#job-type-sqlv" class="md-nav__link">
    <span class="md-ellipsis">
      Job type: sqlv
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Job type: sqlv">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#payload_21" class="md-nav__link">
    <span class="md-ellipsis">
      Payload
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parameters_21" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jinja-rendering-of-the-payload_4" class="md-nav__link">
    <span class="md-ellipsis">
      Jinja Rendering of the Payload
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dev-mode-behaviour_22" class="md-nav__link">
    <span class="md-ellipsis">
      Dev Mode Behaviour
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#examples_19" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="jobs-and-job-types" x-nav="Jobs &amp; Job Types">Jobs and Job Types<a class="headerlink" href="#jobs-and-job-types" title="Permanent link">&para;</a></h1>
<p>A lava job is a static definition represented as an entry in the
<a href="04-dynamodb-tables.html#the-jobs-table">jobs</a> table. Each invocation of a job is
referred to as a <em>run</em> which has a unique <code>run_id</code>.</p>
<p>The <code>run_id</code> is used in construction of prefixes for job outputs in S3 as well
as in event records in the <a href="04-dynamodb-tables.html#the-connections-table">events</a>
table.</p>
<p>Various job types are supported, depending on the kind of processing required.
Each job type has its own requirements for the <code>parameters</code> field in the job
specification.</p>
<p>Jobs can be run in either <em>normal</em> mode or in <em>dev</em> mode by specifying the
<code>--dev</code> argument when invoking the lava worker. In dev mode, the behaviour of
the job may by slightly altered to assist with job development and debugging
without changing the fundamental action of the job. The specifics are job
type dependent.</p>
<p>If the <a href="10-installation-operation.html#general-configuration-parameters">DEBUG configuration
variable</a> is set to <code>true</code>,
some additional information is added to the event records for failed jobs.</p>
<h2 id="job-families">Job Families<a class="headerlink" href="#job-families" title="Permanent link">&para;</a></h2>
<p>Jobs types can be roughly grouped into the following families.</p>
<ul>
<li>
<p><strong>Orchestration jobs</strong> that control the operation of other jobs:</p>
<ul>
<li><a href="#job-type-chain">chain</a></li>
<li><a href="#job-type-dag">dag</a></li>
<li><a href="#job-type-dispatch">dispatch</a></li>
<li><a href="#job-type-foreach">foreach</a></li>
</ul>
</li>
<li>
<p><strong>Database jobs</strong> that interact with a database to run SQL or load / unload
    data:</p>
<ul>
<li><a href="#job-type-db_from_s3">db_from_s3</a></li>
<li><a href="#job-type-redshift_unload">redshift_unload</a></li>
<li><a href="#job-type-sql">sql</a></li>
<li><a href="#job-type-sqlc">sqlc</a></li>
<li><a href="#job-type-sqli">sqli</a></li>
<li><a href="#job-type-sqlv">sqlv</a></li>
</ul>
<p>See also <a href="#choosing-an-sql-job-type">Choosing an SQL Job Type</a>.</p>
</li>
<li>
<p><strong>Executable jobs</strong> that run a code bundle external to lava itself:</p>
<ul>
<li><a href="#job-type-cmd">cmd</a></li>
<li><a href="#job-type-docker">docker</a></li>
<li><a href="#job-type-exe">exe</a></li>
<li><a href="#job-type-pkg">pkg</a></li>
</ul>
</li>
<li>
<p><strong>Integration jobs</strong> that interact with an external system of some kind:</p>
<ul>
<li><a href="#job-type-sharepoint_get_doc">sharepoint_get_doc</a></li>
<li><a href="#job-type-sharepoint_get_list">sharepoint_get_list</a></li>
<li><a href="#job-type-sharepoint_get_multi_doc">sharepoint_get_multi_doc</a></li>
<li><a href="#job-type-sharepoint_put_doc">sharepoint_put_doc</a></li>
<li><a href="#job-type-sharepoint_put_list">sharepoint_put_list</a></li>
<li><a href="#job-type-smb_get">smb_get</a></li>
<li><a href="#job-type-smb_put">smb_put</a></li>
</ul>
</li>
<li>
<p><strong>Lava internal jobs</strong> that lava uses for it's own operations:</p>
<ul>
<li><a href="#job-type-lavasched">lavasched</a></li>
</ul>
</li>
<li>
<p><strong>Miscellaneous jobs</strong> that don't fit the above:</p>
<ul>
<li><a href="#job-type-log">log</a></li>
</ul>
</li>
</ul>
<h2 id="job-payloads">Job Payloads<a class="headerlink" href="#job-payloads" title="Permanent link">&para;</a></h2>
<p>Some job types have some kind of associated payload. Payloads are specified by
the mandatory <code>payload</code> field in the <a href="04-dynamodb-tables.html#the-jobs-table">job specification</a>.</p>
<p>Payloads are job type specific and can be of the following types:</p>
<ul>
<li>
<p><strong><a href="#s3-payloads">S3 based payloads</a></strong>: The <code>payload</code> field will point to
    location(s) in S3 that the lava worker will download at run-time. These are
    typically things such as code bundles, SQL scripts etc.</p>
</li>
<li>
<p><strong>Inline payloads</strong>: The <code>payload</code> field will contain the actual payload.
    These may be things like single CLI commands, small in-line SQL scripts,
    docker repository names etc.</p>
</li>
<li>
<p><strong>No payload</strong>: Some job types (e.g. <a href="#job-type-log">log</a>) don't require a
    payload and hence the value of the <code>payload</code> field is ignored. (As an
    accident of history, the field is still required but it can be set to
    anything. A value of <code>--</code> or <code>null</code> is common usage.)</p>
</li>
</ul>
<h3 id="s3-payloads">S3 Payloads<a class="headerlink" href="#s3-payloads" title="Permanent link">&para;</a></h3>
<p>Prior to version 7.1.0
(<a href="https://en.wikipedia.org/wiki/https://en.wikipedia.org/wiki/Pichincha_(volcano)">Pichincha</a>),
the S3 payload downloader was the <a href="#the-v1-payload-downloader">v1 downloader</a>.</p>
<p>As of version 7.1.0
(<a href="https://en.wikipedia.org/wiki/https://en.wikipedia.org/wiki/Pichincha_(volcano)">Pichincha</a>),
there is an additional <a href="#the-v2-payload-downloader">v2 downloader</a>.</p>
<p>Only one version of the downloader is active on any lava worker.</p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>As of version 8.1.0 (<a href="https://en.wikipedia.org/wiki/Klauea">Klauea</a>), the
<a href="#the-v2-payload-downloader">v2 downloader</a> is the default and the
<a href="#the-v1-payload-downloader">v1 downloader</a> is deprecated.</p>
</div>
<p>The <a href="#the-v1-payload-downloader">v1 downloader</a> can be enabled by setting the
<a href="10-installation-operation.html#general-configuration-parameters"><code>PAYLOAD_DOWNLOADER</code></a> worker configuration
parameter to <code>v1</code>. See <a href="10-installation-operation.html#lava-worker-configuration">Lava Worker Configuration</a>
for more details.</p>
<h4 id="the-v1-payload-downloader">The v1 Payload Downloader<a class="headerlink" href="#the-v1-payload-downloader" title="Permanent link">&para;</a></h4>
<p>The v1 S3 payload downloader requires the <code>payload</code> field in the <a href="04-dynamodb-tables.html#the-jobs-table">job
specification</a> to be a string that specifies a location in S3
relative to the <code>s3_payloads</code> area defined in the <a href="04-dynamodb-tables.html#the-realms-table">realms</a>
table. It can be either:</p>
<ul>
<li>
<p>an S3 object key, in which case a single S3 object is downloaded; or</p>
</li>
<li>
<p>an S3 prefix ending in <code>/</code>, in which case all objects under that prefix will
  be downloaded and made available to the job in lexicographic order.</p>
</li>
</ul>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>The download process when a prefix is specified does not recurse down the
object hierarchy in S3. All objects to be downloaded must sit directly under
that prefix. The job will abort with an error if there are any sub-prefixes.</p>
</div>
<p>A typical job specification might contain something like this:</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-0-1"><span class="p">{</span>
</span><span id="__span-0-2"><span class="w">  </span><span class="nt">&quot;payload&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;app/whatever/query-some-stuff.sql&quot;</span>
</span><span id="__span-0-3"><span class="p">}</span>
</span></code></pre></div>
<p>... or this:</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-1-1"><span class="p">{</span>
</span><span id="__span-1-2"><span class="w">  </span><span class="nt">&quot;payload&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;app/whatever/lots-of-sqls/&quot;</span>
</span><span id="__span-1-3"><span class="p">}</span>
</span></code></pre></div>
<h4 id="the-v2-payload-downloader">The v2 Payload Downloader<a class="headerlink" href="#the-v2-payload-downloader" title="Permanent link">&para;</a></h4>
<p>If the  <code>payload</code> field in the <a href="04-dynamodb-tables.html#the-jobs-table">job specification</a> is a string,
the v2 S3 payload downloader behaves the same as the 
<a href="#the-v1-payload-downloader">v1 downloader</a>, with one minor exception. If the
string is a prefix containing sub-prefixes, the
<a href="#the-v1-payload-downloader">v1 downloader</a> aborts with an error whereas the
<a href="#the-v2-payload-downloader">v2 downloader</a> silently ignores the sub-prefixes.</p>
<p>In v2, the <code>payload</code> field may also be a list of strings. These are processed
in the specified order, using the same mechanism as the
<a href="#the-v1-payload-downloader">v1 downloader</a> and the combined list of downloaded
objects is made available to the job. The download process does not recurse into
sub-prefixes which are silently ignored.</p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>Lava places the files resulting from each item in the list in a separate
private directory to avoid name clashes. There is no way a payload file can
know the location of any other payload file that isn't part of the same list
item.</p>
</div>
<h2 id="job-retries">Job Retries<a class="headerlink" href="#job-retries" title="Permanent link">&para;</a></h2>
<p>By default, lava will make one attempt to run a job once dispatched and the job
will then either succeed or fail.</p>
<p>As of v6.1.0 (Volcn Pinta), lava supports a job retry mechanism that can retry
a failed job one or more times. This process is controlled by the following
fields in the <a href="04-dynamodb-tables.html#the-jobs-table">job specification</a>:</p>
<ul>
<li>
<p><code>iteration_limit</code>: specifies maximum number of attempts that will be made to
    run the job successfully before giving up</p>
</li>
<li>
<p><code>iteration_delay</code>: The delay between run attempts.</p>
</li>
</ul>
<p>The job will be re-run until either it succeeds or the <code>iteration_limit</code> is
reached. Lava makes an additional
<a href="05-job-dispatch.html#globals-owned-by-lava">globals.lava.iteration</a> global
available for use with run-time Jinja rendering of job and action fields.</p>
<p>A single worker thread remains committed to the job for the entirety of the
retry process so it is important to use the retry mechanism sensibly.</p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>The entire duration of the retry process must fit within the queue
visibility timeout of the worker SQS queue or else SQS itself will resubmit
the dispatch message, with the same run ID, while the first job is still
running. This is not ideal.</p>
</div>
<h3 id="job-actions-for-retries">Job Actions for Retries<a class="headerlink" href="#job-actions-for-retries" title="Permanent link">&para;</a></h3>
<p>Lava makes the <a href="08-job-actions.html#job-actions">on_retry</a> job action available
for situations where a job fails but will be retried in another iteration.</p>
<p>For example, if a job has an <code>iteration_count</code> of 2, and both attempts fail, the
<code>on_retry</code> actions will be executed after the first iteration and the <code>on_fail</code>
actions will be executed after the second and final iteration.</p>
<h3 id="lava-job-retries-iterations-vs-sqs-resubmissions">Lava Job Retries (Iterations) vs SQS Resubmissions<a class="headerlink" href="#lava-job-retries-iterations-vs-sqs-resubmissions" title="Permanent link">&para;</a></h3>
<p>The <a href="04-dynamodb-tables.html#the-jobs-table">job specification</a> contains both
<code>iterations_*</code> related fields and a <code>max_tries</code> fields.</p>
<p>The <code>iterations_*</code> related fields control internal job retry within the lava
worker.</p>
<p>The <code>max_tries</code> field controls how many times SQS is permitted to resubmit the
same dispatch message due to SQS queue visibility timeouts before it is
discarded by the lava worker.</p>
<h2 id="choosing-an-sql-job-type">Choosing an SQL Job Type<a class="headerlink" href="#choosing-an-sql-job-type" title="Permanent link">&para;</a></h2>
<p>Lava provides the following SQL jobs types:</p>
<ul>
<li>
<p><a href="#job-type-sql">sql</a></p>
</li>
<li>
<p><a href="#job-type-sqlc">sqlc</a></p>
</li>
<li>
<p><a href="#job-type-sqli">sqli</a></p>
</li>
<li>
<p><a href="#job-type-sqlv">sqlv</a>.</p>
</li>
</ul>
<p>All of these will run blobs of SQL against a relational database using a lava
<a href="07-connectors.html#database-connectors">database connector</a> to connect to the
target database. Each job type has unique characteristics that make it more or
less suited for a given context.</p>
<p>The following table compares the job types as well as the stand-alone
<a href="16-commands-utilities.html#lava-sql-utility">lava-sql</a> CLI utility:</p>
<table>
<thead>
<tr>
<th>Feature</th>
<th style="text-align: center;">sql</th>
<th style="text-align: center;">sqli</th>
<th style="text-align: center;">sqlc</th>
<th style="text-align: center;">sqlv</th>
<th style="text-align: center;">lava-sql</th>
</tr>
</thead>
<tbody>
<tr>
<td>Runs inside the lava worker</td>
<td style="text-align: center;">*</td>
<td style="text-align: center;">*</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
<tr>
<td>Runs outside the lava worker</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;">*</td>
<td style="text-align: center;">*</td>
<td style="text-align: center;">*</td>
</tr>
<tr>
<td>Uniform, lava provided interface</td>
<td style="text-align: center;">*</td>
<td style="text-align: center;">*</td>
<td style="text-align: center;"></td>
<td style="text-align: center;">*</td>
<td style="text-align: center;">*</td>
</tr>
<tr>
<td>DB specific client</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;">*</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
<tr>
<td>Timeout supported</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;">*</td>
<td style="text-align: center;">*</td>
<td style="text-align: center;"></td>
</tr>
<tr>
<td>Can be killed on lava side</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;">*</td>
<td style="text-align: center;">*</td>
<td style="text-align: center;">*</td>
</tr>
<tr>
<td>SQL in-line in job-spec</td>
<td style="text-align: center;"></td>
<td style="text-align: center;">*</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
<tr>
<td>SQL in S3</td>
<td style="text-align: center;">*</td>
<td style="text-align: center;"></td>
<td style="text-align: center;">*</td>
<td style="text-align: center;">*</td>
<td style="text-align: center;"></td>
</tr>
<tr>
<td>Lava transaction support</td>
<td style="text-align: center;">*</td>
<td style="text-align: center;">*</td>
<td style="text-align: center;"></td>
<td style="text-align: center;">*</td>
<td style="text-align: center;"></td>
</tr>
<tr>
<td>Jinja payload rendering</td>
<td style="text-align: center;">*</td>
<td style="text-align: center;">*</td>
<td style="text-align: center;">*</td>
<td style="text-align: center;">*</td>
<td style="text-align: center;"></td>
</tr>
<tr>
<td>Run multiple SQL statements</td>
<td style="text-align: center;">*</td>
<td style="text-align: center;">*</td>
<td style="text-align: center;">*</td>
<td style="text-align: center;">*</td>
<td style="text-align: center;">*</td>
</tr>
<tr>
<td>Suitable for large jobs</td>
<td style="text-align: center;">*</td>
<td style="text-align: center;"></td>
<td style="text-align: center;">**</td>
<td style="text-align: center;">**</td>
<td style="text-align: center;">**</td>
</tr>
<tr>
<td>Lava CSV formatting control</td>
<td style="text-align: center;">*</td>
<td style="text-align: center;">*</td>
<td style="text-align: center;"></td>
<td style="text-align: center;">*</td>
<td style="text-align: center;">*</td>
</tr>
<tr>
<td>HTML output</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;">?</td>
<td style="text-align: center;"></td>
<td style="text-align: center;">*</td>
</tr>
<tr>
<td>Output column headers</td>
<td style="text-align: center;">*</td>
<td style="text-align: center;">*</td>
<td style="text-align: center;">*</td>
<td style="text-align: center;">*</td>
<td style="text-align: center;">*</td>
</tr>
<tr>
<td>Client side copy support</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;">?</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
<tr>
<td>Runs as a stand-alone utility</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;">*</td>
<td style="text-align: center;"></td>
<td style="text-align: center;">*</td>
</tr>
</tbody>
</table>
<p><code>?</code> means support depends on database client capabilities.</p>
<h2 id="job-type-chain">Job type: chain<a class="headerlink" href="#job-type-chain" title="Permanent link">&para;</a></h2>
<p>The <strong>chain</strong> job type runs a list of other jobs sequentially. Unlike the
<a href="#job-type-dispatch">dispatch</a> job type, this is a synchronous
operation. All of the jobs in the chain must be set to run on the same worker
and will all run under the <code>run_id</code> of the parent job.</p>
<p>It is possible to commence processing of a chain at an arbitrary point in the
list. This is useful when it's necessary to resume a failed chain at a mid-point.</p>
<p>Any globals available in the <strong>chain</strong> job will also be passed in the dispatch
requests to the jobs in the chain.</p>
<h3 id="payload">Payload<a class="headerlink" href="#payload" title="Permanent link">&para;</a></h3>
<p>The <code>payload</code> is either a comma separated list of <code>job_id</code>s or an actual list of
<code>job_id</code>s.</p>
<h3 id="parameters">Parameters<a class="headerlink" href="#parameters" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>can_fail</td>
<td>String <em>or</em> List[String]</td>
<td>No</td>
<td>A glob style pattern, or list of patterns specifying child jobs that are allowed to fail. See <a href="#allowing-child-jobs-to-fail">Allowing Child Jobs to Fail</a>.</td>
</tr>
<tr>
<td>job_prefix</td>
<td>String</td>
<td>No</td>
<td>Prepend the specified value to each job ID in the payload, including any job specified by the <code>start</code> parameter.</td>
</tr>
<tr>
<td>start</td>
<td>String</td>
<td>No</td>
<td>The <code>job_id</code> of the starting point in the chain. The chain will commence with the first job with the given ID.</td>
</tr>
</tbody>
</table>
<h3 id="allowing-child-jobs-to-fail">Allowing Child Jobs to Fail<a class="headerlink" href="#allowing-child-jobs-to-fail" title="Permanent link">&para;</a></h3>
<p>By default, the chain is aborted when any job in the list fails unless the
<code>can_fail</code> parameter is specified, however jobs that are not enabled will be
skipped and the chain will continue.</p>
<p>The <code>can_fail</code> parameter can be set to a glob style pattern, or list of
patterns.  A failed child job with a <code>job_id</code> that matches any of the patterns
will not cause the parent chain to fail. In this situation, it is important that
the child job handles its own <a href="08-job-actions.html#job-actions">on_fail</a> actions, as the parent
will not. Tough love.</p>
<p>This tolerance of failure does not include configuration errors on child jobs,
such as malformed job specifications, jobs sent to the wrong worker etc. These
will still cause the entire chain to fail.</p>
<div class="admonition note">
<p class="admonition-title">Keep calm</p>
<p>Before anyone gets all bitter and twisted about <em>can</em> vs <em>may</em> in
<code>can_fail</code>...  both are essentially equivalent in this crazy, modern world.
Look it up.</p>
</div>
<h3 id="handling-of-globals">Handling of Globals<a class="headerlink" href="#handling-of-globals" title="Permanent link">&para;</a></h3>
<p>The <strong>chain</strong> job type merges its globals into those of the child jobs in the
chain. A value specified in the parent <strong>chain</strong> job will override a similarly
named value in the child.</p>
<p>The <strong>chain</strong> job will also add
<a href="05-job-dispatch.html#globals-owned-by-lava">lava specific globals</a> under
<code>globals.lava</code>. These lava owned globals allow all jobs in a chain, even a 
multi-level chain, to access some common global values.</p>
<h3 id="dev-mode-behaviour">Dev Mode Behaviour<a class="headerlink" href="#dev-mode-behaviour" title="Permanent link">&para;</a></h3>
<p>The <strong>chain</strong> job behaviour is unchanged for dev mode. However, dev mode is
propagated to jobs in the chain.</p>
<h3 id="examples">Examples<a class="headerlink" href="#examples" title="Permanent link">&para;</a></h3>
<p>A basic chain:</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-2-1"><span class="p">{</span>
</span><span id="__span-2-2"><span class="w">  </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Chain, chain, chain ... Chain of tools&quot;</span><span class="p">,</span>
</span><span id="__span-2-3"><span class="w">  </span><span class="nt">&quot;dispatcher&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Sydney&quot;</span><span class="p">,</span>
</span><span id="__span-2-4"><span class="w">  </span><span class="nt">&quot;enabled&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-2-5"><span class="w">  </span><span class="nt">&quot;job_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo/chain-01&quot;</span><span class="p">,</span>
</span><span id="__span-2-6"><span class="w">  </span><span class="nt">&quot;owner&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo@somewhere.com&quot;</span><span class="p">,</span>
</span><span id="__span-2-7"><span class="w">  </span><span class="nt">&quot;parameters&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{},</span>
</span><span id="__span-2-8"><span class="w">  </span><span class="nt">&quot;payload&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-2-9"><span class="w">    </span><span class="s2">&quot;demo/job_01&quot;</span><span class="p">,</span>
</span><span id="__span-2-10"><span class="w">    </span><span class="s2">&quot;demo/job_02&quot;</span>
</span><span id="__span-2-11"><span class="w">  </span><span class="p">],</span>
</span><span id="__span-2-12"><span class="w">  </span><span class="nt">&quot;schedule&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;0 0 * * *&quot;</span><span class="p">,</span>
</span><span id="__span-2-13"><span class="w">  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;chain&quot;</span><span class="p">,</span>
</span><span id="__span-2-14"><span class="w">  </span><span class="nt">&quot;worker&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;default&quot;</span>
</span><span id="__span-2-15"><span class="p">}</span>
</span></code></pre></div>
<p>The chain with a different starting point:</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-3-1"><span class="p">{</span>
</span><span id="__span-3-2"><span class="w">  </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Chain, chain, chain ... Chain of tools&quot;</span><span class="p">,</span>
</span><span id="__span-3-3"><span class="w">  </span><span class="nt">&quot;dispatcher&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Sydney&quot;</span><span class="p">,</span>
</span><span id="__span-3-4"><span class="w">  </span><span class="nt">&quot;enabled&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-3-5"><span class="w">  </span><span class="nt">&quot;job_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo/chain-01&quot;</span><span class="p">,</span>
</span><span id="__span-3-6"><span class="w">  </span><span class="nt">&quot;owner&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo@somewhere.com&quot;</span><span class="p">,</span>
</span><span id="__span-3-7"><span class="w">  </span><span class="nt">&quot;parameters&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-3-8"><span class="w">    </span><span class="nt">&quot;start&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo/job_02&quot;</span>
</span><span id="__span-3-9"><span class="w">  </span><span class="p">},</span>
</span><span id="__span-3-10"><span class="w">  </span><span class="nt">&quot;payload&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-3-11"><span class="w">    </span><span class="s2">&quot;demo/job_01&quot;</span><span class="p">,</span>
</span><span id="__span-3-12"><span class="w">    </span><span class="s2">&quot;demo/job_02&quot;</span>
</span><span id="__span-3-13"><span class="w">  </span><span class="p">],</span>
</span><span id="__span-3-14"><span class="w">  </span><span class="nt">&quot;schedule&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;0 0 * * *&quot;</span><span class="p">,</span>
</span><span id="__span-3-15"><span class="w">  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;chain&quot;</span><span class="p">,</span>
</span><span id="__span-3-16"><span class="w">  </span><span class="nt">&quot;worker&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;default&quot;</span>
</span><span id="__span-3-17"><span class="p">}</span>
</span></code></pre></div>
<p>With a common job prefix:</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-4-1"><span class="p">{</span>
</span><span id="__span-4-2"><span class="w">  </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Chain, chain, chain ... Chain of tools&quot;</span><span class="p">,</span>
</span><span id="__span-4-3"><span class="w">  </span><span class="nt">&quot;dispatcher&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Sydney&quot;</span><span class="p">,</span>
</span><span id="__span-4-4"><span class="w">  </span><span class="nt">&quot;enabled&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-4-5"><span class="w">  </span><span class="nt">&quot;job_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo/chain-01&quot;</span><span class="p">,</span>
</span><span id="__span-4-6"><span class="w">  </span><span class="nt">&quot;job_prefix&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo/&quot;</span><span class="p">,</span>
</span><span id="__span-4-7"><span class="w">  </span><span class="nt">&quot;owner&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo@somewhere.com&quot;</span><span class="p">,</span>
</span><span id="__span-4-8"><span class="w">  </span><span class="nt">&quot;parameters&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-4-9"><span class="w">    </span><span class="nt">&quot;start&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;job_02&quot;</span>
</span><span id="__span-4-10"><span class="w">  </span><span class="p">},</span>
</span><span id="__span-4-11"><span class="w">  </span><span class="nt">&quot;payload&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-4-12"><span class="w">    </span><span class="s2">&quot;job_01&quot;</span><span class="p">,</span>
</span><span id="__span-4-13"><span class="w">    </span><span class="s2">&quot;job_02&quot;</span>
</span><span id="__span-4-14"><span class="w">  </span><span class="p">],</span>
</span><span id="__span-4-15"><span class="w">  </span><span class="nt">&quot;schedule&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;0 0 * * *&quot;</span><span class="p">,</span>
</span><span id="__span-4-16"><span class="w">  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;chain&quot;</span><span class="p">,</span>
</span><span id="__span-4-17"><span class="w">  </span><span class="nt">&quot;worker&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;default&quot;</span>
</span><span id="__span-4-18"><span class="p">}</span>
</span></code></pre></div>
<p>An uncaring parent chain job that doesn't care if any of its children fail:</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-5-1"><span class="p">{</span>
</span><span id="__span-5-2"><span class="w">  </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Chain, chain, chain ... Chain of tools&quot;</span><span class="p">,</span>
</span><span id="__span-5-3"><span class="w">  </span><span class="nt">&quot;dispatcher&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Sydney&quot;</span><span class="p">,</span>
</span><span id="__span-5-4"><span class="w">  </span><span class="nt">&quot;enabled&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-5-5"><span class="w">  </span><span class="nt">&quot;job_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo/chain-01&quot;</span><span class="p">,</span>
</span><span id="__span-5-6"><span class="w">  </span><span class="nt">&quot;owner&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo@somewhere.com&quot;</span><span class="p">,</span>
</span><span id="__span-5-7"><span class="w">  </span><span class="nt">&quot;parameters&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-5-8"><span class="w">    </span><span class="nt">&quot;can_fail&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;*&quot;</span>
</span><span id="__span-5-9"><span class="w">  </span><span class="p">},</span>
</span><span id="__span-5-10"><span class="w">  </span><span class="nt">&quot;payload&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-5-11"><span class="w">    </span><span class="s2">&quot;demo/job_01&quot;</span><span class="p">,</span>
</span><span id="__span-5-12"><span class="w">    </span><span class="s2">&quot;demo/job_02&quot;</span>
</span><span id="__span-5-13"><span class="w">  </span><span class="p">],</span>
</span><span id="__span-5-14"><span class="w">  </span><span class="nt">&quot;schedule&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;0 0 * * *&quot;</span><span class="p">,</span>
</span><span id="__span-5-15"><span class="w">  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;chain&quot;</span><span class="p">,</span>
</span><span id="__span-5-16"><span class="w">  </span><span class="nt">&quot;worker&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;default&quot;</span>
</span><span id="__span-5-17"><span class="p">}</span>
</span></code></pre></div>
<p>A parent chain job that plays favourites:</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-6-1"><span class="p">{</span>
</span><span id="__span-6-2"><span class="w">  </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Chain, chain, chain ... Chain of tools&quot;</span><span class="p">,</span>
</span><span id="__span-6-3"><span class="w">  </span><span class="nt">&quot;dispatcher&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Sydney&quot;</span><span class="p">,</span>
</span><span id="__span-6-4"><span class="w">  </span><span class="nt">&quot;enabled&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-6-5"><span class="w">  </span><span class="nt">&quot;job_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo/chain-01&quot;</span><span class="p">,</span>
</span><span id="__span-6-6"><span class="w">  </span><span class="nt">&quot;owner&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo@somewhere.com&quot;</span><span class="p">,</span>
</span><span id="__span-6-7"><span class="w">  </span><span class="nt">&quot;parameters&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-6-8"><span class="w">    </span><span class="nt">&quot;can_fail&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-6-9"><span class="w">      </span><span class="s2">&quot;*/job_[0-9][0-9]&quot;</span>
</span><span id="__span-6-10"><span class="w">    </span><span class="p">]</span>
</span><span id="__span-6-11"><span class="w">  </span><span class="p">},</span>
</span><span id="__span-6-12"><span class="w">  </span><span class="nt">&quot;payload&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-6-13"><span class="w">    </span><span class="s2">&quot;demo/job_01&quot;</span><span class="p">,</span>
</span><span id="__span-6-14"><span class="w">    </span><span class="s2">&quot;demo/job_02&quot;</span><span class="p">,</span>
</span><span id="__span-6-15"><span class="w">    </span><span class="s2">&quot;demo/black_sheep&quot;</span>
</span><span id="__span-6-16"><span class="w">  </span><span class="p">],</span>
</span><span id="__span-6-17"><span class="w">  </span><span class="nt">&quot;schedule&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;0 0 * * *&quot;</span><span class="p">,</span>
</span><span id="__span-6-18"><span class="w">  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;chain&quot;</span><span class="p">,</span>
</span><span id="__span-6-19"><span class="w">  </span><span class="nt">&quot;worker&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;default&quot;</span>
</span><span id="__span-6-20"><span class="p">}</span>
</span></code></pre></div>
<h2 id="job-type-cmd">Job type: cmd<a class="headerlink" href="#job-type-cmd" title="Permanent link">&para;</a></h2>
<p>The <strong>cmd</strong> job type runs a single Linux command.</p>
<h3 id="payload_1">Payload<a class="headerlink" href="#payload_1" title="Permanent link">&para;</a></h3>
<p>The payload is the command string. This will be parsed using standard Linux
shell lexical analysis to determine the executable and arguments. Additional
arguments can also be specified with the <code>args</code> parameter.</p>
<h3 id="environment">Environment<a class="headerlink" href="#environment" title="Permanent link">&para;</a></h3>
<p>Stdin will be redirected from <code>/dev/null</code>. Stdout and stderr are captured and,
if non-empty, placed into the realm <code>s3_temp</code> area with the following
prefixes:</p>
<ul>
<li>
<p>stdout: <code>&lt;s3_temp&gt;/&lt;job_id&gt;/&lt;run_id&gt;/stdout</code></p>
</li>
<li>
<p>stderr: <code>&lt;s3_temp&gt;/&lt;job_id&gt;/&lt;run_id&gt;/stderr</code></p>
</li>
</ul>
<p>The following variables are placed into the environment for the command.</p>
<table>
<thead>
<tr>
<th>Variable</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>LAVA_JOB_ID</td>
<td>The <code>job_id</code>.</td>
</tr>
<tr>
<td>LAVA_OWNER</td>
<td>The value of the <code>owner</code> field from the job specification.</td>
</tr>
<tr>
<td>LAVA_REALM</td>
<td>The realm name.</td>
</tr>
<tr>
<td>LAVA_RUN_ID</td>
<td>The <code>run_id</code> UUID.</td>
</tr>
<tr>
<td>LAVA_S3_KEY</td>
<td>The identifier for the KMS key needed to write data into the S3 temporary area.</td>
</tr>
<tr>
<td>LAVA_S3_TMP</td>
<td>The private S3 temporary area for this job run. The command is allowed to put data here.</td>
</tr>
<tr>
<td>LAVA_WORKER</td>
<td>The worker name.</td>
</tr>
</tbody>
</table>
<h3 id="parameters_1">Parameters<a class="headerlink" href="#parameters_1" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>args</td>
<td>List[String]</td>
<td>No</td>
<td>A list of additional arguments for the command.</td>
</tr>
<tr>
<td>env</td>
<td>Map[String,String]</td>
<td>No</td>
<td>A map of additional environment variables for the command.</td>
</tr>
<tr>
<td>jinja</td>
<td>Boolean</td>
<td>No</td>
<td>If <code>false</code>, disable Jinja rendering of the payload. Default <code>true</code>.</td>
</tr>
<tr>
<td>timeout</td>
<td>String</td>
<td>No</td>
<td>By default, <strong>cmd</strong> jobs are killed after 10 minutes. This parameter can override that with values in the form <code>nnX</code> where <code>nn</code> is a number and <code>X</code> is <code>s</code> (seconds), <code>m</code> (minutes) or <code>h</code> (hours). Note that this must be less than the visibility timeout on the worker SQS queue.</td>
</tr>
<tr>
<td>vars</td>
<td>Map[String,*]</td>
<td>No</td>
<td>A map of variables injected when the command arguments and environment are Jinja rendered.</td>
</tr>
</tbody>
</table>
<h3 id="jinja-rendering-of-the-payload-and-environment">Jinja Rendering of the Payload and Environment<a class="headerlink" href="#jinja-rendering-of-the-payload-and-environment" title="Permanent link">&para;</a></h3>
<p>The collected arguments for the command and any environment values defined in
the job specification are individually rendered using
<a href="http://jinja.pocoo.org">Jinja</a> prior to execution.</p>
<p>Refer to <a href="13-jinja-rendering-in-lava.html#jinja-rendering-in-lava">Jinja Rendering in Lava</a>
for more information.</p>
<p>The following variables are made available to the renderer.</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>globals</td>
<td>dict[str,*]</td>
<td>The <code>globals</code> from the job specification updated with any globals received in the job dispatch.</td>
</tr>
<tr>
<td>job</td>
<td>dict[str,*]</td>
<td>The <a href="13-jinja-rendering-in-lava.html#the-augmented-job-specification">augmented job specification</a>.</td>
</tr>
<tr>
<td>realm</td>
<td>dict[str,*]</td>
<td>The realm specification.</td>
</tr>
<tr>
<td>start</td>
<td>datetime</td>
<td>The local time when the job run started.</td>
</tr>
<tr>
<td>state</td>
<td>dict[str,*]</td>
<td>A dictionary of the state items imported into the job, keyed on state_id. The default values are updated at run-time with any current values obtainable from the <a href="04-dynamodb-tables.html#the-state-table">state</a> table.</td>
</tr>
<tr>
<td>ustart</td>
<td>datetime</td>
<td>The UTC time when the job run started.</td>
</tr>
<tr>
<td>utils</td>
<td>dict[str,runnable]</td>
<td>A dictionary of <a href="13-jinja-rendering-in-lava.html#jinja-utility-functions">utility functions</a> that can be used in the Jinja markup.</td>
</tr>
<tr>
<td>vars</td>
<td>dict[str,*]</td>
<td>A dictionary of variables provided as the <code>vars</code> component of the job <code>parameters</code>.</td>
</tr>
</tbody>
</table>
<h3 id="dev-mode-behaviour_1">Dev Mode Behaviour<a class="headerlink" href="#dev-mode-behaviour_1" title="Permanent link">&para;</a></h3>
<p>Normally, the <strong>cmd</strong> job will copy stdout and stderr to S3 on the conclusion
of the job. In dev mode, stdout and stderr are emitted locally during the job
run instead of being copied to S3.</p>
<h3 id="examples_1">Examples<a class="headerlink" href="#examples_1" title="Permanent link">&para;</a></h3>
<p>The following example will list the contents of the S3 payloads area for this
realm.</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-7-1"><span class="p">{</span>
</span><span id="__span-7-2"><span class="w">  </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;List S3&quot;</span><span class="p">,</span>
</span><span id="__span-7-3"><span class="w">  </span><span class="nt">&quot;dispatcher&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Sydney&quot;</span><span class="p">,</span>
</span><span id="__span-7-4"><span class="w">  </span><span class="nt">&quot;enabled&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-7-5"><span class="w">  </span><span class="nt">&quot;job_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo/list_s3&quot;</span><span class="p">,</span>
</span><span id="__span-7-6"><span class="w">  </span><span class="nt">&quot;owner&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo@somewhere.com&quot;</span><span class="p">,</span>
</span><span id="__span-7-7"><span class="w">  </span><span class="nt">&quot;payload&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;aws s3 ls {{realm.s3_payloads}}/ --recursive&quot;</span><span class="p">,</span>
</span><span id="__span-7-8"><span class="w">  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;cmd&quot;</span><span class="p">,</span>
</span><span id="__span-7-9"><span class="w">  </span><span class="nt">&quot;worker&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;default&quot;</span>
</span><span id="__span-7-10"><span class="p">}</span>
</span></code></pre></div>
<p>This does the same thing but with the arguments supplied a little differently.</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-8-1"><span class="p">{</span>
</span><span id="__span-8-2"><span class="w">  </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;List S3&quot;</span><span class="p">,</span>
</span><span id="__span-8-3"><span class="w">  </span><span class="nt">&quot;dispatcher&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Sydney&quot;</span><span class="p">,</span>
</span><span id="__span-8-4"><span class="w">  </span><span class="nt">&quot;enabled&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-8-5"><span class="w">  </span><span class="nt">&quot;job_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo/list_s3&quot;</span><span class="p">,</span>
</span><span id="__span-8-6"><span class="w">  </span><span class="nt">&quot;owner&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo@somewhere.com&quot;</span><span class="p">,</span>
</span><span id="__span-8-7"><span class="w">  </span><span class="nt">&quot;parameters&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-8"><span class="w">    </span><span class="nt">&quot;args&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-8-9"><span class="w">      </span><span class="s2">&quot;--recursive&quot;</span>
</span><span id="__span-8-10"><span class="w">    </span><span class="p">]</span>
</span><span id="__span-8-11"><span class="w">  </span><span class="p">},</span>
</span><span id="__span-8-12"><span class="w">  </span><span class="nt">&quot;payload&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;aws s3 ls {{realm.s3_payloads}}/&quot;</span><span class="p">,</span>
</span><span id="__span-8-13"><span class="w">  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;cmd&quot;</span><span class="p">,</span>
</span><span id="__span-8-14"><span class="w">  </span><span class="nt">&quot;worker&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;default&quot;</span>
</span><span id="__span-8-15"><span class="p">}</span>
</span></code></pre></div>
<h2 id="job-type-dag">Job type: dag<a class="headerlink" href="#job-type-dag" title="Permanent link">&para;</a></h2>
<p>The <strong>dag</strong> (<strong>D</strong>irected <strong>A</strong>cyclic <strong>G</strong>raph) job type runs a set of child
jobs in the order defined by a dependency matrix.</p>
<p>Ordering controlled by explicit dependencies will be honoured in that a child
job which is a predecessor of another child job will always run to completion
before the successor job starts.  Except for this, there is no guaranteed run
order for the child jobs. Jobs that are not dependent on one another may run in
any order, or in parallel.</p>
<p>All of the jobs in the DAG must be set to run on the same worker and will all
run under the <code>run_id</code> of the parent job. The jobs will be run in a dedicated
transient thread pool that is separate from the main lava worker threads.</p>
<p>Any globals available in the <strong>dag</strong> job will also be passed to the child jobs.</p>
<h3 id="payload_2">Payload<a class="headerlink" href="#payload_2" title="Permanent link">&para;</a></h3>
<p>The <code>payload</code> is a map containing elements in the form:</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-9-1"><span class="p">{</span>
</span><span id="__span-9-2"><span class="w">  </span><span class="nt">&quot;payload&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-9-3"><span class="w">    </span><span class="nt">&quot;child_job_id_1&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;predecessor_job_id&quot;</span><span class="p">,</span>
</span><span id="__span-9-4"><span class="w">    </span><span class="nt">&quot;child_job_id_2&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="err">Lis</span><span class="kc">t</span><span class="w"> </span><span class="err">o</span><span class="kc">f</span><span class="w"> </span><span class="err">predecessor</span><span class="w"> </span><span class="err">job</span><span class="w"> </span><span class="err">IDs</span><span class="w"> </span><span class="p">],</span>
</span><span id="__span-9-5"><span class="w">    </span><span class="nt">&quot;child_job_id_3&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
</span><span id="__span-9-6"><span class="w">    </span><span class="nt">&quot;child_job_id_4&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span>
</span><span id="__span-9-7"><span class="w">  </span><span class="p">}</span>
</span><span id="__span-9-8"><span class="p">}</span>
</span></code></pre></div>
<p>The keys are job IDs and values must be one of the following:</p>
<ol>
<li>
<p>The ID of a predecessor job as a string.</p>
</li>
<li>
<p>A list of predecessor job IDs.</p>
</li>
<li>
<p>A <code>null</code> indicating the job must be run but has no predecessor requirements.</p>
</li>
<li>
<p>An empty list, which also indicates the job must be run but has no
    predecessor requirements.</p>
</li>
</ol>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p><em>Every</em> job listed in the payload map, in either a key, or as an element in
a predecessor list, will be run exactly once by the <strong>dag</strong> job.</p>
</div>
<p>It is not necessary to include a separate key for a job if it is also present in
a predecessor list and has no predecessors of its own, but it's harmless to do
so.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <a href="16-commands-utilities.html#lava-dag-generator">lava-dag-gen</a> utility generates a <strong>dag</strong> job
payload from a dependency matrix. It can be used standalone or with the
<a href="11-lava-job-framework.html#the-lava-job-framework">lava job framework</a>.</p>
</div>
<h3 id="parameters_2">Parameters<a class="headerlink" href="#parameters_2" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>can_fail</td>
<td>String <em>or</em> List[String]</td>
<td>No</td>
<td>A glob style pattern, or list of patterns specifying child jobs that are allowed to fail. See <a href="#allowing-child-jobs-to-fail">Allowing Child Jobs to Fail</a>.</td>
</tr>
<tr>
<td>job_prefix</td>
<td>String</td>
<td>No</td>
<td>Prepend the specified value to each job ID in the payload.</td>
</tr>
<tr>
<td>workers</td>
<td>Integer</td>
<td>No</td>
<td>The number of worker threads to use for running child jobs. The default is specified by the <a href="10-installation-operation.html#configuration-for-dag-jobs">DAG_WORKERS</a> worker configuration parameter and the maximum allowed value is specified by the <a href="10-installation-operation.html#configuration-for-dag-jobs">DAG_MAX_WORKERS</a> configuration parameter.</td>
</tr>
</tbody>
</table>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Don't get carried away setting the <code>workers</code> parameter too high. It will
impact memory consumption.</p>
</div>
<h3 id="allowing-child-jobs-to-fail_1">Allowing Child Jobs to Fail<a class="headerlink" href="#allowing-child-jobs-to-fail_1" title="Permanent link">&para;</a></h3>
<p>By default, the <strong>dag</strong> job is aborted when any child fails, however child jobs
running in parallel with the failed job will generally run to completion.</p>
<p>The <code>can_fail</code> parameter can be set to a glob style pattern, or list of
patterns.  A failed child job with a <code>job_id</code> that matches any of the patterns
will not cause the parent <strong>dag</strong> job, or dependent jobs, to fail. In this
situation, it is important that the child job handles its own
<a href="08-job-actions.html#job-actions">on_fail</a> actions, as the parent will not. Tough love.</p>
<p>This tolerance of failure does not include configuration errors on child jobs,
such as malformed job specifications, jobs sent to the wrong worker etc. These
will still cause the entire <strong>dag</strong> job to fail.</p>
<h3 id="handling-of-globals_1">Handling of Globals<a class="headerlink" href="#handling-of-globals_1" title="Permanent link">&para;</a></h3>
<p>The <strong>dag</strong> job type merges its globals into those of the child jobs.  A value
specified in the parent <strong>dag</strong> job will override a similarly named value in the
child.</p>
<p>The <strong>dag</strong> job will also add
<a href="05-job-dispatch.html#globals-owned-by-lava">lava specific globals</a> under
<code>globals.lava</code>. These lava owned globals allow all child jobs in the dag to
access some common global values.</p>
<h3 id="dev-mode-behaviour_2">Dev Mode Behaviour<a class="headerlink" href="#dev-mode-behaviour_2" title="Permanent link">&para;</a></h3>
<p>The <strong>dag</strong> job behaviour is unchanged for dev mode. However, dev mode is
propagated to child jobs.</p>
<h3 id="examples_2">Examples<a class="headerlink" href="#examples_2" title="Permanent link">&para;</a></h3>
<div class="language-json highlight"><pre><span></span><code><span id="__span-10-1"><span class="p">{</span>
</span><span id="__span-10-2"><span class="w">  </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Daggy job&quot;</span><span class="p">,</span>
</span><span id="__span-10-3"><span class="w">  </span><span class="nt">&quot;dispatcher&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Sydney&quot;</span><span class="p">,</span>
</span><span id="__span-10-4"><span class="w">  </span><span class="nt">&quot;enabled&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-10-5"><span class="w">  </span><span class="nt">&quot;job_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo/dag-01&quot;</span><span class="p">,</span>
</span><span id="__span-10-6"><span class="w">  </span><span class="nt">&quot;owner&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo@somewhere.com&quot;</span><span class="p">,</span>
</span><span id="__span-10-7"><span class="w">  </span><span class="nt">&quot;parameters&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-8"><span class="w">    </span><span class="nt">&quot;workers&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span>
</span><span id="__span-10-9"><span class="w">  </span><span class="p">},</span>
</span><span id="__span-10-10"><span class="w">  </span><span class="nt">&quot;payload&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-11"><span class="w">    </span><span class="nt">&quot;demo/job_01&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo/job_02&quot;</span><span class="p">,</span>
</span><span id="__span-10-12"><span class="w">    </span><span class="nt">&quot;demo/job_02&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">&quot;demo/job_03&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;demo/job_04&quot;</span><span class="w"> </span><span class="p">],</span>
</span><span id="__span-10-13"><span class="w">    </span><span class="nt">&quot;demo/job_05&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span>
</span><span id="__span-10-14"><span class="w">  </span><span class="p">},</span>
</span><span id="__span-10-15"><span class="w">  </span><span class="nt">&quot;schedule&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;0 0 * * *&quot;</span><span class="p">,</span>
</span><span id="__span-10-16"><span class="w">  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;dag&quot;</span><span class="p">,</span>
</span><span id="__span-10-17"><span class="w">  </span><span class="nt">&quot;worker&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;default&quot;</span>
</span><span id="__span-10-18"><span class="p">}</span>
</span></code></pre></div>
<p>This version uses <code>job_prefix</code> and is functionally identical to the one above:</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-11-1"><span class="p">{</span>
</span><span id="__span-11-2"><span class="w">  </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Daggy job&quot;</span><span class="p">,</span>
</span><span id="__span-11-3"><span class="w">  </span><span class="nt">&quot;dispatcher&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Sydney&quot;</span><span class="p">,</span>
</span><span id="__span-11-4"><span class="w">  </span><span class="nt">&quot;enabled&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-11-5"><span class="w">  </span><span class="nt">&quot;job_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo/dag-01&quot;</span><span class="p">,</span>
</span><span id="__span-11-6"><span class="w">  </span><span class="nt">&quot;owner&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo@somewhere.com&quot;</span><span class="p">,</span>
</span><span id="__span-11-7"><span class="w">  </span><span class="nt">&quot;parameters&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-8"><span class="w">    </span><span class="nt">&quot;job_prefix&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo/&quot;</span><span class="p">,</span>
</span><span id="__span-11-9"><span class="w">    </span><span class="nt">&quot;workers&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span>
</span><span id="__span-11-10"><span class="w">  </span><span class="p">},</span>
</span><span id="__span-11-11"><span class="w">  </span><span class="nt">&quot;payload&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-12"><span class="w">    </span><span class="nt">&quot;job_01&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;job_02&quot;</span><span class="p">,</span>
</span><span id="__span-11-13"><span class="w">    </span><span class="nt">&quot;job_02&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">&quot;job_03&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;job_04&quot;</span><span class="w"> </span><span class="p">],</span>
</span><span id="__span-11-14"><span class="w">    </span><span class="nt">&quot;job_05&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span>
</span><span id="__span-11-15"><span class="w">  </span><span class="p">},</span>
</span><span id="__span-11-16"><span class="w">  </span><span class="nt">&quot;schedule&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;0 0 * * *&quot;</span><span class="p">,</span>
</span><span id="__span-11-17"><span class="w">  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;dag&quot;</span><span class="p">,</span>
</span><span id="__span-11-18"><span class="w">  </span><span class="nt">&quot;worker&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;default&quot;</span>
</span><span id="__span-11-19"><span class="p">}</span>
</span></code></pre></div>
<p>An uncaring parent <strong>dag</strong> job that doesn't care if any of its children fail:</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-12-1"><span class="p">{</span>
</span><span id="__span-12-2"><span class="w">  </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Daggy job&quot;</span><span class="p">,</span>
</span><span id="__span-12-3"><span class="w">  </span><span class="nt">&quot;dispatcher&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Sydney&quot;</span><span class="p">,</span>
</span><span id="__span-12-4"><span class="w">  </span><span class="nt">&quot;enabled&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-12-5"><span class="w">  </span><span class="nt">&quot;job_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo/dag-01&quot;</span><span class="p">,</span>
</span><span id="__span-12-6"><span class="w">  </span><span class="nt">&quot;owner&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo@somewhere.com&quot;</span><span class="p">,</span>
</span><span id="__span-12-7"><span class="w">  </span><span class="nt">&quot;parameters&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-8"><span class="w">    </span><span class="nt">&quot;can_fail&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;*&quot;</span><span class="p">,</span>
</span><span id="__span-12-9"><span class="w">    </span><span class="nt">&quot;workers&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span>
</span><span id="__span-12-10"><span class="w">  </span><span class="p">},</span>
</span><span id="__span-12-11"><span class="w">  </span><span class="nt">&quot;payload&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-12"><span class="w">    </span><span class="nt">&quot;demo/job_01&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo/job_02&quot;</span><span class="p">,</span>
</span><span id="__span-12-13"><span class="w">    </span><span class="nt">&quot;demo/job_02&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">&quot;demo/job_03&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;demo/job_04&quot;</span><span class="w"> </span><span class="p">],</span>
</span><span id="__span-12-14"><span class="w">    </span><span class="nt">&quot;demo/job_05&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span>
</span><span id="__span-12-15"><span class="w">  </span><span class="p">},</span>
</span><span id="__span-12-16"><span class="w">  </span><span class="nt">&quot;schedule&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;0 0 * * *&quot;</span><span class="p">,</span>
</span><span id="__span-12-17"><span class="w">  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;dag&quot;</span><span class="p">,</span>
</span><span id="__span-12-18"><span class="w">  </span><span class="nt">&quot;worker&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;default&quot;</span>
</span><span id="__span-12-19"><span class="p">}</span>
</span></code></pre></div>
<p>A parent <strong>dag</strong> job that plays favourites:</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-13-1"><span class="p">{</span>
</span><span id="__span-13-2"><span class="w">  </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Daggy job&quot;</span><span class="p">,</span>
</span><span id="__span-13-3"><span class="w">  </span><span class="nt">&quot;dispatcher&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Sydney&quot;</span><span class="p">,</span>
</span><span id="__span-13-4"><span class="w">  </span><span class="nt">&quot;enabled&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-13-5"><span class="w">  </span><span class="nt">&quot;job_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo/dag-01&quot;</span><span class="p">,</span>
</span><span id="__span-13-6"><span class="w">  </span><span class="nt">&quot;owner&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo@somewhere.com&quot;</span><span class="p">,</span>
</span><span id="__span-13-7"><span class="w">  </span><span class="nt">&quot;parameters&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-13-8"><span class="w">    </span><span class="nt">&quot;can_fail&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-13-9"><span class="w">      </span><span class="s2">&quot;*/job_[24]&quot;</span>
</span><span id="__span-13-10"><span class="w">    </span><span class="p">],</span>
</span><span id="__span-13-11"><span class="w">    </span><span class="nt">&quot;workers&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span>
</span><span id="__span-13-12"><span class="w">  </span><span class="p">},</span>
</span><span id="__span-13-13"><span class="w">  </span><span class="nt">&quot;payload&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-13-14"><span class="w">    </span><span class="nt">&quot;demo/job_01&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo/job_02&quot;</span><span class="p">,</span>
</span><span id="__span-13-15"><span class="w">    </span><span class="nt">&quot;demo/job_02&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">&quot;demo/job_03&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;demo/job_04&quot;</span><span class="w"> </span><span class="p">],</span>
</span><span id="__span-13-16"><span class="w">    </span><span class="nt">&quot;demo/job_05&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span>
</span><span id="__span-13-17"><span class="w">  </span><span class="p">},</span>
</span><span id="__span-13-18"><span class="w">  </span><span class="nt">&quot;schedule&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;0 0 * * *&quot;</span><span class="p">,</span>
</span><span id="__span-13-19"><span class="w">  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;dag&quot;</span><span class="p">,</span>
</span><span id="__span-13-20"><span class="w">  </span><span class="nt">&quot;worker&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;default&quot;</span>
</span><span id="__span-13-21"><span class="p">}</span>
</span></code></pre></div>
<h2 id="job-type-db_from_s3">Job type: db_from_s3<a class="headerlink" href="#job-type-db_from_s3" title="Permanent link">&para;</a></h2>
<p>The <strong>db_from_s3</strong> job type loads data from AWS S3 into a target database. The
data formats supported, and the loading mechanism used, are dependent on the
target database type. For example, Redshift databases use the <code>COPY</code> command to
load structured data from S3.</p>
<p>The target database type, and hence the loading mechanism, are determined by
the type of database connector specified for the job.</p>
<p>The <strong>db_from_s3</strong> job type can be used in conjunction with the lava
<strong>s3trigger</strong> Lambda function to load data whenever a new data file is
placed in S3.</p>
<p>The following target database types are supported:</p>
<ul>
<li>
<p><a href="#loading-data-to-redshift">AWS Redshift</a></p>
</li>
<li>
<p><a href="#loading-data-to-postgres-rds">Postgres RDS and Aurora Postgres</a>.</p>
</li>
<li>
<p><a href="#loading-data-to-postgres">Postgres</a></p>
</li>
<li>
<p><a href="#loading-data-to-aurora-mysql">Aurora MySQL</a></p>
</li>
<li>
<p><a href="#loading-data-to-sqlite3">SQLite3</a></p>
</li>
<li>
<p><a href="#loading-data-to-oracle">Oracle</a></p>
</li>
</ul>
<h3 id="payload_3">Payload<a class="headerlink" href="#payload_3" title="Permanent link">&para;</a></h3>
<p>The payload is ignored.</p>
<h3 id="parameters_3">Parameters<a class="headerlink" href="#parameters_3" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>args</td>
<td>*</td>
<td>*</td>
<td>Dependent on the target database type.</td>
</tr>
<tr>
<td>bucket</td>
<td>String</td>
<td>Yes</td>
<td>The name of the S3 bucket from which the data is copied.</td>
</tr>
<tr>
<td>columns</td>
<td>List[String]</td>
<td>Sometimes</td>
<td>A list of SQL column specifications. Required if the target table must be created (e.g. if the table does not exist or the <code>mode</code> is <code>drop</code>). If specified, the copy process will explicitly include the columns specified. This is useful when only some of the columns in the target table are to be loaded with data.</td>
</tr>
<tr>
<td>db_conn_id</td>
<td>String</td>
<td>Yes</td>
<td>The <a href="07-connectors.html#database-connectors">connection ID</a> for a target database. The <code>type</code> associated with the connection specification will determine which loader is used.</td>
</tr>
<tr>
<td>jinja</td>
<td>Boolean</td>
<td>No</td>
<td>If <code>false</code>, disable Jinja rendering of the <code>bucket</code> and <code>key</code>. Default <code>true</code>.</td>
</tr>
<tr>
<td>key</td>
<td>String</td>
<td>Yes</td>
<td>The key in the S3 bucket from which the data is copied.</td>
</tr>
<tr>
<td>min_size</td>
<td>String | Int</td>
<td>No</td>
<td>The loading process will <em>attempt</em> to avoid loading files below the specified size. The value is a <em>size</em> value as described in <a href="10-installation-operation.html#lava-worker-configuration">Lava Worker Configuration</a>. The default is 0. See <a href="#about-the-min_size-parameter">below</a> for more information.</td>
</tr>
<tr>
<td>mode</td>
<td>String</td>
<td>Yes</td>
<td>Update mode for the target table. See <a href="#copy-modes">Copy Modes</a> for more information.</td>
</tr>
<tr>
<td>s3_conn_id</td>
<td>String</td>
<td>Conditional</td>
<td>The <a href="07-connectors.html#connector-type-aws">connection ID</a> for AWS S3. This is used to allow access to the source data in S3. Whether or not this is required is database dependent. Only one of either <code>s3_conn_id</code> or <code>s3_iam_role</code> is ever required.</td>
</tr>
<tr>
<td>s3_iam_role</td>
<td>String</td>
<td>Conditional</td>
<td>The IAM role name used to allow access to the source data in S3. Whether or not this is required is database dependent. Only one of either <code>s3_conn_id</code> or <code>s3_iam_role</code> is ever required.</td>
</tr>
<tr>
<td>schema</td>
<td>String</td>
<td>Yes</td>
<td>Target schema name. If the Jinja rendered value starts with <code>/</code>, the rest of the value is used as a <a href="#deriving-target-schema-and-table-name-from-the-s3-key">regular expression</a> (regex) to derive the schema name from the Jinja rendered <code>key</code> value. In this case, the <code>columns</code> argument is not permitted and the target table must already exist.</td>
</tr>
<tr>
<td>skip_missing</td>
<td>Boolean</td>
<td>No</td>
<td>If <code>true</code>, no attempt is made to load missing files. The default is <code>false</code> which means attempting to load a non-existent file will result in an error.  This won't help in the situation where the file is removed from S3 between the check for existence and the database load operation. Note that the lava worker will require <code>s3:GetObject</code> access to the object if the value is set to <code>true</code>.</td>
</tr>
<tr>
<td>table</td>
<td>String</td>
<td>Yes</td>
<td>Target table name. If the Jinja rendered value starts with <code>/</code>, the rest of the value is used as a <a href="#deriving-target-schema-and-table-name-from-the-s3-key">regular expression</a> (regex) to derive the table name from the <code>key</code> argument. In this case, the <code>columns</code> argument is not permitted and the target table must already exist.</td>
</tr>
<tr>
<td>vars</td>
<td>Map[String,*]</td>
<td>No</td>
<td>A map of variables injected when <code>bucket</code>, <code>key</code>, <code>schema</code> and <code>table</code> are Jinja rendered.</td>
</tr>
</tbody>
</table>
<h4 id="about-the-min_size-parameter">About the min_size Parameter<a class="headerlink" href="#about-the-min_size-parameter" title="Permanent link">&para;</a></h4>
<p>If the <code>min_size</code> parameter is specified, the loading process will <em>attempt</em> to
avoid loading files below the specified size. This is not always possible,
depending on the loading mechanism being used.</p>
<p>The fundamental use case for this parameter is to avoid attempting to load empty
data files. Most of the database loading mechanisms will happily <em>load</em> an empty
file and consider that to be a success. Some, such as the native S3 loading
process for Aurora Postgres, consider this to be an error and will abort the
transaction. This is particularly problematic when loading a number of files in
one operation, some of which may be empty. This can happen with data unloaded
from Redshift where the source table is skewed and some slice files are empty as
a result.</p>
<p>The file size is checked directly in S3 without downloading the object to the
lava worker. This means that for compressed files, the value applies to the file
before decompression. It also means that the lava worker must have read access
(<code>s3:GetObject</code>) to objects to obtain size information, even if the loading
process is performed directly from the database.</p>
<p>Unfortunately, an empty file will GZIP to a non-empty file of small but
uncertain length due to the embedding of the filename. To avoid empty GZIP
files, the value should be set to a small but non-zero value (e.g. 100).</p>
<p>For uncompressed data without headers, setting the value to <code>1</code> should avoid
empty files.</p>
<h3 id="jinja-rendering-of-the-bucket-key-schema-and-table">Jinja Rendering of the Bucket, Key, Schema and Table<a class="headerlink" href="#jinja-rendering-of-the-bucket-key-schema-and-table" title="Permanent link">&para;</a></h3>
<p>The <code>bucket</code>, <code>key</code>, <code>schema</code> and <code>table</code> parameters are rendered using
<a href="http://jinja.pocoo.org">Jinja</a> prior to further use. The rendering is done in
the following order:</p>
<ol>
<li>The <code>bucket</code> and <code>key</code> parameters are rendered.</li>
<li>The <code>schema</code> and <code>table</code> parameters are rendered.</li>
</ol>
<p>Refer to <a href="13-jinja-rendering-in-lava.html#jinja-rendering-in-lava">Jinja Rendering in Lava</a>
for more information.</p>
<p>The following variables are made available to the renderer.</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>globals</td>
<td>dict[str,*]</td>
<td>The <code>globals</code> from the job specification updated with any globals received in the job dispatch.</td>
</tr>
<tr>
<td>job</td>
<td>dict[str,*]</td>
<td>The <a href="13-jinja-rendering-in-lava.html#the-augmented-job-specification">augmented job specification</a>.</td>
</tr>
<tr>
<td>realm</td>
<td>dict[str,*]</td>
<td>The realm specification.</td>
</tr>
<tr>
<td>start</td>
<td>datetime</td>
<td>The local time when the job run started.</td>
</tr>
<tr>
<td>state</td>
<td>dict[str,*]</td>
<td>A dictionary of the state items imported into the job, keyed on state_id. The default values are updated at run-time with any current values obtainable from the <a href="04-dynamodb-tables.html#the-state-table">state</a> table.</td>
</tr>
<tr>
<td>ustart</td>
<td>datetime</td>
<td>The UTC time when the job run started.</td>
</tr>
<tr>
<td>utils</td>
<td>dict[str,runnable]</td>
<td>A dictionary of <a href="13-jinja-rendering-in-lava.html#jinja-utility-functions">utility functions</a> that can be used in the Jinja markup.</td>
</tr>
<tr>
<td>vars</td>
<td>dict[str,*]</td>
<td>A dictionary of variables provided as the <code>vars</code> component of the job <code>parameters</code>.</td>
</tr>
</tbody>
</table>
<p>The following additional variables are made available when rendering the
<code>schema</code> and <code>table</code> parameters:</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>bucket</td>
<td>str</td>
<td>The Jinja rendered value of the <code>bucket</code> parameter.</td>
</tr>
<tr>
<td>key</td>
<td>str</td>
<td>The Jinja rendered value of the <code>key</code> parameter.</td>
</tr>
</tbody>
</table>
<p>This two-step process provides an additional mechanism for deriving the target
database object name from the S3 object name. It complements the regex based
mechanism described below.</p>
<div class="admonition question">
<p class="admonition-title">Why two mechanisms for deriving schema and table from the S3 key?</p>
<p>Well, the original regex mechanism was a legacy of previous code and is
still supported for historical reasons. The newer Jinja based method is more
flexible and consistent with lava generally. Try not to use them both at
once. It probably won't end well.</p>
</div>
<h3 id="deriving-target-schema-and-table-name-from-the-s3-key">Deriving Target Schema and Table Name from the S3 Key<a class="headerlink" href="#deriving-target-schema-and-table-name-from-the-s3-key" title="Permanent link">&para;</a></h3>
<p>The regex options for <code>schema</code> and <code>table</code> provide an alternate mechanism to
allow the target table to be derived at run time from the S3 object name. This
allows a single job specification to be used for multiple tables provided an
appropriate S3 naming convention is used. This is particularly handy if the job
is dispatched by an <a href="05-job-dispatch.html#dispatching-jobs-from-s3-events">S3 object created
event</a>. In this configuration,
the <code>bucket</code> and <code>key</code> parameters would be supplied when the job is dispatched
as a result of an S3 bucket notification event.</p>
<p>For each of these arguments, if the value starts with <code>/</code>, the rest of the value
must be a regular expression with a single capture group. The regex is applied
to the S3 object key that triggered the event (minus any suffix) and the value
of the capture group is used as the schema or table name respectively. If the
regex option is used, the <code>columns</code> argument is not permitted and the target
schema and table must already exist.</p>
<p>By combining these mechanisms, it is possible to use a single job specification
to load any number of different tables into a given target database provided
the target schema and table name can be derived from the S3 object key using
regular expressions.</p>
<h3 id="copy-modes">Copy Modes<a class="headerlink" href="#copy-modes" title="Permanent link">&para;</a></h3>
<p>The <code>mode</code> argument  specifies how any existing data in the table should be
handled and how new data should be loaded.</p>
<table>
<thead>
<tr>
<th>Mode</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>abort</td>
<td>If the target table contains any data, then abort with an error. This prevents the loss of any existing data.</td>
</tr>
<tr>
<td>append</td>
<td>New data is appended to any existing data in the table.</td>
</tr>
<tr>
<td>drop</td>
<td>The table is dropped and recreated prior to loading. This requires the <code>columns</code> argument to be provided so lava knows how to create the table.</td>
</tr>
<tr>
<td>delete</td>
<td>Delete all existing data from the table.</td>
</tr>
<tr>
<td>switch</td>
<td>Perform A/B table switching. If the <code>table</code> argument specifies a target table of <code>mytable</code>, data will be alternately loaded into switch tables <code>mytable_a</code> and <code>mytable_b</code>. During the load phase, lava will find whichever switch table is empty and load the new data into it. It will then delete all data from the other table. All this is done inside a transaction. Once the transaction is committed, the empty table is truncated to minimise vacuuming requirements. If neither switch table is empty, the load is aborted. Generally, there will be a view on top of the switch tables presenting the union of the two.</td>
</tr>
<tr>
<td>truncate</td>
<td>Truncate the table before loading.</td>
</tr>
</tbody>
</table>
<h3 id="event-driven-loading">Event Driven Loading<a class="headerlink" href="#event-driven-loading" title="Permanent link">&para;</a></h3>
<p>A common usage pattern is to trigger a database load when a data file is created
in S3. Lava supports this via the <a href="05-job-dispatch.html#dispatching-jobs-from-s3-events">s3trigger lambda
function</a>.</p>
<p>To load a table in response to an <a href="05-job-dispatch.html#dispatching-jobs-from-s3-events">S3 bucket notification
event</a> would require an entry
in the <a href="04-dynamodb-tables.html#the-s3triggers-table">s3triggers table</a> like so:</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-14-1"><span class="p">{</span>
</span><span id="__span-14-2"><span class="w">  </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;A new custard club membership file appeared in S3&quot;</span><span class="p">,</span>
</span><span id="__span-14-3"><span class="w">  </span><span class="nt">&quot;bucket&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;my-bucket&quot;</span><span class="p">,</span>
</span><span id="__span-14-4"><span class="w">  </span><span class="nt">&quot;prefix&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;a/b&quot;</span><span class="p">,</span>
</span><span id="__span-14-5"><span class="w">  </span><span class="nt">&quot;enabled&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-14-6"><span class="w">  </span><span class="nt">&quot;job_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo/copy-mytable&quot;</span><span class="p">,</span>
</span><span id="__span-14-7"><span class="w">  </span><span class="nt">&quot;parameters&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-14-8"><span class="w">    </span><span class="nt">&quot;bucket&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;{{bucket}}&quot;</span><span class="p">,</span>
</span><span id="__span-14-9"><span class="w">    </span><span class="nt">&quot;key&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;{{key}}&quot;</span>
</span><span id="__span-14-10"><span class="w">   </span><span class="p">}</span>
</span><span id="__span-14-11"><span class="p">}</span>
</span></code></pre></div>
<p>The <code>bucket</code> and <code>key</code> parameters are then determined at run-time and merged
into the job specification.</p>
<p>When a new data file is placed in S3, the lava <strong>s3trigger</strong> Lambda function
will be invoked. It will look up the event source (bucket + object key) in the
<a href="04-dynamodb-tables.html#the-s3triggers-table">s3triggers table</a> to determine that it
should invoke the <code>demo/copy-mytable</code> job. It will use Jinja to render the
parameters shown above from the bucket event notification details and then
dispatch the job with the customised <code>bucket</code> and <code>key</code> parameters replacing any
value in the job specification.</p>
<h3 id="dev-mode-behaviour_3">Dev Mode Behaviour<a class="headerlink" href="#dev-mode-behaviour_3" title="Permanent link">&para;</a></h3>
<p>Normally, the <strong>db_from_s3</strong> job will copy a log of events to S3 on the
conclusion of the job. In dev mode, this log is emitted locally at the end of
the job run.</p>
<h3 id="moving-data-from-redshift-to-other-databases">Moving Data from Redshift to Other Databases<a class="headerlink" href="#moving-data-from-redshift-to-other-databases" title="Permanent link">&para;</a></h3>
<p>Unfortunately, there is little consistency of data interchange formats
or methods across the AWS database services.</p>
<p>For example:</p>
<ul>
<li>
<p>Data unloaded from Redshift cannot be reliably copied back to Redshift
    without special handling of date fields.</p>
</li>
<li>
<p>Data unloaded from Redshift as pipe separated values (the default), cannot
    be reliably loaded to Postgres, Postgres RDS or Aurora Postgres because of
    differences in escaping the pipe character. CSV format seems to work.</p>
</li>
<li>
<p>Redshift unloading works best with compression and parallel unloading
    enabled. Aurora MySQL supports a manifest but does not support loading of
    compressed data. Postgres RDS and Aurora Postgres don't support loading from
    a manifest. They do support loading compressed data but only if the content
    encoding is set correctly on the S3 objects. Redshift does not do this.</p>
</li>
<li>
<p>The syntax and capability of data loading commands varies widely from
    Redshift to Aurora MySQL to Aurora/RDS Postgres to standard Postgres.</p>
</li>
</ul>
<p>Frankly, it's a mess.</p>
<p>Lava can only compensate for these problems to a limited degree. For example,
the <a href="#job-type-redshift_unload">redshift_unload</a> job has
additional logic to work around the first problem above. The
<a href="#job-type-db_from_s3">db_from_s3</a> job uses a range of
background trickery (such as manifest handling) to partially compensate for some
of the other limitations and inconsistencies.</p>
<p>Be careful out there!</p>
<h3 id="loading-data-to-aurora-mysql">Loading Data to Aurora MySQL<a class="headerlink" href="#loading-data-to-aurora-mysql" title="Permanent link">&para;</a></h3>
<p>Loading to Amazon Aurora MySQL is done using the native
<a href="https://docs.aws.amazon.com/AmazonRDS/latest/AuroraUserGuide/AuroraMySQL.Integrating.LoadFromS3.html#AuroraMySQL.Integrating.LoadFromS3.Text">LOAD DATA FROM S3</a>
facility.</p>
<p>There are a number of preliminary setup steps required on the database itself to
enable this mechanism. Once enabled, it can load uncompressed data. Loading of
compressed data is not supported.</p>
<h4 id="aurora-mysql-specific-parameters">Aurora MySQL Specific Parameters<a class="headerlink" href="#aurora-mysql-specific-parameters" title="Permanent link">&para;</a></h4>
<p>The <code>db_conn_id</code> parameter must point to a connection with a <code>type</code> of
<a href="07-connectors.html#connector-type-mysql-aurora">mysql-aurora</a>.</p>
<p>The loading operation relies on pre-configuration on the cluster itself to
provide access to S3. The <code>s3_conn_id</code> and <code>s3_iam_role</code> parameters are not
used.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The syntax of the <a href="https://docs.aws.amazon.com/AmazonRDS/latest/AuroraUserGuide/AuroraMySQL.Integrating.LoadFromS3.html#AuroraMySQL.Integrating.LoadFromS3.Text">LOAD DATA FROM
S3</a>
command is very different from its Postgres and Redshift counterparts. Lava
attempts to reduce the apparent differences by adopting some of the Redshift
/ Postgres conventions in the <code>args</code> parameter. Whether this is helpful or
dangerous folly is in the eye of the beholder.</p>
</div>
<p>The <code>args</code> parameter must contain a list of 
<a href="https://docs.aws.amazon.com/AmazonRDS/latest/AuroraUserGuide/AuroraMySQL.Integrating.LoadFromS3.html#AuroraMySQL.Integrating.LoadFromS3.Text">Aurora MySQL LOAD DATA</a> command options. See also
the <a href="https://dev.mysql.com/doc/refman/5.6/en/load-data.html">standard MySQL LOAD DATA reference</a>.
Only the following options are supported:</p>
<ul>
<li>FILE</li>
<li>IGNORE</li>
<li>MANIFEST</li>
<li>PARTITION</li>
<li>PREFIX</li>
<li>REPLACE</li>
</ul>
<p>In addition, the following non-standard options are supported:</p>
<table>
<thead>
<tr>
<th>Option</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>DELIMITER</td>
<td>Takes an argument of the form <code>'string'</code> specifying the column delimiter.</td>
</tr>
<tr>
<td>ENCODING</td>
<td>Takes an argument specifying the character set of the data.</td>
</tr>
<tr>
<td>ESCAPE</td>
<td>Takes an argument of the form <code>'char'</code> specifying the character used to escape quote characters.</td>
</tr>
<tr>
<td>HEADER</td>
<td>Takes an optional integer argument specifying the number of header lines to skip. The default value is <code>1</code>.</td>
</tr>
<tr>
<td>QUOTE</td>
<td>Takes arguments of the form <code>[OPTIONAL] 'char'</code> specifying the character used to quote data fields. If the <code>OPTIONAL</code> keyword is present, only fields with a string type are quoted. If omitted, all fields are quoted.</td>
</tr>
<tr>
<td>TERMINATOR</td>
<td>Takes an argument in the form <code>DOS | UNIX | 'char'</code>. The <code>DOS</code> and <code>UNIX</code> options set the line terminator appropriate for data sourced from those systems.</td>
</tr>
</tbody>
</table>
<h4 id="aurora-mysql-examples">Aurora MySQL Examples<a class="headerlink" href="#aurora-mysql-examples" title="Permanent link">&para;</a></h4>
<p>The following example shows loading of a data file to a table in <code>switch</code> mode.
The tables <code>membership_a</code> and <code>membership_b</code> will be created with the given
column specifications if they don't already exist.</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-15-1"><span class="p">{</span>
</span><span id="__span-15-2"><span class="w">  </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Copy data to the table &#39;custardclub.membership&#39;&quot;</span><span class="p">,</span>
</span><span id="__span-15-3"><span class="w">  </span><span class="nt">&quot;dispatcher&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Sydney&quot;</span><span class="p">,</span>
</span><span id="__span-15-4"><span class="w">  </span><span class="nt">&quot;enabled&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-15-5"><span class="w">  </span><span class="nt">&quot;job_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo/copy-mytable&quot;</span><span class="p">,</span>
</span><span id="__span-15-6"><span class="w">  </span><span class="nt">&quot;owner&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo@somewhere.com&quot;</span><span class="p">,</span>
</span><span id="__span-15-7"><span class="w">  </span><span class="nt">&quot;parameters&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-8"><span class="w">    </span><span class="nt">&quot;db_conn_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;mysql-aurora-conn-01&quot;</span><span class="p">,</span>
</span><span id="__span-15-9"><span class="w">    </span><span class="nt">&quot;bucket&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;my-bucket&quot;</span><span class="p">,</span>
</span><span id="__span-15-10"><span class="w">    </span><span class="nt">&quot;key&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;a/b/data.csv&quot;</span><span class="p">,</span>
</span><span id="__span-15-11"><span class="w">    </span><span class="nt">&quot;schema&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;custardclub&quot;</span><span class="p">,</span>
</span><span id="__span-15-12"><span class="w">    </span><span class="nt">&quot;table&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;membership&quot;</span><span class="p">,</span>
</span><span id="__span-15-13"><span class="w">    </span><span class="nt">&quot;mode&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;switch&quot;</span><span class="p">,</span>
</span><span id="__span-15-14"><span class="w">    </span><span class="nt">&quot;args&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-15-15"><span class="w">      </span><span class="s2">&quot;DELIMITER &#39;,&#39;&quot;</span><span class="p">,</span>
</span><span id="__span-15-16"><span class="w">      </span><span class="s2">&quot;HEADER&quot;</span><span class="p">,</span>
</span><span id="__span-15-17"><span class="w">      </span><span class="s2">&quot;ENCODING utf8&quot;</span><span class="p">,</span>
</span><span id="__span-15-18"><span class="w">      </span><span class="s2">&quot;QUOTE OPTIONAL &#39;\&quot;&#39;&quot;</span><span class="p">,</span>
</span><span id="__span-15-19"><span class="w">      </span><span class="s2">&quot;TERMINATOR UNIX&quot;</span>
</span><span id="__span-15-20"><span class="w">    </span><span class="p">],</span>
</span><span id="__span-15-21"><span class="w">    </span><span class="nt">&quot;columns&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-15-22"><span class="w">      </span><span class="s2">&quot;CustardClubNo INTEGER PRIMARY KEY NOT NULL&quot;</span><span class="p">,</span>
</span><span id="__span-15-23"><span class="w">      </span><span class="s2">&quot;GivenName VARCHAR(20)&quot;</span><span class="p">,</span>
</span><span id="__span-15-24"><span class="w">      </span><span class="s2">&quot;FamilyName VARCHAR(30)&quot;</span><span class="p">,</span>
</span><span id="__span-15-25"><span class="w">      </span><span class="s2">&quot;CustardBidPrice FLOAT(2)&quot;</span><span class="p">,</span>
</span><span id="__span-15-26"><span class="w">      </span><span class="s2">&quot;CustardJedi BOOLEAN&quot;</span><span class="p">,</span>
</span><span id="__span-15-27"><span class="w">      </span><span class="s2">&quot;LastCustard DATE&quot;</span><span class="p">,</span>
</span><span id="__span-15-28"><span class="w">      </span><span class="s2">&quot;CustardQuota INTEGER&quot;</span>
</span><span id="__span-15-29"><span class="w">    </span><span class="p">]</span>
</span><span id="__span-15-30"><span class="w">  </span><span class="p">},</span>
</span><span id="__span-15-31"><span class="w">  </span><span class="nt">&quot;payload&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;--&quot;</span><span class="p">,</span>
</span><span id="__span-15-32"><span class="w">  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;db_from_s3&quot;</span><span class="p">,</span>
</span><span id="__span-15-33"><span class="w">  </span><span class="nt">&quot;worker&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;default&quot;</span>
</span><span id="__span-15-34"><span class="p">}</span>
</span></code></pre></div>
<h3 id="loading-data-to-aurora-postgres">Loading Data to Aurora Postgres<a class="headerlink" href="#loading-data-to-aurora-postgres" title="Permanent link">&para;</a></h3>
<p>See <a href="#loading-data-to-postgres-rds">Loading Data to Postgres RDS</a>.</p>
<h3 id="loading-data-to-oracle">Loading Data to Oracle<a class="headerlink" href="#loading-data-to-oracle" title="Permanent link">&para;</a></h3>
<p>Loading to Oracle is done by lava performing direct data insertion. The files
to be loaded are copied from S3 to the lava worker node, decompressed on the fly
if required, and then inserted row by row into the database by lava.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>If using <code>TRUNCATE</code> or <code>DROP</code> mode, a <code>COMMIT</code> is done after the
<code>TRUNCATE</code> / <code>DROP</code> but prior to loading of new data.</p>
</div>
<h4 id="oracle-specific-parameters">Oracle Specific Parameters<a class="headerlink" href="#oracle-specific-parameters" title="Permanent link">&para;</a></h4>
<p>The <code>db_conn_id</code> parameter must point to a connection with a <code>type</code> of
<a href="07-connectors.html#connector-type-sqlite3">oracle</a>.</p>
<p>The <code>args</code> parameter supports the following options. The CSV format related
options are linked directly to the Python <code>csv</code> module
<a href="https://docs.python.org/3.9/library/csv.html#csv-fmt-params">formatting parameters</a>.</p>
<table>
<thead>
<tr>
<th>Option</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>DELIMITER 'c'</td>
<td>As for the Python <code>csv</code> module <a href="https://docs.python.org/3.9/library/csv.html#csv-fmt-params">formatting parameters</a>.</td>
</tr>
<tr>
<td>DOUBLEQUOTE</td>
<td>Controls how instances of <code>QUOTECHAR</code> appearing inside a field should themselves be quoted. If the <code>DOUBLEQUOTE</code> option is present, the character is doubled. If not present, the <code>ESCAPECHAR</code> is used as a prefix to the <code>QUOTECHAR</code>.</td>
</tr>
<tr>
<td>ESCAPECHAR 'c'</td>
<td>As for the Python <code>csv</code> module <a href="https://docs.python.org/3.9/library/csv.html#csv-fmt-params">formatting parameters</a>.</td>
</tr>
<tr>
<td>GZIP</td>
<td>Source data is compressed using gzip. The worker will decompress it on the fly for insertion.</td>
</tr>
<tr>
<td>HEADER</td>
<td>Ignore the first line in each data file.</td>
</tr>
<tr>
<td>MANIFEST</td>
<td>The S3 object will be treated as a <a href="https://docs.aws.amazon.com/redshift/latest/dg/loading-data-files-using-manifest.html">Redshift compatible manifest</a> containing a list of actual data files to load.</td>
</tr>
<tr>
<td>QUOTECHAR 'c'</td>
<td>As for the Python <code>csv</code> module <a href="https://docs.python.org/3.9/library/csv.html#csv-fmt-params">formatting parameters</a>.</td>
</tr>
<tr>
<td>QUOTING 'style'</td>
<td>As for the Python <code>csv</code> module <a href="https://docs.python.org/3.9/library/csv.html#csv.QUOTE_ALL">QUOTE_*</a> parameters (without the <code>QUOTE_</code> prefix). Default is <code>minimal</code> (i.e. <code>QUOTE_MINIMAL</code>). Case is not significant.</td>
</tr>
</tbody>
</table>
<h3 id="loading-data-to-postgres">Loading Data to Postgres<a class="headerlink" href="#loading-data-to-postgres" title="Permanent link">&para;</a></h3>
<p>Loading to Postgres is done using a <a href="https://www.postgresql.org/docs/10/sql-copy.html">client side
COPY</a>. The files to be loaded
are copied from S3 to the lava worker node, decompressed if required, and then
copied to the database via the client.</p>
<p>While this will work for Postgres RDS/Aurora, it will be much slower than a
direct S3 copy as described in <a href="#loading-data-to-postgres-rds">Loading Data to Postgres
RDS</a>.</p>
<p>Moreover, if multiple files are to be loaded (e.g. when using a manifest), the
files are processed sequentially. This can make the whole operation rather slow.
If large amounts of data need to be loaded, it is recommended to implement a
custom loading process.</p>
<p>Loading of each individual file is subject to a timeout which is set via the
<a href="10-installation-operation.html#configuration-for-db_from_s3-jobs">PG_COPY_TIMEOUT</a>
configuration variable. This can be set at the worker or realm level.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>If using <code>TRUNCATE</code> or <code>DROP</code> mode, a <code>COMMIT</code> is done after the <code>TRUNCATE</code>
/ <code>DROP</code> but prior to loading of new data.</p>
</div>
<h4 id="postgres-specific-parameters">Postgres Specific Parameters<a class="headerlink" href="#postgres-specific-parameters" title="Permanent link">&para;</a></h4>
<p>The <code>db_conn_id</code> parameter must point to a connection with a <code>type</code> of
<a href="07-connectors.html#connector-type-postgres">postgres</a> or
<a href="07-connectors.html#connector-type-psql">psql</a>.</p>
<p>Use with
<a href="07-connectors.html#connector-type-postgres-aurora">postgres-aurora</a> or
<a href="07-connectors.html#connector-type-postgres-rds">postgres-rds</a>
will work but is not recommended.</p>
<p>The worker uses its own credentials to copy the files from S3 to local storage.
The <code>s3_conn_id</code> and <code>s3_iam_role</code> parameters are not used.</p>
<p>The <code>args</code> parameter must contain a list Postgres
<a href="https://www.postgresql.org/docs/10/sql-copy.html">COPY</a> options. </p>
<p>The following options are supported:</p>
<ul>
<li>DELIMITER</li>
<li>ENCODING</li>
<li>ESCAPE</li>
<li>FORCE_NOT_NULL (see below)</li>
<li>FORCE_NULL (see below)</li>
<li>FORMAT</li>
<li>FREEZE</li>
<li>HEADER</li>
<li>NULL</li>
<li>OIDS</li>
<li>QUOTE</li>
</ul>
<p>In addition, the following non-standard options are supported:</p>
<table>
<thead>
<tr>
<th>Option</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>FORCE_NOT_NULL</td>
<td>As for <code>FORCE_NULL</code>.</td>
</tr>
<tr>
<td>FORCE_NULL</td>
<td>This standard option accepts a non-standard <code>*</code> argument which lava will replace with a list of all columns in the target table.</td>
</tr>
<tr>
<td>GZIP</td>
<td>Source data is compressed using gzip. The worker will decompress it prior to loading.</td>
</tr>
<tr>
<td>MANIFEST</td>
<td>The S3 object will be treated as a <a href="https://docs.aws.amazon.com/redshift/latest/dg/loading-data-files-using-manifest.html">Redshift compatible manifest</a> containing a list of actual data files to load.</td>
</tr>
</tbody>
</table>
<h3 id="loading-data-to-postgres-rds">Loading Data to Postgres RDS<a class="headerlink" href="#loading-data-to-postgres-rds" title="Permanent link">&para;</a></h3>
<p>Loading to Postgres RDS and Aurora Postgres is done using the native
<a href="https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/PostgreSQL.Procedural.Importing.html">aws_s3.table_import_from_s3</a>
facility. This is supported in the following versions:</p>
<ul>
<li>AWS RDS PostgreSQL versions 11.1+</li>
<li>AWS RDS Aurora PostgreSQL-compatible versions 10.7+</li>
</ul>
<p>There are a number of
<a href="#enabling-the-postgres-rds-copy-extension">preliminary setup steps</a>
required on the database itself to enable this mechanism. Once enabled, it can
load uncompressed data and gzip compressed data.</p>
<h4 id="postgres-rds-specific-parameters">Postgres RDS Specific Parameters<a class="headerlink" href="#postgres-rds-specific-parameters" title="Permanent link">&para;</a></h4>
<p>The <code>db_conn_id</code> parameter must point to a connection with a <code>type</code> of either
<a href="07-connectors.html#connector-type-postgres-aurora">postgres-aurora</a> or
<a href="07-connectors.html#connector-type-postgres-rds">postgres-rds</a>.</p>
<p>If the <code>s3_conn_id</code> parameter is specified, the relevant connector will be used
to provide credentials to access S3. If the parameter is not specified, the
database must have an attached IAM role that provides the required access to S3.
As this is implicit, there is no need to specify the <code>s3_conn_id</code> parameter.</p>
<p>The <code>args</code> parameter must contain a list of Postgres
<a href="https://www.postgresql.org/docs/10/sql-copy.html">COPY</a> command options
appropriate for the data file.</p>
<p>The following options are supported:</p>
<ul>
<li>DELIMITER</li>
<li>ENCODING</li>
<li>ESCAPE</li>
<li>FORCE_NOT_NULL (see below)</li>
<li>FORCE_NULL (see below)</li>
<li>FORMAT</li>
<li>FREEZE</li>
<li>HEADER</li>
<li>NULL</li>
<li>OIDS</li>
<li>QUOTE</li>
</ul>
<p>In addition, the following non-standard options are supported:</p>
<table>
<thead>
<tr>
<th>Option</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>FORCE_NOT_NULL</td>
<td>As for <code>FORCE_NULL</code>.</td>
</tr>
<tr>
<td>FORCE_NULL</td>
<td>This standard option accepts a non-standard <code>*</code> argument which lava will replace with a list of all columns in the target table.</td>
</tr>
<tr>
<td>GZIP</td>
<td>The Postgres copy operation can load gzip compressed data but the S3 object being loaded must have its <code>Content-Encoding</code> metadata set to <code>gzip</code>. If this option is specified, lava will attempt to set the content encoding appropriately if necessary. Be aware that this is, in fact, an object copy operation with new metadata so the worker will require appropriate IAM permissions to do that.</td>
</tr>
<tr>
<td>MANIFEST</td>
<td>The S3 object will be treated as a <a href="https://docs.aws.amazon.com/redshift/latest/dg/loading-data-files-using-manifest.html">Redshift compatible manifest</a> containing a list of actual data files to load.</td>
</tr>
</tbody>
</table>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>When configuring a bucket event notification for s3trigger to dispatch a
<code>db_from_s3</code> job using GZIP compression, <strong>do not</strong>  trigger on All object
create events<code>as this may cause two events to be sent and the job will run
twice. Restrict the event type to</code>ObjectCreated:Put` only. This is due to
the hidden copy operation lava must perform to set the correct content
encoding on the source S3 object.</p>
</div>
<h4 id="enabling-the-postgres-rds-copy-extension">Enabling the Postgres RDS Copy Extension<a class="headerlink" href="#enabling-the-postgres-rds-copy-extension" title="Permanent link">&para;</a></h4>
<p>To enable the
<a href="https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/PostgreSQL.Procedural.Importing.html">aws_s3.table_import_from_s3</a>
copy extension follow the AWS instructions.</p>
<p>It is also necessary to allow the database users who will be performing
copy operations to access the extension, thus:</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-16-1"><span class="k">GRANT</span><span class="w"> </span><span class="k">USAGE</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="k">SCHEMA</span><span class="w"> </span><span class="n">aws_s3</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="o">&lt;</span><span class="k">USER</span><span class="o">&gt;</span><span class="p">;</span>
</span><span id="__span-16-2"><span class="k">GRANT</span><span class="w"> </span><span class="k">EXECUTE</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="k">FUNCTION</span><span class="w"> </span><span class="n">aws_s3</span><span class="p">.</span><span class="n">table_import_from_s3</span>
</span><span id="__span-16-3"><span class="w">    </span><span class="p">(</span>
</span><span id="__span-16-4"><span class="w">        </span><span class="k">table_name</span><span class="w"> </span><span class="nb">text</span><span class="p">,</span>
</span><span id="__span-16-5"><span class="w">        </span><span class="n">column_list</span><span class="w"> </span><span class="nb">text</span><span class="p">,</span>
</span><span id="__span-16-6"><span class="w">        </span><span class="k">options</span><span class="w"> </span><span class="nb">text</span><span class="p">,</span>
</span><span id="__span-16-7"><span class="w">        </span><span class="n">bucket</span><span class="w"> </span><span class="nb">text</span><span class="p">,</span>
</span><span id="__span-16-8"><span class="w">        </span><span class="n">file_path</span><span class="w"> </span><span class="nb">text</span><span class="p">,</span>
</span><span id="__span-16-9"><span class="w">        </span><span class="n">region</span><span class="w"> </span><span class="nb">text</span><span class="p">,</span>
</span><span id="__span-16-10"><span class="w">        </span><span class="n">access_key</span><span class="w"> </span><span class="nb">text</span><span class="p">,</span>
</span><span id="__span-16-11"><span class="w">        </span><span class="n">secret_key</span><span class="w"> </span><span class="nb">text</span><span class="p">,</span>
</span><span id="__span-16-12"><span class="w">        </span><span class="n">session_token</span><span class="w"> </span><span class="nb">text</span>
</span><span id="__span-16-13"><span class="w">        </span><span class="p">)</span>
</span><span id="__span-16-14"><span class="w">    </span><span class="k">TO</span><span class="w"> </span><span class="o">&lt;</span><span class="k">USER</span><span class="o">&gt;</span><span class="p">;</span>
</span></code></pre></div>
<h4 id="postgres-rdsaurora-examples">Postgres RDS/Aurora Examples<a class="headerlink" href="#postgres-rdsaurora-examples" title="Permanent link">&para;</a></h4>
<p>The following example shows loading of a data file to a table in <code>switch</code> mode.
The tables <code>membership_a</code> and <code>membership_b</code> will be created with the given
column specifications if they don't already exist.</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-17-1"><span class="p">{</span>
</span><span id="__span-17-2"><span class="w">  </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Copy data to the table &#39;custardclub.membership&#39;&quot;</span><span class="p">,</span>
</span><span id="__span-17-3"><span class="w">  </span><span class="nt">&quot;dispatcher&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Sydney&quot;</span><span class="p">,</span>
</span><span id="__span-17-4"><span class="w">  </span><span class="nt">&quot;enabled&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-17-5"><span class="w">  </span><span class="nt">&quot;job_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo/copy-mytable&quot;</span><span class="p">,</span>
</span><span id="__span-17-6"><span class="w">  </span><span class="nt">&quot;owner&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo@somewhere.com&quot;</span><span class="p">,</span>
</span><span id="__span-17-7"><span class="w">  </span><span class="nt">&quot;parameters&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-17-8"><span class="w">    </span><span class="nt">&quot;db_conn_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;pg-rds-conn-01&quot;</span><span class="p">,</span>
</span><span id="__span-17-9"><span class="w">    </span><span class="nt">&quot;s3_conn_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;s3-conn-01&quot;</span><span class="p">,</span>
</span><span id="__span-17-10"><span class="w">    </span><span class="nt">&quot;bucket&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;my-bucket&quot;</span><span class="p">,</span>
</span><span id="__span-17-11"><span class="w">    </span><span class="nt">&quot;key&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;a/b/data.csv&quot;</span><span class="p">,</span>
</span><span id="__span-17-12"><span class="w">    </span><span class="nt">&quot;schema&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;custardclub&quot;</span><span class="p">,</span>
</span><span id="__span-17-13"><span class="w">    </span><span class="nt">&quot;table&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;membership&quot;</span><span class="p">,</span>
</span><span id="__span-17-14"><span class="w">    </span><span class="nt">&quot;mode&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;truncate&quot;</span><span class="p">,</span>
</span><span id="__span-17-15"><span class="w">    </span><span class="nt">&quot;args&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-17-16"><span class="w">      </span><span class="s2">&quot;FORMAT CSV&quot;</span><span class="p">,</span>
</span><span id="__span-17-17"><span class="w">      </span><span class="s2">&quot;HEADER&quot;</span>
</span><span id="__span-17-18"><span class="w">    </span><span class="p">],</span>
</span><span id="__span-17-19"><span class="w">    </span><span class="nt">&quot;columns&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-17-20"><span class="w">      </span><span class="s2">&quot;CustardClubNo INTEGER PRIMARY KEY NOT NULL&quot;</span><span class="p">,</span>
</span><span id="__span-17-21"><span class="w">      </span><span class="s2">&quot;GivenName VARCHAR(20)&quot;</span><span class="p">,</span>
</span><span id="__span-17-22"><span class="w">      </span><span class="s2">&quot;FamilyName VARCHAR(30)&quot;</span><span class="p">,</span>
</span><span id="__span-17-23"><span class="w">      </span><span class="s2">&quot;CustardBidPrice FLOAT(2)&quot;</span><span class="p">,</span>
</span><span id="__span-17-24"><span class="w">      </span><span class="s2">&quot;CustardJedi BOOLEAN&quot;</span><span class="p">,</span>
</span><span id="__span-17-25"><span class="w">      </span><span class="s2">&quot;LastCustard DATE&quot;</span><span class="p">,</span>
</span><span id="__span-17-26"><span class="w">      </span><span class="s2">&quot;CustardQuota INTEGER&quot;</span>
</span><span id="__span-17-27"><span class="w">    </span><span class="p">]</span>
</span><span id="__span-17-28"><span class="w">  </span><span class="p">},</span>
</span><span id="__span-17-29"><span class="w">  </span><span class="nt">&quot;payload&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;--&quot;</span><span class="p">,</span>
</span><span id="__span-17-30"><span class="w">  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;db_from_s3&quot;</span><span class="p">,</span>
</span><span id="__span-17-31"><span class="w">  </span><span class="nt">&quot;worker&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;default&quot;</span>
</span><span id="__span-17-32"><span class="p">}</span>
</span></code></pre></div>
<h3 id="loading-data-to-redshift">Loading Data to Redshift<a class="headerlink" href="#loading-data-to-redshift" title="Permanent link">&para;</a></h3>
<p>Loading to Redshift is done using the native Redshift
<a href="https://docs.aws.amazon.com/redshift/latest/dg/r_COPY.html">COPY</a> command.
Data files contain structured, tabular data. All of the formats supported by
the <a href="https://docs.aws.amazon.com/redshift/latest/dg/r_COPY.html">COPY</a> command
can be used, including:</p>
<ul>
<li>CSV files</li>
<li>JSON files</li>
<li>Compressed versions of the above.</li>
</ul>
<p>For Redshift, it is generally better to use <code>truncate</code> mode rather than <code>delete</code>.</p>
<h4 id="redshift-specific-parameters">Redshift Specific Parameters<a class="headerlink" href="#redshift-specific-parameters" title="Permanent link">&para;</a></h4>
<p>The <code>db_conn_id</code> parameter must point to a connection with a <code>type</code> of
<a href="07-connectors.html#connector-type-redshift">redshift</a> or
<a href="07-connectors.html#connector-type-redshift-serverless">redshift-serverless</a>.</p>
<p>The <code>args</code> parameter must contain a list of Redshift
<a href="https://docs.aws.amazon.com/redshift/latest/dg/r_COPY.html">COPY</a> options
appropriate for the data file. Most of the parameters supported by
Redshift <a href="https://docs.aws.amazon.com/redshift/latest/dg/r_COPY.html">COPY</a>,
including <code>MANIFEST</code>, can be used.</p>
<h4 id="redshift-examples">Redshift Examples<a class="headerlink" href="#redshift-examples" title="Permanent link">&para;</a></h4>
<p>The following example shows loading of a data file to a table in <code>append</code> mode.
The table will be created with the given column specifications if it doesn't
already exist.</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-18-1"><span class="p">{</span>
</span><span id="__span-18-2"><span class="w">  </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Copy data to the table &#39;custardclub.membership&#39;&quot;</span><span class="p">,</span>
</span><span id="__span-18-3"><span class="w">  </span><span class="nt">&quot;dispatcher&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Sydney&quot;</span><span class="p">,</span>
</span><span id="__span-18-4"><span class="w">  </span><span class="nt">&quot;enabled&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-18-5"><span class="w">  </span><span class="nt">&quot;job_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo/copy-mytable&quot;</span><span class="p">,</span>
</span><span id="__span-18-6"><span class="w">  </span><span class="nt">&quot;owner&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo@somewhere.com&quot;</span><span class="p">,</span>
</span><span id="__span-18-7"><span class="w">  </span><span class="nt">&quot;parameters&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-18-8"><span class="w">    </span><span class="nt">&quot;db_conn_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;redshift-conn-01&quot;</span><span class="p">,</span>
</span><span id="__span-18-9"><span class="w">    </span><span class="nt">&quot;s3_conn_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;s3-conn-01&quot;</span><span class="p">,</span>
</span><span id="__span-18-10"><span class="w">    </span><span class="nt">&quot;bucket&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;my-bucket&quot;</span><span class="p">,</span>
</span><span id="__span-18-11"><span class="w">    </span><span class="nt">&quot;key&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;a/b/data.csv.bz2&quot;</span><span class="p">,</span>
</span><span id="__span-18-12"><span class="w">    </span><span class="nt">&quot;schema&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;custardclub&quot;</span><span class="p">,</span>
</span><span id="__span-18-13"><span class="w">    </span><span class="nt">&quot;table&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;membership&quot;</span><span class="p">,</span>
</span><span id="__span-18-14"><span class="w">    </span><span class="nt">&quot;mode&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;truncate&quot;</span><span class="p">,</span>
</span><span id="__span-18-15"><span class="w">    </span><span class="nt">&quot;args&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-18-16"><span class="w">      </span><span class="s2">&quot;BLANKSASNULL&quot;</span><span class="p">,</span>
</span><span id="__span-18-17"><span class="w">      </span><span class="s2">&quot;BZIP2&quot;</span><span class="p">,</span>
</span><span id="__span-18-18"><span class="w">      </span><span class="s2">&quot;CSV&quot;</span><span class="p">,</span>
</span><span id="__span-18-19"><span class="w">      </span><span class="s2">&quot;EMPTYASNULL&quot;</span><span class="p">,</span>
</span><span id="__span-18-20"><span class="w">      </span><span class="s2">&quot;IGNOREHEADER 1&quot;</span><span class="p">,</span>
</span><span id="__span-18-21"><span class="w">      </span><span class="s2">&quot;MAXERROR 0&quot;</span><span class="p">,</span>
</span><span id="__span-18-22"><span class="w">    </span><span class="p">],</span>
</span><span id="__span-18-23"><span class="w">    </span><span class="nt">&quot;columns&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-18-24"><span class="w">      </span><span class="s2">&quot;CustardClubNo INTEGER PRIMARY KEY NOT NULL&quot;</span><span class="p">,</span>
</span><span id="__span-18-25"><span class="w">      </span><span class="s2">&quot;GivenName VARCHAR(20)&quot;</span><span class="p">,</span>
</span><span id="__span-18-26"><span class="w">      </span><span class="s2">&quot;FamilyName VARCHAR(30)&quot;</span><span class="p">,</span>
</span><span id="__span-18-27"><span class="w">      </span><span class="s2">&quot;CustardBidPrice FLOAT(2)&quot;</span><span class="p">,</span>
</span><span id="__span-18-28"><span class="w">      </span><span class="s2">&quot;CustardJedi BOOLEAN&quot;</span><span class="p">,</span>
</span><span id="__span-18-29"><span class="w">      </span><span class="s2">&quot;LastCustard DATE&quot;</span><span class="p">,</span>
</span><span id="__span-18-30"><span class="w">      </span><span class="s2">&quot;CustardQuota INTEGER&quot;</span>
</span><span id="__span-18-31"><span class="w">    </span><span class="p">]</span>
</span><span id="__span-18-32"><span class="w">  </span><span class="p">},</span>
</span><span id="__span-18-33"><span class="w">  </span><span class="nt">&quot;payload&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;--&quot;</span><span class="p">,</span>
</span><span id="__span-18-34"><span class="w">  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;db_from_s3&quot;</span><span class="p">,</span>
</span><span id="__span-18-35"><span class="w">  </span><span class="nt">&quot;worker&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;default&quot;</span>
</span><span id="__span-18-36"><span class="p">}</span>
</span></code></pre></div>
<h3 id="loading-data-to-sqlite3">Loading Data to SQLite3<a class="headerlink" href="#loading-data-to-sqlite3" title="Permanent link">&para;</a></h3>
<p>Loading to SQLite is done by lava performing direct data insertion. The files
to be loaded are copied from S3 to the lava worker node, decompressed on the fly
if required, and then inserted row by row into the database by lava.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>If using <code>TRUNCATE</code> or <code>DROP</code> mode, a <code>COMMIT</code> is done after the <code>TRUNCATE</code>
/ <code>DROP</code> but prior to loading of new data.</p>
</div>
<h4 id="sqlite3-specific-parameters">SQLite3 Specific Parameters<a class="headerlink" href="#sqlite3-specific-parameters" title="Permanent link">&para;</a></h4>
<p>The <code>db_conn_id</code> parameter must point to a connection with a <code>type</code> of
<a href="07-connectors.html#connector-type-sqlite3">sqlite3</a>.</p>
<p>The <code>schema</code> parameter <em>must</em> be set to <code>main</code> as SQLite3 has a very limited
notion of schemas.</p>
<p>The <code>args</code> parameter supports the following options. The CSV format related
options are linked directly to the Python <code>csv</code> module
<a href="https://docs.python.org/3.9/library/csv.html#csv-fmt-params">formatting parameters</a>.</p>
<table>
<thead>
<tr>
<th>Option</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>DELIMITER 'c'</td>
<td>As for the Python <code>csv</code> module <a href="https://docs.python.org/3.9/library/csv.html#csv-fmt-params">formatting parameters</a>.</td>
</tr>
<tr>
<td>DOUBLEQUOTE</td>
<td>Controls how instances of <code>QUOTECHAR</code> appearing inside a field should themselves be quoted. If the <code>DOUBLEQUOTE</code> option is present, the character is doubled. If not present, the <code>ESCAPECHAR</code> is used as a prefix to the <code>QUOTECHAR</code>.</td>
</tr>
<tr>
<td>ESCAPECHAR 'c'</td>
<td>As for the Python <code>csv</code> module <a href="https://docs.python.org/3.9/library/csv.html#csv-fmt-params">formatting parameters</a>.</td>
</tr>
<tr>
<td>GZIP</td>
<td>Source data is compressed using gzip. The worker will decompress it on the fly for insertion.</td>
</tr>
<tr>
<td>HEADER</td>
<td>Ignore the first line in each data file.</td>
</tr>
<tr>
<td>MANIFEST</td>
<td>The S3 object will be treated as a <a href="https://docs.aws.amazon.com/redshift/latest/dg/loading-data-files-using-manifest.html">Redshift compatible manifest</a> containing a list of actual data files to load.</td>
</tr>
<tr>
<td>QUOTECHAR 'c'</td>
<td>As for the Python <code>csv</code> module <a href="https://docs.python.org/3.9/library/csv.html#csv-fmt-params">formatting parameters</a>.</td>
</tr>
<tr>
<td>QUOTING 'style'</td>
<td>As for the Python <code>csv</code> module <a href="https://docs.python.org/3.9/library/csv.html#csv.QUOTE_ALL">QUOTE_*</a> parameters (without the <code>QUOTE_</code> prefix). Default is <code>minimal</code> (i.e. <code>QUOTE_MINIMAL</code>). Case is not significant.</td>
</tr>
</tbody>
</table>
<h2 id="job-type-dispatch">Job type: dispatch<a class="headerlink" href="#job-type-dispatch" title="Permanent link">&para;</a></h2>
<p>The <strong>dispatch</strong> job type initiates a dispatch of other jobs.</p>
<p>Unlike the <a href="#job-type-chain">chain job type</a>, this is an
asynchronous operation in that the dispatch is initiated but the job run does
not wait for the dispatched jobs to actually start. The dispatched jobs will not
necessarily run on the same worker and will each have their own <code>run_id</code>.</p>
<p>Any globals available in the <strong>dispatch</strong> job will also be passed in the
dispatch requests to the jobs being dispatched.</p>
<h3 id="payload_4">Payload<a class="headerlink" href="#payload_4" title="Permanent link">&para;</a></h3>
<p>The payload is a comma separated list, or an actual list of job IDs to dispatch.</p>
<h3 id="parameters_4">Parameters<a class="headerlink" href="#parameters_4" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>delay</td>
<td>String</td>
<td>No</td>
<td>Dispatch message sending delay in the form <code>nnX</code> where <code>nn</code> is a number and <code>X</code> is <code>s</code> (seconds) or <code>m</code> (minutes). The maximum allowed value is 15 minutes.</td>
</tr>
<tr>
<td>jinja</td>
<td>Boolean</td>
<td>No</td>
<td>If <code>false</code>, disable Jinja rendering of the payload. Default <code>true</code>.</td>
</tr>
<tr>
<td>job_prefix</td>
<td>String</td>
<td>No</td>
<td>Prepend the specified value to each job ID in the payload.</td>
</tr>
<tr>
<td>parameters</td>
<td>Map[String,*]</td>
<td>No</td>
<td>A map of parameters that will be passed to the job being dispatched. This is Jinja rendered.</td>
</tr>
</tbody>
</table>
<h3 id="handling-of-globals_2">Handling of Globals<a class="headerlink" href="#handling-of-globals_2" title="Permanent link">&para;</a></h3>
<p>The <strong>dispatch</strong> job type merges its globals into those of the child jobs being
dispatched. A value specified in the parent <strong>dispatch</strong> job will override a
similarly named value in the child.</p>
<p>In addition, the <strong>dispatch</strong> job will also add
<a href="05-job-dispatch.html#globals-owned-by-lava">lava specific globals</a> under
<code>globals.lava</code>. These lava owned globals allow all jobs dispatched as a result
of the current job to access some common global values.</p>
<h3 id="jinja-rendering-of-the-payload">Jinja Rendering of the Payload<a class="headerlink" href="#jinja-rendering-of-the-payload" title="Permanent link">&para;</a></h3>
<p>The <code>parameters</code> parameter is Jinja rendered.</p>
<p>Refer to <a href="13-jinja-rendering-in-lava.html#jinja-rendering-in-lava">Jinja Rendering in Lava</a>
for more information.</p>
<p>The following variables are made available to the renderer.</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>globals</td>
<td>dict[str,*]</td>
<td>The <code>globals</code> from the job specification updated with any globals received in the job dispatch.</td>
</tr>
<tr>
<td>job</td>
<td>dict[str,*]</td>
<td>The <a href="13-jinja-rendering-in-lava.html#the-augmented-job-specification">augmented job specification</a>.</td>
</tr>
<tr>
<td>realm</td>
<td>dict[str,*]</td>
<td>The realm specification.</td>
</tr>
<tr>
<td>start</td>
<td>datetime</td>
<td>The local time when the job run started.</td>
</tr>
<tr>
<td>state</td>
<td>dict[str,*]</td>
<td>A dictionary of the state items imported into the job, keyed on state_id. The default values are updated at run-time with any current values obtainable from the <a href="04-dynamodb-tables.html#the-state-table">state</a> table.</td>
</tr>
<tr>
<td>ustart</td>
<td>datetime</td>
<td>The UTC time when the job run started.</td>
</tr>
<tr>
<td>utils</td>
<td>dict[str,runnable]</td>
<td>A dictionary of <a href="13-jinja-rendering-in-lava.html#jinja-utility-functions">utility functions</a> that can be used in the Jinja markup.</td>
</tr>
</tbody>
</table>
<h3 id="dev-mode-behaviour_4">Dev Mode Behaviour<a class="headerlink" href="#dev-mode-behaviour_4" title="Permanent link">&para;</a></h3>
<p>The <strong>dispatch</strong> job behaviour is unchanged for dev mode.</p>
<h3 id="examples_3">Examples<a class="headerlink" href="#examples_3" title="Permanent link">&para;</a></h3>
<p>The following example dispatches two downstream jobs with no delay.</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-19-1"><span class="p">{</span>
</span><span id="__span-19-2"><span class="w">  </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Dispatch two downstream jobs&quot;</span><span class="p">,</span>
</span><span id="__span-19-3"><span class="w">  </span><span class="nt">&quot;dispatcher&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Sydney&quot;</span><span class="p">,</span>
</span><span id="__span-19-4"><span class="w">  </span><span class="nt">&quot;enabled&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-19-5"><span class="w">  </span><span class="nt">&quot;job_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo/dispatch2&quot;</span><span class="p">,</span>
</span><span id="__span-19-6"><span class="w">  </span><span class="nt">&quot;owner&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo@somewhere.com&quot;</span><span class="p">,</span>
</span><span id="__span-19-7"><span class="w">  </span><span class="nt">&quot;payload&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo/job_01, demo/job_02&quot;</span><span class="p">,</span>
</span><span id="__span-19-8"><span class="w">  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;dispatch&quot;</span><span class="p">,</span>
</span><span id="__span-19-9"><span class="w">  </span><span class="nt">&quot;worker&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;default&quot;</span>
</span><span id="__span-19-10"><span class="p">}</span>
</span></code></pre></div>
<p>This one dispatches a downstream job with a 5 minute delay and some additional
parameters being passed to the dispatched job. Jinja rendering is disabled.</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-20-1"><span class="p">{</span>
</span><span id="__span-20-2"><span class="w">  </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Dispatch a downstream job&quot;</span><span class="p">,</span>
</span><span id="__span-20-3"><span class="w">  </span><span class="nt">&quot;dispatcher&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Sydney&quot;</span><span class="p">,</span>
</span><span id="__span-20-4"><span class="w">  </span><span class="nt">&quot;enabled&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-20-5"><span class="w">  </span><span class="nt">&quot;job_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo/dispatch1&quot;</span><span class="p">,</span>
</span><span id="__span-20-6"><span class="w">  </span><span class="nt">&quot;owner&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo@somewhere.com&quot;</span><span class="p">,</span>
</span><span id="__span-20-7"><span class="w">  </span><span class="nt">&quot;payload&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo/job_01, demo/job_02&quot;</span><span class="p">,</span>
</span><span id="__span-20-8"><span class="w">  </span><span class="nt">&quot;parameters&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-9"><span class="w">    </span><span class="nt">&quot;delay&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;5m&quot;</span><span class="p">,</span>
</span><span id="__span-20-10"><span class="w">    </span><span class="nt">&quot;jinja&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
</span><span id="__span-20-11"><span class="w">    </span><span class="nt">&quot;parameters&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-12"><span class="w">      </span><span class="nt">&quot;param01&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Hello&quot;</span><span class="p">,</span>
</span><span id="__span-20-13"><span class="w">      </span><span class="nt">&quot;param02&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;world&quot;</span>
</span><span id="__span-20-14"><span class="w">    </span><span class="p">}</span>
</span><span id="__span-20-15"><span class="w">  </span><span class="p">},</span>
</span><span id="__span-20-16"><span class="w">  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;dispatch&quot;</span><span class="p">,</span>
</span><span id="__span-20-17"><span class="w">  </span><span class="nt">&quot;worker&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;default&quot;</span>
</span><span id="__span-20-18"><span class="p">}</span>
</span></code></pre></div>
<h2 id="job-type-docker">Job type: docker<a class="headerlink" href="#job-type-docker" title="Permanent link">&para;</a></h2>
<p>The <strong>docker</strong> job type launches a docker container on the worker node and runs
the nominated command. Refer to the <a href="15-lava-and-docker.html#lava-and-docker">chapter on docker</a> for
more information.</p>
<p>Lava will connect to a <a href="15-lava-and-docker.html#the-docker-registry">docker registry</a>, pull the
specified image from a repository and use it to create and run a container with
the specified command. If no command is specified, the default entry point for
the container will be used.</p>
<p>The logs from the container will be captured and, if non-empty, placed into the
realm <code>s3_temp</code> area as <code>&lt;s3_temp&gt;/&lt;job_id&gt;/&lt;run_id&gt;/logs</code>.</p>
<p>If the command returns a zero exit status the job is considered to have
succeeded. A non-zero exit status indicates failure.</p>
<h3 id="payload_5">Payload<a class="headerlink" href="#payload_5" title="Permanent link">&para;</a></h3>
<p>The payload is the container repository and, optionally, tag in the form
<code>repository[:tag]</code>. If the tag is not specified, a tag of <code>latest</code> is used.</p>
<h3 id="environment_1">Environment<a class="headerlink" href="#environment_1" title="Permanent link">&para;</a></h3>
<p>The following variables are placed into the environment for the container.</p>
<table>
<thead>
<tr>
<th>Variable</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>LAVA_JOB_ID</td>
<td>The <code>job_id</code>.</td>
</tr>
<tr>
<td>LAVA_OWNER</td>
<td>The value of the <code>owner</code> field from the job specification.</td>
</tr>
<tr>
<td>LAVA_REALM</td>
<td>The realm name.</td>
</tr>
<tr>
<td>LAVA_RUN_ID</td>
<td>The <code>run_id</code> UUID.</td>
</tr>
<tr>
<td>LAVA_S3_KEY</td>
<td>The identifier for the KMS key needed to write data into the S3 temporary area.</td>
</tr>
<tr>
<td>LAVA_S3_PAYLOAD</td>
<td>The payload location for this job.</td>
</tr>
<tr>
<td>LAVA_S3_TMP</td>
<td>The private S3 temporary area for this job run. The executables are allowed to put data here.</td>
</tr>
<tr>
<td>LAVA_TMP</td>
<td>The temporary directory on the host worker node is mapped into the container at this location.</td>
</tr>
<tr>
<td>LAVA_WORKER</td>
<td>The worker name.</td>
</tr>
</tbody>
</table>
<h3 id="docker-runtime-configuration">Docker Runtime Configuration<a class="headerlink" href="#docker-runtime-configuration" title="Permanent link">&para;</a></h3>
<p>The container is run with the following run-time attributes:</p>
<ol>
<li>
<p>Environment variables as described above.</p>
</li>
<li>
<p>The local temporary area on the worker node is mapped inside the container
    and its location is made available as the <code>LAVA_TMP</code> environment variable.
    The container can read and write this directory as for other lava jobs. This
    can be useful for <a href="#job-type-chain">chain</a> jobs as they
    share the same temporary directory.</p>
</li>
<li>
<p>The container runs with the user ID (uid) set to the effective uid (euid)
    of the lava worker unless overridden by the <code>host_config</code> in the job
    specification. <strong>Don't</strong> do this unless you know what you're doing.</p>
</li>
<li>
<p>The effective group ID (egid) of the lava worker is added to the list of
    group IDs for the container unless overridden by the <code>host_config</code> in the
    job specification. <strong>Don't</strong> do this unless you know what you're doing.</p>
</li>
<li>
<p>Unless otherwise specified in the <code>host_config</code> job parameter, the default
    host configuration (memory, CPU, ports etc) is used.</p>
</li>
<li>
<p>Stderr and stdout are captured by the lava worker.</p>
</li>
<li>
<p>The container will use any proxy configuration present in the docker client
    configuration file.</p>
</li>
<li>
<p>Unless otherwise specified in the <code>host_config</code>, the hostname of the
    container is set to <code>lava-&lt;REALM&gt;-&lt;WORKER&gt;-&lt;RUN_ID&gt;</code>.</p>
</li>
<li>
<p>Unless otherwise specified in the <code>host_config</code> job parameter, the working
    directory is set to the temporary directory shared between host and
    container. This mimics the behaviour of other executable job types. The
    lava worker will clean up this area on job completion.</p>
</li>
</ol>
<h3 id="parameters_5">Parameters<a class="headerlink" href="#parameters_5" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>args</td>
<td>List[String]</td>
<td>No</td>
<td>A list of additional arguments for the command. Ignored if no command is specified.</td>
</tr>
<tr>
<td>command</td>
<td>String</td>
<td>No</td>
<td>The command to run in the container. This will be parsed using standard Linux shell lexical analysis to determine the executable and arguments. If not specified, the default entry point for the container is used.</td>
</tr>
<tr>
<td>connections</td>
<td>Map[String,String]</td>
<td>No</td>
<td>A dictionary with keys that are connection labels and the values are conn_id</td>
</tr>
<tr>
<td>docker</td>
<td>String</td>
<td>No</td>
<td>The <code>conn_id</code> for <a href="#connecting-to-docker">connecting to docker</a>. If not specified, a value must be specified for the entire realm in the <a href="04-dynamodb-tables.html#the-realms-table">realms table</a>.</td>
</tr>
<tr>
<td>env</td>
<td>Map[String,String]</td>
<td>No</td>
<td>A map of additional environment variables for the container.</td>
</tr>
<tr>
<td>host_config</td>
<td>Map[String,*]</td>
<td>No</td>
<td>A map of container <a href="#container-host-configuration">host configuration parameters</a>.</td>
</tr>
<tr>
<td>jinja</td>
<td>Boolean</td>
<td>No</td>
<td>If <code>false</code>, disable Jinja rendering of the <code>args</code>. Default <code>true</code>.</td>
</tr>
<tr>
<td>timeout</td>
<td>String</td>
<td>No</td>
<td>By default, containers run by <strong>docker</strong> jobs are killed 10 minutes after the container starts to run. This parameter can override that with values in the form <code>nnX</code> where <code>nn</code> is a number and <code>X</code> is <code>s</code> (seconds), <code>m</code> (minutes) or <code>h</code> (hours). Note that the timeout must be less than the visibility timeout on the worker SQS queue minus the time to pull the image and start the container.</td>
</tr>
<tr>
<td>vars</td>
<td>Map[String,*]</td>
<td>No</td>
<td>A map of variables injected when the command arguments and environment are rendered.</td>
</tr>
</tbody>
</table>
<h3 id="connecting-to-docker">Connecting to Docker<a class="headerlink" href="#connecting-to-docker" title="Permanent link">&para;</a></h3>
<p>Lava needs to be able to connect to a docker daemon to create containers and a
docker registry to obtain docker images. Like all connections in lava, this is
managed through the connection manager.</p>
<p>When running a <strong>docker</strong> job, the process to obtain the specified image is:</p>
<ol>
<li>
<p>Look for a <code>docker</code> connection ID in the job parameters. If not found there,
    look for a <code>docker</code> connection ID in the realm specification from the
    <a href="04-dynamodb-tables.html#the-realms-table">realms table</a>.</p>
</li>
<li>
<p>Fetch the daemon and registry connection details from the
    <a href="04-dynamodb-tables.html#the-connections-table">connections table</a>.</p>
</li>
<li>
<p>Connect to the docker daemon.</p>
</li>
<li>
<p>Login to the docker registry and pull the required image from the
    specified registry.</p>
</li>
</ol>
<p>Refer to the section on the
<a href="07-connectors.html#connector-type-docker">docker connector</a> for more
information.</p>
<h3 id="container-host-configuration">Container Host Configuration<a class="headerlink" href="#container-host-configuration" title="Permanent link">&para;</a></h3>
<p>The <code>host_config</code> parameter in the docker job specification is a map that allows
a number of configuration parameters for the container to be specified. The
definition and types of these parameters correspond to like named parameters of
the
<a href="https://docker-py.readthedocs.io/en/stable/containers.html">containers.run()</a>
function of the
<a href="https://docker-py.readthedocs.io/en/stable/index.html">Docker SDK for Python</a>.</p>
<p>The following parameters are permitted:</p>
<ul>
<li>blkio_weight</li>
<li>blkio_weight_device</li>
<li>cap_add</li>
<li>cap_drop</li>
<li>cpu_count</li>
<li>cpu_percent</li>
<li>cpu_period</li>
<li>cpu_quota</li>
<li>cpu_shares</li>
<li>cpuset_cpus</li>
<li>cpuset_mems</li>
<li>device_read_bps</li>
<li>device_read_iops</li>
<li>device_write_bps</li>
<li>device_write_iops</li>
<li>dns</li>
<li>dns_opt</li>
<li>dns_search</li>
<li>domainname</li>
<li>extra_hosts</li>
<li>hostname</li>
<li>group_add</li>
<li>mem_limit</li>
<li>mem_swappiness</li>
<li>memswap_limit</li>
<li>nano_cpus</li>
<li>network_disabled</li>
<li>network_mode</li>
<li>ports</li>
<li>publish_all_ports</li>
<li>shm_size</li>
<li>user</li>
<li>working_dir</li>
</ul>
<p>So, for example, to allow a container to use CPUs 0 and 1, disable networking in
the container and set the working directory to <code>/tmp/lava</code> add the following:</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-21-1"><span class="p">{</span>
</span><span id="__span-21-2"><span class="w">  </span><span class="nt">&quot;parameters&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-21-3"><span class="w">    </span><span class="nt">&quot;host_config&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-21-4"><span class="w">      </span><span class="nt">&quot;cpuset_cpus&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;0,1&quot;</span><span class="p">,</span>
</span><span id="__span-21-5"><span class="w">      </span><span class="nt">&quot;network_disabled&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-21-6"><span class="w">      </span><span class="nt">&quot;working_dir&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/tmp/lava&quot;</span>
</span><span id="__span-21-7"><span class="w">    </span><span class="p">}</span>
</span><span id="__span-21-8"><span class="w">  </span><span class="p">}</span>
</span><span id="__span-21-9"><span class="p">}</span>
</span></code></pre></div>
<h3 id="jinja-rendering-of-the-arguments-and-environment">Jinja Rendering of the Arguments and Environment<a class="headerlink" href="#jinja-rendering-of-the-arguments-and-environment" title="Permanent link">&para;</a></h3>
<p>The collected arguments for the command and any environment values defined in
the job specification are individually rendered using
<a href="http://jinja.pocoo.org">Jinja</a> prior to execution.</p>
<p>Refer to <a href="13-jinja-rendering-in-lava.html#jinja-rendering-in-lava">Jinja Rendering in Lava</a>
for more information.</p>
<p>The following variables are made available to the renderer.</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>globals</td>
<td>dict[str,*]</td>
<td>The <code>globals</code> from the job specification updated with any globals received in the job dispatch.</td>
</tr>
<tr>
<td>job</td>
<td>dict[str,*]</td>
<td>The <a href="13-jinja-rendering-in-lava.html#the-augmented-job-specification">augmented job specification</a>.</td>
</tr>
<tr>
<td>realm</td>
<td>dict[str,*]</td>
<td>The realm specification.</td>
</tr>
<tr>
<td>start</td>
<td>datetime</td>
<td>The local time when the job run started.</td>
</tr>
<tr>
<td>state</td>
<td>dict[str,*]</td>
<td>A dictionary of the state items imported into the job, keyed on state_id. The default values are updated at run-time with any current values obtainable from the <a href="04-dynamodb-tables.html#the-state-table">state</a> table.</td>
</tr>
<tr>
<td>ustart</td>
<td>datetime</td>
<td>The UTC time when the job run started.</td>
</tr>
<tr>
<td>utils</td>
<td>dict[str,runnable]</td>
<td>A dictionary of <a href="13-jinja-rendering-in-lava.html#jinja-utility-functions">utility functions</a> that can be used in the Jinja markup.</td>
</tr>
<tr>
<td>vars</td>
<td>dict[str,*]</td>
<td>A dictionary of variables provided as the <code>vars</code> component of the job <code>parameters</code>.</td>
</tr>
</tbody>
</table>
<h3 id="connection-handling">Connection Handling<a class="headerlink" href="#connection-handling" title="Permanent link">&para;</a></h3>
<p>Connections are handled similarly to the
<a href="#job-type-exe">exe job type</a>. In the case of a docker job, the
connection handler executables are mapped into the container and are invoked in
the same way.</p>
<p>Python executables running in a docker container based on one of the <a href="15-lava-and-docker.html#docker-images-for-lava">docker
images for lava</a> can use the connection manager
directly as described in <a href="12-developing-lava-jobs.html#connection-handling-for-python-based-jobs">the relevant
section</a> in the chapter on
<a href="12-developing-lava-jobs.html#developing-lava-jobs">developing lava jobs</a>.  It is important to ensure that
<code>/usr/local/lib/lava</code> is on the <code>PYTHONPATH</code> for the executable in the
container.</p>
<h3 id="dev-mode-behaviour_5">Dev Mode Behaviour<a class="headerlink" href="#dev-mode-behaviour_5" title="Permanent link">&para;</a></h3>
<p>Normally, the <strong>docker</strong> job will copy the container logs to S3 on the
conclusion of the job. In dev mode, the container logs are emitted locally after
the job run instead of being copied to S3.</p>
<h3 id="examples_4">Examples<a class="headerlink" href="#examples_4" title="Permanent link">&para;</a></h3>
<p>The following example will run a shell to invoke the Linux date command in one
of the standard lava docker images. The connection ID for the docker registry
containing the image is <code>ecr</code>.</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-22-1"><span class="p">{</span>
</span><span id="__span-22-2"><span class="w">  </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Run a simple command in a container&quot;</span><span class="p">,</span>
</span><span id="__span-22-3"><span class="w">  </span><span class="nt">&quot;dispatcher&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Sydney&quot;</span><span class="p">,</span>
</span><span id="__span-22-4"><span class="w">  </span><span class="nt">&quot;enabled&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-22-5"><span class="w">  </span><span class="nt">&quot;job_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo/simple-docker&quot;</span><span class="p">,</span>
</span><span id="__span-22-6"><span class="w">  </span><span class="nt">&quot;owner&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo@somewhere.com&quot;</span><span class="p">,</span>
</span><span id="__span-22-7"><span class="w">  </span><span class="nt">&quot;parameters&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-22-8"><span class="w">    </span><span class="nt">&quot;args&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-22-9"><span class="w">      </span><span class="s2">&quot;-c&quot;</span><span class="p">,</span>
</span><span id="__span-22-10"><span class="w">      </span><span class="s2">&quot;date&quot;</span>
</span><span id="__span-22-11"><span class="w">    </span><span class="p">],</span>
</span><span id="__span-22-12"><span class="w">    </span><span class="nt">&quot;command&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/bin/sh&quot;</span><span class="p">,</span>
</span><span id="__span-22-13"><span class="w">    </span><span class="nt">&quot;docker&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ecr&quot;</span><span class="p">,</span>
</span><span id="__span-22-14"><span class="w">    </span><span class="nt">&quot;timeout&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;10s&quot;</span>
</span><span id="__span-22-15"><span class="w">  </span><span class="p">},</span>
</span><span id="__span-22-16"><span class="w">  </span><span class="nt">&quot;payload&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;jin-gizmo/lava/amzn2023/base&quot;</span><span class="p">,</span>
</span><span id="__span-22-17"><span class="w">  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;docker&quot;</span><span class="p">,</span>
</span><span id="__span-22-18"><span class="w">  </span><span class="nt">&quot;worker&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;core&quot;</span>
</span><span id="__span-22-19"><span class="p">}</span>
</span></code></pre></div>
<p>This example does exactly the same thing with the docker image and command
specified in a slightly different way.</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-23-1"><span class="p">{</span>
</span><span id="__span-23-2"><span class="w">  </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Run a simple command in a container&quot;</span><span class="p">,</span>
</span><span id="__span-23-3"><span class="w">  </span><span class="nt">&quot;dispatcher&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Sydney&quot;</span><span class="p">,</span>
</span><span id="__span-23-4"><span class="w">  </span><span class="nt">&quot;enabled&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-23-5"><span class="w">  </span><span class="nt">&quot;job_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo/simple-docker&quot;</span><span class="p">,</span>
</span><span id="__span-23-6"><span class="w">  </span><span class="nt">&quot;owner&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo@somewhere.com&quot;</span><span class="p">,</span>
</span><span id="__span-23-7"><span class="w">  </span><span class="nt">&quot;parameters&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-23-8"><span class="w">    </span><span class="nt">&quot;command&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/bin/sh -c date&quot;</span><span class="p">,</span>
</span><span id="__span-23-9"><span class="w">    </span><span class="nt">&quot;docker&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ecr&quot;</span><span class="p">,</span>
</span><span id="__span-23-10"><span class="w">    </span><span class="nt">&quot;timeout&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;10s&quot;</span>
</span><span id="__span-23-11"><span class="w">  </span><span class="p">},</span>
</span><span id="__span-23-12"><span class="w">  </span><span class="nt">&quot;payload&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;dist/lava/centos8/full:latest&quot;</span><span class="p">,</span>
</span><span id="__span-23-13"><span class="w">  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;docker&quot;</span><span class="p">,</span>
</span><span id="__span-23-14"><span class="w">  </span><span class="nt">&quot;worker&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;core&quot;</span>
</span><span id="__span-23-15"><span class="p">}</span>
</span></code></pre></div>
<p>And again:</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-24-1"><span class="p">{</span>
</span><span id="__span-24-2"><span class="w">  </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Run a simple command in a container&quot;</span><span class="p">,</span>
</span><span id="__span-24-3"><span class="w">  </span><span class="nt">&quot;dispatcher&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Sydney&quot;</span><span class="p">,</span>
</span><span id="__span-24-4"><span class="w">  </span><span class="nt">&quot;enabled&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-24-5"><span class="w">  </span><span class="nt">&quot;job_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo/simple-docker&quot;</span><span class="p">,</span>
</span><span id="__span-24-6"><span class="w">  </span><span class="nt">&quot;owner&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo@somewhere.com&quot;</span><span class="p">,</span>
</span><span id="__span-24-7"><span class="w">  </span><span class="nt">&quot;parameters&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-24-8"><span class="w">    </span><span class="nt">&quot;command&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/bin/sh -c {{vars.cmd}}&quot;</span><span class="p">,</span>
</span><span id="__span-24-9"><span class="w">    </span><span class="nt">&quot;docker&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ecr&quot;</span><span class="p">,</span>
</span><span id="__span-24-10"><span class="w">    </span><span class="nt">&quot;timeout&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;10s&quot;</span><span class="p">,</span>
</span><span id="__span-24-11"><span class="w">    </span><span class="nt">&quot;vars&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-24-12"><span class="w">        </span><span class="nt">&quot;cmd&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;date&quot;</span>
</span><span id="__span-24-13"><span class="w">    </span><span class="p">}</span>
</span><span id="__span-24-14"><span class="w">  </span><span class="p">},</span>
</span><span id="__span-24-15"><span class="w">  </span><span class="nt">&quot;payload&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;dist/lava/centos8/full:latest&quot;</span><span class="p">,</span>
</span><span id="__span-24-16"><span class="w">  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;docker&quot;</span><span class="p">,</span>
</span><span id="__span-24-17"><span class="w">  </span><span class="nt">&quot;worker&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;core&quot;</span>
</span><span id="__span-24-18"><span class="p">}</span>
</span></code></pre></div>
<h2 id="job-type-exe">Job type: exe<a class="headerlink" href="#job-type-exe" title="Permanent link">&para;</a></h2>
<p>The <strong>exe</strong> job type downloads one or more executables from the S3 payload area
and runs them.</p>
<h3 id="payload_6">Payload<a class="headerlink" href="#payload_6" title="Permanent link">&para;</a></h3>
<p>The payload is a location in S3 relative to the <code>s3_payloads</code> area specified in
the <a href="04-dynamodb-tables.html#the-realms-table">realms table</a>. It can be either an
object key, in which case a single executable is downloaded, or a prefix ending
in <code>/</code>, in which case all executables under that prefix will be downloaded and
run in lexicographic order.</p>
<p>See <a href="#s3-payloads">S3 Payloads</a> for more information.</p>
<p>The payload value will be parsed using standard Linux shell lexical analysis to
determine the S3 object location and, optionally, any arguments. Additional
arguments can also be specified with the <code>args</code> parameter.</p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>The <code>exe</code> job type requires the payload to be a single string. It does not
support the list mechanism provided by the
<a href="#the-v2-payload-downloader">v2 Payload Downloader</a>.</p>
</div>
<h3 id="environment_2">Environment<a class="headerlink" href="#environment_2" title="Permanent link">&para;</a></h3>
<p>Stdin will be redirected from <code>/dev/null</code>. Stdout and stderr are captured and,
if non-empty, placed into the realm <code>s3_temp</code> area with the following
prefixes:</p>
<ul>
<li>
<p>stdout: <code>&lt;s3_temp&gt;/&lt;job_id&gt;/&lt;run_id&gt;/stdout</code></p>
</li>
<li>
<p>stderr: <code>&lt;s3_temp&gt;/&lt;job_id&gt;/&lt;run_id&gt;/stderr</code></p>
</li>
</ul>
<p>The following variables are placed into the environment for the command.</p>
<table>
<thead>
<tr>
<th>Variable</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>LAVA_JOB_ID</td>
<td>The <code>job_id</code>.</td>
</tr>
<tr>
<td>LAVA_OWNER</td>
<td>The value of the <code>owner</code> field from the job specification.</td>
</tr>
<tr>
<td>LAVA_REALM</td>
<td>The realm name.</td>
</tr>
<tr>
<td>LAVA_RUN_ID</td>
<td>The <code>run_id</code> UUID.</td>
</tr>
<tr>
<td>LAVA_S3_KEY</td>
<td>The identifier for the KMS key needed to write data into the S3 temporary area.</td>
</tr>
<tr>
<td>LAVA_S3_PAYLOAD</td>
<td>The payload location for this job.</td>
</tr>
<tr>
<td>LAVA_S3_TMP</td>
<td>The private S3 temporary area for this job run. The executables are allowed to put data here.</td>
</tr>
<tr>
<td>LAVA_WORKER</td>
<td>The worker name.</td>
</tr>
<tr>
<td>PYTHONPATH</td>
<td>The PYTHONPATH has the lava code directory appended. This allows Python based executables to directly import lava modules. This is particularly handy for accessing the lava connection manager from within a Python program.</td>
</tr>
</tbody>
</table>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>If the payload is a script (e.g. bash or Python) then Lava relies on the
hashbang line at the beginning of the file. If the file has been edited on a
DOS system then it may have DOS style CR-LF line endings which will cause
the script interpreter to be unrecognised and the job will fail.</p>
</div>
<h3 id="parameters_6">Parameters<a class="headerlink" href="#parameters_6" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>args</td>
<td>List[String]</td>
<td>No</td>
<td>A list of additional arguments for the executable(s).</td>
</tr>
<tr>
<td>connections</td>
<td>Map[String,String]</td>
<td>No</td>
<td>A dictionary with keys that are connection labels and the values are conn_id</td>
</tr>
<tr>
<td>env</td>
<td>Map[String,String]</td>
<td>No</td>
<td>A map of additional environment variables for the command.</td>
</tr>
<tr>
<td>jinja</td>
<td>Boolean</td>
<td>No</td>
<td>If <code>false</code>, disable Jinja rendering of the <code>args</code>. Default <code>true</code>.</td>
</tr>
<tr>
<td>timeout</td>
<td>String</td>
<td>No</td>
<td>By default, executables run by <strong>exe</strong> jobs are killed after 10 minutes. This parameter can override that with values in the form <code>nnX</code> where <code>nn</code> is a number and <code>X</code> is <code>s</code> (seconds), <code>m</code> (minutes) or <code>h</code> (hours). Note that the total timeout for the entire job (<code>timeout</code> multiplied by number of payload elements) must be less than the visibility timeout on the worker SQS queue.</td>
</tr>
<tr>
<td>vars</td>
<td>Map[String,*]</td>
<td>No</td>
<td>A map of variables injected when the command arguments and environment are Jinja rendered.</td>
</tr>
</tbody>
</table>
<h3 id="jinja-rendering-of-the-arguments-and-environment_1">Jinja Rendering of the Arguments and Environment<a class="headerlink" href="#jinja-rendering-of-the-arguments-and-environment_1" title="Permanent link">&para;</a></h3>
<p>The collected arguments for the executable(s) and any environment values defined
in the job specification are individually rendered using
<a href="http://jinja.pocoo.org">Jinja</a> prior to execution.</p>
<p>Refer to <a href="13-jinja-rendering-in-lava.html#jinja-rendering-in-lava">Jinja Rendering in Lava</a>
for more information.</p>
<p>The following variables are made available to the renderer.</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>globals</td>
<td>dict[str,*]</td>
<td>The <code>globals</code> from the job specification updated with any globals received in the job dispatch.</td>
</tr>
<tr>
<td>job</td>
<td>dict[str,*]</td>
<td>The <a href="13-jinja-rendering-in-lava.html#the-augmented-job-specification">augmented job specification</a>.</td>
</tr>
<tr>
<td>realm</td>
<td>dict[str,*]</td>
<td>The realm specification.</td>
</tr>
<tr>
<td>start</td>
<td>datetime</td>
<td>The local time when the job run started.</td>
</tr>
<tr>
<td>state</td>
<td>dict[str,*]</td>
<td>A dictionary of the state items imported into the job, keyed on state_id. The default values are updated at run-time with any current values obtainable from the <a href="04-dynamodb-tables.html#the-state-table">state</a> table.</td>
</tr>
<tr>
<td>ustart</td>
<td>datetime</td>
<td>The UTC time when the job run started.</td>
</tr>
<tr>
<td>utils</td>
<td>dict[str,runnable]</td>
<td>A dictionary of <a href="13-jinja-rendering-in-lava.html#jinja-utility-functions">utility functions</a> that can be used in the Jinja markup.</td>
</tr>
<tr>
<td>vars</td>
<td>dict[str,*]</td>
<td>A dictionary of variables provided as the <code>vars</code> component of the job <code>parameters</code>.</td>
</tr>
</tbody>
</table>
<h3 id="connection-handling_1">Connection Handling<a class="headerlink" href="#connection-handling_1" title="Permanent link">&para;</a></h3>
<p>Lava provides a mechanism for <strong>exe</strong> jobs to utilise connections defined in the
<a href="04-dynamodb-tables.html#the-connections-table">connections table</a>. It does this by
creating a small executable that gives effect to the connection and then placing
the name of that executable into an environment variable where it can be
accessed by the job payload.</p>
<p>For example, consider a <code>parameters</code> field for the job like the following,</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-25-1"><span class="p">{</span>
</span><span id="__span-25-2"><span class="w">  </span><span class="nt">&quot;parameters&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-25-3"><span class="w">    </span><span class="nt">&quot;connections&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-25-4"><span class="w">      </span><span class="nt">&quot;pgres_db&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;conn_id_for_postgres&quot;</span>
</span><span id="__span-25-5"><span class="w">    </span><span class="p">}</span>
</span><span id="__span-25-6"><span class="w">  </span><span class="p">}</span>
</span><span id="__span-25-7"><span class="p">}</span>
</span></code></pre></div>
<p>Lava will create a small executable that automates connection to the relevant
Postgres database using the Postgres command line client (psql) and place the
name of that executable in the environment variable <code>LAVA_CONN_PGRES_DB</code>. A
second environment variable, <code>LAVA_CONNID_PGRESS_DB</code> will contain the connection
ID itself, <code>conn_id_for_postgres</code> in this case.</p>
<p>If the payload is a shell script, for example, it would use this in the
following way:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-26-1"><span class="c1"># Use $LAVA_CONN_PGRES_DB anywhere you could use the psql CLI.</span>
</span><span id="__span-26-2"><span class="c1"># The authentication is automated behind the scenes.</span>
</span><span id="__span-26-3">
</span><span id="__span-26-4"><span class="nv">$LAVA_CONN_PGRES_DB</span><span class="w"> </span>&lt;&lt;!
</span><span id="__span-26-5">SELECT<span class="w"> </span>*<span class="w"> </span>FROM<span class="w"> </span>pg_user
</span><span id="__span-26-6">WHERE<span class="w"> </span><span class="nv">usename</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;fred&#39;</span><span class="p">;</span>
</span><span id="__span-26-7">!
</span></code></pre></div>
<p>If the payload is a Python script, the lava connection manager can be used
directly to provide a native Python DBAPI 2.0 connection object, thus:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-27-1"><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
</span><span id="__span-27-2"><span class="kn">from</span><span class="w"> </span><span class="nn">lava.connection</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_pysql_connection</span>
</span><span id="__span-27-3">
</span><span id="__span-27-4"><span class="n">conn</span> <span class="o">=</span> <span class="n">get_pysql_connection</span><span class="p">(</span>
</span><span id="__span-27-5">    <span class="n">conn_id</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;LAVA_CONNID_PGRESS_DB&#39;</span><span class="p">],</span>
</span><span id="__span-27-6">    <span class="n">realm</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;LAVA_REALM&#39;</span><span class="p">]</span>
</span><span id="__span-27-7"><span class="p">)</span>
</span><span id="__span-27-8">
</span><span id="__span-27-9"><span class="c1"># Now use conn object in the usual way.</span>
</span></code></pre></div>
<p>All of the database connectors work in the same way. Non-database connectors have
a similar interface but the behaviour and usage depends on the underlying nature
of the thing to which connection is required.</p>
<h3 id="dev-mode-behaviour_6">Dev Mode Behaviour<a class="headerlink" href="#dev-mode-behaviour_6" title="Permanent link">&para;</a></h3>
<p>Normally, the <strong>exe</strong> job will copy stdout and stderr to S3 on the conclusion
of the job. In dev mode, stdout and stderr are emitted locally during the job
run instead of being copied to S3.</p>
<h3 id="examples_5">Examples<a class="headerlink" href="#examples_5" title="Permanent link">&para;</a></h3>
<p>The following example will download and run a shell script with a non-standard
timeout of 20 minutes.</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-28-1"><span class="p">{</span>
</span><span id="__span-28-2"><span class="w">  </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Test pgconnector from exe&quot;</span><span class="p">,</span>
</span><span id="__span-28-3"><span class="w">  </span><span class="nt">&quot;dispatcher&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Sydney&quot;</span><span class="p">,</span>
</span><span id="__span-28-4"><span class="w">  </span><span class="nt">&quot;enabled&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-28-5"><span class="w">  </span><span class="nt">&quot;job_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo/shell&quot;</span><span class="p">,</span>
</span><span id="__span-28-6"><span class="w">  </span><span class="nt">&quot;owner&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo@somewhere.com&quot;</span><span class="p">,</span>
</span><span id="__span-28-7"><span class="w">  </span><span class="nt">&quot;parameters&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-28-8"><span class="w">    </span><span class="nt">&quot;timeout&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;20m&quot;</span>
</span><span id="__span-28-9"><span class="w">  </span><span class="p">},</span>
</span><span id="__span-28-10"><span class="w">  </span><span class="nt">&quot;payload&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo/shell_script.sh&quot;</span><span class="p">,</span>
</span><span id="__span-28-11"><span class="w">  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;exe&quot;</span><span class="p">,</span>
</span><span id="__span-28-12"><span class="w">  </span><span class="nt">&quot;worker&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;default&quot;</span>
</span><span id="__span-28-13"><span class="p">}</span>
</span></code></pre></div>
<p>This one will download all files under the <code>demo/scripts/</code> prefix
from the payloads area and run them. Note that the download is not recursive.</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-29-1"><span class="p">{</span>
</span><span id="__span-29-2"><span class="w">  </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Test pgconnector from exe&quot;</span><span class="p">,</span>
</span><span id="__span-29-3"><span class="w">  </span><span class="nt">&quot;dispatcher&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Sydney&quot;</span><span class="p">,</span>
</span><span id="__span-29-4"><span class="w">  </span><span class="nt">&quot;enabled&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-29-5"><span class="w">  </span><span class="nt">&quot;job_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo/multi_exe&quot;</span><span class="p">,</span>
</span><span id="__span-29-6"><span class="w">  </span><span class="nt">&quot;owner&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo@somewhere.com&quot;</span><span class="p">,</span>
</span><span id="__span-29-7"><span class="w">  </span><span class="nt">&quot;payload&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo/scripts/&quot;</span><span class="p">,</span>
</span><span id="__span-29-8"><span class="w">  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;exe&quot;</span><span class="p">,</span>
</span><span id="__span-29-9"><span class="w">  </span><span class="nt">&quot;worker&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;default&quot;</span>
</span><span id="__span-29-10"><span class="p">}</span>
</span></code></pre></div>
<p>This one will run a Python script and provide it with connection handles to a
Postgres database and a MySQL database. The command needed to run a Postgres
database client with auto-connect will be in the environment variable
<code>LAVA_CONN_PGRES_DB</code>. The command needed to run a MySQL database client with
auto-connect will be in the environment variable <code>LAVA_CONN_MYSQL_DB</code>.</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-30-1"><span class="p">{</span>
</span><span id="__span-30-2"><span class="w">  </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Run pgconnector from exe&quot;</span><span class="p">,</span>
</span><span id="__span-30-3"><span class="w">  </span><span class="nt">&quot;dispatcher&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Sydney&quot;</span><span class="p">,</span>
</span><span id="__span-30-4"><span class="w">  </span><span class="nt">&quot;enabled&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-30-5"><span class="w">  </span><span class="nt">&quot;job_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo/py_exe&quot;</span><span class="p">,</span>
</span><span id="__span-30-6"><span class="w">  </span><span class="nt">&quot;owner&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo@somewhere.com&quot;</span><span class="p">,</span>
</span><span id="__span-30-7"><span class="w">  </span><span class="nt">&quot;parameters&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-8"><span class="w">    </span><span class="nt">&quot;connections&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-9"><span class="w">      </span><span class="nt">&quot;mysql_db&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;conn_id_for_mysql&quot;</span><span class="p">,</span>
</span><span id="__span-30-10"><span class="w">      </span><span class="nt">&quot;pgres_db&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;conn_id_for_postgres&quot;</span>
</span><span id="__span-30-11"><span class="w">    </span><span class="p">}</span>
</span><span id="__span-30-12"><span class="w">  </span><span class="p">},</span>
</span><span id="__span-30-13"><span class="w">  </span><span class="nt">&quot;payload&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo/conect_to_db.py&quot;</span><span class="p">,</span>
</span><span id="__span-30-14"><span class="w">  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;exe&quot;</span><span class="p">,</span>
</span><span id="__span-30-15"><span class="w">  </span><span class="nt">&quot;worker&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;default&quot;</span>
</span><span id="__span-30-16"><span class="p">}</span>
</span></code></pre></div>
<p>This one will run an executable with some arguments.</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-31-1"><span class="p">{</span>
</span><span id="__span-31-2"><span class="w">  </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;How to pass arguments to the exe&quot;</span><span class="p">,</span>
</span><span id="__span-31-3"><span class="w">  </span><span class="nt">&quot;dispatcher&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Sydney&quot;</span><span class="p">,</span>
</span><span id="__span-31-4"><span class="w">  </span><span class="nt">&quot;enabled&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-31-5"><span class="w">  </span><span class="nt">&quot;job_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo/exe_with_args&quot;</span><span class="p">,</span>
</span><span id="__span-31-6"><span class="w">  </span><span class="nt">&quot;owner&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo@somewhere.com&quot;</span><span class="p">,</span>
</span><span id="__span-31-7"><span class="w">  </span><span class="nt">&quot;payload&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo/my-exe -y --log-level info&quot;</span><span class="p">,</span>
</span><span id="__span-31-8"><span class="w">  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;exe&quot;</span><span class="p">,</span>
</span><span id="__span-31-9"><span class="w">  </span><span class="nt">&quot;worker&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;default&quot;</span>
</span><span id="__span-31-10"><span class="p">}</span>
</span></code></pre></div>
<p>This one will do exactly the same thing with the arguments specified in a
different way.</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-32-1"><span class="p">{</span>
</span><span id="__span-32-2"><span class="w">  </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;How to pass arguments to the exe&quot;</span><span class="p">,</span>
</span><span id="__span-32-3"><span class="w">  </span><span class="nt">&quot;dispatcher&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Sydney&quot;</span><span class="p">,</span>
</span><span id="__span-32-4"><span class="w">  </span><span class="nt">&quot;enabled&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-32-5"><span class="w">  </span><span class="nt">&quot;job_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo/exe_with_args&quot;</span><span class="p">,</span>
</span><span id="__span-32-6"><span class="w">  </span><span class="nt">&quot;owner&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo@somewhere.com&quot;</span><span class="p">,</span>
</span><span id="__span-32-7"><span class="w">  </span><span class="nt">&quot;payload&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo/my-exe -y&quot;</span><span class="p">,</span>
</span><span id="__span-32-8"><span class="w">  </span><span class="nt">&quot;parameters&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-32-9"><span class="w">    </span><span class="nt">&quot;args&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-32-10"><span class="w">      </span><span class="s2">&quot;--log-level&quot;</span><span class="p">,</span>
</span><span id="__span-32-11"><span class="w">      </span><span class="s2">&quot;info&quot;</span>
</span><span id="__span-32-12"><span class="w">    </span><span class="p">]</span>
</span><span id="__span-32-13"><span class="w">  </span><span class="p">},</span>
</span><span id="__span-32-14"><span class="w">  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;exe&quot;</span><span class="p">,</span>
</span><span id="__span-32-15"><span class="w">  </span><span class="nt">&quot;worker&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;default&quot;</span>
</span><span id="__span-32-16"><span class="p">}</span>
</span></code></pre></div>
<p>And again.</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-33-1"><span class="p">{</span>
</span><span id="__span-33-2"><span class="w">  </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;How to pass arguments to the exe&quot;</span><span class="p">,</span>
</span><span id="__span-33-3"><span class="w">  </span><span class="nt">&quot;dispatcher&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Sydney&quot;</span><span class="p">,</span>
</span><span id="__span-33-4"><span class="w">  </span><span class="nt">&quot;enabled&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-33-5"><span class="w">  </span><span class="nt">&quot;job_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo/exe_with_args&quot;</span><span class="p">,</span>
</span><span id="__span-33-6"><span class="w">  </span><span class="nt">&quot;owner&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo@somewhere.com&quot;</span><span class="p">,</span>
</span><span id="__span-33-7"><span class="w">  </span><span class="nt">&quot;payload&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo/my-exe -y --log-level {{vars.level}}&quot;</span><span class="p">,</span>
</span><span id="__span-33-8"><span class="w">  </span><span class="nt">&quot;parameters&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-33-9"><span class="w">    </span><span class="nt">&quot;vars&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-33-10"><span class="w">      </span><span class="nt">&quot;level&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;info&quot;</span>
</span><span id="__span-33-11"><span class="w">    </span><span class="p">}</span>
</span><span id="__span-33-12"><span class="w">  </span><span class="p">},</span>
</span><span id="__span-33-13"><span class="w">  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;exe&quot;</span><span class="p">,</span>
</span><span id="__span-33-14"><span class="w">  </span><span class="nt">&quot;worker&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;default&quot;</span>
</span><span id="__span-33-15"><span class="p">}</span>
</span></code></pre></div>
<h2 id="job-type-foreach">Job type: foreach<a class="headerlink" href="#job-type-foreach" title="Permanent link">&para;</a></h2>
<p>The <strong>foreach</strong> job type runs a single specified job in a loop.</p>
<p>Like the <a href="#job-type-chain">chain</a> job type, this is a synchronous operation. The
parent <strong>foreach</strong> job and the child job must be set to run on the same worker
and the parent and all child iterations will run under the <code>run_id</code> of the
parent job.</p>
<p>Any globals available in the <strong>foreach</strong> job will also be passed to each
iteration of the child job, with additional, iteration specific, globals
injected for each iteration.  A loop index counter
(<code>globals.lava.foreach_index</code>) is also made available to child iterations in the
<a href="05-job-dispatch.html#globals-owned-by-lava">globals owned by lava</a>.</p>
<h3 id="payload_7">Payload<a class="headerlink" href="#payload_7" title="Permanent link">&para;</a></h3>
<p>The <code>payload</code> is the <code>job_id</code> of the job to be iterated.</p>
<h3 id="parameters_7">Parameters<a class="headerlink" href="#parameters_7" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>can_fail</td>
<td>Boolean</td>
<td>No</td>
<td>A boolean that indicates if individual iterations are permitted to fail without causing the entire job to fail. Defaults to <code>false</code>. See <a href="#allowing-foreach-child-jobs-to-fail">Allowing Foreach Child Jobs to Fail</a>.</td>
</tr>
<tr>
<td>foreach</td>
<td>Map[String,*]</td>
<td>Yes</td>
<td>This parameter specifies the mechanism used to generate named values for each iteration. It is effectively a Python-like iterator yielding a dictionary of values for each iteration that is merged into the globals for the child job. See <a href="#foreach-value-generators">Foreach Value Generators</a>.</td>
</tr>
<tr>
<td>limit</td>
<td>Integer</td>
<td>No</td>
<td>An integer. Attempting to run a <strong>foreach</strong> job with more than this many loop iterations will fail without any job being run at all. Defaults to the realm level value as specified by the <a href="10-installation-operation.html#configuration-for-foreach-jobs">FOREACH_LIMIT</a> configuration parameter.</td>
</tr>
<tr>
<td>jinja</td>
<td>Boolean</td>
<td>No</td>
<td>If true (the default), enable Jinja rendering. What gets rendered in the <code>foreach</code> generator specification is controlled by the generator itself.</td>
</tr>
</tbody>
</table>
<h3 id="foreach-value-generators">Foreach Value Generators<a class="headerlink" href="#foreach-value-generators" title="Permanent link">&para;</a></h3>
<p>The <code>foreach</code> parameter is a map that defines the mechanism used to generate a
set of named values for each loop iteration. These named values are merged into
the globals passed to the child job.</p>
<p>Value generation is as lazy as possible to minimise overheads and memory usage.</p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>It is not permitted for any value names returned by a <code>foreach</code> generator to
begin with <code>lava</code> (case independent).</p>
</div>
<p>Apart from the common <code>type</code> field, the other fields in the <code>foreach</code> parameter
depend on the <code>type</code>. Field values are <em>not</em> Jinja rendered unless indicated
otherwise below.</p>
<h4 id="foreach-type-csv">Foreach type: CSV<a class="headerlink" href="#foreach-type-csv" title="Permanent link">&para;</a></h4>
<p>The <strong>csv</strong> generator reads data from a CSV file. The file must have a header to
provide the names of values generated for each <code>foreach</code> iteration.</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>type</td>
<td>String</td>
<td>Yes</td>
<td>The foreach generator type: <code>csv</code>.</td>
</tr>
<tr>
<td>filename</td>
<td>String</td>
<td>Yes</td>
<td>The name of the CSV file, which can be local or in S3 (<code>s3://...</code>). This field is Jinja rendered.</td>
</tr>
</tbody>
</table>
<p>For example, given this CSV source file ...</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-34-1">a,b
</span><span id="__span-34-2">a0,b0
</span><span id="__span-34-3">a1,b1
</span></code></pre></div>
<p>... the globals of the child job would have <code>globals.a=a0</code> on the first
iteration and <code>globals.a=a1</code> on the second.</p>
<h4 id="foreach-type-inline">Foreach type: inline<a class="headerlink" href="#foreach-type-inline" title="Permanent link">&para;</a></h4>
<p>The <strong>inline</strong> generator contains the iteration values within the <code>foreach</code>
parameter itself.</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>type</td>
<td>String</td>
<td>Yes</td>
<td>The foreach generator type: <code>inline</code>.</td>
</tr>
<tr>
<td>values</td>
<td>List[Map[String,*]]</td>
<td>Yes</td>
<td>A list of maps containing iteration values.</td>
</tr>
</tbody>
</table>
<p>For example, given this (partial) job specification ...</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-35-1"><span class="p">{</span>
</span><span id="__span-35-2"><span class="w">  </span><span class="nt">&quot;job_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;example&quot;</span><span class="p">,</span>
</span><span id="__span-35-3"><span class="w">  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;foreach&quot;</span><span class="p">,</span>
</span><span id="__span-35-4"><span class="w">  </span><span class="nt">&quot;payload&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;child_job_id&quot;</span><span class="p">,</span>
</span><span id="__span-35-5"><span class="w">  </span><span class="nt">&quot;parameters&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-35-6"><span class="w">    </span><span class="nt">&quot;foreach&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-35-7"><span class="w">      </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;inline&quot;</span><span class="p">,</span>
</span><span id="__span-35-8"><span class="w">      </span><span class="nt">&quot;values&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-35-9"><span class="w">        </span><span class="p">{</span><span class="nt">&quot;a&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;a0&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;b&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;b0&quot;</span><span class="w"> </span><span class="p">},</span>
</span><span id="__span-35-10"><span class="w">        </span><span class="p">{</span><span class="nt">&quot;a&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;a1&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;b&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;b1&quot;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-35-11"><span class="w">      </span><span class="p">]</span>
</span><span id="__span-35-12"><span class="w">    </span><span class="p">}</span>
</span><span id="__span-35-13"><span class="w">  </span><span class="p">}</span>
</span><span id="__span-35-14"><span class="p">}</span>
</span></code></pre></div>
<p>... the globals of the child job would have <code>globals.a=a0</code> on the first
iteration and <code>globals.a=a1</code> on the second.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>It is not required that each value map in the list has the same keys,
although it would be an unusual use-case.</p>
</div>
<h4 id="foreach-type-jsonl">Foreach type: jsonl<a class="headerlink" href="#foreach-type-jsonl" title="Permanent link">&para;</a></h4>
<p>The <strong>jsonl</strong> generator reads JSON encoded objects from a file, one object per
line.</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>type</td>
<td>String</td>
<td>Yes</td>
<td>The foreach generator type: <code>jsonl</code>.</td>
</tr>
<tr>
<td>filename</td>
<td>String</td>
<td>Yes</td>
<td>The name of the JSONL file, which can be local or in S3 (<code>s3://...</code>). This field is Jinja rendered.</td>
</tr>
</tbody>
</table>
<p>For example, given this JSONL source file ...</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-36-1"><span class="p">{</span><span class="nt">&quot;a&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;a0&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;b&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;b0&quot;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-36-2"><span class="p">{</span><span class="nt">&quot;a&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;a1&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;b&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;b1&quot;</span><span class="w"> </span><span class="p">}</span>
</span></code></pre></div>
<p>... the globals of the child job would have <code>globals.a=a0</code> on the first
iteration and <code>globals.a=a1</code> on the second.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>It is not required that each JSON line has the same keys, although it would
be an unusual use-case.</p>
</div>
<h4 id="foreach-type-query">Foreach type: query<a class="headerlink" href="#foreach-type-query" title="Permanent link">&para;</a></h4>
<p>The <strong>query</strong> generator obtains iteration values from a database query. </p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>type</td>
<td>String</td>
<td>Yes</td>
<td>The foreach generator type: <code>query</code>.</td>
</tr>
<tr>
<td>conn_id</td>
<td>String</td>
<td>Yes</td>
<td>The <a href="07-connectors.html#database-connectors">connection ID</a> for a target database.</td>
</tr>
<tr>
<td>query</td>
<td>String</td>
<td>Yes</td>
<td>The query to provide iteration values. Each row provides one set of iteration values. The field names are derived from the column names in the query. Take care to specify useful column names in the query when using database functions.</td>
</tr>
</tbody>
</table>
<div class="admonition question">
<p class="admonition-title">But but but ...</p>
<p>No, the query text is not Jinja rendered ... and it won't be.</p>
</div>
<p>For example, given this (partial) job specification ...</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-37-1"><span class="p">{</span>
</span><span id="__span-37-2"><span class="w">  </span><span class="nt">&quot;job_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;example&quot;</span><span class="p">,</span>
</span><span id="__span-37-3"><span class="w">  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;foreach&quot;</span><span class="p">,</span>
</span><span id="__span-37-4"><span class="w">  </span><span class="nt">&quot;payload&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;child_job_id&quot;</span><span class="p">,</span>
</span><span id="__span-37-5"><span class="w">  </span><span class="nt">&quot;parameters&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-37-6"><span class="w">    </span><span class="nt">&quot;foreach&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-37-7"><span class="w">      </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;query&quot;</span><span class="p">,</span>
</span><span id="__span-37-8"><span class="w">      </span><span class="nt">&quot;conn_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;my_db_conn_id&quot;</span><span class="p">,</span>
</span><span id="__span-37-9"><span class="w">      </span><span class="nt">&quot;query&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;SELECT a, COUNT(*) AS b FROM some.table GROUP by 1 LIMIT 5&quot;</span>
</span><span id="__span-37-10"><span class="w">    </span><span class="p">}</span>
</span><span id="__span-37-11"><span class="w">  </span><span class="p">}</span>
</span><span id="__span-37-12"><span class="p">}</span>
</span></code></pre></div>
<p>... would generate up to 5 iterations, each containing an <code>a</code> and <code>b</code> global.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Be careful about producing too many rows or including unnecessary values.
The <code>limit</code> parameter will force the job to abort if more than that many
rows are produced. Use database views to effect here.</p>
</div>
<h4 id="foreach-type-range">Foreach type: range<a class="headerlink" href="#foreach-type-range" title="Permanent link">&para;</a></h4>
<p>The <strong>range</strong> generator behaves in the same way as the Python
<a href="https://docs.python.org/3/library/functions.html#func-range">range()</a>
mechanism.</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>type</td>
<td>String</td>
<td>Yes</td>
<td>The foreach generator type: <code>range</code>.</td>
</tr>
<tr>
<td>name</td>
<td>String</td>
<td>No</td>
<td>If specified, the current value of the range counter is made available in a global with this name. This value may be different from <code>lava.globals.foreach_index</code> which always counts up from <code>0</code>.</td>
</tr>
<tr>
<td>start</td>
<td>Integer</td>
<td>No</td>
<td>The starting index for the range. Default is <code>0</code>.</td>
</tr>
<tr>
<td>stop</td>
<td>Integer</td>
<td>Yes</td>
<td>The value of the <code>stop</code> parameter.</td>
</tr>
<tr>
<td>step</td>
<td>Integer</td>
<td>No</td>
<td>The value of the <code>step</code> parameter. Default is <code>1</code>.</td>
</tr>
</tbody>
</table>
<p>For example, given this (partial) job specification ...</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-38-1"><span class="p">{</span>
</span><span id="__span-38-2"><span class="w">  </span><span class="nt">&quot;job_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;example&quot;</span><span class="p">,</span>
</span><span id="__span-38-3"><span class="w">  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;foreach&quot;</span><span class="p">,</span>
</span><span id="__span-38-4"><span class="w">  </span><span class="nt">&quot;payload&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;child_job_id&quot;</span><span class="p">,</span>
</span><span id="__span-38-5"><span class="w">  </span><span class="nt">&quot;parameters&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-38-6"><span class="w">    </span><span class="nt">&quot;foreach&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-38-7"><span class="w">      </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;range&quot;</span><span class="p">,</span>
</span><span id="__span-38-8"><span class="w">      </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;a&quot;</span><span class="p">,</span>
</span><span id="__span-38-9"><span class="w">      </span><span class="nt">&quot;stop&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span>
</span><span id="__span-38-10"><span class="w">    </span><span class="p">}</span>
</span><span id="__span-38-11"><span class="w">  </span><span class="p">}</span>
</span><span id="__span-38-12"><span class="p">}</span>
</span></code></pre></div>
<p>... the globals of the child job would have <code>globals.a=0</code> on the first
iteration and <code>globals.a=1</code> on the second.</p>
<h4 id="foreach-type-s3list">Foreach type: s3list<a class="headerlink" href="#foreach-type-s3list" title="Permanent link">&para;</a></h4>
<p>The <strong>s3list</strong> generator produces a list of objects in an AWS S3 bucket.</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>type</td>
<td>String</td>
<td>Yes</td>
<td>The foreach generator type: <code>s3list</code>.</td>
</tr>
<tr>
<td>bucket</td>
<td>String</td>
<td>Yes</td>
<td>The S3 bucket name. This field is Jinja rendered.</td>
</tr>
<tr>
<td>prefix</td>
<td>String</td>
<td>No</td>
<td>The S3 prefix to list. Defaults to the bucket root. This field is Jinja rendered.</td>
</tr>
<tr>
<td>glob</td>
<td>String|List[String]</td>
<td>No</td>
<td>A glob style pattern, or list of patterns. Only S3 objects with names matching any of the patterns are returned.</td>
</tr>
</tbody>
</table>
<p>A (partial) job specification might look like so:</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-39-1"><span class="p">{</span>
</span><span id="__span-39-2"><span class="w">  </span><span class="nt">&quot;job_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;example&quot;</span><span class="p">,</span>
</span><span id="__span-39-3"><span class="w">  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;foreach&quot;</span><span class="p">,</span>
</span><span id="__span-39-4"><span class="w">  </span><span class="nt">&quot;payload&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;child_job_id&quot;</span><span class="p">,</span>
</span><span id="__span-39-5"><span class="w">  </span><span class="nt">&quot;parameters&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-39-6"><span class="w">    </span><span class="nt">&quot;foreach&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-39-7"><span class="w">      </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;s3list&quot;</span><span class="p">,</span>
</span><span id="__span-39-8"><span class="w">      </span><span class="nt">&quot;bucket&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;my-bucket&quot;</span><span class="p">,</span>
</span><span id="__span-39-9"><span class="w">      </span><span class="nt">&quot;prefix&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;a/prefix/&quot;</span><span class="p">,</span>
</span><span id="__span-39-10"><span class="w">      </span><span class="nt">&quot;glob&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-39-11"><span class="w">        </span><span class="s2">&quot;*.csv&quot;</span><span class="p">,</span>
</span><span id="__span-39-12"><span class="w">        </span><span class="s2">&quot;*.jsonl&quot;</span>
</span><span id="__span-39-13"><span class="w">      </span><span class="p">]</span>
</span><span id="__span-39-14"><span class="w">    </span><span class="p">}</span>
</span><span id="__span-39-15"><span class="w">  </span><span class="p">}</span>
</span><span id="__span-39-16"><span class="p">}</span>
</span></code></pre></div>
<p>Each element returned by the generator to be added to the child globals is of
the form:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-40-1"><span class="p">{</span>
</span><span id="__span-40-2">    <span class="s1">&#39;s3obj&#39;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-40-3">        <span class="s1">&#39;Bucket&#39;</span><span class="p">:</span> <span class="s1">&#39;my-bucket&#39;</span><span class="p">,</span>
</span><span id="__span-40-4">        <span class="s1">&#39;Key&#39;</span><span class="p">:</span> <span class="s1">&#39;a/prefix/somewhere/in/s3.jsonl&#39;</span><span class="p">,</span>
</span><span id="__span-40-5">        <span class="s1">&#39;LastModified&#39;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2024</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">59</span><span class="p">,</span> <span class="n">tzinfo</span><span class="o">=</span><span class="n">tzutc</span><span class="p">()),</span>
</span><span id="__span-40-6">        <span class="s1">&#39;ETag&#39;</span><span class="p">:</span> <span class="s1">&#39;&quot;be0c0123456789abcd0123456678916a&quot;&#39;</span><span class="p">,</span>
</span><span id="__span-40-7">        <span class="s1">&#39;Size&#39;</span><span class="p">:</span> <span class="mi">197</span><span class="p">,</span>
</span><span id="__span-40-8">        <span class="s1">&#39;StorageClass&#39;</span><span class="p">:</span> <span class="s1">&#39;STANDARD&#39;</span>
</span><span id="__span-40-9">    <span class="p">}</span>
</span><span id="__span-40-10"><span class="p">}</span>
</span></code></pre></div>
<p>The value in the dictionary shown above is the object returned in the <code>Contents</code>
list in the response to the boto3 S3 client
<a href="https://boto3.amazonaws.com/v1/documentation/api/latest/reference/services/s3/client/list_objects_v2.html">list_objects_v2</a>
function, with the addition of the bucket name.</p>
<p>In the example shown above, the child job could access the full S3 object name
as:</p>
<div class="language-jinja highlight"><pre><span></span><code><span id="__span-41-1"><span class="x">s3://</span><span class="cp">{{</span> <span class="nv">globals.s3obj.Bucket</span> <span class="cp">}}</span><span class="x">/</span><span class="cp">{{</span> <span class="nv">globals.s3obj.Key</span> <span class="cp">}}</span>
</span></code></pre></div>
<h3 id="allowing-foreach-child-jobs-to-fail">Allowing Foreach Child Jobs to Fail<a class="headerlink" href="#allowing-foreach-child-jobs-to-fail" title="Permanent link">&para;</a></h3>
<p>By default, the <strong>foreach</strong> loop is aborted when any iteration fails unless
the <code>can_fail</code> parameter is set to <code>true</code>. In this case, the iteration process
will continue and the master <strong>foreach</strong> job will succeed even if child
iterations fail. In this situation, it is important that
the child job handles its own <a href="08-job-actions.html#job-actions">on_fail</a> actions, as the parent
will not. Suck it up kid.</p>
<p>This tolerance of failure does not include configuration errors in the child
job, such as a malformed job specification, child job sent to the wrong worker
etc. This will still cause the entire <strong>foreach</strong> job to fail.</p>
<div class="admonition note">
<p class="admonition-title">Keep Calm</p>
<p>Before anyone gets all bitter and twisted about <em>can</em> vs <em>may</em> in
<code>can_fail</code>...  both are essentially equivalent in this crazy, modern world.
Look it up.</p>
</div>
<h3 id="handling-of-globals_3">Handling of Globals<a class="headerlink" href="#handling-of-globals_3" title="Permanent link">&para;</a></h3>
<p>The <strong>foreach</strong> job type merges its globals into those of the child job for
each iteration. A value specified in the parent <strong>foreach</strong> job will override a
similarly named value in the child.</p>
<p>The globals generated by the <a href="#foreach-value-generators">foreach</a> iteration
generator will override any existing global with the same name.</p>
<p>The <strong>foreach</strong> job will also add <a href="05-job-dispatch.html#globals-owned-by-lava">lava specific globals</a>
under <code>globals.lava</code>. These lava owned globals allow all child iterations, to
access some common global values. An attempt by the
<a href="#foreach-value-generators">foreach</a> iteration generator to override any of
these will cause the job to fail.</p>
<p>The <code>global.lava.foreach_index</code> global is special. It is a counter, starting at
zero for the first loop iteration, and incremented by one for each iteration.</p>
<h3 id="dev-mode-behaviour_7">Dev Mode Behaviour<a class="headerlink" href="#dev-mode-behaviour_7" title="Permanent link">&para;</a></h3>
<p>The <strong>foreach</strong> job behaviour is unchanged for dev mode. However, dev mode is
propagated to child jobs.</p>
<h2 id="job-type-lavasched">Job type: lavasched<a class="headerlink" href="#job-type-lavasched" title="Permanent link">&para;</a></h2>
<p>The <strong>lavasched</strong> job type is a special lava internal job type. It must be run
only on workers that are also <a href="02-concepts.html#dispatchers">dispatchers</a> for
the realm to create the crontab on that node to dispatch jobs.</p>
<p>Each crontab entry schedules the dispatch of a job by running <code>lava-dispatcher</code>
to send an SQS message to the appropriate worker SQS queue.</p>
<p>The <strong>lavasched</strong> jobs must themselves be scheduled to update the crontab
periodically to accommodate changes in the <a href="04-dynamodb-tables.html#the-jobs-table">jobs
table</a>. Refer to the section on <a href="05-job-dispatch.html#scheduled-dispatch">Scheduled
Dispatch</a> for more information on how to
initialise this process.</p>
<p>Refer to the section <a href="05-job-dispatch.html#schedule-specifications">Schedule
Specifications</a> for more information.</p>
<h3 id="payload_8">Payload<a class="headerlink" href="#payload_8" title="Permanent link">&para;</a></h3>
<p>The payload is ignored for <strong>lavasched</strong> jobs.</p>
<h3 id="parameters_8">Parameters<a class="headerlink" href="#parameters_8" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>args</td>
<td>List[String]</td>
<td>No</td>
<td>A list of additional arguments that will be added to the invocation of <code>lava-dispatcher</code> in the crontab entries.</td>
</tr>
<tr>
<td>dispatcher</td>
<td>String <em>or</em> List[String]</td>
<td>Yes</td>
<td>Name of dispatcher, or a list of names, specifying the dispatchers for which schedules should be built.</td>
</tr>
<tr>
<td>env</td>
<td>Map[String,String]</td>
<td>No</td>
<td>A map of environment variables that will be added into the crontab. Of these, the most useful is <code>CRON_TZ</code>, which controls the timezone used by cron for this dispatcher. Note that this only controls the timezone for the dispatch process, not for the job run itself which will be the local timezone of the worker. See also <a href="#cron-and-path">Cron and PATH</a>.</td>
</tr>
</tbody>
</table>
<h3 id="cron-and-path">Cron and PATH<a class="headerlink" href="#cron-and-path" title="Permanent link">&para;</a></h3>
<p>Scheduled dispatches are effected by running the Python based <code>lava-dispatcher</code>
utility via <strong>cron(8)</strong>. It is <strong>critical</strong> that the <code>PATH</code> for <strong>cron</strong> yields
a lava compatible version of Python.</p>
<p><strong>Cron</strong> typically has a default <code>PATH</code> set at a system level that points to
the system default version of Python. This may be an older version that is not
lava compatible. This is the case for the <a href="10-installation-operation.html#the-lava-ec2-ami">lava AMI</a>.</p>
<p>The best way to avoid problems is to explicitly specify the desired <code>PATH</code> in
the <code>env</code> parameter for the job. e.g.</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-42-1"><span class="p">{</span>
</span><span id="__span-42-2"><span class="w">  </span><span class="nt">&quot;parameters&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-42-3"><span class="w">    </span><span class="nt">&quot;env&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-42-4"><span class="w">      </span><span class="nt">&quot;PATH&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/usr/local/bin:/bin:/usr/bin&quot;</span>
</span><span id="__span-42-5"><span class="w">  </span><span class="p">}</span>
</span><span id="__span-42-6"><span class="p">}</span>
</span></code></pre></div>
<h3 id="dev-mode-behaviour_8">Dev Mode Behaviour<a class="headerlink" href="#dev-mode-behaviour_8" title="Permanent link">&para;</a></h3>
<p>The <strong>lavasched</strong> job behaviour is unchanged for dev mode.</p>
<h3 id="examples_6">Examples<a class="headerlink" href="#examples_6" title="Permanent link">&para;</a></h3>
<p>The following example will cause the crontab to be rebuilt for the <code>localtime</code>
dispatcher every hour. It will include jobs that have a <code>dispatcher</code> field
of <code>localtime</code> - including this <strong>lavasched</strong> job. The dispatch schedule will
operate with respect to the local time set on the worker instance.</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-43-1"><span class="p">{</span>
</span><span id="__span-43-2"><span class="w">  </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Rebuild the dispatcher crontab&quot;</span><span class="p">,</span>
</span><span id="__span-43-3"><span class="w">  </span><span class="nt">&quot;dispatcher&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;localtime&quot;</span><span class="p">,</span>
</span><span id="__span-43-4"><span class="w">  </span><span class="nt">&quot;enabled&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-43-5"><span class="w">  </span><span class="nt">&quot;job_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo/schedule-01&quot;</span><span class="p">,</span>
</span><span id="__span-43-6"><span class="w">  </span><span class="nt">&quot;owner&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo@somewhere.com&quot;</span><span class="p">,</span>
</span><span id="__span-43-7"><span class="w">  </span><span class="nt">&quot;parameters&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-43-8"><span class="w">    </span><span class="nt">&quot;dispatcher&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;localtime&quot;</span><span class="p">,</span>
</span><span id="__span-43-9"><span class="w">    </span><span class="nt">&quot;env&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-43-10"><span class="w">      </span><span class="nt">&quot;PATH&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/usr/local/bin:/bin:/usr/bin&quot;</span>
</span><span id="__span-43-11"><span class="w">    </span><span class="p">}</span>
</span><span id="__span-43-12"><span class="w">  </span><span class="p">},</span>
</span><span id="__span-43-13"><span class="w">  </span><span class="nt">&quot;payload&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;--&quot;</span><span class="p">,</span>
</span><span id="__span-43-14"><span class="w">  </span><span class="nt">&quot;schedule&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;0 * * * *&quot;</span><span class="p">,</span>
</span><span id="__span-43-15"><span class="w">  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;lavasched&quot;</span><span class="p">,</span>
</span><span id="__span-43-16"><span class="w">  </span><span class="nt">&quot;worker&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;default&quot;</span>
</span><span id="__span-43-17"><span class="p">}</span>
</span></code></pre></div>
<p>This one does the same but sets the logging level on the <code>lava-dispatcher</code>
invocations to <code>warning</code>.</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-44-1"><span class="p">{</span>
</span><span id="__span-44-2"><span class="w">  </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Rebuild the Sydney dispatcher crontab&quot;</span><span class="p">,</span>
</span><span id="__span-44-3"><span class="w">  </span><span class="nt">&quot;dispatcher&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Sydney&quot;</span><span class="p">,</span>
</span><span id="__span-44-4"><span class="w">  </span><span class="nt">&quot;enabled&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-44-5"><span class="w">  </span><span class="nt">&quot;job_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo/schedule-01&quot;</span><span class="p">,</span>
</span><span id="__span-44-6"><span class="w">  </span><span class="nt">&quot;owner&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo@somewhere.com&quot;</span><span class="p">,</span>
</span><span id="__span-44-7"><span class="w">  </span><span class="nt">&quot;parameters&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-44-8"><span class="w">    </span><span class="nt">&quot;args&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">&quot;--level&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;warning&quot;</span><span class="w"> </span><span class="p">],</span>
</span><span id="__span-44-9"><span class="w">    </span><span class="nt">&quot;dispatcher&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Sydney&quot;</span><span class="p">,</span>
</span><span id="__span-44-10"><span class="w">    </span><span class="nt">&quot;env&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-44-11"><span class="w">      </span><span class="nt">&quot;PATH&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/usr/local/bin:/bin:/usr/bin&quot;</span>
</span><span id="__span-44-12"><span class="w">    </span><span class="p">}</span>
</span><span id="__span-44-13"><span class="w">  </span><span class="p">},</span>
</span><span id="__span-44-14"><span class="w">  </span><span class="nt">&quot;payload&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;--&quot;</span><span class="p">,</span>
</span><span id="__span-44-15"><span class="w">  </span><span class="nt">&quot;schedule&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;0 * * * *&quot;</span><span class="p">,</span>
</span><span id="__span-44-16"><span class="w">  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;lavasched&quot;</span><span class="p">,</span>
</span><span id="__span-44-17"><span class="w">  </span><span class="nt">&quot;worker&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;dispatch_syd&quot;</span>
</span><span id="__span-44-18"><span class="p">}</span>
</span></code></pre></div>
<p>This one will cause the dispatcher schedule to operate on Perth time. Note that
the jobs themselves will be dispatched on a Perth schedule but they will run
under whatever timezone setting the worker has.</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-45-1"><span class="p">{</span>
</span><span id="__span-45-2"><span class="w">  </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Rebuild the Perth dispatcher crontab&quot;</span><span class="p">,</span>
</span><span id="__span-45-3"><span class="w">  </span><span class="nt">&quot;dispatcher&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Perth&quot;</span><span class="p">,</span>
</span><span id="__span-45-4"><span class="w">  </span><span class="nt">&quot;enabled&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-45-5"><span class="w">  </span><span class="nt">&quot;job_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo/schedule-01&quot;</span><span class="p">,</span>
</span><span id="__span-45-6"><span class="w">  </span><span class="nt">&quot;owner&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo@somewhere.com&quot;</span><span class="p">,</span>
</span><span id="__span-45-7"><span class="w">  </span><span class="nt">&quot;parameters&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-45-8"><span class="w">    </span><span class="nt">&quot;dispatcher&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Perth&quot;</span><span class="p">,</span>
</span><span id="__span-45-9"><span class="w">    </span><span class="nt">&quot;env&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-45-10"><span class="w">      </span><span class="nt">&quot;CRON_TZ&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Australia/Perth&quot;</span><span class="p">,</span>
</span><span id="__span-45-11"><span class="w">      </span><span class="nt">&quot;PATH&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/usr/local/bin:/bin:/usr/bin&quot;</span>
</span><span id="__span-45-12"><span class="w">    </span><span class="p">}</span>
</span><span id="__span-45-13"><span class="w">  </span><span class="p">},</span>
</span><span id="__span-45-14"><span class="w">  </span><span class="nt">&quot;payload&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;--&quot;</span><span class="p">,</span>
</span><span id="__span-45-15"><span class="w">  </span><span class="nt">&quot;schedule&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;0 * * * *&quot;</span><span class="p">,</span>
</span><span id="__span-45-16"><span class="w">  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;lavasched&quot;</span><span class="p">,</span>
</span><span id="__span-45-17"><span class="w">  </span><span class="nt">&quot;worker&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;dispatch_perth&quot;</span>
</span><span id="__span-45-18"><span class="p">}</span>
</span></code></pre></div>
<h2 id="job-type-log">Job type: log<a class="headerlink" href="#job-type-log" title="Permanent link">&para;</a></h2>
<p>The <strong>log</strong> job type simply logs the job specification to the syslog. Payload
and parameters are ignored.</p>
<h3 id="dev-mode-behaviour_9">Dev Mode Behaviour<a class="headerlink" href="#dev-mode-behaviour_9" title="Permanent link">&para;</a></h3>
<p>The <strong>log</strong> job behaviour is unchanged for dev mode.</p>
<h2 id="job-type-pkg">Job type: pkg<a class="headerlink" href="#job-type-pkg" title="Permanent link">&para;</a></h2>
<p>The <strong>pkg</strong> job type downloads one or more code packages from the S3 payload
area, unpacks them and runs the nominated executable within the package using
the same invocation mechanism as the <a href="#job-type-exe">exe job
type</a>.</p>
<p>Supported package types are:</p>
<ul>
<li>
<p>Tar files, including any compressed variants supported by the standard Linux
    tar command.</p>
</li>
<li>
<p>Zip files.</p>
</li>
</ul>
<h3 id="payload_9">Payload<a class="headerlink" href="#payload_9" title="Permanent link">&para;</a></h3>
<p>The payload is a location in S3 relative to the <code>s3_payloads</code> area specified
in the <a href="04-dynamodb-tables.html#the-realms-table">realms table</a>. It can be either an object
key, in which case a single package is downloaded, or a prefix ending in <code>/</code>,
in which case all packages under that prefix will be downloaded and run in
lexicographic order.</p>
<p>See <a href="#s3-payloads">S3 Payloads</a> for more information.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code>pkg</code> job type also allows the payload to be a list of S3 locations if
the <a href="#the-v2-payload-downloader">v2 Payload Downloader</a> is enabled.</p>
</div>
<h3 id="environment_3">Environment<a class="headerlink" href="#environment_3" title="Permanent link">&para;</a></h3>
<p>Stdin will be redirected from <code>/dev/null</code>. Stdout and Stderr are captured and,
if non-empty, placed into the realm <code>s3_temp</code> area with the following
prefixes:</p>
<ul>
<li>
<p>stdout: <code>&lt;s3_temp&gt;/&lt;job_id&gt;/&lt;run_id&gt;/stdout</code></p>
</li>
<li>
<p>stderr: <code>&lt;s3_temp&gt;/&lt;job_id&gt;/&lt;run_id&gt;/stderr</code></p>
</li>
</ul>
<p>The following variables are placed into the environment for the command.</p>
<table>
<thead>
<tr>
<th>Variable</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>LAVA_JOB_ID</td>
<td>The <code>job_id</code>.</td>
</tr>
<tr>
<td>LAVA_OWNER</td>
<td>The value of the <code>owner</code> field from the job specification.</td>
</tr>
<tr>
<td>LAVA_REALM</td>
<td>The realm name.</td>
</tr>
<tr>
<td>LAVA_RUN_ID</td>
<td>The <code>run_id</code> UUID.</td>
</tr>
<tr>
<td>LAVA_S3_KEY</td>
<td>The identifier for the KMS key needed to write data into the S3 temporary area.</td>
</tr>
<tr>
<td>LAVA_S3_PAYLOAD</td>
<td>The payload location for this job.</td>
</tr>
<tr>
<td>LAVA_S3_TMP</td>
<td>The private S3 temporary area for this job run. The executables are allowed to put data here.</td>
</tr>
<tr>
<td>LAVA_WORKER</td>
<td>The worker name.</td>
</tr>
<tr>
<td>PYTHONPATH</td>
<td>The PYTHONPATH has the lava code directory appended. This allows Python based executables to directly import lava modules. This is particularly handy for accessing the lava connection manager from within a Python program.</td>
</tr>
</tbody>
</table>
<div class="admonition warning beware dos">
<p class="admonition-title">Warning</p>
<p>If the entry point in the payload is a script (e.g. bash or Python) then
Lava relies on the hashbang line at the beginning of the file. If the file
has been edited on a DOS system then it may have DOS style CR-LF line
endings which will cause the script interpreter to be unrecognised and the
job will fail.</p>
</div>
<h3 id="parameters_9">Parameters<a class="headerlink" href="#parameters_9" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>args</td>
<td>List[String]</td>
<td>No</td>
<td>A list of additional arguments for the main executable(s).</td>
</tr>
<tr>
<td>command</td>
<td>String</td>
<td>Yes</td>
<td>The name of the entry point executable in the bundle, relative to the root of the bundle. This will be parsed using standard Linux shell lexical analysis to determine the executable and arguments. Additional arguments can also be specified with the <code>args</code> parameter.</td>
</tr>
<tr>
<td>connections</td>
<td>Map[String,String]</td>
<td>No</td>
<td>A dictionary with keys that are connection labels and the values are conn_id</td>
</tr>
<tr>
<td>env</td>
<td>Map[String,String]</td>
<td>No</td>
<td>A map of additional environment variables for the command.</td>
</tr>
<tr>
<td>jinja</td>
<td>Boolean</td>
<td>No</td>
<td>If <code>false</code>, disable Jinja rendering of the <code>args</code>. Default <code>true</code>.</td>
</tr>
<tr>
<td>timeout</td>
<td>String</td>
<td>No</td>
<td>By default, executables run by <strong>exe</strong> jobs are killed after 10 minutes. This parameter can override that with values in the form <code>nnX</code> where <code>nn</code> is a number and <code>X</code> is <code>s</code> (seconds), <code>m</code> (minutes) or <code>h</code> (hours). Note that the total timeout for the entire job (<code>timeout</code> multiplied by number of payload elements) must be less than the visibility timeout on the worker SQS queue.</td>
</tr>
<tr>
<td>vars</td>
<td>Map[String,*]</td>
<td>No</td>
<td>A map of variables injected when the arguments and environment are Jinja rendered.</td>
</tr>
</tbody>
</table>
<h3 id="jinja-rendering-of-the-arguments-and-environment_2">Jinja Rendering of the Arguments and Environment<a class="headerlink" href="#jinja-rendering-of-the-arguments-and-environment_2" title="Permanent link">&para;</a></h3>
<p>The collected arguments for the executable(s) and any environment values defined
in the job specification are individually rendered using
<a href="http://jinja.pocoo.org">Jinja</a> prior to execution.</p>
<p>Refer to <a href="13-jinja-rendering-in-lava.html#jinja-rendering-in-lava">Jinja Rendering in Lava</a>
for more information.</p>
<p>The following variables are made available to the renderer.</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>globals</td>
<td>dict[str,*]</td>
<td>The <code>globals</code> from the job specification updated with any globals received in the job dispatch.</td>
</tr>
<tr>
<td>job</td>
<td>dict[str,*]</td>
<td>The <a href="13-jinja-rendering-in-lava.html#the-augmented-job-specification">augmented job specification</a>.</td>
</tr>
<tr>
<td>realm</td>
<td>dict[str,*]</td>
<td>The realm specification.</td>
</tr>
<tr>
<td>start</td>
<td>datetime</td>
<td>The local time when the job run started.</td>
</tr>
<tr>
<td>state</td>
<td>dict[str,*]</td>
<td>A dictionary of the state items imported into the job, keyed on state_id. The default values are updated at run-time with any current values obtainable from the <a href="04-dynamodb-tables.html#the-state-table">state</a> table.</td>
</tr>
<tr>
<td>ustart</td>
<td>datetime</td>
<td>The UTC time when the job run started.</td>
</tr>
<tr>
<td>utils</td>
<td>dict[str,runnable]</td>
<td>A dictionary of <a href="13-jinja-rendering-in-lava.html#jinja-utility-functions">utility functions</a> that can be used in the Jinja markup.</td>
</tr>
<tr>
<td>vars</td>
<td>dict[str,*]</td>
<td>A dictionary of variables provided as the <code>vars</code> component of the job <code>parameters</code>.</td>
</tr>
</tbody>
</table>
<h3 id="connection-handling_2">Connection Handling<a class="headerlink" href="#connection-handling_2" title="Permanent link">&para;</a></h3>
<p>Connections are handled exactly as for the <a href="#job-type-exe">exe job
type</a>.</p>
<h3 id="dev-mode-behaviour_10">Dev Mode Behaviour<a class="headerlink" href="#dev-mode-behaviour_10" title="Permanent link">&para;</a></h3>
<p>Normally, the <strong>pkg</strong> job will copy stdout and stderr to S3 on the conclusion
of the job. In dev mode, stdout and stderr are emitted locally during the job
run instead of being copied to S3.</p>
<h3 id="examples_7">Examples<a class="headerlink" href="#examples_7" title="Permanent link">&para;</a></h3>
<p>The following example will download a zip file, unpack it and run the main
executable:</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-46-1"><span class="p">{</span>
</span><span id="__span-46-2"><span class="w">  </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Run a package of code.&quot;</span><span class="p">,</span>
</span><span id="__span-46-3"><span class="w">  </span><span class="nt">&quot;dispatcher&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Sydney&quot;</span><span class="p">,</span>
</span><span id="__span-46-4"><span class="w">  </span><span class="nt">&quot;enabled&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-46-5"><span class="w">  </span><span class="nt">&quot;job_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo/my-pkg&quot;</span><span class="p">,</span>
</span><span id="__span-46-6"><span class="w">  </span><span class="nt">&quot;owner&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo@somewhere.com&quot;</span><span class="p">,</span>
</span><span id="__span-46-7"><span class="w">  </span><span class="nt">&quot;parameters&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-46-8"><span class="w">    </span><span class="nt">&quot;command&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;main-script.sh --log-level warning&quot;</span>
</span><span id="__span-46-9"><span class="w">  </span><span class="p">},</span>
</span><span id="__span-46-10"><span class="w">  </span><span class="nt">&quot;payload&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo/my-pkg.zip&quot;</span><span class="p">,</span>
</span><span id="__span-46-11"><span class="w">  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;pkg&quot;</span><span class="p">,</span>
</span><span id="__span-46-12"><span class="w">  </span><span class="nt">&quot;worker&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;default&quot;</span>
</span><span id="__span-46-13"><span class="p">}</span>
</span></code></pre></div>
<h2 id="job-type-redshift_unload">Job type: redshift_unload<a class="headerlink" href="#job-type-redshift_unload" title="Permanent link">&para;</a></h2>
<p>The <strong>redshift_unload</strong> job type performs an
<a href="https://docs.aws.amazon.com/redshift/latest/dg/r_UNLOAD.html">UNLOAD</a> operation
on an AWS Redshift cluster.</p>
<h3 id="payload_10">Payload<a class="headerlink" href="#payload_10" title="Permanent link">&para;</a></h3>
<p>The payload is ignored.</p>
<h3 id="parameters_10">Parameters<a class="headerlink" href="#parameters_10" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>args</td>
<td>List[String]</td>
<td>Yes</td>
<td>A list of options for the <code>UNLOAD</code> command. All of the Redshift supported parameters except for the authorisation parameters are supported. The options are pre-processed before passing to Redshift as described <a href="#handling-of-redshift-unload-options">below</a>.</td>
</tr>
<tr>
<td>bucket</td>
<td>String</td>
<td>Yes</td>
<td>The name of the S3 bucket to which the data is unloaded.</td>
</tr>
<tr>
<td>conn_id</td>
<td>String</td>
<td>Yes</td>
<td>The connection ID for a <a href="07-connectors.html#connector-type-redshift">Redshift provisioned cluster</a> or a <a href="07-connectors.html#connector-type-redshift-serverless">Redshift Serverless workgroup</a>.</td>
</tr>
<tr>
<td>dateformat</td>
<td>String</td>
<td>No</td>
<td>A Redshift <a href="https://docs.aws.amazon.com/redshift/latest/dg/r_FORMAT_strings.html">datetime format string</a> that will be applied to DATE fields when unloading. The safest value is <code>YYYY-MM-DD</code>. <a href="#date-formatting">More information on date formats</a>.</td>
</tr>
<tr>
<td>insecure</td>
<td>Boolean</td>
<td>No</td>
<td>Disable <a href="#s3-bucket-security-checks">bucket security checks</a>. Default is false.</td>
</tr>
<tr>
<td>prefix</td>
<td>String</td>
<td>Yes</td>
<td>The prefix in the S3 bucket to which the data is unloaded. This value is <a href="#jinja-rendering-of-the-s3-target-key">Jinja rendered</a> prior to use.</td>
</tr>
<tr>
<td>relation</td>
<td>String <em>or</em> List[String]</td>
<td>Yes</td>
<td>The name of the table or view to be unloaded (without schema) or a list of names.</td>
</tr>
<tr>
<td>s3_conn_id</td>
<td>String</td>
<td>No</td>
<td>The <a href="07-connectors.html#connector-type-aws">connection ID</a> for AWS S3. This is used in the <code>UNLOAD</code> command to allow Redshift access to S3. Either <code>s3_conn_id</code> or <code>s3_iam_role</code> is required.</td>
</tr>
<tr>
<td>s3_iam_role</td>
<td>String</td>
<td>No</td>
<td>The IAM role name to use in the <code>UNLOAD</code> command to allow Redshift access to S3. Either <code>s3_conn_id</code> or <code>s3_iam_role</code> is required.</td>
</tr>
<tr>
<td>schema</td>
<td>String</td>
<td>Yes</td>
<td>The name of the source schema for the object to be unloaded.</td>
</tr>
<tr>
<td>start</td>
<td>String</td>
<td>No</td>
<td>Name of the relation to start with when unloading a list of relations. If not specified, start at the beginning of the list. This is useful when <code>stop_on_fail</code> is false and an unload fails as it allows the unloads to be resumed at the point of failure once the issue is rectified.</td>
</tr>
<tr>
<td>stop_on_fail</td>
<td>Boolean</td>
<td>No</td>
<td>If true, stop when any unload fails otherwise keep moving through the unload list. Default is true. The event record for the job will indicate which unloads succeeded and which failed.</td>
</tr>
<tr>
<td>vars</td>
<td>Map[String,*]</td>
<td>No</td>
<td>A map of variables injected when the S3 target prefix is Jinja rendered.</td>
</tr>
<tr>
<td>where</td>
<td>String</td>
<td>No</td>
<td>An optional <code>WHERE</code> condition for the <code>UNLOAD</code> queries. Do not include the <code>WHERE</code> keyword. Note that the same condition will be added to each unload if multiple relations are specified.</td>
</tr>
</tbody>
</table>
<h3 id="handling-of-redshift-unload-options">Handling of Redshift Unload Options<a class="headerlink" href="#handling-of-redshift-unload-options" title="Permanent link">&para;</a></h3>
<p>The options for the Redshift
<a href="https://docs.aws.amazon.com/redshift/latest/dg/r_UNLOAD.html">UNLOAD</a> command
specified in the <code>args</code> key of the job parameters are pre-processed prior to use
in the <code>UNLOAD</code> operation. Unless otherwise specified below, the option is
passed through unmodified.</p>
<h4 id="partition-option">Partition Option<a class="headerlink" href="#partition-option" title="Permanent link">&para;</a></h4>
<p>The <code>PARTITION</code> option is supplied to the <code>UNLOAD</code> command in the following form:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-47-1">PARTITION BY (col1, col2,...)
</span></code></pre></div>
<p>If the unload <code>args</code> contain the <code>PARTITION</code> clause in this format, it is used as is.</p>
<p>The unload <code>args</code> can instead contain a <code>PARTITION</code> clause in this format:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-48-1">PARTITION BY @&lt;SCHEMA_NAME&gt;.&lt;REL_NAME&gt;
</span></code></pre></div>
<p>In this case, the partition information is assumed to be contained in a
partition table (or view) <code>&lt;SCHEMA_NAME&gt;.&lt;REL_NAME&gt;</code> that resides in the same
Redshift cluster as the source relation. The partition table (or view) must
include the following columns:</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>schema_name</td>
<td>VARCHAR(127)</td>
<td>Schema name in lower case.</td>
</tr>
<tr>
<td>rel_name</td>
<td>VARCHAR(127)</td>
<td>Table or view name in lower case.</td>
</tr>
<tr>
<td>partitions</td>
<td>VARCHAR(n)</td>
<td>A comma separated list of columns in the relation that will be used to populate the partition column list in the <code>UNLOAD</code> command.</td>
</tr>
</tbody>
</table>
<p>The following SQL DDL would create a suitable partition table.</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-49-1"><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">metadata</span><span class="p">.</span><span class="n">partitions</span>
</span><span id="__span-49-2"><span class="p">(</span>
</span><span id="__span-49-3"><span class="w">    </span><span class="k">schema_name</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">127</span><span class="p">)</span><span class="w">  </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
</span><span id="__span-49-4"><span class="w">    </span><span class="n">rel_name</span><span class="w">    </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">127</span><span class="p">)</span><span class="w">  </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
</span><span id="__span-49-5"><span class="w">    </span><span class="n">partitions</span><span class="w">  </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">2048</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
</span><span id="__span-49-6"><span class="w">    </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="k">schema_name</span><span class="p">,</span><span class="w"> </span><span class="n">rel_name</span><span class="p">)</span>
</span><span id="__span-49-7"><span class="p">)</span>
</span></code></pre></div>
<p>The <code>PARTITION</code> argument in the job parameters would then look like:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-50-1">PARTITION BY @metadata.partitions
</span></code></pre></div>
<h3 id="date-formatting">Date Formatting<a class="headerlink" href="#date-formatting" title="Permanent link">&para;</a></h3>
<p>Redshift has some very nasty behaviour in its date handling. It will UNLOAD
date fields with years less than 100 in <code>YY-MM-DD</code> format. Madness.</p>
<p>Redshift COPY using <code>DATEFORMAT 'auto'</code> assumes dates in <code>YY-MM-DD</code> format must
be Y2K adjusted (i.e. they are moved to post 2000). More madness.</p>
<p>So, an UNLOAD followed by a COPY will mangle dates. While the COPY command
could specify <code>DATEFORMAT 'YY-MM-DD'</code>, this will then fail for any dates with
years greater than 99. So, if the column contains dates before and after the
year 100, you're in trouble.</p>
<p>In short, there is no reliable way to UNLOAD and then COPY a data set containing
dates without manually formatting date fields.</p>
<p>To get around this singular piece of genius, use the <code>dateformat</code> key in the job
parameters.</p>
<p>If the <code>dateformat</code> key is present, and the relation has one or more DATE
fields, <strong>redshift_unload</strong> will construct a SELECT statement for the unload
that includes all of the columns, applying the given date format to DATE
columns. This is likely to impact UNLOAD performance, so it's best to avoid
using it if you are certain all dates have years greater than 99. The safest
format value is probably <code>YYYY-MM-DD</code>.</p>
<p>If the <code>dateformat</code> key is not present, or the relation has no DATE columns,
<strong>redshift_unload</strong> will simply use <code>SELECT *</code> for the target relation in the
UNLOAD command.</p>
<h3 id="jinja-rendering-of-the-s3-target-key">Jinja Rendering of the S3 Target Key<a class="headerlink" href="#jinja-rendering-of-the-s3-target-key" title="Permanent link">&para;</a></h3>
<p>The <code>prefix</code> parameter specifies the UNLOAD location in the target bucket. Its
value is rendered using <a href="http://jinja.pocoo.org">Jinja</a> to allow injection of
parameters relevant to the individual job specification and run.</p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>If a list of relations is to be unloaded, it is important to use this
rendering facility to ensure that each relation is unloaded to its own area
in S3.</p>
</div>
<p>All of the injected parameters are effectively Python objects so the normal
Jinja syntax and Python methods for those objects can be used in the Jinja
templates. This is particularly useful for the
<a href="https://docs.python.org/3/library/datetime.html#datetime-objects">datetime</a>
objects as <code>strftime()</code> becomes available. For example, the S3 location of
the unload (<code>prefix</code>) can be dynamically set to include components such as the
schema, relation name, unload date etc.</p>
<p>Refer to <a href="13-jinja-rendering-in-lava.html#jinja-rendering-in-lava">Jinja Rendering in Lava</a>
for more information.</p>
<p>The following variables are made available to the renderer.</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>globals</td>
<td>dict[str,*]</td>
<td>The <code>globals</code> from the job specification updated with any globals received in the job dispatch.</td>
</tr>
<tr>
<td>job</td>
<td>dict[str,*]</td>
<td>The <a href="13-jinja-rendering-in-lava.html#the-augmented-job-specification">augmented job specification</a>.</td>
</tr>
<tr>
<td>realm</td>
<td>dict[str,*]</td>
<td>The realm specification.</td>
</tr>
<tr>
<td>relation</td>
<td>str</td>
<td>The relation name.</td>
</tr>
<tr>
<td>schema</td>
<td>str</td>
<td>The schema name.</td>
</tr>
<tr>
<td>start</td>
<td>datetime</td>
<td>The local time when the job run started.</td>
</tr>
<tr>
<td>state</td>
<td>dict[str,*]</td>
<td>A dictionary of the state items imported into the job, keyed on state_id. The default values are updated at run-time with any current values obtainable from the <a href="04-dynamodb-tables.html#the-state-table">state</a> table.</td>
</tr>
<tr>
<td>ustart</td>
<td>datetime</td>
<td>The UTC time when the job run started.</td>
</tr>
<tr>
<td>utils</td>
<td>dict[str,runnable]</td>
<td>A dictionary of <a href="13-jinja-rendering-in-lava.html#jinja-utility-functions">utility functions</a> that can be used in the Jinja markup.</td>
</tr>
<tr>
<td>vars</td>
<td>dict[str,*]</td>
<td>A dictionary of variables provided as the <code>vars</code> component of the job <code>parameters</code>.</td>
</tr>
</tbody>
</table>
<h3 id="s3-bucket-security-checks">S3 Bucket Security Checks<a class="headerlink" href="#s3-bucket-security-checks" title="Permanent link">&para;</a></h3>
<p><strong>Redshift_unload</strong> performs some basic checks on the security of
the target S3 bucket to reduce the risk of unloading data to somewhere unsafe.
This is a convenience only and should not be relied upon for securing your data.</p>
<p>By default, if any of the following are true, the bucket will not be used
for unloaded data and the job run will fail:</p>
<ul>
<li>
<p>The bucket has any form of public access</p>
</li>
<li>
<p>The bucket does not have default encryption enabled</p>
</li>
<li>
<p>Server logging is not enabled on the bucket</p>
</li>
<li>
<p>The bucket is owned by an AWS account other than the one associated with the
    profile being used by the lava worker.</p>
</li>
</ul>
<p>These security checks can be disabled by setting the <code>insecure</code> parameter to
<code>true</code>.</p>
<p>If the security checks are enabled, the lava worker will require the following
additional IAM permissions on the target bucket:</p>
<ul>
<li>
<p>List all buckets: <code>s3:ListAllMyBuckets</code></p>
</li>
<li>
<p>Get bucket logging configuration: <code>s3:GetBucketLogging</code></p>
</li>
<li>
<p>Get bucket encryption configuration: <code>s3:GetEncryptionConfiguration</code></p>
</li>
<li>
<p>Get bucket ACLs: <code>s3:GetBucketAcl</code></p>
</li>
</ul>
<h3 id="dev-mode-behaviour_11">Dev Mode Behaviour<a class="headerlink" href="#dev-mode-behaviour_11" title="Permanent link">&para;</a></h3>
<p>The <strong>redshift_unload</strong> job behaviour is unchanged for dev mode.</p>
<h3 id="examples_8">Examples<a class="headerlink" href="#examples_8" title="Permanent link">&para;</a></h3>
<p>The following example will unload the table <code>mytable</code></p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-51-1"><span class="p">{</span>
</span><span id="__span-51-2"><span class="w">  </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Unload the table &#39;mytable&#39;&quot;</span><span class="p">,</span>
</span><span id="__span-51-3"><span class="w">  </span><span class="nt">&quot;dispatcher&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Sydney&quot;</span><span class="p">,</span>
</span><span id="__span-51-4"><span class="w">  </span><span class="nt">&quot;enabled&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-51-5"><span class="w">  </span><span class="nt">&quot;job_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo/unload-mytable&quot;</span><span class="p">,</span>
</span><span id="__span-51-6"><span class="w">  </span><span class="nt">&quot;owner&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo@somewhere.com&quot;</span><span class="p">,</span>
</span><span id="__span-51-7"><span class="w">  </span><span class="nt">&quot;parameters&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-51-8"><span class="w">    </span><span class="nt">&quot;args&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-51-9"><span class="w">      </span><span class="s2">&quot;parallel on&quot;</span><span class="p">,</span>
</span><span id="__span-51-10"><span class="w">      </span><span class="s2">&quot;delimiter &#39;|&#39;&quot;</span><span class="p">,</span>
</span><span id="__span-51-11"><span class="w">      </span><span class="s2">&quot;kms_key_id &#39;alias/lava-proto-user&#39;&quot;</span><span class="p">,</span>
</span><span id="__span-51-12"><span class="w">      </span><span class="s2">&quot;encrypted&quot;</span><span class="p">,</span>
</span><span id="__span-51-13"><span class="w">      </span><span class="s2">&quot;header&quot;</span><span class="p">,</span>
</span><span id="__span-51-14"><span class="w">      </span><span class="s2">&quot;allowoverwrite&quot;</span>
</span><span id="__span-51-15"><span class="w">    </span><span class="p">],</span>
</span><span id="__span-51-16"><span class="w">    </span><span class="nt">&quot;bucket&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;my-bucket&quot;</span><span class="p">,</span>
</span><span id="__span-51-17"><span class="w">    </span><span class="nt">&quot;conn_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;redshift-conn-01&quot;</span><span class="p">,</span>
</span><span id="__span-51-18"><span class="w">    </span><span class="nt">&quot;dateformat&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;YYYY-MM-DD&quot;</span><span class="p">,</span>
</span><span id="__span-51-19"><span class="w">    </span><span class="nt">&quot;prefix&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;unload_demo/{{schema}}/{{relation}}/&quot;</span><span class="p">,</span>
</span><span id="__span-51-20"><span class="w">    </span><span class="nt">&quot;relation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;mytable&quot;</span><span class="p">,</span>
</span><span id="__span-51-21"><span class="w">    </span><span class="nt">&quot;s3_conn_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;s3-conn-01&quot;</span><span class="p">,</span>
</span><span id="__span-51-22"><span class="w">    </span><span class="nt">&quot;schema&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;public&quot;</span>
</span><span id="__span-51-23"><span class="w">  </span><span class="p">},</span>
</span><span id="__span-51-24"><span class="w">  </span><span class="nt">&quot;payload&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;--&quot;</span><span class="p">,</span>
</span><span id="__span-51-25"><span class="w">  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;redshift_unload&quot;</span><span class="p">,</span>
</span><span id="__span-51-26"><span class="w">  </span><span class="nt">&quot;worker&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;default&quot;</span>
</span><span id="__span-51-27"><span class="p">}</span>
</span></code></pre></div>
<p>This one unloads the same table but the destination in S3 includes a date
component.</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-52-1"><span class="p">{</span>
</span><span id="__span-52-2"><span class="w">  </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Unload the table &#39;mytable&#39;&quot;</span><span class="p">,</span>
</span><span id="__span-52-3"><span class="w">  </span><span class="nt">&quot;dispatcher&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Sydney&quot;</span><span class="p">,</span>
</span><span id="__span-52-4"><span class="w">  </span><span class="nt">&quot;enabled&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-52-5"><span class="w">  </span><span class="nt">&quot;job_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo/unload-mytable&quot;</span><span class="p">,</span>
</span><span id="__span-52-6"><span class="w">  </span><span class="nt">&quot;owner&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo@somewhere.com&quot;</span><span class="p">,</span>
</span><span id="__span-52-7"><span class="w">  </span><span class="nt">&quot;parameters&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-52-8"><span class="w">    </span><span class="nt">&quot;args&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-52-9"><span class="w">      </span><span class="s2">&quot;parallel on&quot;</span><span class="p">,</span>
</span><span id="__span-52-10"><span class="w">      </span><span class="s2">&quot;delimiter &#39;|&#39;&quot;</span><span class="p">,</span>
</span><span id="__span-52-11"><span class="w">      </span><span class="s2">&quot;kms_key_id &#39;alias/lava-proto-user&#39;&quot;</span><span class="p">,</span>
</span><span id="__span-52-12"><span class="w">      </span><span class="s2">&quot;encrypted&quot;</span><span class="p">,</span>
</span><span id="__span-52-13"><span class="w">      </span><span class="s2">&quot;header&quot;</span><span class="p">,</span>
</span><span id="__span-52-14"><span class="w">      </span><span class="s2">&quot;allowoverwrite&quot;</span>
</span><span id="__span-52-15"><span class="w">    </span><span class="p">],</span>
</span><span id="__span-52-16"><span class="w">    </span><span class="nt">&quot;bucket&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;my-bucket&quot;</span><span class="p">,</span>
</span><span id="__span-52-17"><span class="w">    </span><span class="nt">&quot;conn_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;redshift-conn-01&quot;</span><span class="p">,</span>
</span><span id="__span-52-18"><span class="w">    </span><span class="nt">&quot;dateformat&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;YYYY-MM-DD&quot;</span><span class="p">,</span>
</span><span id="__span-52-19"><span class="w">    </span><span class="nt">&quot;prefix&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;unload_demo/{{schema}}/{{relation}}/{{start.strftime(&#39;%Y/%m/%d&#39;)}}/&quot;</span><span class="p">,</span>
</span><span id="__span-52-20"><span class="w">    </span><span class="nt">&quot;relation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;mytable&quot;</span><span class="p">,</span>
</span><span id="__span-52-21"><span class="w">    </span><span class="nt">&quot;s3_conn_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;s3-conn-01&quot;</span><span class="p">,</span>
</span><span id="__span-52-22"><span class="w">    </span><span class="nt">&quot;schema&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;public&quot;</span>
</span><span id="__span-52-23"><span class="w">  </span><span class="p">},</span>
</span><span id="__span-52-24"><span class="w">  </span><span class="nt">&quot;payload&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;--&quot;</span><span class="p">,</span>
</span><span id="__span-52-25"><span class="w">  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;redshift_unload&quot;</span><span class="p">,</span>
</span><span id="__span-52-26"><span class="w">  </span><span class="nt">&quot;worker&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;default&quot;</span>
</span><span id="__span-52-27"><span class="p">}</span>
</span></code></pre></div>
<p>This one unloads a list of tables.</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-53-1"><span class="p">{</span>
</span><span id="__span-53-2"><span class="w">  </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Unload multiple tables&quot;</span><span class="p">,</span>
</span><span id="__span-53-3"><span class="w">  </span><span class="nt">&quot;dispatcher&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Sydney&quot;</span><span class="p">,</span>
</span><span id="__span-53-4"><span class="w">  </span><span class="nt">&quot;enabled&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-53-5"><span class="w">  </span><span class="nt">&quot;job_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo/unload-multi&quot;</span><span class="p">,</span>
</span><span id="__span-53-6"><span class="w">  </span><span class="nt">&quot;owner&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo@somewhere.com&quot;</span><span class="p">,</span>
</span><span id="__span-53-7"><span class="w">  </span><span class="nt">&quot;parameters&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-53-8"><span class="w">    </span><span class="nt">&quot;args&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-53-9"><span class="w">      </span><span class="s2">&quot;parallel on&quot;</span><span class="p">,</span>
</span><span id="__span-53-10"><span class="w">      </span><span class="s2">&quot;delimiter &#39;|&#39;&quot;</span><span class="p">,</span>
</span><span id="__span-53-11"><span class="w">      </span><span class="s2">&quot;kms_key_id &#39;alias/lava-proto-user&#39;&quot;</span><span class="p">,</span>
</span><span id="__span-53-12"><span class="w">      </span><span class="s2">&quot;encrypted&quot;</span><span class="p">,</span>
</span><span id="__span-53-13"><span class="w">      </span><span class="s2">&quot;header&quot;</span><span class="p">,</span>
</span><span id="__span-53-14"><span class="w">      </span><span class="s2">&quot;allowoverwrite&quot;</span>
</span><span id="__span-53-15"><span class="w">    </span><span class="p">],</span>
</span><span id="__span-53-16"><span class="w">    </span><span class="nt">&quot;bucket&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;my-bucket&quot;</span><span class="p">,</span>
</span><span id="__span-53-17"><span class="w">    </span><span class="nt">&quot;conn_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;redshift-conn-01&quot;</span><span class="p">,</span>
</span><span id="__span-53-18"><span class="w">    </span><span class="nt">&quot;dateformat&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;YYYY-MM-DD&quot;</span><span class="p">,</span>
</span><span id="__span-53-19"><span class="w">    </span><span class="nt">&quot;prefix&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;unload_demo/{{schema}}/{{relation}}/{{start.strftime(&#39;%Y/%m/%d&#39;)}}/&quot;</span><span class="p">,</span>
</span><span id="__span-53-20"><span class="w">    </span><span class="nt">&quot;relation&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-53-21"><span class="w">      </span><span class="s2">&quot;mytable&quot;</span><span class="p">,</span>
</span><span id="__span-53-22"><span class="w">      </span><span class="s2">&quot;yourtable&quot;</span>
</span><span id="__span-53-23"><span class="w">    </span><span class="p">],</span>
</span><span id="__span-53-24"><span class="w">    </span><span class="nt">&quot;s3_conn_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;s3-conn-01&quot;</span><span class="p">,</span>
</span><span id="__span-53-25"><span class="w">    </span><span class="nt">&quot;schema&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;public&quot;</span>
</span><span id="__span-53-26"><span class="w">  </span><span class="p">},</span>
</span><span id="__span-53-27"><span class="w">  </span><span class="nt">&quot;payload&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;--&quot;</span><span class="p">,</span>
</span><span id="__span-53-28"><span class="w">  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;redshift_unload&quot;</span><span class="p">,</span>
</span><span id="__span-53-29"><span class="w">  </span><span class="nt">&quot;worker&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;default&quot;</span>
</span><span id="__span-53-30"><span class="p">}</span>
</span></code></pre></div>
<h2 id="job-type-sharepoint_get_doc">Job type: sharepoint_get_doc<a class="headerlink" href="#job-type-sharepoint_get_doc" title="Permanent link">&para;</a></h2>
<p>The <strong>sharepoint_get_doc</strong> job type downloads a SharePoint document to a
specified destination file.</p>
<p>Connection to the target SharePoint site is handled automatically by lava.</p>
<h3 id="payload_11">Payload<a class="headerlink" href="#payload_11" title="Permanent link">&para;</a></h3>
<p>The payload is ignored.</p>
<h3 id="parameters_11">Parameters<a class="headerlink" href="#parameters_11" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>basedir</td>
<td>String</td>
<td>No</td>
<td>If the target file is specified as a relative filename, it will be treated as relative to the specified directory. Defaults to the lava temporary directory for the job.</td>
</tr>
<tr>
<td>conn_id</td>
<td>String</td>
<td>Yes</td>
<td>The <a href="07-connectors.html#connector-type-sharepoint">connection ID</a> for a SharePoint site.</td>
</tr>
<tr>
<td>file</td>
<td>String</td>
<td>Yes</td>
<td>The destination file name. If it starts with <code>s3://</code> it is assumed to be an object in S3, otherwise a local file. If a local file and not absolute, it will be relative to the <code>basedir</code> parameter. This value is Jinja rendered.</td>
</tr>
<tr>
<td>jinja</td>
<td>Boolean</td>
<td>No</td>
<td>If <code>false</code>, disable Jinja rendering. Default <code>true</code>.</td>
</tr>
<tr>
<td>kms_key_id</td>
<td>String</td>
<td>No</td>
<td>An AWS KMS encryption key to use when uploading to AWS S3.</td>
</tr>
<tr>
<td>library</td>
<td>String</td>
<td>Yes</td>
<td>Source SharePoint library name. This value is Jinja rendered.</td>
</tr>
<tr>
<td>path</td>
<td>String</td>
<td>Yes</td>
<td>The source document path in SharePoint. Use POSIX, not DOS, style path names (i.e. forward slash path separators). It must be an absolute path starting with <code>/</code>. This value is Jinja rendered.</td>
</tr>
<tr>
<td>vars</td>
<td>Map[String,*]</td>
<td>No</td>
<td>A map of variables injected when the parameters are Jinja rendered.</td>
</tr>
</tbody>
</table>
<h3 id="jinja-rendering-of-parameters">Jinja Rendering of Parameters<a class="headerlink" href="#jinja-rendering-of-parameters" title="Permanent link">&para;</a></h3>
<p>Some of the parameters are  rendered using <a href="http://jinja.pocoo.org">Jinja</a>.</p>
<p>All of the injected parameters are effectively Python objects so the normal
Jinja syntax and Python methods for those objects can be used in the Jinja
templates. This is particularly useful for the
<a href="https://docs.python.org/3/library/datetime.html#datetime-objects">datetime</a>
objects as <code>strftime()</code> becomes available. For example, the source path can be
dynamically set to include components such as the date or part of the target
file name.</p>
<p>Refer to <a href="13-jinja-rendering-in-lava.html#jinja-rendering-in-lava">Jinja Rendering in Lava</a>
for more information.</p>
<p>The following variables are made available to the renderer.</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>globals</td>
<td>dict[str,*]</td>
<td>The <code>globals</code> from the job specification updated with any globals received in the job dispatch.</td>
</tr>
<tr>
<td>job</td>
<td>dict[str,*]</td>
<td>The <a href="13-jinja-rendering-in-lava.html#the-augmented-job-specification">augmented job specification</a>.</td>
</tr>
<tr>
<td>realm</td>
<td>dict[str,*]</td>
<td>The realm specification.</td>
</tr>
<tr>
<td>start</td>
<td>datetime</td>
<td>The local time when the job run started.</td>
</tr>
<tr>
<td>state</td>
<td>dict[str,*]</td>
<td>A dictionary of the state items imported into the job, keyed on state_id. The default values are updated at run-time with any current values obtainable from the <a href="04-dynamodb-tables.html#the-state-table">state</a> table.</td>
</tr>
<tr>
<td>ustart</td>
<td>datetime</td>
<td>The UTC time when the job run started.</td>
</tr>
<tr>
<td>utils</td>
<td>dict[str,runnable]</td>
<td>A dictionary of <a href="13-jinja-rendering-in-lava.html#jinja-utility-functions">utility functions</a> that can be used in the Jinja markup.</td>
</tr>
<tr>
<td>vars</td>
<td>dict[str,*]</td>
<td>A dictionary of variables provided as the <code>vars</code> component of the job <code>parameters</code>.</td>
</tr>
</tbody>
</table>
<h3 id="dev-mode-behaviour_12">Dev Mode Behaviour<a class="headerlink" href="#dev-mode-behaviour_12" title="Permanent link">&para;</a></h3>
<p>The <strong>sharepoint_get_doc</strong> job behaviour is unchanged for dev mode.</p>
<h3 id="examples_9">Examples<a class="headerlink" href="#examples_9" title="Permanent link">&para;</a></h3>
<p>The following example downloads a document from SharePoint and places it in S3.
The file will be KMS encrypted in S3 with the specified KMS key.</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-54-1"><span class="p">{</span>
</span><span id="__span-54-2"><span class="w">  </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Download a CSV file from SharePoint&quot;</span><span class="p">,</span>
</span><span id="__span-54-3"><span class="w">  </span><span class="nt">&quot;dispatcher&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Sydney&quot;</span><span class="p">,</span>
</span><span id="__span-54-4"><span class="w">  </span><span class="nt">&quot;enabled&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-54-5"><span class="w">  </span><span class="nt">&quot;job_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo/sharepoint-doc&quot;</span><span class="p">,</span>
</span><span id="__span-54-6"><span class="w">  </span><span class="nt">&quot;owner&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo@somewhere.com&quot;</span><span class="p">,</span>
</span><span id="__span-54-7"><span class="w">  </span><span class="nt">&quot;parameters&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-54-8"><span class="w">    </span><span class="nt">&quot;conn_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;sp-conn-01&quot;</span><span class="p">,</span>
</span><span id="__span-54-9"><span class="w">    </span><span class="nt">&quot;library&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;My SharePoint Library&quot;</span><span class="p">,</span>
</span><span id="__span-54-10"><span class="w">    </span><span class="nt">&quot;path&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/Interesting/Data/x.csv&quot;</span><span class="p">,</span>
</span><span id="__span-54-11"><span class="w">    </span><span class="nt">&quot;file&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;s3://my-bucket/x.csv&quot;</span><span class="p">,</span>
</span><span id="__span-54-12"><span class="w">    </span><span class="nt">&quot;kms_key_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;alias/data&quot;</span>
</span><span id="__span-54-13"><span class="w">  </span><span class="p">},</span>
</span><span id="__span-54-14"><span class="w">  </span><span class="nt">&quot;payload&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;--&quot;</span><span class="p">,</span>
</span><span id="__span-54-15"><span class="w">  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;sharepoint_get_doc&quot;</span><span class="p">,</span>
</span><span id="__span-54-16"><span class="w">  </span><span class="nt">&quot;worker&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;default&quot;</span>
</span><span id="__span-54-17"><span class="p">}</span>
</span></code></pre></div>
<p>This one shows how Jinja can be used to include the current date in the source
document name.</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-55-1"><span class="p">{</span>
</span><span id="__span-55-2"><span class="w">  </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Download a CSV file from SharePoint&quot;</span><span class="p">,</span>
</span><span id="__span-55-3"><span class="w">  </span><span class="nt">&quot;dispatcher&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Sydney&quot;</span><span class="p">,</span>
</span><span id="__span-55-4"><span class="w">  </span><span class="nt">&quot;enabled&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-55-5"><span class="w">  </span><span class="nt">&quot;job_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo/sharepoint-doc&quot;</span><span class="p">,</span>
</span><span id="__span-55-6"><span class="w">  </span><span class="nt">&quot;owner&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo@somewhere.com&quot;</span><span class="p">,</span>
</span><span id="__span-55-7"><span class="w">  </span><span class="nt">&quot;parameters&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-55-8"><span class="w">    </span><span class="nt">&quot;conn_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;sp-conn-01&quot;</span><span class="p">,</span>
</span><span id="__span-55-9"><span class="w">    </span><span class="nt">&quot;library&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;My SharePoint Library&quot;</span><span class="p">,</span>
</span><span id="__span-55-10"><span class="w">    </span><span class="nt">&quot;path&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/Interesting/Data/{{start.strftime(&#39;%Y-%m-%d&#39;)}}.csv&quot;</span><span class="p">,</span>
</span><span id="__span-55-11"><span class="w">    </span><span class="nt">&quot;file&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;s3://my-bucket/{{start.strftime(&#39;%Y-%m-%d&#39;)}}.csv&quot;</span><span class="p">,</span>
</span><span id="__span-55-12"><span class="w">    </span><span class="nt">&quot;kms_key_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;alias/data&quot;</span>
</span><span id="__span-55-13"><span class="w">  </span><span class="p">},</span>
</span><span id="__span-55-14"><span class="w">  </span><span class="nt">&quot;payload&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;--&quot;</span><span class="p">,</span>
</span><span id="__span-55-15"><span class="w">  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;sharepoint_get_doc&quot;</span><span class="p">,</span>
</span><span id="__span-55-16"><span class="w">  </span><span class="nt">&quot;worker&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;default&quot;</span>
</span><span id="__span-55-17"><span class="p">}</span>
</span></code></pre></div>
<h2 id="job-type-sharepoint_get_list">Job type: sharepoint_get_list<a class="headerlink" href="#job-type-sharepoint_get_list" title="Permanent link">&para;</a></h2>
<p>The <strong>sharepoint_get_list</strong> job type downloads a SharePoint list to a
a specified destination file, one row per line.</p>
<p>Connection to the target SharePoint site is handled automatically by lava.</p>
<h3 id="payload_12">Payload<a class="headerlink" href="#payload_12" title="Permanent link">&para;</a></h3>
<p>The payload is ignored.</p>
<h3 id="parameters_12">Parameters<a class="headerlink" href="#parameters_12" title="Permanent link">&para;</a></h3>
<p>The formatting related parameters are as defined for the Python CSV writer,
although some of the defaults are different.  Defaults can be overridden at the
realm level using <a href="10-installation-operation.html#configuration-for-sharepoint-jobs">configuration
variables</a>.</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>basedir</td>
<td>String</td>
<td>No</td>
<td>If the target file is specified as a relative filename, it will be treated as relative to the specified directory. Defaults to the lava temporary directory for the job.</td>
</tr>
<tr>
<td>conn_id</td>
<td>String</td>
<td>Yes</td>
<td>The <a href="07-connectors.html#connector-type-sharepoint">connection ID</a> for a SharePoint site.</td>
</tr>
<tr>
<td>data_columns</td>
<td>String</td>
<td>No</td>
<td>A comma separated list of column names. If specified, then only columns listed are extracted (in addition to any specified <code>system_columns</code>).</td>
</tr>
<tr>
<td>delimiter</td>
<td>String</td>
<td>No</td>
<td>Single character field delimiter. Default <code>|</code>.</td>
</tr>
<tr>
<td>doublequote</td>
<td>Boolean</td>
<td>No</td>
<td>As for <a href="https://docs.python.org/library/csv.html#csv-fmt-params">csv.writer</a>. Default <code>false</code>.</td>
</tr>
<tr>
<td>escapechar</td>
<td>String</td>
<td>No</td>
<td>As for <a href="https://docs.python.org/library/csv.html#csv-fmt-params">csv.writer</a>. Default <code>null</code>.</td>
</tr>
<tr>
<td>file</td>
<td>String</td>
<td>Yes</td>
<td>The destination file name. If it starts with <code>s3://</code> it is assumed to be an object in S3, otherwise a local file. If a local file and not absolute, it will be relative to the <code>basedir</code> parameter. This value is Jinja rendered.</td>
</tr>
<tr>
<td>header</td>
<td>Boolean</td>
<td>No</td>
<td>If <code>true</code>, include a header line containing column names. Default <code>true</code>.</td>
</tr>
<tr>
<td>jinja</td>
<td>Boolean</td>
<td>No</td>
<td>If <code>false</code>, disable Jinja rendering. Default <code>true</code>.</td>
</tr>
<tr>
<td>kms_key_id</td>
<td>String</td>
<td>No</td>
<td>An AWS KMS encryption key to use when uploading to AWS S3.</td>
</tr>
<tr>
<td>list</td>
<td>String</td>
<td>Yes</td>
<td>Name of the list. It must already exist in SharePoint. This will be jinja rendered.</td>
</tr>
<tr>
<td>quotechar</td>
<td>String</td>
<td>No</td>
<td>As for <a href="https://docs.python.org/library/csv.html#csv-fmt-params">csv.writer</a>. Default <code>"</code>.</td>
</tr>
<tr>
<td>quoting</td>
<td>String</td>
<td>No</td>
<td>As for <a href="https://docs.python.org/library/csv.html#csv-fmt-params">csv.writer</a> <code>QUOTE_*</code> parameters (without the QUOTE_ prefix). Default <code>minimal</code> (i.e. <code>QUOTE_MINIMAL</code>).</td>
</tr>
<tr>
<td>system_columns</td>
<td>String</td>
<td>No</td>
<td>A comma separated list of system columns to retrieve in addition to the data columns. Unless specified, only data columns are retrieved.</td>
</tr>
<tr>
<td>vars</td>
<td>Map[String,*]</td>
<td>No</td>
<td>A map of variables injected when the parameters are Jinja rendered.</td>
</tr>
</tbody>
</table>
<p>Consult SharePoint documentation for available system columns. Currently known
columns include:</p>
<ul>
<li><code>ComplianceAssetId</code></li>
<li><code>AppAuthor</code></li>
<li><code>AppEditor</code></li>
<li><code>Attachments</code></li>
<li><code>Author</code></li>
<li><code>ContentType</code></li>
<li><code>Created</code></li>
<li><code>DocIcon</code></li>
<li><code>Edit</code></li>
<li><code>Editor</code></li>
<li><code>FolderChildCount</code></li>
<li><code>ID</code></li>
<li><code>ItemChildCount</code></li>
<li><code>LinkTitleNoMenu</code></li>
<li><code>LinkTitle</code></li>
<li><code>Modified</code></li>
<li><code>_ComplianceFlags</code></li>
<li><code>_ComplianceTagUserId</code></li>
<li><code>_ComplianceTagWrittenTime</code></li>
<li><code>_ComplianceTag</code></li>
<li><code>_IsRecord</code></li>
<li><code>_UIVersionString</code></li>
</ul>
<h3 id="handling-of-personorgroup-columns">Handling of personorgroup Columns<a class="headerlink" href="#handling-of-personorgroup-columns" title="Permanent link">&para;</a></h3>
<p>Columns of type <code>personorgroup</code> have an associated <code>LookupId</code> column. So for a
column named <code>&lt;COLUMN&gt;</code>, the list also has a <code>&lt;COLUMN&gt;LookupId</code> column.</p>
<p>If the <code>data_columns</code> parameter is not specified, meaning to retrieve all
columns, the <code>&lt;COLUMN&gt;</code> and <code>&lt;COLUMN&gt;LookupId</code> will both be retrieved, in that
order.</p>
<p>If the <code>data_columns</code> parameter is specified, the <code>&lt;COLUMN&gt;LookupId</code> must be
explicitly named in the list if required.</p>
<p>System columns of type <code>personorgroup</code> also have an associated <code>LookupId</code> column
that can be retrieved by naming it in the <code>system_columns</code> parameter.</p>
<h3 id="jinja-rendering-of-parameters_1">Jinja Rendering of Parameters<a class="headerlink" href="#jinja-rendering-of-parameters_1" title="Permanent link">&para;</a></h3>
<p>Some of the parameters are  rendered using <a href="http://jinja.pocoo.org">Jinja</a>.</p>
<p>All of the injected parameters are effectively Python objects so the normal
Jinja syntax and Python methods for those objects can be used in the Jinja
templates. This is particularly useful for the
<a href="https://docs.python.org/3/library/datetime.html#datetime-objects">datetime</a>
objects as <code>strftime()</code> becomes available. For example, target path can be
dynamically set to include components such as the date or part of the source
file name.</p>
<p>Refer to <a href="13-jinja-rendering-in-lava.html#jinja-rendering-in-lava">Jinja Rendering in Lava</a>
for more information.</p>
<p>The following variables are made available to the renderer.</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>globals</td>
<td>dict[str,*]</td>
<td>The <code>globals</code> from the job specification updated with any globals received in the job dispatch.</td>
</tr>
<tr>
<td>job</td>
<td>dict[str,*]</td>
<td>The <a href="13-jinja-rendering-in-lava.html#the-augmented-job-specification">augmented job specification</a>.</td>
</tr>
<tr>
<td>realm</td>
<td>dict[str,*]</td>
<td>The realm specification.</td>
</tr>
<tr>
<td>start</td>
<td>datetime</td>
<td>The local time when the job run started.</td>
</tr>
<tr>
<td>state</td>
<td>dict[str,*]</td>
<td>A dictionary of the state items imported into the job, keyed on state_id. The default values are updated at run-time with any current values obtainable from the <a href="04-dynamodb-tables.html#the-state-table">state</a> table.</td>
</tr>
<tr>
<td>ustart</td>
<td>datetime</td>
<td>The UTC time when the job run started.</td>
</tr>
<tr>
<td>utils</td>
<td>dict[str,runnable]</td>
<td>A dictionary of <a href="13-jinja-rendering-in-lava.html#jinja-utility-functions">utility functions</a> that can be used in the Jinja markup.</td>
</tr>
<tr>
<td>vars</td>
<td>dict[str,*]</td>
<td>A dictionary of variables provided as the <code>vars</code> component of the job <code>parameters</code>.</td>
</tr>
</tbody>
</table>
<h3 id="dev-mode-behaviour_13">Dev Mode Behaviour<a class="headerlink" href="#dev-mode-behaviour_13" title="Permanent link">&para;</a></h3>
<p>The <strong>sharepoint_get_list</strong> job behaviour is unchanged for dev mode.</p>
<h3 id="examples_10">Examples<a class="headerlink" href="#examples_10" title="Permanent link">&para;</a></h3>
<p>The following example replaces the contents of a list with data from S3.</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-56-1"><span class="p">{</span>
</span><span id="__span-56-2"><span class="w">  </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Download a SharePoint list to a CSV file&quot;</span><span class="p">,</span>
</span><span id="__span-56-3"><span class="w">  </span><span class="nt">&quot;dispatcher&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Sydney&quot;</span><span class="p">,</span>
</span><span id="__span-56-4"><span class="w">  </span><span class="nt">&quot;enabled&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-56-5"><span class="w">  </span><span class="nt">&quot;job_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo/sharepoint-list&quot;</span><span class="p">,</span>
</span><span id="__span-56-6"><span class="w">  </span><span class="nt">&quot;owner&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo@somewhere.com&quot;</span><span class="p">,</span>
</span><span id="__span-56-7"><span class="w">  </span><span class="nt">&quot;parameters&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-56-8"><span class="w">    </span><span class="nt">&quot;conn_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;sp-conn-01&quot;</span><span class="p">,</span>
</span><span id="__span-56-9"><span class="w">    </span><span class="nt">&quot;list&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;My List&quot;</span><span class="p">,</span>
</span><span id="__span-56-10"><span class="w">    </span><span class="nt">&quot;file&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;s3://my-bucket/x.csv&quot;</span><span class="p">,</span>
</span><span id="__span-56-11"><span class="w">    </span><span class="nt">&quot;kms_key_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;alias/data&quot;</span><span class="p">,</span>
</span><span id="__span-56-12"><span class="w">    </span><span class="nt">&quot;quote&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;minimal&quot;</span><span class="p">,</span>
</span><span id="__span-56-13"><span class="w">    </span><span class="nt">&quot;separator&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;,&quot;</span>
</span><span id="__span-56-14"><span class="w">  </span><span class="p">},</span>
</span><span id="__span-56-15"><span class="w">  </span><span class="nt">&quot;payload&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;--&quot;</span><span class="p">,</span>
</span><span id="__span-56-16"><span class="w">  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;sharepoint_get_list&quot;</span><span class="p">,</span>
</span><span id="__span-56-17"><span class="w">  </span><span class="nt">&quot;worker&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;default&quot;</span>
</span><span id="__span-56-18"><span class="p">}</span>
</span></code></pre></div>
<h2 id="job-type-sharepoint_get_multi_doc">Job type: sharepoint_get_multi_doc<a class="headerlink" href="#job-type-sharepoint_get_multi_doc" title="Permanent link">&para;</a></h2>
<p>The <strong>sharepoint_get_multi_doc</strong> job type downloads multiple SharePoint
documents to a specified destination path.</p>
<p>Connection to the target SharePoint site is handled automatically by lava.</p>
<h3 id="payload_13">Payload<a class="headerlink" href="#payload_13" title="Permanent link">&para;</a></h3>
<p>The payload is ignored.</p>
<h3 id="parameters_13">Parameters<a class="headerlink" href="#parameters_13" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>basedir</td>
<td>String</td>
<td>No</td>
<td>If the target file is specified as a relative filename, it will be treated as relative to the specified directory. Defaults to the lava temporary directory for the job.</td>
</tr>
<tr>
<td>conn_id</td>
<td>String</td>
<td>Yes</td>
<td>The <a href="07-connectors.html#connector-type-sharepoint">connection ID</a> for a SharePoint site.</td>
</tr>
<tr>
<td>glob</td>
<td>String</td>
<td>No</td>
<td>The UNIX glob style pattern used to select files in the specified SharePoint folder path area. If not specified, all files are selected. Matching is case-insensitive. This value is Jinja rendered.</td>
</tr>
<tr>
<td>jinja</td>
<td>Boolean</td>
<td>No</td>
<td>If <code>false</code>, disable Jinja rendering. Default <code>true</code>.</td>
</tr>
<tr>
<td>kms_key_id</td>
<td>String</td>
<td>No</td>
<td>An AWS KMS encryption key to use when uploading to AWS S3.</td>
</tr>
<tr>
<td>library</td>
<td>String</td>
<td>Yes</td>
<td>Source SharePoint library name. This value is Jinja rendered.</td>
</tr>
<tr>
<td>outpath</td>
<td>String</td>
<td>Yes</td>
<td>The destination file location. If it starts with <code>s3://</code> it is assumed to be a prefix in S3 (add your own trailing <code>/</code> if needed), otherwise a local directory. If a local directory and not absolute, it will be relative to the <code>basedir</code> parameter. This value is Jinja rendered.</td>
</tr>
<tr>
<td>path</td>
<td>String</td>
<td>Yes</td>
<td>The source document path in SharePoint. Use POSIX, not DOS, style path names (i.e. forward slash path separators). It must be an absolute path starting with <code>/</code> and a SharePoint folder. This value is Jinja rendered.</td>
</tr>
<tr>
<td>vars</td>
<td>Map[String,*]</td>
<td>No</td>
<td>A map of variables injected when the parameters are Jinja rendered.</td>
</tr>
</tbody>
</table>
<h3 id="jinja-rendering-of-parameters_2">Jinja Rendering of Parameters<a class="headerlink" href="#jinja-rendering-of-parameters_2" title="Permanent link">&para;</a></h3>
<p>Some of the parameters are  rendered using <a href="http://jinja.pocoo.org">Jinja</a>.</p>
<p>All of the injected parameters are effectively Python objects so the normal
Jinja syntax and Python methods for those objects can be used in the Jinja
templates. This is particularly useful for the
<a href="https://docs.python.org/3/library/datetime.html#datetime-objects">datetime</a>
objects as <code>strftime()</code> becomes available. For example, the source path can be
dynamically set to include components such as the date or part of the target
file name.</p>
<p>Refer to <a href="13-jinja-rendering-in-lava.html#jinja-rendering-in-lava">Jinja Rendering in Lava</a>
for more information.</p>
<p>The following variables are made available to the renderer.</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>globals</td>
<td>dict[str,*]</td>
<td>The <code>globals</code> from the job specification updated with any globals received in the job dispatch.</td>
</tr>
<tr>
<td>job</td>
<td>dict[str,*]</td>
<td>The <a href="13-jinja-rendering-in-lava.html#the-augmented-job-specification">augmented job specification</a>.</td>
</tr>
<tr>
<td>realm</td>
<td>dict[str,*]</td>
<td>The realm specification.</td>
</tr>
<tr>
<td>start</td>
<td>datetime</td>
<td>The local time when the job run started.</td>
</tr>
<tr>
<td>state</td>
<td>dict[str,*]</td>
<td>A dictionary of the state items imported into the job, keyed on state_id. The default values are updated at run-time with any current values obtainable from the <a href="04-dynamodb-tables.html#the-state-table">state</a> table.</td>
</tr>
<tr>
<td>ustart</td>
<td>datetime</td>
<td>The UTC time when the job run started.</td>
</tr>
<tr>
<td>utils</td>
<td>dict[str,runnable]</td>
<td>A dictionary of <a href="13-jinja-rendering-in-lava.html#jinja-utility-functions">utility functions</a> that can be used in the Jinja markup.</td>
</tr>
<tr>
<td>vars</td>
<td>dict[str,*]</td>
<td>A dictionary of variables provided as the <code>vars</code> component of the job <code>parameters</code>.</td>
</tr>
</tbody>
</table>
<h3 id="dev-mode-behaviour_14">Dev Mode Behaviour<a class="headerlink" href="#dev-mode-behaviour_14" title="Permanent link">&para;</a></h3>
<p>The <strong>sharepoint_get_multi_doc</strong> job behaviour is unchanged for dev mode.</p>
<h3 id="examples_11">Examples<a class="headerlink" href="#examples_11" title="Permanent link">&para;</a></h3>
<p>The following example downloads all csv files from SharePoint path and places it in S3.
The file will be KMS encrypted in S3 with the specified KMS key.</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-57-1"><span class="p">{</span>
</span><span id="__span-57-2"><span class="w">  </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Download a CSV file from SharePoint&quot;</span><span class="p">,</span>
</span><span id="__span-57-3"><span class="w">  </span><span class="nt">&quot;dispatcher&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Sydney&quot;</span><span class="p">,</span>
</span><span id="__span-57-4"><span class="w">  </span><span class="nt">&quot;enabled&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-57-5"><span class="w">  </span><span class="nt">&quot;job_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo/sharepoint-multi-doc&quot;</span><span class="p">,</span>
</span><span id="__span-57-6"><span class="w">  </span><span class="nt">&quot;owner&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo@somewhere.com&quot;</span><span class="p">,</span>
</span><span id="__span-57-7"><span class="w">  </span><span class="nt">&quot;parameters&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-57-8"><span class="w">    </span><span class="nt">&quot;conn_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;sp-conn-01&quot;</span><span class="p">,</span>
</span><span id="__span-57-9"><span class="w">    </span><span class="nt">&quot;library&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;My SharePoint Library&quot;</span><span class="p">,</span>
</span><span id="__span-57-10"><span class="w">    </span><span class="nt">&quot;path&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/Interesting/Data/&quot;</span><span class="p">,</span>
</span><span id="__span-57-11"><span class="w">    </span><span class="nt">&quot;outpath&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;s3://my-bucket/base-prefix/&quot;</span><span class="p">,</span>
</span><span id="__span-57-12"><span class="w">    </span><span class="nt">&quot;glob&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;*.csv&quot;</span><span class="p">,</span>
</span><span id="__span-57-13"><span class="w">    </span><span class="nt">&quot;kms_key_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;alias/data&quot;</span>
</span><span id="__span-57-14"><span class="w">  </span><span class="p">},</span>
</span><span id="__span-57-15"><span class="w">  </span><span class="nt">&quot;payload&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;--&quot;</span><span class="p">,</span>
</span><span id="__span-57-16"><span class="w">  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;sharepoint_get_multi_doc&quot;</span><span class="p">,</span>
</span><span id="__span-57-17"><span class="w">  </span><span class="nt">&quot;worker&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;default&quot;</span>
</span><span id="__span-57-18"><span class="p">}</span>
</span></code></pre></div>
<p>This one shows how Jinja can be used to include the current date in the source
document name.</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-58-1"><span class="p">{</span>
</span><span id="__span-58-2"><span class="w">  </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Download a CSV file from SharePoint&quot;</span><span class="p">,</span>
</span><span id="__span-58-3"><span class="w">  </span><span class="nt">&quot;dispatcher&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Sydney&quot;</span><span class="p">,</span>
</span><span id="__span-58-4"><span class="w">  </span><span class="nt">&quot;enabled&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-58-5"><span class="w">  </span><span class="nt">&quot;job_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo/sharepoint-multi-doc&quot;</span><span class="p">,</span>
</span><span id="__span-58-6"><span class="w">  </span><span class="nt">&quot;owner&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo@somewhere.com&quot;</span><span class="p">,</span>
</span><span id="__span-58-7"><span class="w">  </span><span class="nt">&quot;parameters&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-58-8"><span class="w">    </span><span class="nt">&quot;conn_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;sp-conn-01&quot;</span><span class="p">,</span>
</span><span id="__span-58-9"><span class="w">    </span><span class="nt">&quot;library&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;My SharePoint Library&quot;</span><span class="p">,</span>
</span><span id="__span-58-10"><span class="w">    </span><span class="nt">&quot;path&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/Interesting/Data/{{start.strftime(&#39;%Y-%m-%d&#39;)}}&quot;</span><span class="p">,</span>
</span><span id="__span-58-11"><span class="w">    </span><span class="nt">&quot;outpath&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;s3://my-bucket/{{start.strftime(&#39;%Y-%m-%d&#39;)}}/&quot;</span><span class="p">,</span>
</span><span id="__span-58-12"><span class="w">    </span><span class="nt">&quot;kms_key_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;alias/data&quot;</span>
</span><span id="__span-58-13"><span class="w">  </span><span class="p">},</span>
</span><span id="__span-58-14"><span class="w">  </span><span class="nt">&quot;payload&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;--&quot;</span><span class="p">,</span>
</span><span id="__span-58-15"><span class="w">  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;sharepoint_get_multi_doc&quot;</span><span class="p">,</span>
</span><span id="__span-58-16"><span class="w">  </span><span class="nt">&quot;worker&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;default&quot;</span>
</span><span id="__span-58-17"><span class="p">}</span>
</span></code></pre></div>
<h2 id="job-type-sharepoint_put_doc">Job type: sharepoint_put_doc<a class="headerlink" href="#job-type-sharepoint_put_doc" title="Permanent link">&para;</a></h2>
<p>The <strong>sharepoint_put_doc</strong> job type creates or updates a SharePoint document
from a specified source file.</p>
<p>Connection to the target SharePoint site is handled automatically by lava.</p>
<h3 id="payload_14">Payload<a class="headerlink" href="#payload_14" title="Permanent link">&para;</a></h3>
<p>The payload is ignored.</p>
<h3 id="parameters_14">Parameters<a class="headerlink" href="#parameters_14" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>basedir</td>
<td>String</td>
<td>No</td>
<td>If the source file is specified as a relative filename, it will be treated as relative to the specified directory. Defaults to the lava temporary directory for the job.</td>
</tr>
<tr>
<td>conn_id</td>
<td>String</td>
<td>Yes</td>
<td>The <a href="07-connectors.html#connector-type-sharepoint">connection ID</a> for a SharePoint site.</td>
</tr>
<tr>
<td>file</td>
<td>String</td>
<td>Yes</td>
<td>The source file name. If it starts with <code>s3://</code> it is assumed to be an object in S3, otherwise a local file. If a local file and not absolute, it will be relative to the <code>basedir</code> parameter. This value is Jinja rendered.</td>
</tr>
<tr>
<td>jinja</td>
<td>Boolean</td>
<td>No</td>
<td>If <code>false</code>, disable Jinja rendering. Default <code>true</code>.</td>
</tr>
<tr>
<td>library</td>
<td>String</td>
<td>Yes</td>
<td>Target SharePoint library name. This value is Jinja rendered.</td>
</tr>
<tr>
<td>path</td>
<td>String</td>
<td>Yes</td>
<td>The target document path in SharePoint. Use POSIX, not DOS, style path names (i.e. forward slash path separators). It must be an absolute path starting with <code>/</code>. This value is Jinja rendered.</td>
</tr>
<tr>
<td>title</td>
<td>String</td>
<td>No</td>
<td>A title for the document. This value is Jinja rendered.</td>
</tr>
<tr>
<td>vars</td>
<td>Map[String,*]</td>
<td>No</td>
<td>A map of variables injected when the parameters are Jinja rendered.</td>
</tr>
</tbody>
</table>
<h3 id="jinja-rendering-of-parameters_3">Jinja Rendering of Parameters<a class="headerlink" href="#jinja-rendering-of-parameters_3" title="Permanent link">&para;</a></h3>
<p>Some of the parameters are  rendered using <a href="http://jinja.pocoo.org">Jinja</a>.</p>
<p>All of the injected parameters are effectively Python objects so the normal
Jinja syntax and Python methods for those objects can be used in the Jinja
templates. This is particularly useful for the
<a href="https://docs.python.org/3/library/datetime.html#datetime-objects">datetime</a>
objects as <code>strftime()</code> becomes available. For example, target path can be
dynamically set to include components such as the date or part of the source
file name.</p>
<p>Refer to <a href="13-jinja-rendering-in-lava.html#jinja-rendering-in-lava">Jinja Rendering in Lava</a>
for more information.</p>
<p>The following variables are made available to the renderer.</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>globals</td>
<td>dict[str,*]</td>
<td>The <code>globals</code> from the job specification updated with any globals received in the job dispatch.</td>
</tr>
<tr>
<td>job</td>
<td>dict[str,*]</td>
<td>The <a href="13-jinja-rendering-in-lava.html#the-augmented-job-specification">augmented job specification</a>.</td>
</tr>
<tr>
<td>realm</td>
<td>dict[str,*]</td>
<td>The realm specification.</td>
</tr>
<tr>
<td>start</td>
<td>datetime</td>
<td>The local time when the job run started.</td>
</tr>
<tr>
<td>state</td>
<td>dict[str,*]</td>
<td>A dictionary of the state items imported into the job, keyed on state_id. The default values are updated at run-time with any current values obtainable from the <a href="04-dynamodb-tables.html#the-state-table">state</a> table.</td>
</tr>
<tr>
<td>ustart</td>
<td>datetime</td>
<td>The UTC time when the job run started.</td>
</tr>
<tr>
<td>utils</td>
<td>dict[str,runnable]</td>
<td>A dictionary of <a href="13-jinja-rendering-in-lava.html#jinja-utility-functions">utility functions</a> that can be used in the Jinja markup.</td>
</tr>
<tr>
<td>vars</td>
<td>dict[str,*]</td>
<td>A dictionary of variables provided as the <code>vars</code> component of the job <code>parameters</code>.</td>
</tr>
</tbody>
</table>
<h3 id="dev-mode-behaviour_15">Dev Mode Behaviour<a class="headerlink" href="#dev-mode-behaviour_15" title="Permanent link">&para;</a></h3>
<p>The <strong>sharepoint_put_doc</strong> job behaviour is unchanged for dev mode.</p>
<h3 id="examples_12">Examples<a class="headerlink" href="#examples_12" title="Permanent link">&para;</a></h3>
<p>The following example uploads a file from S3 to a SharePoint library.</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-59-1"><span class="p">{</span>
</span><span id="__span-59-2"><span class="w">  </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Upload a CSV file to SharePoint&quot;</span><span class="p">,</span>
</span><span id="__span-59-3"><span class="w">  </span><span class="nt">&quot;dispatcher&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Sydney&quot;</span><span class="p">,</span>
</span><span id="__span-59-4"><span class="w">  </span><span class="nt">&quot;enabled&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-59-5"><span class="w">  </span><span class="nt">&quot;job_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo/sharepoint-doc&quot;</span><span class="p">,</span>
</span><span id="__span-59-6"><span class="w">  </span><span class="nt">&quot;owner&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo@somewhere.com&quot;</span><span class="p">,</span>
</span><span id="__span-59-7"><span class="w">  </span><span class="nt">&quot;parameters&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-59-8"><span class="w">    </span><span class="nt">&quot;conn_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;sp-conn-01&quot;</span><span class="p">,</span>
</span><span id="__span-59-9"><span class="w">    </span><span class="nt">&quot;library&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;My SharePoint Library&quot;</span><span class="p">,</span>
</span><span id="__span-59-10"><span class="w">    </span><span class="nt">&quot;path&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/Interesting/Data/x.csv&quot;</span><span class="p">,</span>
</span><span id="__span-59-11"><span class="w">    </span><span class="nt">&quot;file&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;s3://my-bucket/x.csv&quot;</span><span class="p">,</span>
</span><span id="__span-59-12"><span class="w">    </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;This is an interesting data set&quot;</span>
</span><span id="__span-59-13"><span class="w">  </span><span class="p">},</span>
</span><span id="__span-59-14"><span class="w">  </span><span class="nt">&quot;payload&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;--&quot;</span><span class="p">,</span>
</span><span id="__span-59-15"><span class="w">  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;sharepoint_put_doc&quot;</span><span class="p">,</span>
</span><span id="__span-59-16"><span class="w">  </span><span class="nt">&quot;worker&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;default&quot;</span>
</span><span id="__span-59-17"><span class="p">}</span>
</span></code></pre></div>
<p>This one shows how Jinja can be used to replicate the source file name into
the target document name.</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-60-1"><span class="p">{</span>
</span><span id="__span-60-2"><span class="w">  </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Upload a CSV file to SharePoint&quot;</span><span class="p">,</span>
</span><span id="__span-60-3"><span class="w">  </span><span class="nt">&quot;dispatcher&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Sydney&quot;</span><span class="p">,</span>
</span><span id="__span-60-4"><span class="w">  </span><span class="nt">&quot;enabled&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-60-5"><span class="w">  </span><span class="nt">&quot;job_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo/sharepoint-doc&quot;</span><span class="p">,</span>
</span><span id="__span-60-6"><span class="w">  </span><span class="nt">&quot;owner&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo@somewhere.com&quot;</span><span class="p">,</span>
</span><span id="__span-60-7"><span class="w">  </span><span class="nt">&quot;parameters&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-60-8"><span class="w">    </span><span class="nt">&quot;conn_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;sp-conn-01&quot;</span><span class="p">,</span>
</span><span id="__span-60-9"><span class="w">    </span><span class="nt">&quot;library&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;My SharePoint Library&quot;</span><span class="p">,</span>
</span><span id="__span-60-10"><span class="w">    </span><span class="nt">&quot;path&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/Interesting/Data/{{job.parameters.file}}.split(&#39;/&#39;)[-1]}}&quot;</span><span class="p">,</span>
</span><span id="__span-60-11"><span class="w">    </span><span class="nt">&quot;file&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;s3://my-bucket/x.csv&quot;</span><span class="p">,</span>
</span><span id="__span-60-12"><span class="w">    </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;This is an interesting data set&quot;</span>
</span><span id="__span-60-13"><span class="w">  </span><span class="p">},</span>
</span><span id="__span-60-14"><span class="w">  </span><span class="nt">&quot;payload&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;--&quot;</span><span class="p">,</span>
</span><span id="__span-60-15"><span class="w">  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;sharepoint_put_doc&quot;</span><span class="p">,</span>
</span><span id="__span-60-16"><span class="w">  </span><span class="nt">&quot;worker&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;default&quot;</span>
</span><span id="__span-60-17"><span class="p">}</span>
</span></code></pre></div>
<p>This one shows how Jinja can be used to include the current date in the target
document name.</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-61-1"><span class="p">{</span>
</span><span id="__span-61-2"><span class="w">  </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Upload a CSV file to SharePoint&quot;</span><span class="p">,</span>
</span><span id="__span-61-3"><span class="w">  </span><span class="nt">&quot;dispatcher&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Sydney&quot;</span><span class="p">,</span>
</span><span id="__span-61-4"><span class="w">  </span><span class="nt">&quot;enabled&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-61-5"><span class="w">  </span><span class="nt">&quot;job_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo/sharepoint-doc&quot;</span><span class="p">,</span>
</span><span id="__span-61-6"><span class="w">  </span><span class="nt">&quot;owner&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo@somewhere.com&quot;</span><span class="p">,</span>
</span><span id="__span-61-7"><span class="w">  </span><span class="nt">&quot;parameters&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-61-8"><span class="w">    </span><span class="nt">&quot;conn_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;sp-conn-01&quot;</span><span class="p">,</span>
</span><span id="__span-61-9"><span class="w">    </span><span class="nt">&quot;library&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;My SharePoint Library&quot;</span><span class="p">,</span>
</span><span id="__span-61-10"><span class="w">    </span><span class="nt">&quot;path&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/Interesting/Data/{{start.strftime(&#39;%Y-%m-%d&#39;)}}.csv&quot;</span><span class="p">,</span>
</span><span id="__span-61-11"><span class="w">    </span><span class="nt">&quot;file&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;s3://my-bucket/x.csv&quot;</span><span class="p">,</span>
</span><span id="__span-61-12"><span class="w">    </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;This is an interesting data set&quot;</span>
</span><span id="__span-61-13"><span class="w">  </span><span class="p">},</span>
</span><span id="__span-61-14"><span class="w">  </span><span class="nt">&quot;payload&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;--&quot;</span><span class="p">,</span>
</span><span id="__span-61-15"><span class="w">  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;sharepoint_put_doc&quot;</span><span class="p">,</span>
</span><span id="__span-61-16"><span class="w">  </span><span class="nt">&quot;worker&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;default&quot;</span>
</span><span id="__span-61-17"><span class="p">}</span>
</span></code></pre></div>
<h2 id="job-type-sharepoint_put_list">Job type: sharepoint_put_list<a class="headerlink" href="#job-type-sharepoint_put_list" title="Permanent link">&para;</a></h2>
<p>The <strong>sharepoint_put_list</strong> job type updates a SharePoint list from
a specified CSV source file.</p>
<p>Connection to the target SharePoint site is handled automatically by lava.</p>
<h3 id="payload_15">Payload<a class="headerlink" href="#payload_15" title="Permanent link">&para;</a></h3>
<p>The payload is ignored.</p>
<h3 id="parameters_15">Parameters<a class="headerlink" href="#parameters_15" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>basedir</td>
<td>String</td>
<td>No</td>
<td>If the source file is specified as a relative filename, it will be treated as relative to the specified directory. Defaults to the lava temporary directory for the job.</td>
</tr>
<tr>
<td>conn_id</td>
<td>String</td>
<td>Yes</td>
<td>The <a href="07-connectors.html#connector-type-sharepoint">connection ID</a> for a SharePoint site.</td>
</tr>
<tr>
<td>data_columns</td>
<td>String</td>
<td>No</td>
<td>A comma separated list of column names. If specified, then only columns listed are modified. Any columns specified in SharePoint as required must be included in the source data for modes <code>append</code> and <code>replace</code>. Required columns present in the source data will be included in the append/replace even if not explicitly included in the <code>data_columns</code> list.</td>
</tr>
<tr>
<td>delimiter</td>
<td>String</td>
<td>No</td>
<td>Single character field delimiter. Default <code>|</code>.</td>
</tr>
<tr>
<td>doublequote</td>
<td>Boolean</td>
<td>No</td>
<td>As for <a href="https://docs.python.org/library/csv.html#csv-fmt-params">csv.reader</a>. Default <code>false</code>.</td>
</tr>
<tr>
<td>error_missing</td>
<td>Boolean</td>
<td>No</td>
<td>If <code>true</code> and there are columns in the source file that are not in the SharePoint list, raise an error. If <code>false</code>, the extra columns are silently ignored. Default <code>false</code>.</td>
</tr>
<tr>
<td>escapechar</td>
<td>String</td>
<td>No</td>
<td>As for <a href="https://docs.python.org/library/csv.html#csv-fmt-params">csv.reader</a>. Default <code>null</code>.</td>
</tr>
<tr>
<td>file</td>
<td>String</td>
<td>Yes</td>
<td>The source file name. If it starts with <code>s3://</code> it is assumed to be an object in S3, otherwise a local file. If a local file and not absolute, it will be relative to the <code>basedir</code> parameter. This value is Jinja rendered. The contents must be a CSV data with a single header line. The columns must match the pre-existing list in SharePoint.</td>
</tr>
<tr>
<td>jinja</td>
<td>Boolean</td>
<td>No</td>
<td>If <code>false</code>, disable Jinja rendering. Default <code>true</code>.</td>
</tr>
<tr>
<td>list</td>
<td>String</td>
<td>Yes</td>
<td>Name of the list. It must already exist in SharePoint. This will be jinja rendered.</td>
</tr>
<tr>
<td>mode</td>
<td>String</td>
<td>No</td>
<td>See below. Default is <code>append</code>.</td>
</tr>
<tr>
<td>quotechar</td>
<td>String</td>
<td>No</td>
<td>As for <a href="https://docs.python.org/library/csv.html#csv-fmt-params">csv.reader</a>. Default <code>"</code>.</td>
</tr>
<tr>
<td>quoting</td>
<td>String</td>
<td>No</td>
<td>As for <a href="https://docs.python.org/library/csv.html#csv-fmt-params">csv.reader</a> <code>QUOTE_*</code> parameters (without the QUOTE_ prefix). Default <code>minimal</code> (i.e. <code>QUOTE_MINIMAL</code>).</td>
</tr>
<tr>
<td>vars</td>
<td>Map[String,*]</td>
<td>No</td>
<td>A map of variables injected when the parameters are Jinja rendered.</td>
</tr>
</tbody>
</table>
<p>The <code>mode</code> parameter can take the following values:</p>
<table>
<thead>
<tr>
<th>Mode</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>append</td>
<td>Rows are added to the existing list contents.</td>
</tr>
<tr>
<td>delete</td>
<td>Rows are deleted based on an <code>ID</code> column that must be present in the source data. No new data is added.</td>
</tr>
<tr>
<td>replace</td>
<td>Existing list contents are a deleted before adding new data.</td>
</tr>
<tr>
<td>update</td>
<td>Rows are updated based on an <code>ID</code> column that must be present in the source data. Fields in existing rows may be updated but no new rows will be added.</td>
</tr>
</tbody>
</table>
<p>Note that any read-only columns in the SharePoint list are not updated.
These are silently skipped in the update process.</p>
<h3 id="handling-of-personorgroup-columns_1">Handling of personorgroup Columns<a class="headerlink" href="#handling-of-personorgroup-columns_1" title="Permanent link">&para;</a></h3>
<p>Columns of type <code>personorgroup</code> have an associated <code>LookupId</code> column. So for a
column named <code>&lt;COLUMN&gt;</code>, the list also has a <code>&lt;COLUMN&gt;LookupId</code> column.</p>
<p>A <code>personorgroup</code> type column can only be updated if its provided using the
name <code>&lt;COLUMN&gt;LookupId</code> and the actual <code>LookupId</code> value</p>
<h3 id="jinja-rendering-of-parameters_4">Jinja Rendering of Parameters<a class="headerlink" href="#jinja-rendering-of-parameters_4" title="Permanent link">&para;</a></h3>
<p>Some of the parameters are  rendered using <a href="http://jinja.pocoo.org">Jinja</a>.</p>
<p>All of the injected parameters are effectively Python objects so the normal
Jinja syntax and Python methods for those objects can be used in the Jinja
templates. This is particularly useful for the
<a href="https://docs.python.org/3/library/datetime.html#datetime-objects">datetime</a>
objects as <code>strftime()</code> becomes available. For example, target path can be
dynamically set to include components such as the date or part of the source
file name.</p>
<p>Refer to <a href="13-jinja-rendering-in-lava.html#jinja-rendering-in-lava">Jinja Rendering in Lava</a>
for more information.</p>
<p>The following variables are made available to the renderer.</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>globals</td>
<td>dict[str,*]</td>
<td>The <code>globals</code> from the job specification updated with any globals received in the job dispatch.</td>
</tr>
<tr>
<td>job</td>
<td>dict[str,*]</td>
<td>The <a href="13-jinja-rendering-in-lava.html#the-augmented-job-specification">augmented job specification</a>.</td>
</tr>
<tr>
<td>realm</td>
<td>dict[str,*]</td>
<td>The realm specification.</td>
</tr>
<tr>
<td>start</td>
<td>datetime</td>
<td>The local time when the job run started.</td>
</tr>
<tr>
<td>state</td>
<td>dict[str,*]</td>
<td>A dictionary of the state items imported into the job, keyed on state_id. The default values are updated at run-time with any current values obtainable from the <a href="04-dynamodb-tables.html#the-state-table">state</a> table.</td>
</tr>
<tr>
<td>ustart</td>
<td>datetime</td>
<td>The UTC time when the job run started.</td>
</tr>
<tr>
<td>utils</td>
<td>dict[str,runnable]</td>
<td>A dictionary of <a href="13-jinja-rendering-in-lava.html#jinja-utility-functions">utility functions</a> that can be used in the Jinja markup.</td>
</tr>
<tr>
<td>vars</td>
<td>dict[str,*]</td>
<td>A dictionary of variables provided as the <code>vars</code> component of the job <code>parameters</code>.</td>
</tr>
</tbody>
</table>
<h3 id="dev-mode-behaviour_16">Dev Mode Behaviour<a class="headerlink" href="#dev-mode-behaviour_16" title="Permanent link">&para;</a></h3>
<p>The <strong>sharepoint_put_list</strong> job behaviour is unchanged for dev mode.</p>
<h3 id="examples_13">Examples<a class="headerlink" href="#examples_13" title="Permanent link">&para;</a></h3>
<p>The following example replaces the contents of a list with data from S3.</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-62-1"><span class="p">{</span>
</span><span id="__span-62-2"><span class="w">  </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Upload a CSV file to a SharePoint list&quot;</span><span class="p">,</span>
</span><span id="__span-62-3"><span class="w">  </span><span class="nt">&quot;dispatcher&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Sydney&quot;</span><span class="p">,</span>
</span><span id="__span-62-4"><span class="w">  </span><span class="nt">&quot;enabled&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-62-5"><span class="w">  </span><span class="nt">&quot;job_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo/sharepoint-list&quot;</span><span class="p">,</span>
</span><span id="__span-62-6"><span class="w">  </span><span class="nt">&quot;owner&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo@somewhere.com&quot;</span><span class="p">,</span>
</span><span id="__span-62-7"><span class="w">  </span><span class="nt">&quot;parameters&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-62-8"><span class="w">    </span><span class="nt">&quot;conn_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;sp-conn-01&quot;</span><span class="p">,</span>
</span><span id="__span-62-9"><span class="w">    </span><span class="nt">&quot;list&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;My List&quot;</span><span class="p">,</span>
</span><span id="__span-62-10"><span class="w">    </span><span class="nt">&quot;file&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;s3://my-bucket/x.csv&quot;</span><span class="p">,</span>
</span><span id="__span-62-11"><span class="w">    </span><span class="nt">&quot;mode&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;replace&quot;</span>
</span><span id="__span-62-12"><span class="w">  </span><span class="p">},</span>
</span><span id="__span-62-13"><span class="w">  </span><span class="nt">&quot;payload&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;--&quot;</span><span class="p">,</span>
</span><span id="__span-62-14"><span class="w">  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;sharepoint_put_list&quot;</span><span class="p">,</span>
</span><span id="__span-62-15"><span class="w">  </span><span class="nt">&quot;worker&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;default&quot;</span>
</span><span id="__span-62-16"><span class="p">}</span>
</span></code></pre></div>
<h2 id="job-type-smb_get">Job type: smb_get<a class="headerlink" href="#job-type-smb_get" title="Permanent link">&para;</a></h2>
<p>The <strong>smb_get</strong> job type downloads a file from an SMB file server to the
specified destination file.</p>
<p>Connection to the target SMB server is handled automatically by lava.</p>
<h3 id="payload_16">Payload<a class="headerlink" href="#payload_16" title="Permanent link">&para;</a></h3>
<p>The payload is ignored.</p>
<h3 id="parameters_16">Parameters<a class="headerlink" href="#parameters_16" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>basedir</td>
<td>String</td>
<td>No</td>
<td>If the target file is specified as a relative filename, it will be treated as relative to the specified directory. Defaults to the lava temporary directory for the job.</td>
</tr>
<tr>
<td>conn_id</td>
<td>String</td>
<td>Yes</td>
<td>The <a href="07-connectors.html#connector-type-smb">connection ID</a> for an SMB file share.</td>
</tr>
<tr>
<td>file</td>
<td>String</td>
<td>Yes</td>
<td>The destination file name. If it starts with <code>s3://</code> it is assumed to be an object in S3, otherwise a local file. If a local file and not absolute, it will be relative to the <code>basedir</code> parameter. This value is Jinja rendered.</td>
</tr>
<tr>
<td>jinja</td>
<td>Boolean</td>
<td>No</td>
<td>If <code>false</code>, disable Jinja rendering. Default <code>true</code>.</td>
</tr>
<tr>
<td>kms_key_id</td>
<td>String</td>
<td>No</td>
<td>An AWS KMS encryption key to use when uploading to AWS S3.</td>
</tr>
<tr>
<td>path</td>
<td>String</td>
<td>Yes</td>
<td>The source file path on the SMB file share. Use POSIX, not DOS, style path names (i.e. forward slash path separators). This value is Jinja rendered.</td>
</tr>
<tr>
<td>share_name</td>
<td>String</td>
<td>Yes</td>
<td>The name of the file share.</td>
</tr>
<tr>
<td>vars</td>
<td>Map[String,*]</td>
<td>No</td>
<td>A map of variables injected when the parameters are Jinja rendered.</td>
</tr>
</tbody>
</table>
<h3 id="jinja-rendering-of-parameters_5">Jinja Rendering of Parameters<a class="headerlink" href="#jinja-rendering-of-parameters_5" title="Permanent link">&para;</a></h3>
<p>Some of the parameters are  rendered using <a href="http://jinja.pocoo.org">Jinja</a>.</p>
<p>All of the injected parameters are effectively Python objects so the normal
Jinja syntax and Python methods for those objects can be used in the Jinja
templates. This is particularly useful for the
<a href="https://docs.python.org/3/library/datetime.html#datetime-objects">datetime</a>
objects as <code>strftime()</code> becomes available. For example, the source path can be
dynamically set to include components such as the date or part of the target
file name.</p>
<p>Refer to <a href="13-jinja-rendering-in-lava.html#jinja-rendering-in-lava">Jinja Rendering in Lava</a>
for more information.</p>
<p>The following variables are made available to the renderer.</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>globals</td>
<td>dict[str,*]</td>
<td>The <code>globals</code> from the job specification updated with any globals received in the job dispatch.</td>
</tr>
<tr>
<td>job</td>
<td>dict[str,*]</td>
<td>The <a href="13-jinja-rendering-in-lava.html#the-augmented-job-specification">augmented job specification</a>.</td>
</tr>
<tr>
<td>realm</td>
<td>dict[str,*]</td>
<td>The realm specification.</td>
</tr>
<tr>
<td>start</td>
<td>datetime</td>
<td>The local time when the job run started.</td>
</tr>
<tr>
<td>state</td>
<td>dict[str,*]</td>
<td>A dictionary of the state items imported into the job, keyed on state_id. The default values are updated at run-time with any current values obtainable from the <a href="04-dynamodb-tables.html#the-state-table">state</a> table.</td>
</tr>
<tr>
<td>ustart</td>
<td>datetime</td>
<td>The UTC time when the job run started.</td>
</tr>
<tr>
<td>utils</td>
<td>dict[str,runnable]</td>
<td>A dictionary of <a href="13-jinja-rendering-in-lava.html#jinja-utility-functions">utility functions</a> that can be used in the Jinja markup.</td>
</tr>
<tr>
<td>vars</td>
<td>dict[str,*]</td>
<td>A dictionary of variables provided as the <code>vars</code> component of the job <code>parameters</code>.</td>
</tr>
</tbody>
</table>
<h3 id="dev-mode-behaviour_17">Dev Mode Behaviour<a class="headerlink" href="#dev-mode-behaviour_17" title="Permanent link">&para;</a></h3>
<p>Job behaviour is unchanged for dev mode.</p>
<h3 id="examples_14">Examples<a class="headerlink" href="#examples_14" title="Permanent link">&para;</a></h3>
<p>The following example downloads a file from an SMB file share and places it in
S3.  The file will be KMS encrypted in S3 with the specified KMS key.</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-63-1"><span class="p">{</span>
</span><span id="__span-63-2"><span class="w">  </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Download a CSV file from a file share&quot;</span><span class="p">,</span>
</span><span id="__span-63-3"><span class="w">  </span><span class="nt">&quot;dispatcher&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Sydney&quot;</span><span class="p">,</span>
</span><span id="__span-63-4"><span class="w">  </span><span class="nt">&quot;enabled&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-63-5"><span class="w">  </span><span class="nt">&quot;job_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo/smb-get&quot;</span><span class="p">,</span>
</span><span id="__span-63-6"><span class="w">  </span><span class="nt">&quot;owner&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo@somewhere.com&quot;</span><span class="p">,</span>
</span><span id="__span-63-7"><span class="w">  </span><span class="nt">&quot;parameters&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-63-8"><span class="w">    </span><span class="nt">&quot;conn_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;smb-conn-01&quot;</span><span class="p">,</span>
</span><span id="__span-63-9"><span class="w">    </span><span class="nt">&quot;share_name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Public&quot;</span><span class="p">,</span>
</span><span id="__span-63-10"><span class="w">    </span><span class="nt">&quot;path&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/Interesting/Data/x.csv&quot;</span><span class="p">,</span>
</span><span id="__span-63-11"><span class="w">    </span><span class="nt">&quot;file&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;s3://my-bucket/x.csv&quot;</span><span class="p">,</span>
</span><span id="__span-63-12"><span class="w">    </span><span class="nt">&quot;kms_key_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;alias/data&quot;</span>
</span><span id="__span-63-13"><span class="w">  </span><span class="p">},</span>
</span><span id="__span-63-14"><span class="w">  </span><span class="nt">&quot;payload&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;--&quot;</span><span class="p">,</span>
</span><span id="__span-63-15"><span class="w">  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;smb_get&quot;</span><span class="p">,</span>
</span><span id="__span-63-16"><span class="w">  </span><span class="nt">&quot;worker&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;default&quot;</span>
</span><span id="__span-63-17"><span class="p">}</span>
</span></code></pre></div>
<p>This one shows how Jinja can be used to include the current date in the source
file name.</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-64-1"><span class="p">{</span>
</span><span id="__span-64-2"><span class="w">  </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Download a CSV file from a file share&quot;</span><span class="p">,</span>
</span><span id="__span-64-3"><span class="w">  </span><span class="nt">&quot;dispatcher&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Sydney&quot;</span><span class="p">,</span>
</span><span id="__span-64-4"><span class="w">  </span><span class="nt">&quot;enabled&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-64-5"><span class="w">  </span><span class="nt">&quot;job_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo/smb-get&quot;</span><span class="p">,</span>
</span><span id="__span-64-6"><span class="w">  </span><span class="nt">&quot;owner&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo@somewhere.com&quot;</span><span class="p">,</span>
</span><span id="__span-64-7"><span class="w">  </span><span class="nt">&quot;parameters&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-64-8"><span class="w">    </span><span class="nt">&quot;conn_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;smb-conn-01&quot;</span><span class="p">,</span>
</span><span id="__span-64-9"><span class="w">    </span><span class="nt">&quot;share_name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Public&quot;</span><span class="p">,</span>
</span><span id="__span-64-10"><span class="w">    </span><span class="nt">&quot;path&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/Interesting/Data/{{start.strftime(&#39;%Y-%m-%d&#39;)}}.csv&quot;</span><span class="p">,</span>
</span><span id="__span-64-11"><span class="w">    </span><span class="nt">&quot;file&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;s3://my-bucket/{{start.strftime(&#39;%Y-%m-%d&#39;)}}.csv&quot;</span><span class="p">,</span>
</span><span id="__span-64-12"><span class="w">    </span><span class="nt">&quot;kms_key_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;alias/data&quot;</span>
</span><span id="__span-64-13"><span class="w">  </span><span class="p">},</span>
</span><span id="__span-64-14"><span class="w">  </span><span class="nt">&quot;payload&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;--&quot;</span><span class="p">,</span>
</span><span id="__span-64-15"><span class="w">  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;smb_get&quot;</span><span class="p">,</span>
</span><span id="__span-64-16"><span class="w">  </span><span class="nt">&quot;worker&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;default&quot;</span>
</span><span id="__span-64-17"><span class="p">}</span>
</span></code></pre></div>
<h2 id="job-type-smb_put">Job type: smb_put<a class="headerlink" href="#job-type-smb_put" title="Permanent link">&para;</a></h2>
<p>The <strong>smb_put</strong> job type creates or updates a file on an SMB file share from a
specified source file.</p>
<p>Connection to the target SMB server is handled automatically by lava.</p>
<h3 id="payload_17">Payload<a class="headerlink" href="#payload_17" title="Permanent link">&para;</a></h3>
<p>The payload is ignored.</p>
<h3 id="parameters_17">Parameters<a class="headerlink" href="#parameters_17" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>basedir</td>
<td>String</td>
<td>No</td>
<td>If the source file is specified as a relative filename, it will be treated as relative to the specified directory. Defaults to the lava temporary directory for the job.</td>
</tr>
<tr>
<td>conn_id</td>
<td>String</td>
<td>Yes</td>
<td>The <a href="07-connectors.html#connector-type-smb">connection ID</a> for an SMB server.</td>
</tr>
<tr>
<td>create_dirs</td>
<td>Boolean</td>
<td>No</td>
<td>If <code>true</code>, the target directory, including parent directories, will be created if it doesn't exist. Default is <code>false</code>.</td>
</tr>
<tr>
<td>file</td>
<td>String</td>
<td>Yes</td>
<td>The source file name. If it starts with <code>s3://</code> it is assumed to be an object in S3, otherwise a local file. If a local file and not absolute, it will be relative to the <code>basedir</code> parameter. This value is Jinja rendered.</td>
</tr>
<tr>
<td>jinja</td>
<td>Boolean</td>
<td>No</td>
<td>If <code>false</code>, disable Jinja rendering. Default <code>true</code>.</td>
</tr>
<tr>
<td>path</td>
<td>String</td>
<td>Yes</td>
<td>The target path on the SMB file share. Use POSIX, not DOS, style path names (i.e. forward slash path separators). This value is Jinja rendered.</td>
</tr>
<tr>
<td>share_name</td>
<td>String</td>
<td>Yes</td>
<td>The name of the file share.</td>
</tr>
<tr>
<td>vars</td>
<td>Map[String,*]</td>
<td>No</td>
<td>A map of variables injected when the parameters are Jinja rendered.</td>
</tr>
</tbody>
</table>
<h3 id="jinja-rendering-of-parameters_6">Jinja Rendering of Parameters<a class="headerlink" href="#jinja-rendering-of-parameters_6" title="Permanent link">&para;</a></h3>
<p>Some of the parameters are rendered using <a href="http://jinja.pocoo.org">Jinja</a>.</p>
<p>All of the injected parameters are effectively Python objects so the normal
Jinja syntax and Python methods for those objects can be used in the Jinja
templates. This is particularly useful for the
<a href="https://docs.python.org/3/library/datetime.html#datetime-objects">datetime</a>
objects as <code>strftime()</code> becomes available. For example, target path can be
dynamically set to include components such as the date or part of the source
file name.</p>
<p>Refer to <a href="13-jinja-rendering-in-lava.html#jinja-rendering-in-lava">Jinja Rendering in Lava</a>
for more information.</p>
<p>The following variables are made available to the renderer.</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>globals</td>
<td>dict[str,*]</td>
<td>The <code>globals</code> from the job specification updated with any globals received in the job dispatch.</td>
</tr>
<tr>
<td>job</td>
<td>dict[str,*]</td>
<td>The <a href="13-jinja-rendering-in-lava.html#the-augmented-job-specification">augmented job specification</a>.</td>
</tr>
<tr>
<td>realm</td>
<td>dict[str,*]</td>
<td>The realm specification.</td>
</tr>
<tr>
<td>start</td>
<td>datetime</td>
<td>The local time when the job run started.</td>
</tr>
<tr>
<td>state</td>
<td>dict[str,*]</td>
<td>A dictionary of the state items imported into the job, keyed on state_id. The default values are updated at run-time with any current values obtainable from the <a href="04-dynamodb-tables.html#the-state-table">state</a> table.</td>
</tr>
<tr>
<td>ustart</td>
<td>datetime</td>
<td>The UTC time when the job run started.</td>
</tr>
<tr>
<td>utils</td>
<td>dict[str,runnable]</td>
<td>A dictionary of <a href="13-jinja-rendering-in-lava.html#jinja-utility-functions">utility functions</a> that can be used in the Jinja markup.</td>
</tr>
<tr>
<td>vars</td>
<td>dict[str,*]</td>
<td>A dictionary of variables provided as the <code>vars</code> component of the job <code>parameters</code>.</td>
</tr>
</tbody>
</table>
<h3 id="dev-mode-behaviour_18">Dev Mode Behaviour<a class="headerlink" href="#dev-mode-behaviour_18" title="Permanent link">&para;</a></h3>
<p>Job behaviour is unchanged for dev mode.</p>
<h3 id="examples_15">Examples<a class="headerlink" href="#examples_15" title="Permanent link">&para;</a></h3>
<p>The following example uploads a file from S3 to an SMB file share.</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-65-1"><span class="p">{</span>
</span><span id="__span-65-2"><span class="w">  </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Upload a CSV file to an SMB file share&quot;</span><span class="p">,</span>
</span><span id="__span-65-3"><span class="w">  </span><span class="nt">&quot;dispatcher&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Sydney&quot;</span><span class="p">,</span>
</span><span id="__span-65-4"><span class="w">  </span><span class="nt">&quot;enabled&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-65-5"><span class="w">  </span><span class="nt">&quot;job_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo/smb-put&quot;</span><span class="p">,</span>
</span><span id="__span-65-6"><span class="w">  </span><span class="nt">&quot;owner&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo@somewhere.com&quot;</span><span class="p">,</span>
</span><span id="__span-65-7"><span class="w">  </span><span class="nt">&quot;parameters&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-65-8"><span class="w">    </span><span class="nt">&quot;conn_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;smb-conn-01&quot;</span><span class="p">,</span>
</span><span id="__span-65-9"><span class="w">    </span><span class="nt">&quot;share_name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Public&quot;</span><span class="p">,</span>
</span><span id="__span-65-10"><span class="w">    </span><span class="nt">&quot;path&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/Interesting/Data/x.csv&quot;</span><span class="p">,</span>
</span><span id="__span-65-11"><span class="w">    </span><span class="nt">&quot;file&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;s3://my-bucket/x.csv&quot;</span>
</span><span id="__span-65-12"><span class="w">  </span><span class="p">},</span>
</span><span id="__span-65-13"><span class="w">  </span><span class="nt">&quot;payload&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;--&quot;</span><span class="p">,</span>
</span><span id="__span-65-14"><span class="w">  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;smb_put&quot;</span><span class="p">,</span>
</span><span id="__span-65-15"><span class="w">  </span><span class="nt">&quot;worker&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;default&quot;</span>
</span><span id="__span-65-16"><span class="p">}</span>
</span></code></pre></div>
<p>This one shows how Jinja can be used to replicate the source file name into
the target file name.</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-66-1"><span class="p">{</span>
</span><span id="__span-66-2"><span class="w">  </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Upload a CSV file to an SMB file share&quot;</span><span class="p">,</span>
</span><span id="__span-66-3"><span class="w">  </span><span class="nt">&quot;dispatcher&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Sydney&quot;</span><span class="p">,</span>
</span><span id="__span-66-4"><span class="w">  </span><span class="nt">&quot;enabled&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-66-5"><span class="w">  </span><span class="nt">&quot;job_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo/smb-put&quot;</span><span class="p">,</span>
</span><span id="__span-66-6"><span class="w">  </span><span class="nt">&quot;owner&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo@somewhere.com&quot;</span><span class="p">,</span>
</span><span id="__span-66-7"><span class="w">  </span><span class="nt">&quot;parameters&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-66-8"><span class="w">    </span><span class="nt">&quot;conn_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;smb-conn-01&quot;</span><span class="p">,</span>
</span><span id="__span-66-9"><span class="w">    </span><span class="nt">&quot;share_name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Public&quot;</span><span class="p">,</span>
</span><span id="__span-66-10"><span class="w">    </span><span class="nt">&quot;path&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/Interesting/Data/{{job.parameters.file}}.split(&#39;/&#39;)[-1]}}&quot;</span><span class="p">,</span>
</span><span id="__span-66-11"><span class="w">    </span><span class="nt">&quot;file&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;s3://my-bucket/x.csv&quot;</span>
</span><span id="__span-66-12"><span class="w">  </span><span class="p">},</span>
</span><span id="__span-66-13"><span class="w">  </span><span class="nt">&quot;payload&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;--&quot;</span><span class="p">,</span>
</span><span id="__span-66-14"><span class="w">  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;smb_put&quot;</span><span class="p">,</span>
</span><span id="__span-66-15"><span class="w">  </span><span class="nt">&quot;worker&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;default&quot;</span>
</span><span id="__span-66-16"><span class="p">}</span>
</span></code></pre></div>
<p>This one shows how Jinja can be used to include the current date in the target
path. Note that target directories are created on the fly.</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-67-1"><span class="p">{</span>
</span><span id="__span-67-2"><span class="w">  </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Upload a CSV file to an SMB file share&quot;</span><span class="p">,</span>
</span><span id="__span-67-3"><span class="w">  </span><span class="nt">&quot;dispatcher&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Sydney&quot;</span><span class="p">,</span>
</span><span id="__span-67-4"><span class="w">  </span><span class="nt">&quot;enabled&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-67-5"><span class="w">  </span><span class="nt">&quot;job_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo/smb-put&quot;</span><span class="p">,</span>
</span><span id="__span-67-6"><span class="w">  </span><span class="nt">&quot;owner&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo@somewhere.com&quot;</span><span class="p">,</span>
</span><span id="__span-67-7"><span class="w">  </span><span class="nt">&quot;parameters&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-67-8"><span class="w">    </span><span class="nt">&quot;conn_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;sp-conn-01&quot;</span><span class="p">,</span>
</span><span id="__span-67-9"><span class="w">    </span><span class="nt">&quot;share_name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Public&quot;</span><span class="p">,</span>
</span><span id="__span-67-10"><span class="w">    </span><span class="nt">&quot;path&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/Interesting/Data/{{start.strftime(&#39;%Y/%m/%d&#39;)}}/data.csv&quot;</span><span class="p">,</span>
</span><span id="__span-67-11"><span class="w">    </span><span class="nt">&quot;file&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;s3://my-bucket/x.csv&quot;</span><span class="p">,</span>
</span><span id="__span-67-12"><span class="w">    </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;This is an interesting data set&quot;</span><span class="p">,</span>
</span><span id="__span-67-13"><span class="w">    </span><span class="nt">&quot;create_dirs&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-67-14"><span class="w">  </span><span class="p">},</span>
</span><span id="__span-67-15"><span class="w">  </span><span class="nt">&quot;payload&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;--&quot;</span><span class="p">,</span>
</span><span id="__span-67-16"><span class="w">  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;smb_put&quot;</span><span class="p">,</span>
</span><span id="__span-67-17"><span class="w">  </span><span class="nt">&quot;worker&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;default&quot;</span>
</span><span id="__span-67-18"><span class="p">}</span>
</span></code></pre></div>
<h2 id="job-type-sql">Job type: sql<a class="headerlink" href="#job-type-sql" title="Permanent link">&para;</a></h2>
<p>The <strong>sql</strong> job type runs one or more SQL statements.</p>
<p>The <strong>sql</strong> job type is functionally identically to the
<a href="#job-type-sqli">sqli</a> job type with the exception that <strong>sql</strong>
obtains the SQL statements from files in S3 whereas for
<a href="#job-type-sqli">sqli</a> jobs the payload is inline in the job
specification.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>For help selecting the appropriate SQL job type, See
<a href="#choosing-an-sql-job-type">Choosing an SQL Job Type</a>.</p>
</div>
<p>Connection to the target database is handled automatically by lava.</p>
<p>The <strong>sql</strong> job type is intended for simple SQL sequences. For more complex
cases, the <a href="#job-type-sqlc">sqlc</a> or
<a href="#job-type-sqlv">sqlv</a> job types may be more appropriate.</p>
<h3 id="payload_18">Payload<a class="headerlink" href="#payload_18" title="Permanent link">&para;</a></h3>
<p>The payload is a location in S3 relative to the <code>s3_payloads</code> area specified in
the <a href="04-dynamodb-tables.html#the-realms-table">realms table</a>. It can be either an object
key, in which case a single file is downloaded, or a prefix ending in /, in
which case all files under that prefix will be downloaded and run in
lexicographic order.</p>
<p>See <a href="#s3-payloads">S3 Payloads</a> for more information.</p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>The <code>sql</code> job type also allows the payload to be a list of S3 locations if
the <a href="#the-v2-payload-downloader">v2 Payload Downloader</a> is enabled.</p>
</div>
<p>Each payload file can contain one or more SQL statements that are compatible
with the target database.</p>
<p>Note that some database drivers are pickier than others about the presence or
absence of a terminating semi-colon (e.g. Oracle) so these will be stripped
from the end of each statement before execution.</p>
<h3 id="parameters_18">Parameters<a class="headerlink" href="#parameters_18" title="Permanent link">&para;</a></h3>
<p>The formatting related parameters are as defined for the Python CSV writer,
although some of the defaults are different. Defaults can be overridden at the
realm level using <a href="10-installation-operation.html#configuration-for-sql-sqli-and-sqlv-jobs">configuration
variables</a>.</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>batch_size</td>
<td>Integer</td>
<td>No</td>
<td>Fetch this many rows at a time. Default is 1000.</td>
</tr>
<tr>
<td>conn_id</td>
<td>String</td>
<td>Yes</td>
<td>The <a href="07-connectors.html#database-connectors">connection ID</a> for an SQL database.</td>
</tr>
<tr>
<td>delimiter</td>
<td>String</td>
<td>No</td>
<td>Single character field delimiter. Default <code>|</code>.</td>
</tr>
<tr>
<td>dialect</td>
<td>String</td>
<td>No</td>
<td>As for <a href="https://docs.python.org/library/csv.html#csv-fmt-params">csv.writer</a>. Default <code>excel</code>. The <code>unix</code> option is useful when DOS style line endings must be avoided.</td>
</tr>
<tr>
<td>doublequote</td>
<td>Boolean</td>
<td>No</td>
<td>As for <a href="https://docs.python.org/library/csv.html#csv-fmt-params">csv.writer</a>. Default <code>false</code>.</td>
</tr>
<tr>
<td>escapechar</td>
<td>String</td>
<td>No</td>
<td>As for <a href="https://docs.python.org/library/csv.html#csv-fmt-params">csv.writer</a>. Default <code>null</code>.</td>
</tr>
<tr>
<td>header</td>
<td>Boolean</td>
<td>No</td>
<td>Add a header for data produced from SELECT queries. Default is <code>false</code>.</td>
</tr>
<tr>
<td>jinja</td>
<td>Boolean</td>
<td>No</td>
<td>If <code>false</code>, disable Jinja rendering of the payload. Default <code>true</code>.</td>
</tr>
<tr>
<td>output</td>
<td>String</td>
<td>No</td>
<td>If specified, the output from statements that produce result tuples will be placed in this subdirectory in both the job run temporary area in the local filesystem and in the <code>s3_temp</code> area. This option must be specified for <a href="#job-type-dag">dag</a> jobs if the output is needed. See <a href="#output-data">Output Data</a> below. It must contain only alphanumeric characters and underscores.</td>
</tr>
<tr>
<td>quotechar</td>
<td>String</td>
<td>No</td>
<td>As for <a href="https://docs.python.org/library/csv.html#csv-fmt-params">csv.writer</a>. Default <code>"</code>.</td>
</tr>
<tr>
<td>quoting</td>
<td>String</td>
<td>No</td>
<td>As for <a href="https://docs.python.org/library/csv.html#csv-fmt-params">csv.writer</a> <code>QUOTE_*</code> parameters (without the QUOTE_ prefix). Default <code>minimal</code> (i.e. <code>QUOTE_MINIMAL</code>).</td>
</tr>
<tr>
<td>raw</td>
<td>Boolean</td>
<td>No</td>
<td>By default, an attempt will be made to split each payload file into individual SQL statements. This should be safe in most cases. To suppress this behaviour and run the payload as-is, set raw to <code>true</code>. Default <code>false</code>.</td>
</tr>
<tr>
<td>transaction</td>
<td>Boolean</td>
<td>No</td>
<td>If <code>true</code>, auto-commit is disabled and the sequence of SQLs is run within a transaction. If <code>false</code>, auto-commit is enabled (if supported by the driver). Default <code>false</code>.</td>
</tr>
<tr>
<td>vars</td>
<td>Map[String,*]</td>
<td>No</td>
<td>A map of variables injected when the SQL is Jinja rendered.</td>
</tr>
</tbody>
</table>
<h3 id="jinja-rendering-of-the-payload_1">Jinja Rendering of the Payload<a class="headerlink" href="#jinja-rendering-of-the-payload_1" title="Permanent link">&para;</a></h3>
<p>Each SQL statement is rendered using <a href="http://jinja.pocoo.org">Jinja</a> prior to
execution.</p>
<p>All of the injected parameters are effectively Python objects so the normal
Jinja syntax and Python methods for those objects can be used in the Jinja
templates. This is particularly useful for the
<a href="https://docs.python.org/3/library/datetime.html#datetime-objects">datetime</a>
objects as <code>strftime()</code> becomes available. For example, the S3 location of
the unload (<code>s3key</code>) can be dynamically set to include components such as the
schema, table name, unload date etc.</p>
<p>Refer to <a href="13-jinja-rendering-in-lava.html#jinja-rendering-in-lava">Jinja Rendering in Lava</a>
for more information.</p>
<p>The following variables are made available to the renderer.</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>globals</td>
<td>dict[str,*]</td>
<td>The <code>globals</code> from the job specification updated with any globals received in the job dispatch.</td>
</tr>
<tr>
<td>job</td>
<td>dict[str,*]</td>
<td>The <a href="13-jinja-rendering-in-lava.html#the-augmented-job-specification">augmented job specification</a>.</td>
</tr>
<tr>
<td>realm</td>
<td>dict[str,*]</td>
<td>The realm specification.</td>
</tr>
<tr>
<td>start</td>
<td>datetime</td>
<td>The local time when the job run started.</td>
</tr>
<tr>
<td>state</td>
<td>dict[str,*]</td>
<td>A dictionary of the state items imported into the job, keyed on state_id. The default values are updated at run-time with any current values obtainable from the <a href="04-dynamodb-tables.html#the-state-table">state</a> table.</td>
</tr>
<tr>
<td>ustart</td>
<td>datetime</td>
<td>The UTC time when the job run started.</td>
</tr>
<tr>
<td>utils</td>
<td>dict[str,runnable]</td>
<td>A dictionary of <a href="13-jinja-rendering-in-lava.html#jinja-utility-functions">utility functions</a> that can be used in the Jinja markup.</td>
</tr>
<tr>
<td>vars</td>
<td>dict[str,*]</td>
<td>A dictionary of variables provided as the <code>vars</code> component of the job <code>parameters</code>.</td>
</tr>
</tbody>
</table>
<h3 id="output-data">Output Data<a class="headerlink" href="#output-data" title="Permanent link">&para;</a></h3>
<p>If any of the queries in the payload produce result tuples (e.g. <code>SELECT</code>
statements), the output is placed in its own file in the local file system and
in the <code>s3_temp</code> area.</p>
<p>If the <code>output</code> parameter is not specified, the output files will be placed in
the root of the temporary run directory on the local worker file system and at
the root of the job run's <code>s3_temp</code> area.</p>
<p>If the <code>output</code> parameter is specified, the output files will be placed in a
subdirectory of that name under the root of the temporary run directory on the
local worker file system and under a similarly named sub-prefix of the root
of the job run's <code>s3_temp</code> area.</p>
<p>Files are named <code>&lt;PAYLOAD&gt;.&lt;n&gt;.out</code>, where:</p>
<ul>
<li><code>&lt;PAYLOAD&gt;</code> is the name of the payload file containing the <code>SELECT</code> query;
    and</li>
<li><code>&lt;n&gt;</code> is the SQL statement sequence number within that file, starting from
    zero.</li>
</ul>
<p>So with an <code>output</code> parameter of <code>whatever</code> and a payload file,
<code>some-queries.sql</code>, containing only a <code>SELECT</code> statement,
the output file would be named <code>whatever/some-queries.sql.0.out</code>.</p>
<p>As child jobs in <a href="#job-type-chain">chain</a> and <a href="#job-type-dag">dag</a> jobs all
share the same run directory, this provides a mechanism for one child job to
leave data behind for a subsequent job.</p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>It is <strong>critical</strong> to use the <code>output</code> parameter in these circumstances.</p>
</div>
<p>Unless modified by job parameters, the output of each <code>SELECT</code> statement is pipe
separated values, one record per line.</p>
<h3 id="dev-mode-behaviour_19">Dev Mode Behaviour<a class="headerlink" href="#dev-mode-behaviour_19" title="Permanent link">&para;</a></h3>
<p>The <strong>sql</strong> job behaviour is unchanged for dev mode.</p>
<h3 id="examples_16">Examples<a class="headerlink" href="#examples_16" title="Permanent link">&para;</a></h3>
<p>The following example runs the SQL statement in <code>demo/query-mytable.sql</code>. The
output is written to <code>demo/query-mytable.sql.out</code> in the <code>s3_temp</code> area.</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-68-1"><span class="p">{</span>
</span><span id="__span-68-2"><span class="w">  </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Run a single SQL statement.&quot;</span><span class="p">,</span>
</span><span id="__span-68-3"><span class="w">  </span><span class="nt">&quot;dispatcher&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Sydney&quot;</span><span class="p">,</span>
</span><span id="__span-68-4"><span class="w">  </span><span class="nt">&quot;enabled&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-68-5"><span class="w">  </span><span class="nt">&quot;job_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo/sql-query-01&quot;</span><span class="p">,</span>
</span><span id="__span-68-6"><span class="w">  </span><span class="nt">&quot;owner&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo@somewhere.com&quot;</span><span class="p">,</span>
</span><span id="__span-68-7"><span class="w">  </span><span class="nt">&quot;parameters&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-68-8"><span class="w">    </span><span class="nt">&quot;conn_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;db-conn-01&quot;</span><span class="p">,</span>
</span><span id="__span-68-9"><span class="w">    </span><span class="nt">&quot;delimiter&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;|&quot;</span><span class="p">,</span>
</span><span id="__span-68-10"><span class="w">    </span><span class="nt">&quot;quoting&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;all&quot;</span>
</span><span id="__span-68-11"><span class="w">  </span><span class="p">},</span>
</span><span id="__span-68-12"><span class="w">  </span><span class="nt">&quot;payload&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo/query-mytable.sql&quot;</span><span class="p">,</span>
</span><span id="__span-68-13"><span class="w">  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;sql&quot;</span><span class="p">,</span>
</span><span id="__span-68-14"><span class="w">  </span><span class="nt">&quot;worker&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;default&quot;</span>
</span><span id="__span-68-15"><span class="p">}</span>
</span></code></pre></div>
<h2 id="job-type-sqlc">Job type: sqlc<a class="headerlink" href="#job-type-sqlc" title="Permanent link">&para;</a></h2>
<p>The <strong>sqlc</strong> job type runs one or more files containing native SQL client
commands. It differs from the <a href="#job-type-sql">sql</a> and
<a href="#job-type-sqli">sqli</a> job types in that, instead of a Python
DBAPI 2.0 driver, it uses a command line client specific to the target database
type. This makes <strong>sqlc</strong> less portable than
<a href="#job-type-sql">sql</a>/<a href="#job-type-sqli">sqli</a>/<a href="#job-type-sqlv">sqlv</a> as
the former allows access to all the meta-commands available in the command line
client.</p>
<p>The <strong>sqlc</strong> job type is intended for more complex requirements where the
specific capabilities of the native CLI are critical. In most cases, one of the
<a href="#job-type-sql">sql</a>, <a href="#job-type-sqli">sqli</a> or <a href="#job-type-sqlv">sqlv</a> job types
will be more appropriate.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>For help selecting the appropriate SQL job type, See
<a href="#choosing-an-sql-job-type">Choosing an SQL Job Type</a>.</p>
</div>
<p>The stdout and stderr of each SQL script, if any, is placed in its own file in
the <code>s3_temp</code> area.</p>
<p>For Postgres flavoured databases (including Redshift), the
<a href="https://www.postgresql.org/docs/9.6/reference-client.html">psql</a> client is
used. For MySQL databases, the
<a href="https://dev.mysql.com/doc/refman/8.0/en/mysql.html">mysql</a> client is used.
For Oracle databases, the SQL*Plus client is used. It's a horror. Sorry.</p>
<h3 id="payload_19">Payload<a class="headerlink" href="#payload_19" title="Permanent link">&para;</a></h3>
<p>The payload is a location in S3 relative to the <code>s3_payloads</code> area specified in
the <a href="04-dynamodb-tables.html#the-realms-table">realms table</a>. It can be either an object
key, in which case a single file is downloaded, or a prefix ending in /, in
which case all files under that prefix will be downloaded and run in
lexicographic order.</p>
<p>See <a href="#s3-payloads">S3 Payloads</a> for more information.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code>sqlc</code> job type also allows the payload to be a list of S3 locations if the
<a href="#the-v2-payload-downloader">v2 Payload Downloader</a> is enabled.</p>
</div>
<p>Each file may contain a mix of SQL statements and client
meta-commands. The SQL must be compatible with the target database. SQL
commands must always be properly terminated with semi-colons.</p>
<h3 id="parameters_19">Parameters<a class="headerlink" href="#parameters_19" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>args</td>
<td>List[String]</td>
<td>No</td>
<td>A list of zero or more additional arguments provided to the database client. These are necessarily specific to the database type and underlying database client.</td>
</tr>
<tr>
<td>conn_id</td>
<td>String</td>
<td>Yes</td>
<td>The connection ID for a database.</td>
</tr>
<tr>
<td>jinja</td>
<td>Boolean</td>
<td>No</td>
<td>If <code>false</code>, disable Jinja rendering of the payload. Default <code>true</code>.</td>
</tr>
<tr>
<td>timeout</td>
<td>String</td>
<td>No</td>
<td>By default, payload components run by <strong>sqlc</strong> jobs are killed after 10 minutes. This parameter can override that with values in the form <code>nnX</code> where <code>nn</code> is a number and <code>X</code> is <code>s</code> (seconds), <code>m</code> (minutes) or <code>h</code> (hours). Note that the total timeout for the entire job (<code>timeout</code> multiplied by number of payload elements) must be less than the visibility timeout on the worker SQS queue.</td>
</tr>
<tr>
<td>vars</td>
<td>Map[String,*]</td>
<td>No</td>
<td>A map of variables injected when the SQL is Jinja rendered.</td>
</tr>
</tbody>
</table>
<h3 id="jinja-rendering-of-the-payload_2">Jinja Rendering of the Payload<a class="headerlink" href="#jinja-rendering-of-the-payload_2" title="Permanent link">&para;</a></h3>
<p>Each file in the payload is rendered using <a href="http://jinja.pocoo.org">Jinja</a>
prior to execution.</p>
<p>All of the injected parameters are effectively Python objects so the normal
Jinja syntax and Python methods for those objects can be used in the Jinja
templates. This is particularly useful for the
<a href="https://docs.python.org/3/library/datetime.html#datetime-objects">datetime</a>
objects as <code>strftime()</code> becomes available. For example, the S3 location of
the unload (<code>s3key</code>) can be dynamically set to include components such as the
schema, table name, unload date etc.</p>
<p>Refer to <a href="13-jinja-rendering-in-lava.html#jinja-rendering-in-lava">Jinja Rendering in Lava</a>
for more information.</p>
<p>The following variables are made available to the renderer.</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>globals</td>
<td>dict[str,*]</td>
<td>The <code>globals</code> from the job specification updated with any globals received in the job dispatch.</td>
</tr>
<tr>
<td>job</td>
<td>dict[str,*]</td>
<td>The <a href="13-jinja-rendering-in-lava.html#the-augmented-job-specification">augmented job specification</a>.</td>
</tr>
<tr>
<td>realm</td>
<td>dict[str,*]</td>
<td>The realm specification.</td>
</tr>
<tr>
<td>start</td>
<td>datetime</td>
<td>The local time when the job run started.</td>
</tr>
<tr>
<td>state</td>
<td>dict[str,*]</td>
<td>A dictionary of the state items imported into the job, keyed on state_id. The default values are updated at run-time with any current values obtainable from the <a href="04-dynamodb-tables.html#the-state-table">state</a> table.</td>
</tr>
<tr>
<td>ustart</td>
<td>datetime</td>
<td>The UTC time when the job run started.</td>
</tr>
<tr>
<td>utils</td>
<td>dict[str,runnable]</td>
<td>A dictionary of <a href="13-jinja-rendering-in-lava.html#jinja-utility-functions">utility functions</a> that can be used in the Jinja markup.</td>
</tr>
<tr>
<td>vars</td>
<td>dict[str,*]</td>
<td>A dictionary of variables provided as the <code>vars</code> component of the job <code>parameters</code>.</td>
</tr>
</tbody>
</table>
<h3 id="dev-mode-behaviour_20">Dev Mode Behaviour<a class="headerlink" href="#dev-mode-behaviour_20" title="Permanent link">&para;</a></h3>
<p>Normally, the <strong>sqlc</strong> job will copy stdout and stderr to S3 on the conclusion
of the job. In dev mode, stdout and stderr are emitted locally during the job
run instead of being copied to S3.</p>
<h3 id="examples_17">Examples<a class="headerlink" href="#examples_17" title="Permanent link">&para;</a></h3>
<p>The following example runs all of the commands in <code>demo/psql-commands.sql</code>. The
<code>--no-align</code> argument is passed to the <code>psql</code> command line client. Stdout is
written to <code>demo/sqlc-query-01.sql.stdout</code> and stderr is written to
<code>demo/sqlc-query-01.sql.sterr</code> in the <code>s3_temp</code> area. The underlying database
type is specified in the connection specification not the job specification but
the payload must match the underlying database type.</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-69-1"><span class="p">{</span>
</span><span id="__span-69-2"><span class="w">  </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Run a psql file.&quot;</span><span class="p">,</span>
</span><span id="__span-69-3"><span class="w">  </span><span class="nt">&quot;dispatcher&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Sydney&quot;</span><span class="p">,</span>
</span><span id="__span-69-4"><span class="w">  </span><span class="nt">&quot;enabled&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-69-5"><span class="w">  </span><span class="nt">&quot;job_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo/sqlc-query-01&quot;</span><span class="p">,</span>
</span><span id="__span-69-6"><span class="w">  </span><span class="nt">&quot;owner&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo@somewhere.com&quot;</span><span class="p">,</span>
</span><span id="__span-69-7"><span class="w">  </span><span class="nt">&quot;parameters&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-69-8"><span class="w">    </span><span class="nt">&quot;args&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-69-9"><span class="w">      </span><span class="s2">&quot;--no-align&quot;</span>
</span><span id="__span-69-10"><span class="w">    </span><span class="p">],</span>
</span><span id="__span-69-11"><span class="w">    </span><span class="nt">&quot;conn_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;pgdb-conn-01&quot;</span>
</span><span id="__span-69-12"><span class="w">  </span><span class="p">},</span>
</span><span id="__span-69-13"><span class="w">  </span><span class="nt">&quot;payload&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo/psql-commands.sql&quot;</span><span class="p">,</span>
</span><span id="__span-69-14"><span class="w">  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;sql&quot;</span><span class="p">,</span>
</span><span id="__span-69-15"><span class="w">  </span><span class="nt">&quot;worker&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;default&quot;</span>
</span><span id="__span-69-16"><span class="p">}</span>
</span></code></pre></div>
<p>This one runs all files found under the given payload prefix. Separate stdout
and stderr files are created for each payload file. The timeout for each
individual payload element is set to 30 minutes.</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-70-1"><span class="p">{</span>
</span><span id="__span-70-2"><span class="w">  </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Run a psql file.&quot;</span><span class="p">,</span>
</span><span id="__span-70-3"><span class="w">  </span><span class="nt">&quot;dispatcher&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Sydney&quot;</span><span class="p">,</span>
</span><span id="__span-70-4"><span class="w">  </span><span class="nt">&quot;enabled&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-70-5"><span class="w">  </span><span class="nt">&quot;job_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo/sqlc-query-01&quot;</span><span class="p">,</span>
</span><span id="__span-70-6"><span class="w">  </span><span class="nt">&quot;owner&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo@somewhere.com&quot;</span><span class="p">,</span>
</span><span id="__span-70-7"><span class="w">  </span><span class="nt">&quot;parameters&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-70-8"><span class="w">    </span><span class="nt">&quot;args&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-70-9"><span class="w">      </span><span class="s2">&quot;--no-align&quot;</span>
</span><span id="__span-70-10"><span class="w">    </span><span class="p">],</span>
</span><span id="__span-70-11"><span class="w">    </span><span class="nt">&quot;conn_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;pgdb-conn-01&quot;</span>
</span><span id="__span-70-12"><span class="w">  </span><span class="p">},</span>
</span><span id="__span-70-13"><span class="w">  </span><span class="nt">&quot;payload&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo/psql-commands/&quot;</span><span class="p">,</span>
</span><span id="__span-70-14"><span class="w">  </span><span class="nt">&quot;timeout&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;30m&quot;</span><span class="p">,</span>
</span><span id="__span-70-15"><span class="w">  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;sql&quot;</span><span class="p">,</span>
</span><span id="__span-70-16"><span class="w">  </span><span class="nt">&quot;worker&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;default&quot;</span>
</span><span id="__span-70-17"><span class="p">}</span>
</span></code></pre></div>
<h2 id="job-type-sqli">Job type: sqli<a class="headerlink" href="#job-type-sqli" title="Permanent link">&para;</a></h2>
<p>The <strong>sqli</strong> job type runs one or more SQL statements.</p>
<p>The <strong>sqli</strong> job type is functionally identical to the
<a href="#job-type-sql">sql</a> job type with the exception that <strong>sqli</strong>
obtains the SQL statements inline from the payload whereas for
<a href="#job-type-sql">sql</a> jobs the payload specifies S3 objects
containing the SQL statements.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>For help selecting the appropriate SQL job type, see
<a href="#choosing-an-sql-job-type">Choosing an SQL Job Type</a>.</p>
</div>
<p>Connection to the target database is handled automatically by lava.</p>
<p>The <strong>sqli</strong> job type is intended for simple, relatively small SQL sequences.
For larger or more complex cases, the <a href="#job-type-sql">sql</a> or
<a href="#job-type-sqlc">sqlc</a> job types may be more appropriate.</p>
<h3 id="payload_20">Payload<a class="headerlink" href="#payload_20" title="Permanent link">&para;</a></h3>
<p>The payload is a string, or list of strings, containing SQL statements.</p>
<p>Each payload string can itself contain one or more SQL statements that are
compatible with the target database.</p>
<p>For statements that produce result tuples (e.g. <code>SELECT</code> statements), the output
is placed in its own file in the <code>s3_temp</code> area. Unless modified by job
parameters, the output of each statement is pipe separated values, one
record per line.</p>
<p>Note that some database drivers are pickier than others about the presence or
absence of a terminating semi-colon (e.g. Oracle) so these will be stripped
from the end of each statement before execution.</p>
<h3 id="parameters_20">Parameters<a class="headerlink" href="#parameters_20" title="Permanent link">&para;</a></h3>
<p>Parameters are identical to those for the <a href="#job-type-sql">sql</a>
job type.</p>
<h3 id="output-data_1">Output Data<a class="headerlink" href="#output-data_1" title="Permanent link">&para;</a></h3>
<p>If any of the queries in the payload produce result tuples (e.g. <code>SELECT</code>
statements), the output is placed in its own file in the local file system and
in the <code>s3_temp</code> area.</p>
<p>If the <code>output</code> parameter is not specified, the output files will be placed in
the root of the temporary run directory on the local worker file system and at
the root of the job run's <code>s3_temp</code> area.</p>
<p>If the <code>output</code> parameter is specified, the output files will be placed in a
subdirectory of that name under the root of the temporary run directory on the
local worker file system and under a similarly named sub-prefix of the root
of the job run's <code>s3_temp</code> area.</p>
<p>Files are named <code>&lt;m&gt;.&lt;n&gt;.out</code>, where:</p>
<ul>
<li><code>&lt;m&gt;</code> is the sequence number of the payload element, starting from zero. 
    Note that each payload element can contain multiple SQL statements.
    Hence ...</li>
<li><code>&lt;n&gt;</code> is the SQL statement sequence number within the payload element,
    starting from zero.</li>
</ul>
<p>So, with an <code>output</code> parameter of <code>whatever</code> and a payload list containing a
single element which is a <code>SELECT</code> statement, the output file would be named
<code>whatever/0.0.out</code>.</p>
<p>As child jobs in <a href="#job-type-chain">chain</a> and <a href="#job-type-dag">dag</a> jobs all
share the same run directory, this provides a mechanism for one child job to
leave data behind for a subsequent job.</p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>It is <strong>critical</strong> to use the <code>output</code> parameter in these circumstances.</p>
</div>
<p>Unless modified by job parameters, the output of each <code>SELECT</code> statement is pipe
separated values, one record per line.</p>
<h3 id="jinja-rendering-of-the-payload_3">Jinja Rendering of the Payload<a class="headerlink" href="#jinja-rendering-of-the-payload_3" title="Permanent link">&para;</a></h3>
<p>Each SQL statement is rendered using <a href="http://jinja.pocoo.org">Jinja</a> prior to
execution. The rendering process is identical to that for the
<a href="#job-type-sql">sql</a> job type.</p>
<h3 id="dev-mode-behaviour_21">Dev Mode Behaviour<a class="headerlink" href="#dev-mode-behaviour_21" title="Permanent link">&para;</a></h3>
<p>The <strong>sqli</strong> job behaviour is unchanged for dev mode.</p>
<h3 id="examples_18">Examples<a class="headerlink" href="#examples_18" title="Permanent link">&para;</a></h3>
<p>The following example runs a single SQL statement.
The output is written to the <code>s3_temp</code> area.</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-71-1"><span class="p">{</span>
</span><span id="__span-71-2"><span class="w">  </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Run a single SQL statement.&quot;</span><span class="p">,</span>
</span><span id="__span-71-3"><span class="w">  </span><span class="nt">&quot;dispatcher&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Sydney&quot;</span><span class="p">,</span>
</span><span id="__span-71-4"><span class="w">  </span><span class="nt">&quot;enabled&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-71-5"><span class="w">  </span><span class="nt">&quot;job_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo/sql-query-01&quot;</span><span class="p">,</span>
</span><span id="__span-71-6"><span class="w">  </span><span class="nt">&quot;owner&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo@somewhere.com&quot;</span><span class="p">,</span>
</span><span id="__span-71-7"><span class="w">  </span><span class="nt">&quot;parameters&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-71-8"><span class="w">    </span><span class="nt">&quot;conn_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;db-conn-01&quot;</span><span class="p">,</span>
</span><span id="__span-71-9"><span class="w">    </span><span class="nt">&quot;delimiter&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;|&quot;</span><span class="p">,</span>
</span><span id="__span-71-10"><span class="w">    </span><span class="nt">&quot;quoting&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;all&quot;</span>
</span><span id="__span-71-11"><span class="w">  </span><span class="p">},</span>
</span><span id="__span-71-12"><span class="w">  </span><span class="nt">&quot;payload&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;SELECT numbers FROM lottery_results WHERE result_date &gt; NOW()&quot;</span><span class="p">,</span>
</span><span id="__span-71-13"><span class="w">  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;sqli&quot;</span><span class="p">,</span>
</span><span id="__span-71-14"><span class="w">  </span><span class="nt">&quot;worker&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;default&quot;</span>
</span><span id="__span-71-15"><span class="p">}</span>
</span></code></pre></div>
<p>The following example runs multiple SQL statements in a transaction.</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-72-1"><span class="p">{</span>
</span><span id="__span-72-2"><span class="w">  </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Run multiple SQL statements.&quot;</span><span class="p">,</span>
</span><span id="__span-72-3"><span class="w">  </span><span class="nt">&quot;dispatcher&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Sydney&quot;</span><span class="p">,</span>
</span><span id="__span-72-4"><span class="w">  </span><span class="nt">&quot;enabled&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-72-5"><span class="w">  </span><span class="nt">&quot;job_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo/sql-query-01&quot;</span><span class="p">,</span>
</span><span id="__span-72-6"><span class="w">  </span><span class="nt">&quot;owner&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo@somewhere.com&quot;</span><span class="p">,</span>
</span><span id="__span-72-7"><span class="w">  </span><span class="nt">&quot;parameters&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-72-8"><span class="w">    </span><span class="nt">&quot;conn_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;db-conn-01&quot;</span><span class="p">,</span>
</span><span id="__span-72-9"><span class="w">    </span><span class="nt">&quot;delimiter&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;|&quot;</span><span class="p">,</span>
</span><span id="__span-72-10"><span class="w">    </span><span class="nt">&quot;quoting&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;all&quot;</span><span class="p">,</span>
</span><span id="__span-72-11"><span class="w">    </span><span class="nt">&quot;transaction&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-72-12"><span class="w">  </span><span class="p">},</span>
</span><span id="__span-72-13"><span class="w">  </span><span class="nt">&quot;payload&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-72-14"><span class="w">    </span><span class="s2">&quot;DELETE FROM main_table&quot;</span><span class="p">,</span>
</span><span id="__span-72-15"><span class="w">    </span><span class="s2">&quot;INSERT INTO main_table (SELECT * FROM staging_table)&quot;</span>
</span><span id="__span-72-16"><span class="w">  </span><span class="p">],</span>
</span><span id="__span-72-17"><span class="w">  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;sqli&quot;</span><span class="p">,</span>
</span><span id="__span-72-18"><span class="w">  </span><span class="nt">&quot;worker&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;default&quot;</span>
</span><span id="__span-72-19"><span class="p">}</span>
</span></code></pre></div>
<h2 id="job-type-sqlv">Job type: sqlv<a class="headerlink" href="#job-type-sqlv" title="Permanent link">&para;</a></h2>
<p>The <strong>sqlv</strong> job type runs one or more files containing SQL statements. It is
essentially a hybrid of the <a href="#job-type-sql">sql</a> and
<a href="#job-type-sqlc">sqlc</a> job types. It has a consistent, lava
controlled interface across all database types like the former, but uses an
external CLI client like the latter.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>For help selecting the appropriate SQL job type, see
<a href="#choosing-an-sql-job-type">Choosing an SQL Job Type</a>.</p>
</div>
<p>The client, <code>lava-sql</code> is provided as part of the lava code base. It supports
SQL statements only, not the meta-commands that are typical of the proprietary
database clients used by <a href="#job-type-sqlc">sqlc</a>. The
<a href="16-commands-utilities.html#lava-commands-and-utilities">lava-sql</a>
utility can also be used stand-alone or invoked by lava
<a href="#job-type-exe">exe</a>, <a href="#job-type-pkg">pkg</a> and
<a href="#job-type-docker">docker</a> jobs.</p>
<p>Connection to the target database is handled automatically by lava.</p>
<h3 id="payload_21">Payload<a class="headerlink" href="#payload_21" title="Permanent link">&para;</a></h3>
<p>The payload is a location in S3 relative to the <code>s3_payloads</code> area specified in
the <a href="04-dynamodb-tables.html#the-realms-table">realms table</a>. It can be either an object
key, in which case a single file is downloaded, or a prefix ending in /, in
which case all files under that prefix will be downloaded and run in
lexicographic order.</p>
<p>See <a href="#s3-payloads">S3 Payloads</a> for more information.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code>sqlv</code> job type also allows the payload to be a list of S3 locations if the
<a href="#the-v2-payload-downloader">v2 Payload Downloader</a> is enabled.</p>
</div>
<p>Each payload file can contain one or more SQL statements that are compatible
with the target database.</p>
<p>For <code>SELECT</code> statements, the output is placed in its own file in the <code>s3_temp</code>
area. Unless modified by job parameters, the output of each <code>SELECT</code> statement
is pipe separated values, one record per line.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>All output is placed in a single file. To avoid a mess, each job should
either limit itself to a single <code>SELECT</code> statement that produces output or
all <code>SELECT</code> statements should produce the same column structure.</p>
</div>
<h3 id="parameters_21">Parameters<a class="headerlink" href="#parameters_21" title="Permanent link">&para;</a></h3>
<p>Some of the formatting related parameters are output format dependent. In most
cases, defaults can be overridden at the realm level using
<a href="10-installation-operation.html#configuration-for-sql-sqli-and-sqlv-jobs">configuration variables</a>.</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>batch_size</td>
<td>Integer</td>
<td>No</td>
<td>Fetch this many rows at a time. Default is 1000.</td>
</tr>
<tr>
<td>conn_id</td>
<td>String</td>
<td>Yes</td>
<td>The <a href="07-connectors.html#database-connectors">connection ID</a> for an SQL database.</td>
</tr>
<tr>
<td>delimiter</td>
<td>String</td>
<td>No</td>
<td>Single character field delimiter. Default <code>|</code>.</td>
</tr>
<tr>
<td>dialect</td>
<td>String</td>
<td>No</td>
<td>As for <a href="https://docs.python.org/library/csv.html#csv-fmt-params">csv.writer</a>. Default <code>excel</code>. The <code>unix</code> option is useful when DOS style line endings must be avoided.</td>
</tr>
<tr>
<td>doublequote</td>
<td>Boolean</td>
<td>No</td>
<td>As for <a href="https://docs.python.org/library/csv.html#csv-fmt-params">csv.writer</a>. Default <code>false</code>.</td>
</tr>
<tr>
<td>escapechar</td>
<td>String</td>
<td>No</td>
<td>As for <a href="https://docs.python.org/library/csv.html#csv-fmt-params">csv.writer</a>. Default <code>null</code>.</td>
</tr>
<tr>
<td>format</td>
<td>String</td>
<td>No</td>
<td>Specify the output format for <code>SELECT</code> statements. Any of the formats supported by the <a href="16-commands-utilities.html#lava-sql-utility">lava-sql</a> can be used. The default is <code>csv</code>.</td>
</tr>
<tr>
<td>jinja</td>
<td>Boolean</td>
<td>No</td>
<td>If <code>false</code>, disable Jinja rendering of the payload. Default <code>true</code>.</td>
</tr>
<tr>
<td>header</td>
<td>Boolean</td>
<td>No</td>
<td>Add a header for data produced from SELECT queries. Default is <code>false</code>.</td>
</tr>
<tr>
<td>level</td>
<td>String</td>
<td>No</td>
<td>Print log messages of a given severity level or above. The standard logging level names are available but <code>debug</code>, <code>info</code>, <code>warning</code> and <code>error</code> are most useful. The Default is <code>info</code>.</td>
</tr>
<tr>
<td>quotechar</td>
<td>String</td>
<td>No</td>
<td>As for <a href="https://docs.python.org/library/csv.html#csv-fmt-params">csv.writer</a>. Default <code>"</code>.</td>
</tr>
<tr>
<td>quoting</td>
<td>String</td>
<td>No</td>
<td>As for <a href="https://docs.python.org/library/csv.html#csv-fmt-params">csv.writer</a> <code>QUOTE_*</code> parameters (without the QUOTE_ prefix). Default <code>minimal</code> (i.e. <code>QUOTE_MINIMAL</code>).</td>
</tr>
<tr>
<td>raw</td>
<td>Boolean</td>
<td>No</td>
<td>By default, an attempt will be made to split each payload file into individual SQL statements. This should be safe in most cases. To suppress this behaviour and run the payload as-is, set raw to <code>true</code>. Default <code>false</code>.</td>
</tr>
<tr>
<td>timeout</td>
<td>String</td>
<td>No</td>
<td>By default, jobs are killed after 10 minutes. This parameter can override that with values in the form <code>nnX</code> where <code>nn</code> is a number and <code>X</code> is <code>s</code> (seconds), <code>m</code> (minutes) or <code>h</code> (hours). Note that the total timeout for the entire job (<code>timeout</code> multiplied by number of payload elements) must be less than the visibility timeout on the worker SQS queue.</td>
</tr>
<tr>
<td>transaction</td>
<td>Boolean</td>
<td>No</td>
<td>If <code>true</code>, auto-commit is disabled and the sequence of SQLs is run within a transaction. If <code>false</code>, auto-commit is enabled (if supported by the driver). Default <code>false</code>.</td>
</tr>
<tr>
<td>vars</td>
<td>Map[String,*]</td>
<td>No</td>
<td>A map of variables injected when the SQL is Jinja rendered.</td>
</tr>
</tbody>
</table>
<h3 id="jinja-rendering-of-the-payload_4">Jinja Rendering of the Payload<a class="headerlink" href="#jinja-rendering-of-the-payload_4" title="Permanent link">&para;</a></h3>
<p>Each SQL statement is rendered using <a href="http://jinja.pocoo.org">Jinja</a> prior to
execution.</p>
<p>All of the injected parameters are effectively Python objects so the normal
Jinja syntax and Python methods for those objects can be used in the Jinja
templates. This is particularly useful for the
<a href="https://docs.python.org/3/library/datetime.html#datetime-objects">datetime</a>
objects as <code>strftime()</code> becomes available. For example, the S3 location of
the unload (<code>s3key</code>) can be dynamically set to include components such as the
schema, table name, unload date etc.</p>
<p>Refer to <a href="13-jinja-rendering-in-lava.html#jinja-rendering-in-lava">Jinja Rendering in Lava</a>
for more information.</p>
<p>The following variables are made available to the renderer.</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>globals</td>
<td>dict[str,*]</td>
<td>The <code>globals</code> from the job specification updated with any globals received in the job dispatch.</td>
</tr>
<tr>
<td>job</td>
<td>dict[str,*]</td>
<td>The <a href="13-jinja-rendering-in-lava.html#the-augmented-job-specification">augmented job specification</a>.</td>
</tr>
<tr>
<td>realm</td>
<td>dict[str,*]</td>
<td>The realm specification.</td>
</tr>
<tr>
<td>start</td>
<td>datetime</td>
<td>The local time when the job run started.</td>
</tr>
<tr>
<td>state</td>
<td>dict[str,*]</td>
<td>A dictionary of the state items imported into the job, keyed on state_id. The default values are updated at run-time with any current values obtainable from the <a href="04-dynamodb-tables.html#the-state-table">state</a> table.</td>
</tr>
<tr>
<td>ustart</td>
<td>datetime</td>
<td>The UTC time when the job run started.</td>
</tr>
<tr>
<td>utils</td>
<td>dict[str,runnable]</td>
<td>A dictionary of <a href="13-jinja-rendering-in-lava.html#jinja-utility-functions">utility functions</a> that can be used in the Jinja markup.</td>
</tr>
<tr>
<td>vars</td>
<td>dict[str,*]</td>
<td>A dictionary of variables provided as the <code>vars</code> component of the job <code>parameters</code>.</td>
</tr>
</tbody>
</table>
<h3 id="dev-mode-behaviour_22">Dev Mode Behaviour<a class="headerlink" href="#dev-mode-behaviour_22" title="Permanent link">&para;</a></h3>
<p>Normally, the <strong>sqlv</strong> job will copy stdout and stderr to S3 on the conclusion
of the job. In dev mode, stderr is emitted locally during the job
run instead of being copied to S3. Stdout will still be copied to S3 as it may
contain binary information.</p>
<h3 id="examples_19">Examples<a class="headerlink" href="#examples_19" title="Permanent link">&para;</a></h3>
<p>The following example runs the SQL statements in <code>demo/query-mytable.sql</code>. The
output is written to <code>demo/query-mytable.sql.out</code> in the <code>s3_temp</code> area.</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-73-1"><span class="p">{</span>
</span><span id="__span-73-2"><span class="w">  </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Run a file containing SQL statements.&quot;</span><span class="p">,</span>
</span><span id="__span-73-3"><span class="w">  </span><span class="nt">&quot;dispatcher&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Sydney&quot;</span><span class="p">,</span>
</span><span id="__span-73-4"><span class="w">  </span><span class="nt">&quot;enabled&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-73-5"><span class="w">  </span><span class="nt">&quot;job_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo/sql-query-01&quot;</span><span class="p">,</span>
</span><span id="__span-73-6"><span class="w">  </span><span class="nt">&quot;owner&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo@somewhere.com&quot;</span><span class="p">,</span>
</span><span id="__span-73-7"><span class="w">  </span><span class="nt">&quot;parameters&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-73-8"><span class="w">    </span><span class="nt">&quot;conn_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;db-conn-01&quot;</span><span class="p">,</span>
</span><span id="__span-73-9"><span class="w">    </span><span class="nt">&quot;delimiter&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;|&quot;</span><span class="p">,</span>
</span><span id="__span-73-10"><span class="w">    </span><span class="nt">&quot;quoting&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;all&quot;</span><span class="p">,</span>
</span><span id="__span-73-11"><span class="w">    </span><span class="nt">&quot;timeout&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;20m&quot;</span><span class="p">,</span>
</span><span id="__span-73-12"><span class="w">    </span><span class="nt">&quot;transaction&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-73-13"><span class="w">  </span><span class="p">},</span>
</span><span id="__span-73-14"><span class="w">  </span><span class="nt">&quot;payload&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo/queries.sql&quot;</span><span class="p">,</span>
</span><span id="__span-73-15"><span class="w">  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;sqlc&quot;</span><span class="p">,</span>
</span><span id="__span-73-16"><span class="w">  </span><span class="nt">&quot;worker&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;default&quot;</span>
</span><span id="__span-73-17"><span class="p">}</span>
</span></code></pre></div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      &copy; Origin Energy 2025
    </div>
  
</div>
      <div class="md-footer-social">
        <div class="md-copyright">
          <div class="md-copyright__highlight">
            v8.2.0 (Kilauea)
          </div>
        </div>
      </div>
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": ".", "features": ["navigation.instant", "content.code.copy", {"icon": {"repo": "material/github"}}], "search": "assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="assets/javascripts/bundle.f55a23d4.min.js"></script>
      
    
  </body>
</html>