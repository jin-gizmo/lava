
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="AWS based distributed scheduler and job runner">
      
      
        <meta name="author" content="Murray Andrews">
      
      
      
        <link rel="prev" href="06-jobs-job-types.html">
      
      
        <link rel="next" href="08-job-actions.html">
      
      
      <link rel="icon" href="img/lava-icons/png/256/lava-icon-256-transparent.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.23">
    
    
      
        <title>Connectors - Lava User Guide</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.84d31ad4.min.css">
      
        
        <link rel="stylesheet" href="assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="css/extra.css">
    
    <script>__md_scope=new URL(".",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#connectors" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="." title="Lava User Guide" class="md-header__button md-logo" aria-label="Lava User Guide" data-md-component="logo">
      
  <img src="img/lava-icons/svg/256/lava-icon-256-opaque.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Lava User Guide
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Connectors
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="custom" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        

<a href="https://github.com/jin-gizmo/lava" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    Lava on GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="." title="Lava User Guide" class="md-nav__button md-logo" aria-label="Lava User Guide" data-md-component="logo">
      
  <img src="img/lava-icons/svg/256/lava-icon-256-opaque.svg" alt="logo">

    </a>
    Lava User Guide
  </label>
  
    <div class="md-nav__source">
      

<a href="https://github.com/jin-gizmo/lava" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    Lava on GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="01-about-lava.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    About Lava
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="02-concepts.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Concepts
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="03-architecture.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Architecture
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="04-dynamodb-tables.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    DynamoDB Tables
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="05-job-dispatch.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Job Dispatch
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="06-jobs-job-types.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Jobs & Job Types
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Connectors
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="07-connectors.html" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Connectors
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#database-connectors" class="md-nav__link">
    <span class="md-ellipsis">
      Database Connectors
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Database Connectors">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#database-authentication-using-aws-ssm-parameter-store" class="md-nav__link">
    <span class="md-ellipsis">
      Authentication Using SSM Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#database-authentication-using-aws-secrets-manager" class="md-nav__link">
    <span class="md-ellipsis">
      Authentication Using Secrets Manager
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#database-authentication-using-iam-credential-generation" class="md-nav__link">
    <span class="md-ellipsis">
      Authentication Using IAM
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#database-client-application-identification" class="md-nav__link">
    <span class="md-ellipsis">
      Client Application Identification
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#other-connectors" class="md-nav__link">
    <span class="md-ellipsis">
      Other Connectors
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#connector-type-aws" class="md-nav__link">
    <span class="md-ellipsis">
      Connector type: aws
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Connector type: aws">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#using-the-aws-connector-in-shell-scripts" class="md-nav__link">
    <span class="md-ellipsis">
      Use in Shell Scripts
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-the-aws-connector-in-python" class="md-nav__link">
    <span class="md-ellipsis">
      Use in Python
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#connector-type-docker" class="md-nav__link">
    <span class="md-ellipsis">
      Connector type: docker
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Connector type: docker">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#accessing-external-registries" class="md-nav__link">
    <span class="md-ellipsis">
      Accessing External Registries
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#examples" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#connector-type-email" class="md-nav__link">
    <span class="md-ellipsis">
      Connector type: email
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Connector type: email">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#subtype-ses" class="md-nav__link">
    <span class="md-ellipsis">
      Subtype: ses
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#subtype-smtp" class="md-nav__link">
    <span class="md-ellipsis">
      Subtype: smtp
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-the-email-connector" class="md-nav__link">
    <span class="md-ellipsis">
      Using the Email Connector
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#connector-type-generic" class="md-nav__link">
    <span class="md-ellipsis">
      Connector type: generic
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Connector type: generic">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#specifying-generic-connector-attribute-values" class="md-nav__link">
    <span class="md-ellipsis">
      Specifying Attribute Vales
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-generic-connector-specification" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-the-generic-connector" class="md-nav__link">
    <span class="md-ellipsis">
      Using the Generic Connector
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#connector-type-git" class="md-nav__link">
    <span class="md-ellipsis">
      Connector type: git
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#connector-type-mariadb-rds" class="md-nav__link">
    <span class="md-ellipsis">
      Connector type: mariadb-rds
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#connector-type-mariadb" class="md-nav__link">
    <span class="md-ellipsis">
      Connector type: mariadb
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Connector type: mariadb">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#implementation-notes" class="md-nav__link">
    <span class="md-ellipsis">
      Implementation Notes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#connector-type-mysql-aurora" class="md-nav__link">
    <span class="md-ellipsis">
      Connector type: mysql-aurora
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Connector type: mysql-aurora">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#creating-temporary-iam-user-credentials-for-aws-rds-aurora-mysql" class="md-nav__link">
    <span class="md-ellipsis">
      IAM Auth for Aurora MySQL
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#connector-type-mysql-rds" class="md-nav__link">
    <span class="md-ellipsis">
      Connector type: mysql-rds
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#connector-type-mysql" class="md-nav__link">
    <span class="md-ellipsis">
      Connector type: mysql
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#connector-type-oracle-rds" class="md-nav__link">
    <span class="md-ellipsis">
      Connector type: oracle-rds
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#connector-type-oracle" class="md-nav__link">
    <span class="md-ellipsis">
      Connector type: oracle
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Connector type: oracle">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#security-warnings" class="md-nav__link">
    <span class="md-ellipsis">
      Security Warnings
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#connector-type-postgres-aurora" class="md-nav__link">
    <span class="md-ellipsis">
      Connector type: postgres-aurora
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Connector type: postgres-aurora">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#creating-temporary-iam-user-credentials-for-aws-rds-aurora-postgresql" class="md-nav__link">
    <span class="md-ellipsis">
      IAM Auth for Aurora PostgreSQL
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#psql-cli-password-limitations" class="md-nav__link">
    <span class="md-ellipsis">
      Psql CLI Password Limitations
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#connector-type-postgres-rds" class="md-nav__link">
    <span class="md-ellipsis">
      Connector type: postgres-rds
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#connector-type-postgres" class="md-nav__link">
    <span class="md-ellipsis">
      Connector type: postgres
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#connector-type-psql" class="md-nav__link">
    <span class="md-ellipsis">
      Connector type: psql
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#connector-type-redshift-serverless" class="md-nav__link">
    <span class="md-ellipsis">
      Connector type: redshift-serverless
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#connector-type-redshift" class="md-nav__link">
    <span class="md-ellipsis">
      Connector type: redshift
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#connector-type-ses" class="md-nav__link">
    <span class="md-ellipsis">
      Connector type: ses
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#connector-type-sharepoint" class="md-nav__link">
    <span class="md-ellipsis">
      Connector type: sharepoint
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Connector type: sharepoint">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#using-sharepoint-connectors" class="md-nav__link">
    <span class="md-ellipsis">
      Using SharePoint Connectors
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#connector-type-slack" class="md-nav__link">
    <span class="md-ellipsis">
      Connector type: slack
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Connector type: slack">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#using-the-slack-connector" class="md-nav__link">
    <span class="md-ellipsis">
      Using the Slack Connector
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#connector-type-smb" class="md-nav__link">
    <span class="md-ellipsis">
      Connector type: smb
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Connector type: smb">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#use-with-python-based-executable-jobs" class="md-nav__link">
    <span class="md-ellipsis">
      Use with Python-based Jobs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-with-other-executable-jobs" class="md-nav__link">
    <span class="md-ellipsis">
      Use with Other Executable Jobs
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#connector-type-sqlite3" class="md-nav__link">
    <span class="md-ellipsis">
      Connector type: sqlite3
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#connector-type-ssh-scp-sftp" class="md-nav__link">
    <span class="md-ellipsis">
      Connector type: ssh, scp, sftp
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="08-job-actions.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Job Actions
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="09-lava-state-manager.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lava State Manager
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="10-installation-operation.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Installation & Operation
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="11-lava-job-framework.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lava Job Framework
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="12-developing-lava-jobs.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Developing Lava Jobs
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="13-jinja-rendering-in-lava.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Jinja Rendering in Lava
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="14-enhancing-lava.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Enhancing Lava
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="15-lava-and-docker.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lava and Docker
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="16-commands-utilities.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Commands & Utilities
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="17-job-framework-samples.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Job Framework Samples
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="18-api.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    API
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="19-cloudformation-templates.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CloudFormation Templates
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="20-faq.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    FAQ
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="21-release-notes.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Release Notes
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="22-credits.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Credits
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="23-known-issues.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Known Issues
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#database-connectors" class="md-nav__link">
    <span class="md-ellipsis">
      Database Connectors
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Database Connectors">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#database-authentication-using-aws-ssm-parameter-store" class="md-nav__link">
    <span class="md-ellipsis">
      Authentication Using SSM Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#database-authentication-using-aws-secrets-manager" class="md-nav__link">
    <span class="md-ellipsis">
      Authentication Using Secrets Manager
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#database-authentication-using-iam-credential-generation" class="md-nav__link">
    <span class="md-ellipsis">
      Authentication Using IAM
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#database-client-application-identification" class="md-nav__link">
    <span class="md-ellipsis">
      Client Application Identification
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#other-connectors" class="md-nav__link">
    <span class="md-ellipsis">
      Other Connectors
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#connector-type-aws" class="md-nav__link">
    <span class="md-ellipsis">
      Connector type: aws
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Connector type: aws">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#using-the-aws-connector-in-shell-scripts" class="md-nav__link">
    <span class="md-ellipsis">
      Use in Shell Scripts
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-the-aws-connector-in-python" class="md-nav__link">
    <span class="md-ellipsis">
      Use in Python
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#connector-type-docker" class="md-nav__link">
    <span class="md-ellipsis">
      Connector type: docker
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Connector type: docker">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#accessing-external-registries" class="md-nav__link">
    <span class="md-ellipsis">
      Accessing External Registries
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#examples" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#connector-type-email" class="md-nav__link">
    <span class="md-ellipsis">
      Connector type: email
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Connector type: email">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#subtype-ses" class="md-nav__link">
    <span class="md-ellipsis">
      Subtype: ses
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#subtype-smtp" class="md-nav__link">
    <span class="md-ellipsis">
      Subtype: smtp
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-the-email-connector" class="md-nav__link">
    <span class="md-ellipsis">
      Using the Email Connector
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#connector-type-generic" class="md-nav__link">
    <span class="md-ellipsis">
      Connector type: generic
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Connector type: generic">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#specifying-generic-connector-attribute-values" class="md-nav__link">
    <span class="md-ellipsis">
      Specifying Attribute Vales
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-generic-connector-specification" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-the-generic-connector" class="md-nav__link">
    <span class="md-ellipsis">
      Using the Generic Connector
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#connector-type-git" class="md-nav__link">
    <span class="md-ellipsis">
      Connector type: git
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#connector-type-mariadb-rds" class="md-nav__link">
    <span class="md-ellipsis">
      Connector type: mariadb-rds
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#connector-type-mariadb" class="md-nav__link">
    <span class="md-ellipsis">
      Connector type: mariadb
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Connector type: mariadb">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#implementation-notes" class="md-nav__link">
    <span class="md-ellipsis">
      Implementation Notes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#connector-type-mysql-aurora" class="md-nav__link">
    <span class="md-ellipsis">
      Connector type: mysql-aurora
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Connector type: mysql-aurora">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#creating-temporary-iam-user-credentials-for-aws-rds-aurora-mysql" class="md-nav__link">
    <span class="md-ellipsis">
      IAM Auth for Aurora MySQL
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#connector-type-mysql-rds" class="md-nav__link">
    <span class="md-ellipsis">
      Connector type: mysql-rds
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#connector-type-mysql" class="md-nav__link">
    <span class="md-ellipsis">
      Connector type: mysql
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#connector-type-oracle-rds" class="md-nav__link">
    <span class="md-ellipsis">
      Connector type: oracle-rds
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#connector-type-oracle" class="md-nav__link">
    <span class="md-ellipsis">
      Connector type: oracle
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Connector type: oracle">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#security-warnings" class="md-nav__link">
    <span class="md-ellipsis">
      Security Warnings
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#connector-type-postgres-aurora" class="md-nav__link">
    <span class="md-ellipsis">
      Connector type: postgres-aurora
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Connector type: postgres-aurora">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#creating-temporary-iam-user-credentials-for-aws-rds-aurora-postgresql" class="md-nav__link">
    <span class="md-ellipsis">
      IAM Auth for Aurora PostgreSQL
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#psql-cli-password-limitations" class="md-nav__link">
    <span class="md-ellipsis">
      Psql CLI Password Limitations
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#connector-type-postgres-rds" class="md-nav__link">
    <span class="md-ellipsis">
      Connector type: postgres-rds
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#connector-type-postgres" class="md-nav__link">
    <span class="md-ellipsis">
      Connector type: postgres
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#connector-type-psql" class="md-nav__link">
    <span class="md-ellipsis">
      Connector type: psql
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#connector-type-redshift-serverless" class="md-nav__link">
    <span class="md-ellipsis">
      Connector type: redshift-serverless
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#connector-type-redshift" class="md-nav__link">
    <span class="md-ellipsis">
      Connector type: redshift
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#connector-type-ses" class="md-nav__link">
    <span class="md-ellipsis">
      Connector type: ses
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#connector-type-sharepoint" class="md-nav__link">
    <span class="md-ellipsis">
      Connector type: sharepoint
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Connector type: sharepoint">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#using-sharepoint-connectors" class="md-nav__link">
    <span class="md-ellipsis">
      Using SharePoint Connectors
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#connector-type-slack" class="md-nav__link">
    <span class="md-ellipsis">
      Connector type: slack
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Connector type: slack">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#using-the-slack-connector" class="md-nav__link">
    <span class="md-ellipsis">
      Using the Slack Connector
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#connector-type-smb" class="md-nav__link">
    <span class="md-ellipsis">
      Connector type: smb
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Connector type: smb">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#use-with-python-based-executable-jobs" class="md-nav__link">
    <span class="md-ellipsis">
      Use with Python-based Jobs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-with-other-executable-jobs" class="md-nav__link">
    <span class="md-ellipsis">
      Use with Other Executable Jobs
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#connector-type-sqlite3" class="md-nav__link">
    <span class="md-ellipsis">
      Connector type: sqlite3
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#connector-type-ssh-scp-sftp" class="md-nav__link">
    <span class="md-ellipsis">
      Connector type: ssh, scp, sftp
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="connectors">Connectors<a class="headerlink" href="#connectors" title="Permanent link">&para;</a></h1>
<p>Lava provides a mechanism to assist with connections to external resources to
minimise the need for individual jobs to manage connectivity details and
credentials. This also simplifies the process of migrating jobs from one
environment or lava realm to another.</p>
<p>Configuration information for connection handlers (aka <em>connectors</em>) is stored
in the <a href="04-dynamodb-tables.html#the-connections-table">connections table</a>. The required
fields are dependent on the connector type.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Loosely speaking, a <strong>connector</strong> is a handler for a specific type of resource
and a <strong>connection</strong> is an instance of a connector for a specific instance of
a resource.</p>
<p>It probably doesn't matter that much and, historically, the user guide has
played fast and loose with this distinction.</p>
</div>
<p>The underlying implementation of connectors is specific to the type of
target resource and the job type. Lava attempts to provide a connection handle
to jobs in a form that is relatively native to the job type. For example, a
database connection for an <a href="06-jobs-job-types.html#job-type-sql">sql</a> job is provided
as a Python DBAPI 2.0 connection instance. For an
<a href="06-jobs-job-types.html#job-type-exe">exe</a> or <a href="06-jobs-job-types.html#job-type-pkg">pkg</a>
job, it is provided as a command line wrapper that handles credential management
and connectivity behind the scenes.</p>
<p>Connector credentials are typically stored in the AWS SSM Parameter Store to
provide a level of isolation and security. SSM parameters for a given realm
should be stored with parameter names starting with <code>/lava/&lt;REALM&gt;/</code>.</p>
<p>Connectors are implemented using a simple plugin architecture and new ones can
be added relatively easily.</p>
<h2 id="database-connectors">Database Connectors<a class="headerlink" href="#database-connectors" title="Permanent link">&para;</a></h2>
<p>Lava provides database connectors for a number of common database types,
including MySQL, Postgres and Oracle.</p>
<p>If used with <a href="06-jobs-job-types.html#job-type-sql">sql</a>,
<a href="06-jobs-job-types.html#job-type-sqlc">sqlc</a>,
<a href="06-jobs-job-types.html#job-type-sqli">sqli</a>,
<a href="06-jobs-job-types.html#job-type-sqlv">sqlv</a>,
<a href="06-jobs-job-types.html#job-type-db_from_s3">db_from_s3</a> and
<a href="06-jobs-job-types.html#job-type-redshift_unload">redshift_unload</a> jobs, lava manages
the connection process in the background.</p>
<p>If used with <a href="06-jobs-job-types.html#job-type-exe">exe</a>,
<a href="06-jobs-job-types.html#job-type-pkg">pkg</a> and
<a href="06-jobs-job-types.html#job-type-docker">docker</a> jobs, lava provides an environment
variable pointing to a script that will connect to the database to run SQL. The
executable in the job payload can run the script to access the database without
worrying about managing database connectivity.</p>
<p>Python programs in job payloads can access the lava connector subsystem
directly to obtain either a DBAPI 2.0 connection object or an SQLAlchemy engine
object. Refer to <a href="12-developing-lava-jobs.html#developing-lava-jobs">Developing Lava Jobs</a>
for more information.</p>
<h3 id="database-authentication-using-aws-ssm-parameter-store">Database Authentication Using AWS SSM Parameter Store<a class="headerlink" href="#database-authentication-using-aws-ssm-parameter-store" title="Permanent link">&para;</a></h3>
<p>The database connectors typically require a number of connection and
authentication parameters to be specified, such as:</p>
<ul>
<li>host name</li>
<li>port</li>
<li>user name</li>
<li>password.</li>
</ul>
<p>These can be defined explicitly in the connection specification, except for the
password. By default, the value of this field is interpreted as the name of an
encrypted SSM parameter that contains the actual password.</p>
<p>The standard lava worker IAM policies will provide read access to SSM parameters
with names of the form <code>/lava/&lt;REALM&gt;/*</code>. These must be encrypted with the realm
KMS key <code>lava-&lt;REALM&gt;-sys</code>.</p>
<h3 id="database-authentication-using-aws-secrets-manager">Database Authentication Using AWS Secrets Manager<a class="headerlink" href="#database-authentication-using-aws-secrets-manager" title="Permanent link">&para;</a></h3>
<p>The lava database connectors support the AWS Secrets Manager as an alternative
source for some of the connection specification parameters where they are not
provided directly in the specification.</p>
<p>If the connection specification contains a <code>secret_id</code> field, a field in the
named secret will be used to populate a missing component in the connector
specification.</p>
<p>Note that Secrets Manager and lava use slightly different naming conventions
for fields. Lava will map Secrets Manager fields to lava fields automatically
using the following translation:</p>
<table>
<thead>
<tr>
<th>Secrets Manager Field</th>
<th>Lava Field</th>
</tr>
</thead>
<tbody>
<tr>
<td>dbClusterIdentifier</td>
<td>description</td>
</tr>
<tr>
<td>dbname</td>
<td>database</td>
</tr>
<tr>
<td>host</td>
<td>host</td>
</tr>
<tr>
<td>password</td>
<td>password</td>
</tr>
<tr>
<td>port</td>
<td>port</td>
</tr>
<tr>
<td>serviceName</td>
<td>service_name</td>
</tr>
<tr>
<td>sid</td>
<td>sid</td>
</tr>
<tr>
<td>username</td>
<td>user</td>
</tr>
</tbody>
</table>
<p>The standard lava worker IAM policies will provide read access to secrets with
names of the form <code>/lava/&lt;REALM&gt;/*</code>. These must be encrypted with the realm KMS
key <code>lava-&lt;REALM&gt;-sys</code>.</p>
<h3 id="database-authentication-using-iam-credential-generation">Database Authentication Using IAM Credential Generation<a class="headerlink" href="#database-authentication-using-iam-credential-generation" title="Permanent link">&para;</a></h3>
<p>Some AWS database types provide an IAM based mechanism for obtaining temporary
database credentials. Lava supports this mechanism for some connectors. The
mechanism will be used where the connection specification (after inclusion of
any AWS Secrets Manager components) does not contain a password.</p>
<p>Refer to individual connector details for more information.</p>
<h3 id="database-client-application-identification">Database Client Application Identification<a class="headerlink" href="#database-client-application-identification" title="Permanent link">&para;</a></h3>
<p>Some database types support a mechanism for the client to identify itself when
connecting, in addition to the user authentication. This information may then be
available in things such as connection logs, activity logs etc. The mechanism
used is database dependent and not all databases provide a mechanism.</p>
<p>Lava attempts to provide a uniform interface to the underlying database client
identification mechanism where possible.</p>
<p>For most of the built in database related job types, lava will automatically
provide a client identifier when connecting. By default, this is in the form
<code>lv-&lt;REALM&gt;-&lt;JOB-ID&gt;</code>. (See the <code>CONN_APP_NAME</code> <a href="10-installation-operation.html#general-configuration-parameters">worker configuration
parameter</a>.)</p>
<p>Support in <a href="06-jobs-job-types.html#job-type-sqlc">sqlc</a> jobs is dependent on the capabilities of the
database specific CLI tool used to support the connection. Likewise for
executable job types (e.g. <a href="06-jobs-job-types.html#job-type-exe">exe</a> and <a href="06-jobs-job-types.html#job-type-pkg">pkg</a>) using
a CLI based connector. See also
<a href="12-developing-lava-jobs.html#connection-handling-for-executable-jobs">Connection Handling for Executable Jobs</a>.</p>
<p>When using the lava API <code>get_pysql_connection()</code>, a new, optional
<code>application_name</code> parameter is available. If a value is not provided, a value
in the form described above is used <em>if</em> the lava job ID can be determined from
the presence of a <code>LAVA_JOB_ID</code> environment variable. This should work whenever
the API is being used within a lava job. See also
<a href="12-developing-lava-jobs.html#connection-handling-for-python-based-jobs">Connection Handling for Python Based Jobs</a>.</p>
<p>In short, in most normal usage patterns for databases for which lava supports
client identification, it will, more or less, do the <em>right</em> thing without
modifying jobs or additional configuration.</p>
<p>Lava's support for a client identification mechanism is summarised in the
following table:</p>
<table>
<thead>
<tr>
<th>Job Type</th>
<th>MS SQL</th>
<th>MySQL</th>
<th>Oracle</th>
<th>Postgres</th>
<th>Redshift</th>
<th>SQLite</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="06-jobs-job-types.html#job-type-sql">sql</a></td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Yes</td>
<td>Yes</td>
<td></td>
</tr>
<tr>
<td><a href="06-jobs-job-types.html#job-type-sqli">sqli</a></td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Yes</td>
<td>Yes</td>
<td></td>
</tr>
<tr>
<td><a href="06-jobs-job-types.html#job-type-sqlc">sqlc</a></td>
<td></td>
<td></td>
<td></td>
<td>Yes</td>
<td>Yes</td>
<td></td>
</tr>
<tr>
<td><a href="06-jobs-job-types.html#job-type-sqlv">sqlv</a></td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Yes</td>
<td>Yes</td>
<td></td>
</tr>
<tr>
<td><a href="06-jobs-job-types.html#job-type-db_from_s3">db_from_s3</a></td>
<td>Yes</td>
<td>Yes</td>
<td></td>
<td>Yes</td>
<td>Yes</td>
<td></td>
</tr>
<tr>
<td><a href="06-jobs-job-types.html#job-type-redshift_unload">redshift_unload</a></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>Yes</td>
<td></td>
</tr>
<tr>
<td>lava-sql CLI</td>
<td>(1)</td>
<td>(1)</td>
<td></td>
<td>(1)</td>
<td>(1)</td>
<td></td>
</tr>
<tr>
<td>Lava API</td>
<td>(2)</td>
<td>(2)</td>
<td></td>
<td>(2)</td>
<td>(2)</td>
<td></td>
</tr>
</tbody>
</table>
<p>Notes:</p>
<ol>
<li>
<p>The <strong>lava-sql</strong> utility will automatically populate a client connection
    identifier when used as part of a lava job payload. In other usages, the
    <code>-a</code> / <code>--app-name</code> argument will need to be specified.</p>
</li>
<li>
<p>The <code>get_pysql_connection()</code> API will automatically populate a client
    connection identifier when used as part of a lava job payload. In other
    usages, the otherwise optional <code>application_name</code> parameter will need to be
    specified.</p>
</li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This article by Andy Grunwald was very helpful when implementing database
client identification in lava: your <a href="https://andygrunwald.com/blog/your-database-connection-deserves-a-name">database connection deserves a
name</a></p>
</div>
<h4 id="client-application-identification-for-postgres">Client Application Identification for Postgres<a class="headerlink" href="#client-application-identification-for-postgres" title="Permanent link">&para;</a></h4>
<p>Postgres flavoured databases use the <code>application_name</code> connection parameter to
identify client connections. Postgres will truncate the supplied value to 63
characters.</p>
<p>The following sample query will display connected application names.</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-0-1"><span class="k">SELECT</span><span class="w"> </span><span class="n">usename</span><span class="p">,</span><span class="w"> </span><span class="n">application_name</span><span class="p">,</span><span class="w"> </span><span class="n">client_addr</span><span class="p">,</span><span class="w"> </span><span class="n">backend_type</span>
</span><span id="__span-0-2"><span class="k">FROM</span><span class="w"> </span><span class="n">pg_stat_activity</span><span class="p">;</span>
</span></code></pre></div>
<h4 id="client-application-identification-for-redshift">Client Application Identification for Redshift<a class="headerlink" href="#client-application-identification-for-redshift" title="Permanent link">&para;</a></h4>
<p>Redshift, like Postgres, uses the <code>application_name</code> connection parameter to
identify client connections. Redshift allows application names up to 250
characters.</p>
<p>The following sample query can display application names:</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-1-1"><span class="k">SELECT</span><span class="w"> </span><span class="n">RTRIM</span><span class="p">(</span><span class="n">username</span><span class="p">)</span><span class="w">         </span><span class="k">AS</span><span class="w"> </span><span class="k">user</span><span class="p">,</span>
</span><span id="__span-1-2"><span class="w">       </span><span class="n">sessionid</span><span class="p">,</span>
</span><span id="__span-1-3"><span class="w">       </span><span class="k">SUBSTRING</span><span class="p">(</span><span class="n">event</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">20</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">event</span><span class="p">,</span>
</span><span id="__span-1-4"><span class="w">       </span><span class="n">recordtime</span><span class="p">,</span>
</span><span id="__span-1-5"><span class="w">       </span><span class="n">RTRIM</span><span class="p">(</span><span class="n">authmethod</span><span class="p">)</span><span class="w">       </span><span class="k">AS</span><span class="w"> </span><span class="n">auth</span><span class="p">,</span>
</span><span id="__span-1-6"><span class="w">       </span><span class="n">RTRIM</span><span class="p">(</span><span class="n">sslversion</span><span class="p">)</span><span class="w">       </span><span class="k">AS</span><span class="w"> </span><span class="n">ssl</span><span class="p">,</span>
</span><span id="__span-1-7"><span class="w">       </span><span class="n">RTRIM</span><span class="p">(</span><span class="n">application_name</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">app_name</span>
</span><span id="__span-1-8"><span class="k">FROM</span><span class="w"> </span><span class="n">stl_connection_log</span>
</span><span id="__span-1-9"><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">recordtime</span><span class="w"> </span><span class="k">DESC</span><span class="p">;</span>
</span></code></pre></div>
<h4 id="client-application-identification-for-mysql">Client Application Identification for MySQL<a class="headerlink" href="#client-application-identification-for-mysql" title="Permanent link">&para;</a></h4>
<p>MySQL use the <code>program_name</code> connection parameter to identify client
connections.</p>
<p>The performance schema must be enabled to run queries that access the
<code>program_name</code> parameter. For AWS Aurora instances, see
<a href="https://docs.aws.amazon.com/AmazonRDS/latest/AuroraUserGuide/USER_PerfInsights.EnableMySQL.html">Turning on the Performance Schema for Performance Insights on Aurora MySQL</a>
for information on enabling the performance schema.</p>
<p>The following sample query, when run as an admin user, shows currently active
connections:</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-2-1"><span class="k">SELECT</span>
</span><span id="__span-2-2"><span class="w"> </span><span class="n">session_connect_attrs</span><span class="p">.</span><span class="n">ATTR_VALUE</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">program_name</span><span class="p">,</span>
</span><span id="__span-2-3"><span class="w"> </span><span class="n">processlist</span><span class="p">.</span><span class="o">*</span>
</span><span id="__span-2-4"><span class="k">FROM</span><span class="w"> </span><span class="n">information_schema</span><span class="p">.</span><span class="n">processlist</span>
</span><span id="__span-2-5"><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w">  </span><span class="n">performance_schema</span><span class="p">.</span><span class="n">session_connect_attrs</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-2-6"><span class="w"> </span><span class="n">processlist</span><span class="p">.</span><span class="n">ID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">session_connect_attrs</span><span class="p">.</span><span class="n">PROCESSLIST_ID</span>
</span><span id="__span-2-7"><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">session_connect_attrs</span><span class="p">.</span><span class="n">ATTR_NAME</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;program_name&quot;</span>
</span><span id="__span-2-8"><span class="p">)</span>
</span></code></pre></div>
<p>The following query shows active connections for the current user:</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-3-1"><span class="k">SELECT</span>
</span><span id="__span-3-2"><span class="w"> </span><span class="n">session_account_connect_attrs</span><span class="p">.</span><span class="n">ATTR_VALUE</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">program_name</span><span class="p">,</span>
</span><span id="__span-3-3"><span class="w"> </span><span class="n">processlist</span><span class="p">.</span><span class="o">*</span>
</span><span id="__span-3-4"><span class="k">FROM</span><span class="w"> </span><span class="n">information_schema</span><span class="p">.</span><span class="n">processlist</span>
</span><span id="__span-3-5"><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w">  </span><span class="n">performance_schema</span><span class="p">.</span><span class="n">session_account_connect_attrs</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-3-6"><span class="w"> </span><span class="n">processlist</span><span class="p">.</span><span class="n">ID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">session_account_connect_attrs</span><span class="p">.</span><span class="n">PROCESSLIST_ID</span>
</span><span id="__span-3-7"><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">session_account_connect_attrs</span><span class="p">.</span><span class="n">ATTR_NAME</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;program_name&quot;</span><span class="p">;</span>
</span></code></pre></div>
<h4 id="client-application-identification-for-sql-server-ms-sql">Client Application Identification for SQL Server (MS SQL)<a class="headerlink" href="#client-application-identification-for-sql-server-ms-sql" title="Permanent link">&para;</a></h4>
<p>SQL Server uses the <code>program_name</code> connection parameter to identify client
connections.</p>
<p>The following sample query, when run as an admin user, shows currently active
connections:</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-4-1"><span class="k">SELECT</span><span class="w"> </span><span class="n">hostname</span><span class="p">,</span><span class="w"> </span><span class="n">program_name</span><span class="p">,</span><span class="w"> </span><span class="n">loginame</span><span class="p">,</span><span class="w"> </span><span class="n">cmd</span>
</span><span id="__span-4-2"><span class="k">FROM</span><span class="w"> </span><span class="n">sys</span><span class="p">.</span><span class="n">sysprocesses</span>
</span><span id="__span-4-3"><span class="k">WHERE</span><span class="w"> </span><span class="n">loginame</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s1">&#39;rdsa&#39;</span><span class="p">;</span>
</span></code></pre></div>
<h2 id="other-connectors">Other Connectors<a class="headerlink" href="#other-connectors" title="Permanent link">&para;</a></h2>
<p>Lava also provides connectors for various other types of resource, including
sFTP servers, SharePoint sites, SMB fileshares and the AWS CLI. These are
typically used either by a job type that is specific to the target resource or
in <a href="06-jobs-job-types.html#job-type-exe">exe</a>, <a href="06-jobs-job-types.html#job-type-pkg">pkg</a>
and <a href="06-jobs-job-types.html#job-type-docker">docker</a>
jobs.</p>
<h2 id="connector-type-aws">Connector type: aws<a class="headerlink" href="#connector-type-aws" title="Permanent link">&para;</a></h2>
<p>The <strong>aws</strong> connector manages access to AWS access keys. It supports static
access keys as well as session credentials obtained by assuming an IAM role in
either the current AWS account or another account.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>IAM assumed role session credentials are new in version 8.1 (Klauea).</p>
</div>
<p>When used with <a href="06-jobs-job-types.html#job-type-redshift_unload">redshift_unload</a> jobs,
this connector provides the access keys that are used in the S3 <code>AUTHORIZATION</code>
parameters in the <code>UNLOAD</code> command.</p>
<p>When used with <a href="06-jobs-job-types.html#job-type-db_from_s3">db_from_s3</a> jobs,
this connector provides the access keys that are used to provide the database
the required access to S3 to load the data.</p>
<p>When used with <a href="06-jobs-job-types.html#job-type-exe">exe</a> and
<a href="06-jobs-job-types.html#job-type-pkg">pkg</a> jobs, it provides an environment variable
pointing to a script that will run the AWS CLI with an appropriate AWS
authentication profile.</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>access_keys</td>
<td>String</td>
<td>Note 1</td>
<td>The name of an encrypted SSM parameter containing the access keys. For a given <code>&lt;REALM&gt;</code>, the SSM parameter name must be of the form <code>/lava/&lt;REALM&gt;/...</code>. The value must be in the format <code>access_key_id,access_secret_key</code> and must be a <strong>secure string</strong> encrypted using the <code>lava-&lt;REALM&gt;-sys</code> KMS key.</td>
</tr>
<tr>
<td>conn_id</td>
<td>String</td>
<td>Yes</td>
<td>Connection identifier.</td>
</tr>
<tr>
<td>description</td>
<td>String</td>
<td>No</td>
<td>Description.</td>
</tr>
<tr>
<td>duration</td>
<td>Duration</td>
<td>No</td>
<td>The duration of a session created when an IAM role is assumed. Defaults to the value of the <a href="10-installation-operation.html#configuration-for-the-aws-connector">AWS_CONN_DURATION</a> configuration parameter. As AWS credentials are cached, it is critical that this is significantly longer than the cache duration as specified by the <a href="10-installation-operation.html#configuration-for-the-aws-connector">AWS_ACCESS_KEY_CACHE_TTL</a> parameter.</td>
</tr>
<tr>
<td>enabled</td>
<td>Boolean</td>
<td>Yes</td>
<td>Whether or not the connection is enabled.</td>
</tr>
<tr>
<td>external_id</td>
<td>String</td>
<td>No</td>
<td>Name of an SSM parameter containing an external ID to use when assuming a role to obtain session credentials. While AWS does not consider this to be a sensitive security parameter, it is stored in the SSM parameter store for ease of management. It is still recommended to use a secure parameter. Can't hurt.</td>
</tr>
<tr>
<td>policy_arns</td>
<td>String | List[String]</td>
<td>No</td>
<td>The ARNs of IAM managed policies to use as managed session policies. The policies must exist in the same account as the role. The session permissions are the intersection of these policies and the policies of the role being assumed. It is not possible to expand the underlying role permissions.</td>
</tr>
<tr>
<td>policy</td>
<td>Map[String,*]</td>
<td>No</td>
<td>An IAM policy to use as an inline session policy. The value must be a fully-formed AWS IAM policy. The session permissions are the intersection of the specified policy and the policies of the role being assumed. It is not possible to expand the underlying role permissions.</td>
</tr>
<tr>
<td>region</td>
<td>String</td>
<td>No</td>
<td>The AWS region name. If not specified, the current region is assumed.</td>
</tr>
<tr>
<td>role_arn</td>
<td>String</td>
<td>Note 1</td>
<td>The ARN of an IAM role to assume to obtain session credentials.</td>
</tr>
<tr>
<td>tags</td>
<td>Map[String,String]</td>
<td>No</td>
<td>A map of session tags to pass. See <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_session-tags.html">Tagging Amazon Web Services STS Sessions</a>.</td>
</tr>
<tr>
<td>type</td>
<td>String</td>
<td>Yes</td>
<td><code>aws</code>.</td>
</tr>
</tbody>
</table>
<p>Notes:</p>
<ol>
<li>
<p>One of <code>access_keys</code> or <code>role_arn</code> must be specified.</p>
</li>
<li>
<p>If a <code>role_arn</code> is specified, The trust policy on the role must allow it to
    be assumed by the lava worker. If session tags are specified using the <code>tags</code>
    field, the trust policy must also permit this.</p>
</li>
<li>
<p>When assuming a role, the lava worker will set the role session name. By
    default, this is in the form <code>lv-&lt;REALM&gt;-&lt;JOB-ID&gt;</code>, cleansed as necessary to
    satisfy the requirements for session names. (See the <code>CONN_APP_NAME</code>
    <a href="10-installation-operation.html#general-configuration-parameters">worker configuration parameter</a>.)</p>
</li>
</ol>
<h3 id="using-the-aws-connector-in-shell-scripts">Using the AWS Connector in Shell Scripts<a class="headerlink" href="#using-the-aws-connector-in-shell-scripts" title="Permanent link">&para;</a></h3>
<p>The <strong>aws</strong> connector creates a small shell script that is a wrapper around the
AWS CLI that handles the access keys. The shell script is a drop in replacement
for the AWS CLI when used in lava jobs.</p>
<p>Consider the following <a href="06-jobs-job-types.html#job-type-exe">exe</a> job:</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-5-1"><span class="p">{</span>
</span><span id="__span-5-2"><span class="w">    </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Show usage of aws CLI connector in a shell script&quot;</span><span class="p">,</span>
</span><span id="__span-5-3"><span class="w">    </span><span class="nt">&quot;enabled&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-5-4"><span class="w">    </span><span class="nt">&quot;job_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;aws-cli-example&quot;</span><span class="p">,</span>
</span><span id="__span-5-5"><span class="w">    </span><span class="nt">&quot;parameters&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-5-6"><span class="w">        </span><span class="nt">&quot;connections&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-5-7"><span class="w">            </span><span class="nt">&quot;aws1&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;aws-conn-id-1&quot;</span><span class="p">,</span>
</span><span id="__span-5-8"><span class="w">            </span><span class="nt">&quot;aws2&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;aws-conn-id-2&quot;</span>
</span><span id="__span-5-9"><span class="w">        </span><span class="p">}</span>
</span><span id="__span-5-10"><span class="w">    </span><span class="p">},</span>
</span><span id="__span-5-11"><span class="w">    </span><span class="nt">&quot;payload&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;example/aws-cli-conn.sh&quot;</span><span class="p">,</span>
</span><span id="__span-5-12"><span class="w">    </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;exe&quot;</span><span class="p">,</span>
</span><span id="__span-5-13"><span class="w">    </span><span class="nt">&quot;worker&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;core&quot;</span>
</span><span id="__span-5-14"><span class="p">}</span>
</span></code></pre></div>
<p>The <code>connections</code> element in the <code>parameters</code> will result in lava preparing
connector shell scripts whose names are placed in the environment variables
<code>LAVA_CONN_AWS1</code> and <code>LAVA_CONN_AWS2</code> respectively.</p>
<p>The payload (<code>example/aws-cli-conn.sh</code> in this example) can then use these
scripts just like the AWS CLI. For example:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-6-1"><span class="ch">#!/bin/bash</span>
</span><span id="__span-6-2">
</span><span id="__span-6-3"><span class="nv">$LAVA_CONN_AWS1</span><span class="w"> </span>sts<span class="w"> </span>get-caller-identity
</span><span id="__span-6-4">
</span><span id="__span-6-5"><span class="nv">$LAVA_CONN_AWS2</span><span class="w"> </span>s3<span class="w"> </span>ls
</span></code></pre></div>
<h3 id="using-the-aws-connector-in-python">Using the AWS Connector in Python<a class="headerlink" href="#using-the-aws-connector-in-python" title="Permanent link">&para;</a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>New in version 8.1 (Klauea).</p>
</div>
<p>Python jobs can call the lava connector subsystem directly via the lava API.</p>
<p>Consider the following <a href="06-jobs-job-types.html#job-type-exe">exe</a> job:</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-7-1"><span class="p">{</span>
</span><span id="__span-7-2"><span class="w">    </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Show usage of aws CLI connector in a Python program&quot;</span><span class="p">,</span>
</span><span id="__span-7-3"><span class="w">    </span><span class="nt">&quot;enabled&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-7-4"><span class="w">    </span><span class="nt">&quot;job_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;aws-python-example&quot;</span><span class="p">,</span>
</span><span id="__span-7-5"><span class="w">    </span><span class="nt">&quot;parameters&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-7-6"><span class="w">        </span><span class="nt">&quot;connections&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-7-7"><span class="w">            </span><span class="nt">&quot;aws3&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;aws-conn-id-3&quot;</span>
</span><span id="__span-7-8"><span class="w">        </span><span class="p">}</span>
</span><span id="__span-7-9"><span class="w">    </span><span class="p">},</span>
</span><span id="__span-7-10"><span class="w">    </span><span class="nt">&quot;payload&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;example/aws-cli-conn.py&quot;</span><span class="p">,</span>
</span><span id="__span-7-11"><span class="w">    </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;exe&quot;</span><span class="p">,</span>
</span><span id="__span-7-12"><span class="w">    </span><span class="nt">&quot;worker&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;core&quot;</span>
</span><span id="__span-7-13"><span class="p">}</span>
</span></code></pre></div>
<p>Once again, lava will create a shell script accessed via the <code>LAVA_CONN_AWS3</code>
environment variable. It will also populate the <code>LAVA_CONNID_AWS3</code> environment
variable with the connection ID. This can be used with the lava connector API to
obtain a boto3
<a href="https://boto3.amazonaws.com/v1/documentation/api/latest/reference/core/session.html">Session</a>
object, thus:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-8-1"><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
</span><span id="__span-8-2"><span class="kn">from</span><span class="w"> </span><span class="nn">lava.connection</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_aws_session</span>
</span><span id="__span-8-3">
</span><span id="__span-8-4"><span class="n">realm</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;LAVA_REALM&#39;</span><span class="p">]</span>
</span><span id="__span-8-5">
</span><span id="__span-8-6"><span class="c1"># Note we want the connection ID, not the CLI script here.</span>
</span><span id="__span-8-7"><span class="n">conn_id</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;LAVA_CONNID_AWS3&#39;</span><span class="p">]</span>
</span><span id="__span-8-8">
</span><span id="__span-8-9"><span class="c1"># Use the lava API to the connection subsystem to obtain a boto3 Session.</span>
</span><span id="__span-8-10"><span class="n">aws_session</span> <span class="o">=</span> <span class="n">get_aws_session</span><span class="p">(</span><span class="n">conn_id</span><span class="p">,</span> <span class="n">realm</span><span class="p">)</span>
</span><span id="__span-8-11">
</span><span id="__span-8-12"><span class="n">sts</span> <span class="o">=</span> <span class="n">aws_session</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">&#39;sts&#39;</span><span class="p">)</span>
</span><span id="__span-8-13"><span class="nb">print</span><span class="p">(</span><span class="n">sts</span><span class="o">.</span><span class="n">get_caller_identity</span><span class="p">())</span>
</span></code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>A Python script <em>can</em> use the CLI script as well (e.g. via the
<a href="https://docs.python.org/3/library/subprocess.html">subprocess</a> module) but
why would you want to?</p>
</div>
<h2 id="connector-type-docker">Connector type: docker<a class="headerlink" href="#connector-type-docker" title="Permanent link">&para;</a></h2>
<p>The <strong>docker</strong> connector manages access to a docker daemon and docker
registry for use with <a href="06-jobs-job-types.html#job-type-docker">docker</a> jobs.</p>
<p>Lava supports the following registry options:</p>
<ul>
<li>AWS ECR</li>
<li>Private docker registries</li>
<li>The standard docker public registry.</li>
</ul>
<table>
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>conn_id</td>
<td>String</td>
<td>Yes</td>
<td>Connection identifier.</td>
</tr>
<tr>
<td>description</td>
<td>String</td>
<td>No</td>
<td>Description.</td>
</tr>
<tr>
<td>email</td>
<td>String</td>
<td>No</td>
<td>Email address for registry login.</td>
</tr>
<tr>
<td>enabled</td>
<td>Boolean</td>
<td>Yes</td>
<td>Whether or not the connection is enabled.</td>
</tr>
<tr>
<td>password</td>
<td>String</td>
<td>No</td>
<td>Name of the SSM parameter containing the password for authenticating to the registry. Required for private docker repositories. Ignored for ECR registries. For a given <code>&lt;REALM&gt;</code>, the SSM parameter name must be of the form <code>/lava/&lt;REALM&gt;/...</code> and the value must be a secure string encrypted using the <code>lava-&lt;REALM&gt;-sys</code> KMS key.</td>
</tr>
<tr>
<td>registry</td>
<td>String</td>
<td>No</td>
<td>Either the URL for a standard registry or <code>ecr[:account-id]</code>. In the latter case, lava will connect to the AWS ECR registry in the specified AWS account or the current account if no <code>account-id</code> is specified. If no registry is specified, the default public docker registry is used.</td>
</tr>
<tr>
<td>server</td>
<td>String</td>
<td>No</td>
<td>URL for the docker server. If not specified, then the normal docker environment variables are used. Generally, this means using the local docker daemon accessed via the UNIX socket.</td>
</tr>
<tr>
<td>timeout</td>
<td>Number</td>
<td>No</td>
<td>Timeout on docker API calls in seconds.</td>
</tr>
<tr>
<td>tls</td>
<td>Boolean</td>
<td>No</td>
<td>Use TLS when connecting to the docker server. Default True.</td>
</tr>
<tr>
<td>type</td>
<td>String</td>
<td>Yes</td>
<td><code>docker</code>.</td>
</tr>
<tr>
<td>user</td>
<td>String</td>
<td>No</td>
<td>User name for authenticating to the registry. Required for private docker repositories. Ignored for ECR registries.</td>
</tr>
</tbody>
</table>
<h3 id="accessing-external-registries">Accessing External Registries<a class="headerlink" href="#accessing-external-registries" title="Permanent link">&para;</a></h3>
<p>Lava prefers to obtain its docker images from the local AWS ECR. It's safer,
simpler and more robust than relying on external registries to provide safe,
secure code at run-time, particularly for a production environment.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>If you need to use an external image, copy it to the local AWS ECR and use
it from there. The <a href="11-lava-job-framework.html#the-lava-job-framework">lava job framework</a> will
place the built payloads for docker jobs in ECR. A trivial Dockerfile can
copy an external image as part of the build process.</p>
</div>
<p>If you must do this damn fool thing, lava permits it. There are some considerations:</p>
<ol>
<li>
<p><strong>Private registries</strong> (i.e. requiring authentication to access) will
    require a connection specification as described above, including the 
    registry identifier and credentials. The registry will also be part of the
    image name as usual.</p>
</li>
<li>
<p><strong>Public registries</strong>, such as Docker Hub and public repositories on GitHub
    Container Registry (GHCR), can be addressed by a common connection
    specification containing neither registry, nor credentials. The registry
    will be part of the image name as usual (except for Docker Hub which is the
    default registry).</p>
</li>
<li>
<p><strong>Proxies</strong> can be a problem. Lava will not help you here. The docker daemon
    proxy configuration will need to be handled at the platform level, however
    that is done.</p>
</li>
</ol>
<h3 id="examples">Examples<a class="headerlink" href="#examples" title="Permanent link">&para;</a></h3>
<div class="tabbed-set tabbed-alternate" data-tabs="1:3"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio" /><input id="__tabbed_1_2" name="__tabbed_1" type="radio" /><input id="__tabbed_1_3" name="__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="__tabbed_1_1">ECR Connector</label><label for="__tabbed_1_2">Public Registries</label><label for="__tabbed_1_3">Private Registries</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>This is the standard connection specification for the local AWS ECR.</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-9-1"><span class="p">{</span>
</span><span id="__span-9-2"><span class="w">    </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;docker&quot;</span><span class="p">,</span>
</span><span id="__span-9-3"><span class="w">    </span><span class="nt">&quot;conn_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;docker/ecr&quot;</span><span class="p">,</span>
</span><span id="__span-9-4"><span class="w">    </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Docker ECR connection&quot;</span><span class="p">,</span>
</span><span id="__span-9-5"><span class="w">    </span><span class="nt">&quot;enabled&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-9-6"><span class="w">    </span><span class="nt">&quot;registry&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ecr&quot;</span><span class="p">,</span>
</span><span id="__span-9-7"><span class="p">}</span>
</span></code></pre></div>
</div>
<div class="tabbed-block">
<p>This connection specification should handle most public registries.</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-10-1"><span class="p">{</span>
</span><span id="__span-10-2"><span class="w">    </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;docker&quot;</span><span class="p">,</span>
</span><span id="__span-10-3"><span class="w">    </span><span class="nt">&quot;conn_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;docker/public&quot;</span><span class="p">,</span>
</span><span id="__span-10-4"><span class="w">    </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Docker basic connection (covers public repos)&quot;</span><span class="p">,</span>
</span><span id="__span-10-5"><span class="w">    </span><span class="nt">&quot;enabled&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-10-6"><span class="p">}</span>
</span></code></pre></div>
</div>
<div class="tabbed-block">
<p>This connection specification is for a private registry on the
Github Container Registry:</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-11-1"><span class="p">{</span>
</span><span id="__span-11-2"><span class="w">    </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;docker&quot;</span><span class="p">,</span>
</span><span id="__span-11-3"><span class="w">    </span><span class="nt">&quot;conn_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;docker/ghcr/xyzzy&quot;</span><span class="p">,</span>
</span><span id="__span-11-4"><span class="w">    </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Github Container Registry for user xyzzy&quot;</span><span class="p">,</span>
</span><span id="__span-11-5"><span class="w">    </span><span class="nt">&quot;enabled&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-11-6"><span class="w">    </span><span class="nt">&quot;registry&quot;</span><span class="p">:</span><span class="w"> </span><span class="nt">&quot;ghcr.io&quot;</span>
</span><span id="__span-11-7"><span class="w">    </span><span class="nt">&quot;user&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;not-used-by-ghcr&quot;</span><span class="p">,</span>
</span><span id="__span-11-8"><span class="w">    </span><span class="nt">&quot;password&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/lava/my-realm/ghcr/xyzzy/access-token&quot;</span>
</span><span id="__span-11-9"><span class="p">}</span>
</span></code></pre></div>
</div>
</div>
</div>
<h2 id="connector-type-email">Connector type: email<a class="headerlink" href="#connector-type-email" title="Permanent link">&para;</a></h2>
<p>The <strong>email</strong> connector provides a generic interface for an email sending
subsystem. It is implemented by one or more actual email handlers. The email
subsystem type is selected by the <code>subtype</code> field in the connection
specification. Each subtype may have extra field requirements of its own.</p>
<p>Currently supported email handler subtypes are:</p>
<ul>
<li>
<p><code>ses</code>: AWS Simple Email Service (SES)</p>
</li>
<li>
<p><code>smtp</code>: SMTP, including optional TLS support.</p>
</li>
</ul>
<table>
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>conn_id</td>
<td>String</td>
<td>Yes</td>
<td>Connection identifier.</td>
</tr>
<tr>
<td>description</td>
<td>String</td>
<td>No</td>
<td>Description.</td>
</tr>
<tr>
<td>enabled</td>
<td>Boolean</td>
<td>Yes</td>
<td>Whether or not the connection is enabled.</td>
</tr>
<tr>
<td>from</td>
<td>String</td>
<td>No</td>
<td>The email address that is sending the email. While this is not a mandatory field in the connector, there must be a value available at the time an email is sent, either from the job itself, the connection specification or an email handler specific mechanism. It is strongly recommended to include a default value in the connection specification.</td>
</tr>
<tr>
<td>reply_to</td>
<td>String <em>or</em> List[String]</td>
<td>No</td>
<td>The default reply-to email address(es) for messages.</td>
</tr>
<tr>
<td>subtype</td>
<td>String</td>
<td>No</td>
<td>Specifies the underlying email handler. If not specified, <code>ses</code> is assumed, in which case the field requirements for this subtype must be met.</td>
</tr>
<tr>
<td>type</td>
<td>String</td>
<td>Yes</td>
<td><code>email</code>.</td>
</tr>
</tbody>
</table>
<h3 id="subtype-ses">Subtype: ses<a class="headerlink" href="#subtype-ses" title="Permanent link">&para;</a></h3>
<p>The <code>ses</code> subtype uses AWS Simple Email Service to send email.</p>
<p>The following fields are specific to the <code>ses</code> subtype.</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>configuration_set</td>
<td>String</td>
<td>No</td>
<td>Use the specified SES Configuration Set when sending an email. If not specified, the value specified by the <a href="10-installation-operation.html#general-configuration-parameters">SES_CONFIGURATION_SET</a> realm configuration parameter is used.</td>
</tr>
<tr>
<td>from</td>
<td>String</td>
<td>No</td>
<td>The email address that is sending the email. This email address must be either individually verified with Amazon SES, or from a domain that has been verified with Amazon SES. If not specified, the value specified by the <a href="10-installation-operation.html#general-configuration-parameters">SES_FROM</a> realm configuration parameter is used. A value must be specified by one of these mechanisms.</td>
</tr>
<tr>
<td>region</td>
<td>String</td>
<td>No</td>
<td>The AWS region name for the SES service. If not specified, the value specified by the <a href="10-installation-operation.html#general-configuration-parameters">SES_REGION</a> realm configuration parameter is used, which itself defaults to <code>us-east-1</code>.</td>
</tr>
<tr>
<td>subtype</td>
<td>String</td>
<td>No</td>
<td>Either <code>ses</code> or missing.</td>
</tr>
</tbody>
</table>
<h3 id="subtype-smtp">Subtype: smtp<a class="headerlink" href="#subtype-smtp" title="Permanent link">&para;</a></h3>
<p>The <code>smtp</code> subtype uses standard SMTP to send email. SMTP over TLS is also
supported.</p>
<p>The following fields are specific to the <code>smtp</code> subtype.</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>host</td>
<td>String</td>
<td>Yes</td>
<td>The SMTP server host DNS name or IP address.</td>
</tr>
<tr>
<td>password</td>
<td>String</td>
<td>Sometimes</td>
<td>The name of an encrypted SSM parameter containing the SMTP server password. For a given <code>&lt;REALM&gt;</code>, the SSM parameter name must be of the form <code>/lava/&lt;REALM&gt;/...</code> and the value must be a <strong>secure string</strong> encrypted using the <code>lava-&lt;REALM&gt;-sys</code> KMS key. This field is required if the <code>host</code> field is specified.</td>
</tr>
<tr>
<td>port</td>
<td>Number</td>
<td>No</td>
<td>The SMTP port number. If not specified, the default is 25 without TLS and 465 with TLS. Note that Gmail requires TLS on port 587.</td>
</tr>
<tr>
<td>subtype</td>
<td>String</td>
<td>Yes</td>
<td><code>smtp</code></td>
</tr>
<tr>
<td>tls</td>
<td>Boolean</td>
<td>No</td>
<td>If <code>true</code>, use SMTP over TLS. Default is <code>false</code>.</td>
</tr>
<tr>
<td>user</td>
<td>String</td>
<td>No</td>
<td>SMTP server user name. If specified, the <code>password</code> field must also be specified. If not specified, the connection will be unauthenticated.</td>
</tr>
</tbody>
</table>
<h3 id="using-the-email-connector">Using the Email Connector<a class="headerlink" href="#using-the-email-connector" title="Permanent link">&para;</a></h3>
<p>The <code>email</code> connector provides two distinct interfaces:</p>
<ol>
<li>
<p>A <a href="#python-interface-for-email-connectors">native Python interface</a></p>
</li>
<li>
<p>A <a href="#executable-interface-for-email-connectors">command line interface</a>.</p>
</li>
</ol>
<h4 id="python-interface-for-email-connectors">Python Interface for Email Connectors<a class="headerlink" href="#python-interface-for-email-connectors" title="Permanent link">&para;</a></h4>
<p>Python scripts can directly access the underlying Python interface of an email
connector. In this case, the connector returns a <code>lava.lib.email.Emailer</code>
object as described in the lava API documentation.</p>
<p>As an example, consider an <a href="06-jobs-job-types.html#job-type-exe">exe</a> job specification
that looks something like this:</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-12-1"><span class="p">{</span>
</span><span id="__span-12-2"><span class="w">    </span><span class="nt">&quot;job_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;...&quot;</span><span class="p">,</span>
</span><span id="__span-12-3"><span class="w">    </span><span class="nt">&quot;parameters&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-4"><span class="w">        </span><span class="nt">&quot;connections&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-5"><span class="w">            </span><span class="nt">&quot;email&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;email-connection-id&quot;</span>
</span><span id="__span-12-6"><span class="w">        </span><span class="p">}</span>
</span><span id="__span-12-7"><span class="w">    </span><span class="p">},</span>
</span><span id="__span-12-8"><span class="w">    </span><span class="nt">&quot;payload&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;my-payload.py ...&quot;</span>
</span><span id="__span-12-9"><span class="p">}</span>
</span></code></pre></div>
<p>A Python program can use the email connector like this:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-13-1"><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
</span><span id="__span-13-2"><span class="kn">from</span><span class="w"> </span><span class="nn">lava.connection</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_email_connection</span>
</span><span id="__span-13-3">
</span><span id="__span-13-4"><span class="c1"># If running as a lava exe/pkg/docker, get some info provided by lava in the</span>
</span><span id="__span-13-5"><span class="c1"># environment. Assume our connector is labeled `email` in the job spec.</span>
</span><span id="__span-13-6"><span class="n">realm</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;LAVA_REALM&#39;</span><span class="p">]</span>
</span><span id="__span-13-7"><span class="n">conn_id</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;LAVA_CONNID_EMAIL&#39;</span><span class="p">]</span>
</span><span id="__span-13-8">
</span><span id="__span-13-9"><span class="c1"># We can use the email connection as a context manager</span>
</span><span id="__span-13-10"><span class="k">with</span> <span class="n">get_email_connection</span><span class="p">(</span><span class="n">conn_id</span><span class="p">,</span> <span class="n">realm</span><span class="p">)</span> <span class="k">as</span> <span class="n">emailer</span><span class="p">:</span>
</span><span id="__span-13-11">    <span class="n">emailer</span><span class="o">.</span><span class="n">send</span><span class="p">(</span>
</span><span id="__span-13-12">        <span class="n">subject</span><span class="o">=</span><span class="s1">&#39;Oh no&#39;</span><span class="p">,</span>
</span><span id="__span-13-13">        <span class="n">message</span><span class="o">=</span><span class="s1">&#39;Your oscillation overthruster has malfunctioned&#39;</span><span class="p">,</span>
</span><span id="__span-13-14">        <span class="n">to</span><span class="o">=</span><span class="s1">&#39;Buckaroo.Banzai@dimension8.com&#39;</span><span class="p">,</span>
</span><span id="__span-13-15">        <span class="n">cc</span><span class="o">=</span><span class="p">[</span>
</span><span id="__span-13-16">            <span class="s1">&#39;Professor.Hikita@dimension8.com&#39;</span><span class="p">,</span>
</span><span id="__span-13-17">            <span class="s1">&#39;Sidney Zweibel@dimension8.com&#39;</span>
</span><span id="__span-13-18">        <span class="p">]</span>
</span><span id="__span-13-19">    <span class="p">)</span>
</span></code></pre></div>
<h4 id="executable-interface-for-email-connectors">Executable Interface for Email Connectors<a class="headerlink" href="#executable-interface-for-email-connectors" title="Permanent link">&para;</a></h4>
<p>When used with <a href="06-jobs-job-types.html#job-type-exe">exe</a>,
<a href="06-jobs-job-types.html#job-type-pkg">pkg</a> and
<a href="06-jobs-job-types.html#job-type-docker">docker</a> job types (e.g. shell scripts), the
connection is implemented by the <code>lava-email</code> command.</p>
<p>When used as a connection script within a lava job, the <code>-r REALM</code> and
<code>-c CONN_ID</code> arguments don't need to be provided by the job as these are
provided by lava in the connection script.</p>
<p>Also, values for the <code>--from</code> and <code>--reply-to</code> options will be provided by lava
if it has values available from the connection specification or other
configuration data. These values can be overridden by providing the appropriate
options to then connection script.</p>
<details>
<summary>lava-email Usage</summary>
<div class="language-bare highlight"><pre><span></span><code><span id="__span-14-1"><span class="err">usage:</span><span class="w"> </span><span class="err">lava-email</span><span class="w"> </span><span class="err">[-h]</span><span class="w"> </span><span class="err">[--profile</span><span class="w"> </span><span class="err">PROFILE]</span><span class="w"> </span><span class="err">[-v]</span><span class="w"> </span><span class="err">-c</span><span class="w"> </span><span class="err">CONN_ID</span><span class="w"> </span><span class="err">[-r</span><span class="w"> </span><span class="err">REALM]</span>
</span><span id="__span-14-2"><span class="w">                  </span><span class="err">[--bcc</span><span class="w"> </span><span class="err">EMAIL]</span><span class="w"> </span><span class="err">[--cc</span><span class="w"> </span><span class="err">EMAIL]</span><span class="w"> </span><span class="err">[--from</span><span class="w"> </span><span class="err">EMAIL]</span><span class="w"> </span><span class="err">[--reply-to</span><span class="w"> </span><span class="err">EMAIL]</span>
</span><span id="__span-14-3"><span class="w">                  </span><span class="err">[--to</span><span class="w"> </span><span class="err">EMAIL]</span><span class="w"> </span><span class="err">-s</span><span class="w"> </span><span class="err">SUBJECT</span><span class="w"> </span><span class="err">[--html</span><span class="w"> </span><span class="err">FILENAME]</span><span class="w"> </span><span class="err">[--text</span><span class="w"> </span><span class="err">FILENAME]</span>
</span><span id="__span-14-4"><span class="w">                  </span><span class="err">[--no-colour]</span><span class="w"> </span><span class="err">[-l</span><span class="w"> </span><span class="err">LEVEL]</span><span class="w"> </span><span class="err">[--log</span><span class="w"> </span><span class="err">LOG]</span><span class="w"> </span><span class="err">[--tag</span><span class="w"> </span><span class="err">TAG]</span>
</span><span id="__span-14-5"><span class="w">                  </span><span class="err">[FILENAME]</span>
</span><span id="__span-14-6">
</span><span id="__span-14-7"><span class="err">Send</span><span class="w"> </span><span class="err">email</span><span class="w"> </span><span class="err">using</span><span class="w"> </span><span class="err">lava</span><span class="w"> </span><span class="err">email</span><span class="w"> </span><span class="err">connections.</span>
</span><span id="__span-14-8">
</span><span id="__span-14-9"><span class="err">optional</span><span class="w"> </span><span class="err">arguments:</span>
</span><span id="__span-14-10"><span class="w">  </span><span class="err">-h,</span><span class="w"> </span><span class="err">--help</span><span class="w">            </span><span class="err">show</span><span class="w"> </span><span class="err">this</span><span class="w"> </span><span class="err">help</span><span class="w"> </span><span class="err">message</span><span class="w"> </span><span class="err">and</span><span class="w"> </span><span class="err">exit</span>
</span><span id="__span-14-11"><span class="w">  </span><span class="err">--profile</span><span class="w"> </span><span class="err">PROFILE</span><span class="w">     </span><span class="err">As</span><span class="w"> </span><span class="err">for</span><span class="w"> </span><span class="err">AWS</span><span class="w"> </span><span class="err">CLI.</span>
</span><span id="__span-14-12"><span class="w">  </span><span class="err">-v,</span><span class="w"> </span><span class="err">--version</span><span class="w">         </span><span class="err">show</span><span class="w"> </span><span class="err">program&#39;s</span><span class="w"> </span><span class="err">version</span><span class="w"> </span><span class="err">number</span><span class="w"> </span><span class="err">and</span><span class="w"> </span><span class="err">exit</span>
</span><span id="__span-14-13">
</span><span id="__span-14-14"><span class="err">lava</span><span class="w"> </span><span class="err">arguments:</span>
</span><span id="__span-14-15"><span class="w">  </span><span class="err">-c</span><span class="w"> </span><span class="err">CONN_ID,</span><span class="w"> </span><span class="err">--conn-id</span><span class="w"> </span><span class="err">CONN_ID</span>
</span><span id="__span-14-16"><span class="w">                        </span><span class="err">Lava</span><span class="w"> </span><span class="err">connection</span><span class="w"> </span><span class="err">ID.</span><span class="w"> </span><span class="err">Required.</span>
</span><span id="__span-14-17"><span class="w">  </span><span class="err">-r</span><span class="w"> </span><span class="err">REALM,</span><span class="w"> </span><span class="err">--realm</span><span class="w"> </span><span class="err">REALM</span>
</span><span id="__span-14-18"><span class="w">                        </span><span class="err">Lava</span><span class="w"> </span><span class="err">realm</span><span class="w"> </span><span class="err">name.</span><span class="w"> </span><span class="err">If</span><span class="w"> </span><span class="err">not</span><span class="w"> </span><span class="err">specified,</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">environment</span>
</span><span id="__span-14-19"><span class="w">                        </span><span class="err">variable</span><span class="w"> </span><span class="err">LAVA_REALM</span><span class="w"> </span><span class="err">must</span><span class="w"> </span><span class="err">be</span><span class="w"> </span><span class="err">set.</span>
</span><span id="__span-14-20">
</span><span id="__span-14-21"><span class="err">email</span><span class="w"> </span><span class="err">arguments:</span>
</span><span id="__span-14-22"><span class="w">  </span><span class="err">--bcc</span><span class="w"> </span><span class="err">EMAIL</span><span class="w">           </span><span class="err">Recipients</span><span class="w"> </span><span class="err">to</span><span class="w"> </span><span class="err">place</span><span class="w"> </span><span class="err">on</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">Bcc:</span><span class="w"> </span><span class="err">line</span><span class="w"> </span><span class="err">of</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">message.</span>
</span><span id="__span-14-23"><span class="w">                        </span><span class="err">Can</span><span class="w"> </span><span class="err">be</span><span class="w"> </span><span class="err">used</span><span class="w"> </span><span class="err">multiple</span><span class="w"> </span><span class="err">times.</span>
</span><span id="__span-14-24"><span class="w">  </span><span class="err">--cc</span><span class="w"> </span><span class="err">EMAIL</span><span class="w">            </span><span class="err">Recipients</span><span class="w"> </span><span class="err">to</span><span class="w"> </span><span class="err">place</span><span class="w"> </span><span class="err">on</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">Cc:</span><span class="w"> </span><span class="err">line</span><span class="w"> </span><span class="err">of</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">message.</span>
</span><span id="__span-14-25"><span class="w">                        </span><span class="err">Can</span><span class="w"> </span><span class="err">be</span><span class="w"> </span><span class="err">used</span><span class="w"> </span><span class="err">multiple</span><span class="w"> </span><span class="err">times.</span>
</span><span id="__span-14-26"><span class="w">  </span><span class="err">--from</span><span class="w"> </span><span class="err">EMAIL</span><span class="w">          </span><span class="err">Message</span><span class="w"> </span><span class="err">sender.</span><span class="w"> </span><span class="err">If</span><span class="w"> </span><span class="err">not</span><span class="w"> </span><span class="err">specified,</span><span class="w"> </span><span class="err">a</span><span class="w"> </span><span class="err">value</span><span class="w"> </span><span class="err">must</span><span class="w"> </span><span class="err">be</span>
</span><span id="__span-14-27"><span class="w">                        </span><span class="err">available</span><span class="w"> </span><span class="err">in</span><span class="w"> </span><span class="err">either</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">connection</span><span class="w"> </span><span class="err">specification</span><span class="w"> </span><span class="err">or</span>
</span><span id="__span-14-28"><span class="w">                        </span><span class="err">the</span><span class="w"> </span><span class="err">realm</span><span class="w"> </span><span class="err">specification.</span>
</span><span id="__span-14-29"><span class="w">  </span><span class="err">--reply-to</span><span class="w"> </span><span class="err">EMAIL</span><span class="w">      </span><span class="err">Reply-to</span><span class="w"> </span><span class="err">address</span><span class="w"> </span><span class="err">of</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">message.Can</span><span class="w"> </span><span class="err">be</span><span class="w"> </span><span class="err">used</span><span class="w"> </span><span class="err">multiple</span>
</span><span id="__span-14-30"><span class="w">                        </span><span class="err">times.</span>
</span><span id="__span-14-31"><span class="w">  </span><span class="err">--to</span><span class="w"> </span><span class="err">EMAIL</span><span class="w">            </span><span class="err">Recipients</span><span class="w"> </span><span class="err">to</span><span class="w"> </span><span class="err">place</span><span class="w"> </span><span class="err">on</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">To:</span><span class="w"> </span><span class="err">line</span><span class="w"> </span><span class="err">of</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">message.Can</span>
</span><span id="__span-14-32"><span class="w">                        </span><span class="err">be</span><span class="w"> </span><span class="err">used</span><span class="w"> </span><span class="err">multiple</span><span class="w"> </span><span class="err">times.</span>
</span><span id="__span-14-33"><span class="w">  </span><span class="err">-s</span><span class="w"> </span><span class="err">SUBJECT,</span><span class="w"> </span><span class="err">--subject</span><span class="w"> </span><span class="err">SUBJECT</span>
</span><span id="__span-14-34"><span class="w">                        </span><span class="err">Message</span><span class="w"> </span><span class="err">subject.</span><span class="w"> </span><span class="err">Required.</span>
</span><span id="__span-14-35">
</span><span id="__span-14-36"><span class="err">message</span><span class="w"> </span><span class="err">source</span><span class="w"> </span><span class="err">arguments:</span>
</span><span id="__span-14-37"><span class="w">  </span><span class="err">At</span><span class="w"> </span><span class="err">most</span><span class="w"> </span><span class="err">one</span><span class="w"> </span><span class="err">of</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">following</span><span class="w"> </span><span class="err">arguments</span><span class="w"> </span><span class="err">is</span><span class="w"> </span><span class="err">permitted.</span>
</span><span id="__span-14-38">
</span><span id="__span-14-39"><span class="w">  </span><span class="err">--html</span><span class="w"> </span><span class="err">FILENAME</span><span class="w">       </span><span class="err">This</span><span class="w"> </span><span class="err">is</span><span class="w"> </span><span class="err">a</span><span class="w"> </span><span class="err">legacy</span><span class="w"> </span><span class="err">argument</span><span class="w"> </span><span class="err">for</span><span class="w"> </span><span class="err">backward</span><span class="w"> </span><span class="err">compatibility.</span>
</span><span id="__span-14-40"><span class="w">  </span><span class="err">--text</span><span class="w"> </span><span class="err">FILENAME</span><span class="w">       </span><span class="err">This</span><span class="w"> </span><span class="err">is</span><span class="w"> </span><span class="err">a</span><span class="w"> </span><span class="err">legacy</span><span class="w"> </span><span class="err">argument</span><span class="w"> </span><span class="err">for</span><span class="w"> </span><span class="err">backward</span><span class="w"> </span><span class="err">compatibility.</span>
</span><span id="__span-14-41"><span class="w">  </span><span class="err">FILENAME</span><span class="w">              </span><span class="err">Name</span><span class="w"> </span><span class="err">of</span><span class="w"> </span><span class="err">file</span><span class="w"> </span><span class="err">containing</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">message</span><span class="w"> </span><span class="err">body.</span><span class="w"> </span><span class="err">If</span><span class="w"> </span><span class="err">not</span>
</span><span id="__span-14-42"><span class="w">                        </span><span class="err">specified</span><span class="w"> </span><span class="err">or</span><span class="w"> </span><span class="err">&quot;-&quot;,</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">body</span><span class="w"> </span><span class="err">will</span><span class="w"> </span><span class="err">be</span><span class="w"> </span><span class="err">read</span><span class="w"> </span><span class="err">from</span><span class="w"> </span><span class="err">stdin.</span><span class="w"> </span><span class="err">An</span>
</span><span id="__span-14-43"><span class="w">                        </span><span class="err">attempt</span><span class="w"> </span><span class="err">is</span><span class="w"> </span><span class="err">made</span><span class="w"> </span><span class="err">to</span><span class="w"> </span><span class="err">determine</span><span class="w"> </span><span class="err">if</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">message</span><span class="w"> </span><span class="err">is</span><span class="w"> </span><span class="err">HTML</span><span class="w"> </span><span class="err">and</span>
</span><span id="__span-14-44"><span class="w">                        </span><span class="err">send</span><span class="w"> </span><span class="err">it</span><span class="w"> </span><span class="err">accordingly.</span><span class="w"> </span><span class="err">Only</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">first</span><span class="w"> </span><span class="err">2MB</span><span class="w"> </span><span class="err">is</span><span class="w"> </span><span class="err">read.</span>
</span><span id="__span-14-45">
</span><span id="__span-14-46"><span class="err">logging</span><span class="w"> </span><span class="err">arguments:</span>
</span><span id="__span-14-47"><span class="w">  </span><span class="err">--no-colour,</span><span class="w"> </span><span class="err">--no-color</span>
</span><span id="__span-14-48"><span class="w">                        </span><span class="err">Don&#39;t</span><span class="w"> </span><span class="err">use</span><span class="w"> </span><span class="err">colour</span><span class="w"> </span><span class="err">in</span><span class="w"> </span><span class="err">information</span><span class="w"> </span><span class="err">messages.</span>
</span><span id="__span-14-49"><span class="w">  </span><span class="err">-l</span><span class="w"> </span><span class="err">LEVEL,</span><span class="w"> </span><span class="err">--level</span><span class="w"> </span><span class="err">LEVEL</span>
</span><span id="__span-14-50"><span class="w">                        </span><span class="err">Print</span><span class="w"> </span><span class="err">messages</span><span class="w"> </span><span class="err">of</span><span class="w"> </span><span class="err">a</span><span class="w"> </span><span class="err">given</span><span class="w"> </span><span class="err">severity</span><span class="w"> </span><span class="err">level</span><span class="w"> </span><span class="err">or</span><span class="w"> </span><span class="err">above.</span><span class="w"> </span><span class="err">The</span>
</span><span id="__span-14-51"><span class="w">                        </span><span class="err">standard</span><span class="w"> </span><span class="err">logging</span><span class="w"> </span><span class="err">level</span><span class="w"> </span><span class="err">names</span><span class="w"> </span><span class="err">are</span><span class="w"> </span><span class="err">available</span><span class="w"> </span><span class="err">but</span><span class="w"> </span><span class="err">debug,</span>
</span><span id="__span-14-52"><span class="w">                        </span><span class="err">info,</span><span class="w"> </span><span class="err">warning</span><span class="w"> </span><span class="err">and</span><span class="w"> </span><span class="err">error</span><span class="w"> </span><span class="err">are</span><span class="w"> </span><span class="err">most</span><span class="w"> </span><span class="err">useful.</span><span class="w"> </span><span class="err">The</span><span class="w"> </span><span class="err">default</span>
</span><span id="__span-14-53"><span class="w">                        </span><span class="err">is</span><span class="w"> </span><span class="err">info.</span>
</span><span id="__span-14-54"><span class="w">  </span><span class="err">--log</span><span class="w"> </span><span class="err">LOG</span><span class="w">             </span><span class="err">Log</span><span class="w"> </span><span class="err">to</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">specified</span><span class="w"> </span><span class="err">target.</span><span class="w"> </span><span class="err">This</span><span class="w"> </span><span class="err">can</span><span class="w"> </span><span class="err">be</span><span class="w"> </span><span class="err">either</span><span class="w"> </span><span class="err">a</span><span class="w"> </span><span class="err">file</span>
</span><span id="__span-14-55"><span class="w">                        </span><span class="err">name</span><span class="w"> </span><span class="err">or</span><span class="w"> </span><span class="err">a</span><span class="w"> </span><span class="err">syslog</span><span class="w"> </span><span class="err">facility</span><span class="w"> </span><span class="err">with</span><span class="w"> </span><span class="err">an</span><span class="w"> </span><span class="err">@</span><span class="w"> </span><span class="err">prefix</span><span class="w"> </span><span class="err">(e.g.</span>
</span><span id="__span-14-56"><span class="w">                        </span><span class="err">@local0).</span>
</span><span id="__span-14-57"><span class="w">  </span><span class="err">--tag</span><span class="w"> </span><span class="err">TAG</span><span class="w">             </span><span class="err">Tag</span><span class="w"> </span><span class="err">log</span><span class="w"> </span><span class="err">entries</span><span class="w"> </span><span class="err">with</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">specified</span><span class="w"> </span><span class="err">value.</span><span class="w"> </span><span class="err">The</span><span class="w"> </span><span class="err">default</span>
</span><span id="__span-14-58"><span class="w">                        </span><span class="err">is</span><span class="w"> </span><span class="err">lava-email.</span>
</span></code></pre></div>
</details>
<p>As an example, consider an <a href="06-jobs-job-types.html#job-type-exe">exe</a> job specification
that looks something like this:</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-15-1"><span class="p">{</span>
</span><span id="__span-15-2"><span class="w">    </span><span class="nt">&quot;job_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;...&quot;</span><span class="p">,</span>
</span><span id="__span-15-3"><span class="w">    </span><span class="nt">&quot;parameters&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-4"><span class="w">        </span><span class="nt">&quot;connections&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-5"><span class="w">            </span><span class="nt">&quot;email&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;email-connection-id&quot;</span>
</span><span id="__span-15-6"><span class="w">        </span><span class="p">}</span>
</span><span id="__span-15-7"><span class="w">    </span><span class="p">},</span>
</span><span id="__span-15-8"><span class="w">    </span><span class="nt">&quot;payload&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;my-payload.sh ...&quot;</span>
</span><span id="__span-15-9"><span class="p">}</span>
</span></code></pre></div>
<p>Note the <code>email</code> connection. This will provide the job with an environment
variable <code>LAVA_CONN_EMAIL</code> which points to the executable handling the
connection.</p>
<p>If the job payload is a shell script, the connector would be invoked thus:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-16-1"><span class="c1"># Send an email with a text message body.</span>
</span><span id="__span-16-2"><span class="nv">$LAVA_CONN_EMAIL</span><span class="w"> </span>--to<span class="w"> </span>Buckaroo.Banzai@dimension8.com<span class="w"> </span>--subject<span class="w"> </span><span class="s2">&quot;Oh no&quot;</span><span class="w"> </span>&lt;&lt;!
</span><span id="__span-16-3"><span class="w">    </span>Dear<span class="w"> </span>Buckaroo,
</span><span id="__span-16-4">
</span><span id="__span-16-5"><span class="w">    </span>Your<span class="w"> </span>oscillation<span class="w"> </span>overthruster<span class="w"> </span>has<span class="w"> </span>malfunctioned.
</span><span id="__span-16-6">
</span><span id="__span-16-7"><span class="w">    </span>--<span class="w"> </span>John<span class="w"> </span>Bigboot
</span><span id="__span-16-8">!
</span><span id="__span-16-9">
</span><span id="__span-16-10"><span class="c1"># But wait -- we can do HTML as well</span>
</span><span id="__span-16-11"><span class="nv">$LAVA_CONN_EMAIL</span><span class="w"> </span>--to<span class="w"> </span>Buckaroo.Banzai@dimension8.com<span class="w"> </span>--subject<span class="w"> </span><span class="s2">&quot;Oh no&quot;</span><span class="w"> </span>&lt;&lt;!
</span><span id="__span-16-12">&lt;HTML&gt;
</span><span id="__span-16-13"><span class="w">    </span>&lt;BODY&gt;
</span><span id="__span-16-14"><span class="w">        </span>&lt;P&gt;Dear<span class="w"> </span>Buckaroo,&lt;/P&gt;
</span><span id="__span-16-15"><span class="w">        </span>&lt;P&gt;Your<span class="w"> </span>oscillation<span class="w"> </span>overthruster<span class="w"> </span>has<span class="w"> </span>malfunctioned&lt;/P&gt;
</span><span id="__span-16-16"><span class="w">        </span>&lt;P&gt;--<span class="w"> </span>John<span class="w"> </span>Bigboot&lt;/P&gt;
</span><span id="__span-16-17"><span class="w">    </span>&lt;/BODY&gt;
</span><span id="__span-16-18">&lt;/HTML&gt;
</span><span id="__span-16-19">!
</span></code></pre></div>
<h2 id="connector-type-generic">Connector type: generic<a class="headerlink" href="#connector-type-generic" title="Permanent link">&para;</a></h2>
<p>The <strong>generic</strong> connector provides a general purpose mechanism to group a set of
associated attributes together and have them made available to lava jobs at
run-time. Lava doesn't actually <em>connect</em> to any external resources other than
to obtain attribute values.</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>conn_id</td>
<td>String</td>
<td>Yes</td>
<td>Connection identifier.</td>
</tr>
<tr>
<td>description</td>
<td>String</td>
<td>No</td>
<td>Description.</td>
</tr>
<tr>
<td>enabled</td>
<td>Boolean</td>
<td>Yes</td>
<td>Whether or not the connection is enabled.</td>
</tr>
<tr>
<td>attributes</td>
<td>Map[String,*]</td>
<td>Yes</td>
<td>A map comprising the attributes for the connector. The keys are the attribute names and the values are either simple scalars or another map specifying how to obtain the value. See <a href="#specifying-generic-connector-attribute-values">below</a> for more information.</td>
</tr>
<tr>
<td>type</td>
<td>String</td>
<td>Yes</td>
<td><code>generic</code>.</td>
</tr>
</tbody>
</table>
<h3 id="specifying-generic-connector-attribute-values">Specifying Generic Connector Attribute Values<a class="headerlink" href="#specifying-generic-connector-attribute-values" title="Permanent link">&para;</a></h3>
<p>The <code>attributes</code> field of the <strong>generic</strong> connector specifies the names of the
connector attributes and how the attribute values are obtained. The following
variants are supported.</p>
<h4 id="simple-scalar-attributes">Simple Scalar Attributes<a class="headerlink" href="#simple-scalar-attributes" title="Permanent link">&para;</a></h4>
<p>Simple scalar attributes are specified thus:</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-17-1"><span class="p">{</span>
</span><span id="__span-17-2"><span class="w">  </span><span class="nt">&quot;attributes&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-17-3"><span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;value&quot;</span>
</span><span id="__span-17-4"><span class="w">  </span><span class="p">}</span>
</span><span id="__span-17-5"><span class="p">}</span>
</span></code></pre></div>
<p>In addition to string values, integer and float values are also supported.</p>
<h4 id="local-parameters">Local Parameters<a class="headerlink" href="#local-parameters" title="Permanent link">&para;</a></h4>
<p>This is an alternative syntax to the simple scalar attribute syntax described
above.</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-18-1"><span class="p">{</span>
</span><span id="__span-18-2"><span class="w">  </span><span class="nt">&quot;attributes&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-18-3"><span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-18-4"><span class="w">      </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;local&quot;</span><span class="p">,</span>
</span><span id="__span-18-5"><span class="w">      </span><span class="nt">&quot;value&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;value&quot;</span>
</span><span id="__span-18-6"><span class="w">    </span><span class="p">}</span>
</span><span id="__span-18-7"><span class="w">  </span><span class="p">}</span>
</span><span id="__span-18-8"><span class="p">}</span>
</span></code></pre></div>
<h4 id="ssm-parameters">SSM Parameters<a class="headerlink" href="#ssm-parameters" title="Permanent link">&para;</a></h4>
<p>Values from SSM parameters are specified thus:</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-19-1"><span class="p">{</span>
</span><span id="__span-19-2"><span class="w">  </span><span class="nt">&quot;attributes&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-19-3"><span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-19-4"><span class="w">      </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ssm&quot;</span><span class="p">,</span>
</span><span id="__span-19-5"><span class="w">      </span><span class="nt">&quot;parameter&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;SSM parameter name&quot;</span>
</span><span id="__span-19-6"><span class="w">    </span><span class="p">}</span>
</span><span id="__span-19-7"><span class="w">  </span><span class="p">}</span>
</span><span id="__span-19-8"><span class="p">}</span>
</span></code></pre></div>
<p>Lava will obtain the value from the SSM parameter store, decrypting as required.</p>
<h3 id="example-generic-connector-specification">Example Generic Connector Specification<a class="headerlink" href="#example-generic-connector-specification" title="Permanent link">&para;</a></h3>
<div class="language-json highlight"><pre><span></span><code><span id="__span-20-1"><span class="p">{</span>
</span><span id="__span-20-2"><span class="w">  </span><span class="nt">&quot;conn_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;widget-conn-id&quot;</span><span class="p">,</span>
</span><span id="__span-20-3"><span class="w">  </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Sample generic connector&quot;</span><span class="p">,</span>
</span><span id="__span-20-4"><span class="w">  </span><span class="nt">&quot;enabled&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-20-5"><span class="w">  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;generic&quot;</span><span class="p">,</span>
</span><span id="__span-20-6"><span class="w">  </span><span class="nt">&quot;attributes&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-7"><span class="w">    </span><span class="nt">&quot;a&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;a string&quot;</span><span class="p">,</span>
</span><span id="__span-20-8"><span class="w">    </span><span class="nt">&quot;b&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-9"><span class="w">      </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;local&quot;</span><span class="p">,</span>
</span><span id="__span-20-10"><span class="w">      </span><span class="nt">&quot;value&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">30</span>
</span><span id="__span-20-11"><span class="w">    </span><span class="p">},</span>
</span><span id="__span-20-12"><span class="w">    </span><span class="nt">&quot;c&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-13"><span class="w">      </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ssm&quot;</span><span class="p">,</span>
</span><span id="__span-20-14"><span class="w">      </span><span class="nt">&quot;parameter&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/lava/&lt;REALM&gt;/my_var&quot;</span>
</span><span id="__span-20-15"><span class="w">    </span><span class="p">}</span>
</span><span id="__span-20-16"><span class="w">  </span><span class="p">}</span>
</span><span id="__span-20-17"><span class="p">}</span>
</span></code></pre></div>
<h3 id="using-the-generic-connector">Using the Generic Connector<a class="headerlink" href="#using-the-generic-connector" title="Permanent link">&para;</a></h3>
<p>The <strong>generic</strong> connector provides two distinct interfaces:</p>
<ol>
<li>
<p>A <a href="#python-interface-for-generic-connectors">native Python interface</a></p>
</li>
<li>
<p>A <a href="#executable-interface-for-generic-connectors">command line interface</a>.</p>
</li>
</ol>
<h4 id="python-interface-for-generic-connectors">Python Interface for Generic Connectors<a class="headerlink" href="#python-interface-for-generic-connectors" title="Permanent link">&para;</a></h4>
<p>Python scripts can directly access the underlying Python interface of a <strong>generic</strong>
connector. In this case, the connector returns a dictionary of resolved attribute
values.</p>
<p>As an example, consider an <a href="06-jobs-job-types.html#job-type-exe">exe</a> job specification
that looks something like this:</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-21-1"><span class="p">{</span>
</span><span id="__span-21-2"><span class="w">    </span><span class="nt">&quot;job_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;...&quot;</span><span class="p">,</span>
</span><span id="__span-21-3"><span class="w">    </span><span class="nt">&quot;parameters&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-21-4"><span class="w">        </span><span class="nt">&quot;connections&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-21-5"><span class="w">            </span><span class="nt">&quot;widget&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;widget-connection-id&quot;</span>
</span><span id="__span-21-6"><span class="w">        </span><span class="p">}</span>
</span><span id="__span-21-7"><span class="w">    </span><span class="p">},</span>
</span><span id="__span-21-8"><span class="w">    </span><span class="nt">&quot;payload&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;my-payload.py ...&quot;</span>
</span><span id="__span-21-9"><span class="p">}</span>
</span></code></pre></div>
<p>A Python program can use the <strong>generic</strong> connector like this:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-22-1"><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
</span><span id="__span-22-2"><span class="kn">from</span><span class="w"> </span><span class="nn">lava.connection</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_generic_connection</span>
</span><span id="__span-22-3">
</span><span id="__span-22-4"><span class="c1"># If running as a lava exe/pkg/docker, get some info provided by lava in the</span>
</span><span id="__span-22-5"><span class="c1"># environment. Assume our connector is labeled `widget` in the job spec.</span>
</span><span id="__span-22-6"><span class="n">realm</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;LAVA_REALM&#39;</span><span class="p">]</span>
</span><span id="__span-22-7"><span class="n">conn_id</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;LAVA_CONNID_WIDGET&#39;</span><span class="p">]</span>
</span><span id="__span-22-8">
</span><span id="__span-22-9"><span class="n">attributes</span> <span class="o">=</span> <span class="n">get_generic_connection</span><span class="p">(</span><span class="n">conn_id</span><span class="p">,</span> <span class="n">realm</span><span class="p">)</span>
</span></code></pre></div>
<p>The <code>attributes</code> dictionary would then look like:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-23-1"><span class="p">{</span>
</span><span id="__span-23-2">    <span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="s1">&#39;a string&#39;</span><span class="p">,</span>
</span><span id="__span-23-3">    <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span>
</span><span id="__span-23-4">    <span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="s1">&#39;Value of SSM parameter /lava/&lt;REALM&gt;/my_var&#39;</span>
</span><span id="__span-23-5"><span class="p">}</span>
</span></code></pre></div>
<h4 id="executable-interface-for-generic-connectors">Executable Interface for Generic Connectors<a class="headerlink" href="#executable-interface-for-generic-connectors" title="Permanent link">&para;</a></h4>
<p>When used with <a href="06-jobs-job-types.html#job-type-exe">exe</a>,
<a href="06-jobs-job-types.html#job-type-pkg">pkg</a> and
<a href="06-jobs-job-types.html#job-type-docker">docker</a> job types (e.g. shell scripts), the
connection is implemented by a simple script that can be used to obtain the
value of individual attributes.</p>
<p>As an example, consider an <a href="06-jobs-job-types.html#job-type-exe">exe</a> job specification
that looks something like this:</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-24-1"><span class="p">{</span>
</span><span id="__span-24-2"><span class="w">  </span><span class="nt">&quot;job_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;...&quot;</span><span class="p">,</span>
</span><span id="__span-24-3"><span class="w">  </span><span class="nt">&quot;parameters&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-24-4"><span class="w">    </span><span class="nt">&quot;connections&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-24-5"><span class="w">      </span><span class="nt">&quot;widget&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;widget-connection-id&quot;</span>
</span><span id="__span-24-6"><span class="w">    </span><span class="p">}</span>
</span><span id="__span-24-7"><span class="w">  </span><span class="p">},</span>
</span><span id="__span-24-8"><span class="w">  </span><span class="nt">&quot;payload&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;my-payload.sh ...&quot;</span>
</span><span id="__span-24-9"><span class="p">}</span>
</span></code></pre></div>
<p>Note the <code>widget</code> connection. This will provide the job with an environment
variable <code>LAVA_CONN_WIDGET</code> which points to the executable handling the
connection.</p>
<p>If the job payload is a shell script, the connector would be invoked thus:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-25-1"><span class="c1"># Get the values of the attributes</span>
</span><span id="__span-25-2"><span class="nv">ATTR_A</span><span class="o">=</span><span class="k">$(</span><span class="nv">$LAVA_CONN_WIDGET</span><span class="w"> </span>a<span class="k">)</span>
</span><span id="__span-25-3"><span class="nv">ATTR_B</span><span class="o">=</span><span class="k">$(</span><span class="nv">$LAVA_CONN_WIDGET</span><span class="w"> </span>b<span class="k">)</span>
</span><span id="__span-25-4"><span class="nv">ATTR_C</span><span class="o">=</span><span class="k">$(</span><span class="nv">$LAVA_CONN_WIDGET</span><span class="w"> </span>c<span class="k">)</span>
</span></code></pre></div>
<h2 id="connector-type-git">Connector type: git<a class="headerlink" href="#connector-type-git" title="Permanent link">&para;</a></h2>
<p>The <strong>git</strong> connector manages access to Git repositories by providing support
for managing SSH private keys.</p>
<p>When used with <a href="06-jobs-job-types.html#job-type-exe">exe</a> and
<a href="06-jobs-job-types.html#job-type-pkg">pkg</a> jobs, it provides an environment variable
pointing to a script that will run the Git CLI with SSH keys managed in the
background.</p>
<p>Note that only SSH access to repositories is supported. HTTPS is not supported.</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>conn_id</td>
<td>String</td>
<td>Yes</td>
<td>Connection identifier.</td>
</tr>
<tr>
<td>description</td>
<td>String</td>
<td>No</td>
<td>Description.</td>
</tr>
<tr>
<td>enabled</td>
<td>Boolean</td>
<td>Yes</td>
<td>Whether or not the connection is enabled.</td>
</tr>
<tr>
<td>ssh_key</td>
<td>String</td>
<td>Yes</td>
<td>The name of an encrypted SSM parameter containing the SSH private key. There <strong>must not</strong> be any passphrase on the key. For a given <code>&lt;REALM&gt;</code>, the SSM parameter name must be of the form <code>/lava/&lt;REALM&gt;/...</code> and the value must be a <strong>secure string</strong> encrypted using the <code>lava-&lt;REALM&gt;-sys</code> KMS key. Refer to the <a href="#connector-type-ssh-scp-sftp">ssh connector</a> for more information on how to prepare and store the key.</td>
</tr>
<tr>
<td>ssh_options</td>
<td>List[String]</td>
<td>No</td>
<td>A list of SSH options as per <strong>ssh_config(5)</strong>. e.g. <code>StrictHostKeyChecking=no</code></td>
</tr>
<tr>
<td>type</td>
<td>String</td>
<td>Yes</td>
<td><code>git</code>.</td>
</tr>
</tbody>
</table>
<h2 id="connector-type-mariadb-rds">Connector type: mariadb-rds<a class="headerlink" href="#connector-type-mariadb-rds" title="Permanent link">&para;</a></h2>
<p>This is currently a synonym for <a href="#connector-type-mysql">mysql</a>.</p>
<p>It has been defined in the event of future feature differences between
conventional MySQL and AWS RDS MariaDB.</p>
<h2 id="connector-type-mariadb">Connector type: mariadb<a class="headerlink" href="#connector-type-mariadb" title="Permanent link">&para;</a></h2>
<p>This is a synonym for <a href="#connector-type-mysql">mysql</a>.</p>
<div class="language-text highlight"><pre><span></span><code>## Connector type: mssql
</code></pre></div>
<p>The <strong>mssql</strong> connector handles connections to Microsoft SQL Server databases.</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>conn_id</td>
<td>String</td>
<td>Yes</td>
<td>Connection identifier.</td>
</tr>
<tr>
<td>description</td>
<td>String</td>
<td>No</td>
<td>Description.</td>
</tr>
<tr>
<td>database</td>
<td>String</td>
<td>Yes*</td>
<td>The name of the database within the database server.</td>
</tr>
<tr>
<td>driver</td>
<td>String</td>
<td>No</td>
<td>The ODBC driver specification. This must correspond to the name of a section in <code>/etc/odbcinst.ini</code>. The default is <code>FreeTDS</code>.</td>
</tr>
<tr>
<td>enabled</td>
<td>Boolean</td>
<td>Yes</td>
<td>Whether or not the connection is enabled.</td>
</tr>
<tr>
<td>host</td>
<td>String</td>
<td>Yes*</td>
<td>The database host DNS name or IP address.</td>
</tr>
<tr>
<td>password</td>
<td>String</td>
<td>Yes*</td>
<td>The name of an encrypted SSM parameter containing the password. For a given <code>&lt;REALM&gt;</code>, the SSM parameter name must be of the form <code>/lava/&lt;REALM&gt;/...</code> and the value must be a <strong>secure string</strong> encrypted using the <code>lava-&lt;REALM&gt;-sys</code> KMS key.</td>
</tr>
<tr>
<td>port</td>
<td>Number</td>
<td>Yes*</td>
<td>The database port number.</td>
</tr>
<tr>
<td>preserve_case</td>
<td>Boolean</td>
<td>No</td>
<td>If <code>true</code>, don't fold database object names to lower case when quoting them for use in <a href="06-jobs-job-types.html#job-type-db_from_s3">db_from_s3</a> jobs. The default is <code>false</code> (i.e. case folding is enabled).</td>
</tr>
<tr>
<td>secret_id</td>
<td>String</td>
<td>No</td>
<td>Obtain missing fields from AWS Secrets Manager. <a href="#database-authentication-using-aws-secrets-manager">More information</a>.</td>
</tr>
<tr>
<td>subtype</td>
<td>String</td>
<td>No</td>
<td>Specifies the underlying DBAPI 2.0 driver. The default and only allowed value is <code>pyodbc</code>.</td>
</tr>
<tr>
<td>timeout</td>
<td>Integer</td>
<td>No</td>
<td>Connection timeout in seconds. If not specified, no timeout is applied.</td>
</tr>
<tr>
<td>type</td>
<td>String</td>
<td>Yes</td>
<td><code>mssql</code>.</td>
</tr>
<tr>
<td>user</td>
<td>String</td>
<td>Yes*</td>
<td>Database user name.</td>
</tr>
</tbody>
</table>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>Fields with a <strong>Required</strong> column marked with <code>*</code> can have a value provided
directly in the connection specification or indirectly via AWS Secrets
Manager using the <code>secret_id</code> field.  See <a href="#database-authentication-using-aws-secrets-manager">Database Authentication Using AWS
Secrets Manager</a> for
more information.</p>
</div>
<p>SSL connections are not currently supported.</p>
<p>When used with <a href="06-jobs-job-types.html#job-type-exe">exe</a> and
<a href="06-jobs-job-types.html#job-type-pkg">pkg</a> job types, the connection is implemented by
the <a href="16-commands-utilities.html#lava-sql-utility">lava-sql</a> CLI.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>There are some MSSQL CLI tools that come with the TDS or unixODBC packages.
None of them are wonderful so for now <code>lava-sql</code> will have to do. Also not
wonderful but what do you expect for free?</p>
</div>
<h3 id="implementation-notes">Implementation Notes<a class="headerlink" href="#implementation-notes" title="Permanent link">&para;</a></h3>
<p>The current implementation requires the following components be installed and
configured on the lava worker:</p>
<ul>
<li>
<p><a href="http://www.freetds.org/">Free TDS</a></p>
</li>
<li>
<p><a href="http://www.unixodbc.org">unixODBC</a></p>
</li>
<li>
<p><a href="https://pypi.org/project/pyodbc/">pyodbc</a></p>
</li>
</ul>
<p><a href="http://www.unixodbc.org/doc/FreeTDS.html">Configuring unixODBC with Free TDS</a></p>
<h2 id="connector-type-mysql-aurora">Connector type: mysql-aurora<a class="headerlink" href="#connector-type-mysql-aurora" title="Permanent link">&para;</a></h2>
<p>The <strong>mysql-aurora</strong> connector handles connections to AWS RDS Aurora MySQL
database clusters. This is almost a synonym for
<a href="#connector-type-mysql">mysql</a>. Key differences are:</p>
<ul>
<li>
<p>The <a href="06-jobs-job-types.html#job-type-db_from_s3">db_from_s3</a> job can take
    advantage of an AWS facility to load data directly from S3.</p>
</li>
<li>
<p><a href="#creating-temporary-iam-user-credentials-for-aws-rds-aurora-mysql">Database authentication using IAM credential generation</a> is supported.</p>
</li>
</ul>
<table>
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>ca_cert</td>
<td>String</td>
<td>No</td>
<td>The name of a file containing the CA certificate for the database server. Ignored unless <code>ssl</code> is <code>true</code>.</td>
</tr>
<tr>
<td>conn_id</td>
<td>String</td>
<td>Yes</td>
<td>Connection identifier.</td>
</tr>
<tr>
<td>description</td>
<td>String</td>
<td>No</td>
<td>Description.</td>
</tr>
<tr>
<td>database</td>
<td>String</td>
<td>Yes*</td>
<td>The name of the database (schema) within the database server.</td>
</tr>
<tr>
<td>enabled</td>
<td>Boolean</td>
<td>Yes</td>
<td>Whether or not the connection is enabled.</td>
</tr>
<tr>
<td>host</td>
<td>String</td>
<td>Yes*</td>
<td>The database host DNS name or IP address.</td>
</tr>
<tr>
<td>password</td>
<td>String</td>
<td>No*</td>
<td>The name of an encrypted SSM parameter containing the password. For a given <code>&lt;REALM&gt;</code>, the SSM parameter name must be of the form <code>/lava/&lt;REALM&gt;/...</code> and the value must be a <strong>secure string</strong> encrypted using the <code>lava-&lt;REALM&gt;-sys</code> KMS key. If not specified, the worker will attempt to <a href="#creating-temporary-iam-user-credentials-for-aws-rds-aurora-mysql">generate temporary IAM user credentials</a>.</td>
</tr>
<tr>
<td>port</td>
<td>Number</td>
<td>Yes*</td>
<td>The database port number.</td>
</tr>
<tr>
<td>preserve_case</td>
<td>Boolean</td>
<td>No</td>
<td>If <code>true</code>, don't fold database object names to lower case when quoting them for use in <a href="06-jobs-job-types.html#job-type-db_from_s3">db_from_s3</a> jobs. The default is <code>false</code> (i.e. case folding is enabled).</td>
</tr>
<tr>
<td>secret_id</td>
<td>String</td>
<td>No</td>
<td>Obtain missing fields from AWS Secrets Manager. <a href="#database-authentication-using-aws-secrets-manager">More information</a>.</td>
</tr>
<tr>
<td>ssl</td>
<td>Boolean</td>
<td>No</td>
<td>Set to <code>true</code> to enable SSL. Default is <code>false</code>.</td>
</tr>
<tr>
<td>type</td>
<td>String</td>
<td>Yes</td>
<td><code>mysql-aurora</code></td>
</tr>
<tr>
<td>user</td>
<td>String</td>
<td>Yes*</td>
<td>Database user name.</td>
</tr>
</tbody>
</table>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>Fields with a <strong>Required</strong> column marked with <code>*</code> can have a value provided
directly in the connection specification or indirectly via AWS Secrets
Manager using the <code>secret_id</code> field.  See <a href="#database-authentication-using-aws-secrets-manager">Database Authentication Using AWS
Secrets Manager</a> for
more information.</p>
</div>
<p>When used with <a href="06-jobs-job-types.html#job-type-exe">exe</a> and
<a href="06-jobs-job-types.html#job-type-pkg">pkg</a> job types, the connection is implemented by
the <code>mysql</code> CLI.  Apart from the connection parameters, it is invoked with the
following options:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-26-1">mysql<span class="w"> </span>--batch<span class="w"> </span>--connect-timeout<span class="o">=</span><span class="m">10</span>
</span></code></pre></div>
<h3 id="creating-temporary-iam-user-credentials-for-aws-rds-aurora-mysql">Creating Temporary IAM User Credentials for AWS RDS Aurora MySQL<a class="headerlink" href="#creating-temporary-iam-user-credentials-for-aws-rds-aurora-mysql" title="Permanent link">&para;</a></h3>
<p>If the <code>password</code> field is not present in the connection specification, lava
will attempt to
<a href="https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/UsingWithRDS.IAMDBAuth.html">generate temporary IAM credentials</a> using the <code>generate-db-auth-token</code> mechanism.</p>
<p>The specified user must already exist in the database. Enable IAM
authentication for a user thus:</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-27-1"><span class="k">CREATE</span><span class="w"> </span><span class="k">USER</span><span class="w"> </span><span class="n">a_user</span><span class="w"> </span><span class="n">IDENTIFIED</span><span class="w"> </span><span class="k">WITH</span><span class="w"> </span><span class="n">AWSAuthenticationPlugin</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="s1">&#39;RDS&#39;</span><span class="p">;</span>
</span></code></pre></div>
<p>The IAM policy attached to the worker will need to contain an element something
like this:</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-28-1"><span class="nt">&quot;Statement&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-28-2"><span class="w">    </span><span class="p">{</span>
</span><span id="__span-28-3"><span class="w">        </span><span class="nt">&quot;Sid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;GetRdsCreds&quot;</span><span class="p">,</span>
</span><span id="__span-28-4"><span class="w">        </span><span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
</span><span id="__span-28-5"><span class="w">        </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;rds-db:connect&quot;</span><span class="p">,</span>
</span><span id="__span-28-6"><span class="w">        </span><span class="nt">&quot;Resource&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-28-7"><span class="w">            </span><span class="s2">&quot;arn:aws:rds-db:ap-southeast-2:123456789012:dbuser:db-JMH2...6KW6Q/a_user&quot;</span>
</span><span id="__span-28-8"><span class="w">        </span><span class="p">]</span>
</span><span id="__span-28-9"><span class="w">    </span><span class="p">}</span>
</span><span id="__span-28-10"><span class="p">]</span>
</span></code></pre></div>
<p>The DB instance ID for use in the IAM policy can be obtained thus:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-29-1">aws<span class="w"> </span>rds<span class="w"> </span>describe-db-instances<span class="w"> </span>--db-instance-identifier<span class="w"> </span><span class="s1">&#39;DB_ID&#39;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-29-2"><span class="w">     </span>--query<span class="w"> </span><span class="s1">&#39;DBInstances[0].DbiResourceId&#39;</span><span class="w"> </span>--output<span class="w"> </span>text
</span></code></pre></div>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>SSL is mandatory when using temporary IAM user credentials.</p>
</div>
<h2 id="connector-type-mysql-rds">Connector type: mysql-rds<a class="headerlink" href="#connector-type-mysql-rds" title="Permanent link">&para;</a></h2>
<p>This is currently a synonym for
<a href="#connector-type-mysql-aurora">mysql-aurora</a>.</p>
<p>It has been defined in the event of future feature differences between
conventional AWS RDS Aurora MySQL and AWS RDS MySQL.</p>
<h2 id="connector-type-mysql">Connector type: mysql<a class="headerlink" href="#connector-type-mysql" title="Permanent link">&para;</a></h2>
<p>The <strong>mysql</strong> connector handles connections to MySQL compatible databases.</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>ca_cert</td>
<td>String</td>
<td>No</td>
<td>The name of a file containing the CA certificate for the database server. Ignored unless <code>ssl</code> is <code>true</code>.</td>
</tr>
<tr>
<td>conn_id</td>
<td>String</td>
<td>Yes</td>
<td>Connection identifier.</td>
</tr>
<tr>
<td>description</td>
<td>String</td>
<td>No</td>
<td>Description.</td>
</tr>
<tr>
<td>database</td>
<td>String</td>
<td>Yes*</td>
<td>The name of the database (schema) within the database server.</td>
</tr>
<tr>
<td>enabled</td>
<td>Boolean</td>
<td>Yes</td>
<td>Whether or not the connection is enabled.</td>
</tr>
<tr>
<td>host</td>
<td>String</td>
<td>Yes*</td>
<td>The database host DNS name or IP address.</td>
</tr>
<tr>
<td>password</td>
<td>String</td>
<td>Yes*</td>
<td>The name of an encrypted SSM parameter containing the password. For a given <code>&lt;REALM&gt;</code>, the SSM parameter name must be of the form <code>/lava/&lt;REALM&gt;/...</code> and the value must be a <strong>secure string</strong> encrypted using the <code>lava-&lt;REALM&gt;-sys</code> KMS key.</td>
</tr>
<tr>
<td>port</td>
<td>Number</td>
<td>Yes*</td>
<td>The database port number.</td>
</tr>
<tr>
<td>preserve_case</td>
<td>Boolean</td>
<td>No</td>
<td>If <code>true</code>, don't fold database object names to lower case when quoting them for use in <a href="06-jobs-job-types.html#job-type-db_from_s3">db_from_s3</a> jobs. The default is <code>false</code> (i.e. case folding is enabled).</td>
</tr>
<tr>
<td>secret_id</td>
<td>String</td>
<td>No</td>
<td>Obtain missing fields from AWS Secrets Manager. <a href="#database-authentication-using-aws-secrets-manager">More information</a>.</td>
</tr>
<tr>
<td>ssl</td>
<td>Boolean</td>
<td>No</td>
<td>Set to <code>true</code> to enable SSL. Default is <code>false</code>.</td>
</tr>
<tr>
<td>type</td>
<td>String</td>
<td>Yes</td>
<td><code>mysql</code>.</td>
</tr>
<tr>
<td>user</td>
<td>String</td>
<td>Yes*</td>
<td>Database user name.</td>
</tr>
</tbody>
</table>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>Fields with a <strong>Required</strong> column marked with <code>*</code> can have a value provided
directly in the connection specification or indirectly via AWS Secrets
Manager using the <code>secret_id</code> field.  See <a href="#database-authentication-using-aws-secrets-manager">Database Authentication Using AWS
Secrets Manager</a> for
more information.</p>
</div>
<p>When used with <a href="06-jobs-job-types.html#job-type-exe">exe</a> and
<a href="06-jobs-job-types.html#job-type-pkg">pkg</a> job types, the connection is implemented by
the <code>mysql</code> CLI, either the MySQL Community version, or the MariaDB version,
depending on the variant installed on the worker. These have some minor CLI
parameter differences which lava manages for the connection parameters. Apart
from the connection parameters, it is invoked with the following options:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-30-1">mysql<span class="w"> </span>--batch<span class="w"> </span>--connect-timeout<span class="o">=</span><span class="m">10</span>
</span></code></pre></div>
<h2 id="connector-type-oracle-rds">Connector type: oracle-rds<a class="headerlink" href="#connector-type-oracle-rds" title="Permanent link">&para;</a></h2>
<p>This is currently a synonym for
<a href="#connector-type-oracle">oracle</a>.</p>
<p>It has been defined in the event of future feature differences between
conventional Oracle and AWS RDS Oracle.</p>
<h2 id="connector-type-oracle">Connector type: oracle<a class="headerlink" href="#connector-type-oracle" title="Permanent link">&para;</a></h2>
<p>The <strong>oracle</strong> connector handles connections to Oracle databases.</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>conn_id</td>
<td>String</td>
<td>Yes</td>
<td>Connection identifier.</td>
</tr>
<tr>
<td>database</td>
<td>String</td>
<td>No*</td>
<td>A deprecated synonym for <code>sid</code>.</td>
</tr>
<tr>
<td>description</td>
<td>String</td>
<td>No</td>
<td>Description.</td>
</tr>
<tr>
<td>edition</td>
<td>String</td>
<td>No</td>
<td>Oracle version for compatibility in the form <code>x.y[.z]</code>.</td>
</tr>
<tr>
<td>enabled</td>
<td>Boolean</td>
<td>Yes</td>
<td>Whether or not the connection is enabled.</td>
</tr>
<tr>
<td>host</td>
<td>String</td>
<td>Yes*</td>
<td>The database host DNS name or IP address.</td>
</tr>
<tr>
<td>password</td>
<td>String</td>
<td>Yes*</td>
<td>The name of an encrypted SSM parameter containing the password. For a given <code>&lt;REALM&gt;</code>, the SSM parameter name must be of the form <code>/lava/&lt;REALM&gt;/...</code> and the value must be a <strong>secure string</strong> encrypted using the <code>lava-&lt;REALM&gt;-sys</code> KMS key.</td>
</tr>
<tr>
<td>port</td>
<td>Number</td>
<td>Yes*</td>
<td>The database port number.</td>
</tr>
<tr>
<td>secret_id</td>
<td>String</td>
<td>No</td>
<td>Obtain missing fields from AWS Secrets Manager. <a href="#database-authentication-using-aws-secrets-manager">More information</a>.</td>
</tr>
<tr>
<td>service_name</td>
<td>String</td>
<td>No*</td>
<td>The Oracle data base service name. Generally exactly one of <code>service_name</code> or <code>sid</code> must be specified.</td>
</tr>
<tr>
<td>sid</td>
<td>String</td>
<td>No*</td>
<td>The Oracle System Identifier of the database. Generally exactly one of <code>service_name</code> or <code>sid</code> must be specified.</td>
</tr>
<tr>
<td>type</td>
<td>String</td>
<td>Yes</td>
<td><code>oracle</code>.</td>
</tr>
<tr>
<td>user</td>
<td>String</td>
<td>Yes*</td>
<td>Database user name.</td>
</tr>
</tbody>
</table>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>Fields with a <strong>Required</strong> column marked with <code>*</code> can have a value provided
directly in the connection specification or indirectly via AWS Secrets
Manager using the <code>secret_id</code> field.  See <a href="#database-authentication-using-aws-secrets-manager">Database Authentication Using AWS
Secrets Manager</a> for
more information.</p>
</div>
<p>When used with <a href="06-jobs-job-types.html#job-type-exe">exe</a> and
<a href="06-jobs-job-types.html#job-type-pkg">pkg</a> job types, the connection is implemented by
the <a href="https://docs.oracle.com/en/database/oracle/oracle-database/18/sqpug/toc.htm">SQL*Plus
CLI</a>,
<code>sqlplus</code>.  Apart from the connection parameters, it is invoked with the
following options:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-31-1">sqlplus<span class="w"> </span>-NOLOGINTIME<span class="w"> </span>-L<span class="w"> </span>-S<span class="w"> </span>-C<span class="w"> </span>&lt;version&gt;
</span></code></pre></div>
<p>The SQL*Plus CLI is a particularly contrary beast. It is important to explicitly
exit the CLI using an <code>EXIT</code> command at the end of any session or else it will
drop into interactive mode and sit there waiting for further commands until the
job reaches its timeout and is killed by lava. A safer approach is to send
commands to the connector via stdin, thus:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-32-1"><span class="c1"># Assume our conn_id is ora</span>
</span><span id="__span-32-2">
</span><span id="__span-32-3"><span class="nv">$LAVA_CONN_ORA</span><span class="w"> </span>&lt;&lt;!
</span><span id="__span-32-4">SELECT<span class="w"> </span>whatever<span class="w"> </span>FROM<span class="w"> </span>whichever<span class="p">;</span>
</span><span id="__span-32-5">!
</span></code></pre></div>
<p>When used with <a href="06-jobs-job-types.html#job-type-sql">sql</a> jobs, do not terminate the
SQL with a semi-colon or a syntax error results.</p>
<p>When used with <a href="06-jobs-job-types.html#job-type-sqlc">sqlc</a> jobs, SQL commands must be
terminated with a semi-colon or either a syntax error or no output will result.</p>
<h3 id="security-warnings">Security Warnings<a class="headerlink" href="#security-warnings" title="Permanent link">&para;</a></h3>
<p>Oracle CLI clients, including <code>sqlplus</code>, do not provide any means to automate
login to the database without specifying the password on the command line. This
means the password is exposed in a process listing. <strong>Do not</strong> use the
<strong>oracle</strong> command line connector on any worker that has multi-user access.</p>
<p>The <strong>oracle</strong> connector does not currently support SSL/TLS.</p>
<h2 id="connector-type-postgres-aurora">Connector type: postgres-aurora<a class="headerlink" href="#connector-type-postgres-aurora" title="Permanent link">&para;</a></h2>
<p>This connector support AWS RDS Aurora PostgreSQL clusters. This is almost a
synonym for <a href="#connector-type-postgres">postgres</a>.
Key differences are:</p>
<ul>
<li>
<p>The <a href="06-jobs-job-types.html#job-type-db_from_s3">db_from_s3</a> job can take
    advantage of an AWS facility to load data directly from S3.</p>
</li>
<li>
<p><a href="#creating-temporary-iam-user-credentials-for-aws-rds-aurora-postgresql">Database authentication using IAM credential generation</a>
    is supported.</p>
</li>
</ul>
<table>
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>conn_id</td>
<td>String</td>
<td>Yes</td>
<td>Connection identifier.</td>
</tr>
<tr>
<td>database</td>
<td>String</td>
<td>Yes*</td>
<td>The name of the database within the database server.</td>
</tr>
<tr>
<td>description</td>
<td>String</td>
<td>No</td>
<td>Description.</td>
</tr>
<tr>
<td>enabled</td>
<td>Boolean</td>
<td>Yes</td>
<td>Whether or not the connection is enabled.</td>
</tr>
<tr>
<td>host</td>
<td>String</td>
<td>Yes*</td>
<td>The database host DNS name or IP address.</td>
</tr>
<tr>
<td>password</td>
<td>String</td>
<td>No*</td>
<td>The name of an encrypted SSM parameter containing the password. For a given <code>&lt;REALM&gt;</code>, the SSM parameter name must be of the form <code>/lava/&lt;REALM&gt;/...</code> and the value must be a <strong>secure string</strong> encrypted using the <code>lava-&lt;REALM&gt;-sys</code> KMS key. If not specified, the worker will attempt to <a href="#creating-temporary-iam-user-credentials-for-aws-rds-aurora-postgresql">generate temporary IAM user credentials</a>.</td>
</tr>
<tr>
<td>port</td>
<td>Number</td>
<td>Yes*</td>
<td>The database port number.</td>
</tr>
<tr>
<td>preserve_case</td>
<td>Boolean</td>
<td>No</td>
<td>If <code>true</code>, don't fold database object names to lower case when quoting them for use in <a href="06-jobs-job-types.html#job-type-db_from_s3">db_from_s3</a> jobs. The default is <code>false</code> (i.e. case folding is enabled).</td>
</tr>
<tr>
<td>secret_id</td>
<td>String</td>
<td>No</td>
<td>Obtain missing fields from AWS Secrets Manager. <a href="#database-authentication-using-aws-secrets-manager">More information</a>.</td>
</tr>
<tr>
<td>ssl</td>
<td>Boolean</td>
<td>No</td>
<td>Set to <code>true</code> to enable SSL. Default is <code>false</code></td>
</tr>
<tr>
<td>subtype</td>
<td>String</td>
<td>No</td>
<td>Specifies the underlying DBAPI 2.0 driver. The default is <code>pg8000</code> which should be used wherever possible. The <code>pygresql</code> driver is also available.</td>
</tr>
<tr>
<td>type</td>
<td>String</td>
<td>Yes</td>
<td><code>psql</code> or <code>postgres</code>.</td>
</tr>
<tr>
<td>user</td>
<td>String</td>
<td>Yes*</td>
<td>Database user name.</td>
</tr>
</tbody>
</table>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>Fields with a <strong>Required</strong> column marked with <code>*</code> can have a value provided
directly in the connection specification or indirectly via AWS Secrets
Manager using the <code>secret_id</code> field.  See <a href="#database-authentication-using-aws-secrets-manager">Database Authentication Using AWS
Secrets Manager</a> for
more information.</p>
</div>
<p>When used with <a href="06-jobs-job-types.html#job-type-exe">exe</a> and
<a href="06-jobs-job-types.html#job-type-pkg">pkg</a> job types, the connection is implemented by
the <code>psql</code> CLI.  Apart from the connection parameters, it is invoked with the
following options:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-33-1">psql<span class="w"> </span>--no-psqlrc<span class="w"> </span>--quiet<span class="w"> </span>--set<span class="w"> </span><span class="nv">ON_ERROR_STOP</span><span class="o">=</span>on<span class="w"> </span>--pset<span class="w"> </span><span class="nv">footer</span><span class="o">=</span>off
</span></code></pre></div>
<h3 id="creating-temporary-iam-user-credentials-for-aws-rds-aurora-postgresql">Creating Temporary IAM User Credentials for AWS RDS Aurora PostgreSQL<a class="headerlink" href="#creating-temporary-iam-user-credentials-for-aws-rds-aurora-postgresql" title="Permanent link">&para;</a></h3>
<p>If the <code>password</code> field is not present in the connection specification, lava
will attempt to
<a href="https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/UsingWithRDS.IAMDBAuth.html">generate temporary IAM credentials</a> using the <code>generate-db-auth-token</code> mechanism.</p>
<p>The specified user must already exist in the database. Enable IAM authentication
for a user thus:</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-34-1"><span class="k">CREATE</span><span class="w"> </span><span class="k">USER</span><span class="w"> </span><span class="n">a_user</span><span class="p">;</span><span class="w"> </span>
</span><span id="__span-34-2"><span class="k">GRANT</span><span class="w"> </span><span class="n">rds_iam</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="n">a_user</span><span class="p">;</span>
</span></code></pre></div>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>SSL is mandatory when using temporary IAM user credentials.</p>
</div>
<h3 id="psql-cli-password-limitations">Psql CLI Password Limitations<a class="headerlink" href="#psql-cli-password-limitations" title="Permanent link">&para;</a></h3>
<p>The psql CLI will not accept passwords in a PGPASS file (or entered
interactively) that are longer than a certain (undocumented) length. IAM based
authentication for RDS involves temporary passwords that are much longer than
this limit.</p>
<p>To workaround this limitation, lava has to put long passwords into an
environment variable. While this is not ideal from a security perspective, at
least the passwords are short lived.</p>
<h2 id="connector-type-postgres-rds">Connector type: postgres-rds<a class="headerlink" href="#connector-type-postgres-rds" title="Permanent link">&para;</a></h2>
<p>This is currently a synonym for
<a href="#connector-type-postgres-aurora">postgres-aurora</a>.</p>
<p>It has been defined in the event of future feature differences between
conventional AWS RDS Aurora PostgreSQL and AWS RDS PostgreSQL.</p>
<h2 id="connector-type-postgres">Connector type: postgres<a class="headerlink" href="#connector-type-postgres" title="Permanent link">&para;</a></h2>
<p>The <strong>postgres</strong> connector handles connections to Postgres compatible databases.</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>conn_id</td>
<td>String</td>
<td>Yes</td>
<td>Connection identifier.</td>
</tr>
<tr>
<td>database</td>
<td>String</td>
<td>Yes*</td>
<td>The name of the database within the database server.</td>
</tr>
<tr>
<td>description</td>
<td>String</td>
<td>No</td>
<td>Description.</td>
</tr>
<tr>
<td>enabled</td>
<td>Boolean</td>
<td>Yes</td>
<td>Whether or not the connection is enabled.</td>
</tr>
<tr>
<td>host</td>
<td>String</td>
<td>Yes*</td>
<td>The database host DNS name or IP address.</td>
</tr>
<tr>
<td>password</td>
<td>String</td>
<td>Yes*</td>
<td>The name of an encrypted SSM parameter containing the password. For a given <code>&lt;REALM&gt;</code>, the SSM parameter name must be of the form <code>/lava/&lt;REALM&gt;/...</code> and the value must be a <strong>secure string</strong> encrypted using the <code>lava-&lt;REALM&gt;-sys</code> KMS key.</td>
</tr>
<tr>
<td>port</td>
<td>Number</td>
<td>Yes*</td>
<td>The database port number.</td>
</tr>
<tr>
<td>preserve_case</td>
<td>Boolean</td>
<td>No</td>
<td>If <code>true</code>, don't fold database object names to lower case when quoting them for use in <a href="06-jobs-job-types.html#job-type-db_from_s3">db_from_s3</a> jobs. The default is <code>false</code> (i.e. case folding is enabled).</td>
</tr>
<tr>
<td>secret_id</td>
<td>String</td>
<td>No</td>
<td>Obtain missing fields from AWS Secrets Manager. <a href="#database-authentication-using-aws-secrets-manager">More information</a>.</td>
</tr>
<tr>
<td>ssl</td>
<td>Boolean</td>
<td>No</td>
<td>Set to <code>true</code> to enable SSL. Default is <code>false</code></td>
</tr>
<tr>
<td>subtype</td>
<td>String</td>
<td>No</td>
<td>Specifies the underlying DBAPI 2.0 driver. The default is <code>pg8000</code> which should be used wherever possible. The <code>pygresql</code> driver is also available.</td>
</tr>
<tr>
<td>type</td>
<td>String</td>
<td>Yes</td>
<td><code>psql</code> or <code>postgres</code>.</td>
</tr>
<tr>
<td>user</td>
<td>String</td>
<td>Yes*</td>
<td>Database user name.</td>
</tr>
</tbody>
</table>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>Fields with a <strong>Required</strong> column marked with <code>*</code> can have a value provided
directly in the connection specification or indirectly via AWS Secrets
Manager using the <code>secret_id</code> field.  See <a href="#database-authentication-using-aws-secrets-manager">Database Authentication Using AWS
Secrets Manager</a> for
more information.</p>
</div>
<p>When used with <a href="06-jobs-job-types.html#job-type-exe">exe</a> and
<a href="06-jobs-job-types.html#job-type-pkg">pkg</a> job types, the connection is implemented by
the <code>psql</code> CLI.  Apart from the connection parameters, it is invoked with the
following options:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-35-1">psql<span class="w"> </span>--no-psqlrc<span class="w"> </span>--quiet<span class="w"> </span>--set<span class="w"> </span><span class="nv">ON_ERROR_STOP</span><span class="o">=</span>on<span class="w"> </span>--pset<span class="w"> </span><span class="nv">footer</span><span class="o">=</span>off
</span></code></pre></div>
<h2 id="connector-type-psql">Connector type: psql<a class="headerlink" href="#connector-type-psql" title="Permanent link">&para;</a></h2>
<p>This is a synonym for <a href="#connector-type-postgres">postgres</a>.</p>
<h2 id="connector-type-redshift-serverless">Connector type: redshift-serverless<a class="headerlink" href="#connector-type-redshift-serverless" title="Permanent link">&para;</a></h2>
<p>This is the connector for Redshift Serverless clusters.</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>conn_id</td>
<td>String</td>
<td>Yes</td>
<td>Connection identifier.</td>
</tr>
<tr>
<td>database</td>
<td>String</td>
<td>Yes*</td>
<td>The name of the database within the Redshift Serverless namespace.</td>
</tr>
<tr>
<td>description</td>
<td>String</td>
<td>No</td>
<td>Description.</td>
</tr>
<tr>
<td>enabled</td>
<td>Boolean</td>
<td>Yes</td>
<td>Whether or not the connection is enabled.</td>
</tr>
<tr>
<td>external_id</td>
<td>String</td>
<td>No</td>
<td>Name of an SSM parameter containing an external ID to use when assuming the IAM role specified by <code>role_arn</code> when <a href="#creating-temporary-iam-user-credentials-for-redshift-serverless">generating temporary IAM user credentials</a>. While AWS does not consider this to be a sensitive security parameter, it is stored in the SSM parameter store for ease of management. It is still recommended to use a secure parameter. Can't hurt.</td>
</tr>
<tr>
<td>host</td>
<td>String</td>
<td>Yes*</td>
<td>The Redshift serverless workgroup endpoint address.</td>
</tr>
<tr>
<td>password_duration</td>
<td>String</td>
<td>No</td>
<td>The password duration when <a href="#creating-temporary-iam-user-credentials-for-redshift-serverless">generating temporary IAM user credentials</a> in the form <code>nnX</code> where <code>nn</code> is a number and <code>X</code> is <code>s</code> (seconds), <code>m</code> (minutes) or <code>h</code> (hours). If not specified, the <a href="10-installation-operation.html#configuration-for-the-redshift-serverless-connector">default worker configuration</a> is used. Limits imposed by the Redshift Serverless <a href="https://docs.aws.amazon.com/redshift-serverless/latest/APIReference/API_GetCredentials.html">GetCredentials</a> API apply.</td>
</tr>
<tr>
<td>password</td>
<td>String</td>
<td>No*</td>
<td>The name of an encrypted SSM parameter containing the password. For a given <code>&lt;REALM&gt;</code>, the SSM parameter name must be of the form <code>/lava/&lt;REALM&gt;/...</code> and the value must be a <strong>secure string</strong> encrypted using the <code>lava-&lt;REALM&gt;-sys</code> KMS key. If not specified, the worker will attempt to <a href="#creating-temporary-iam-user-credentials-for-redshift-serverless">generate temporary IAM user credentials</a>.</td>
</tr>
<tr>
<td>port</td>
<td>Number</td>
<td>Yes*</td>
<td>The Redshift serverless workgroup port number.</td>
</tr>
<tr>
<td>preserve_case</td>
<td>Boolean</td>
<td>No</td>
<td>If <code>true</code>, don't fold database object names to lower case when quoting them for use in <a href="06-jobs-job-types.html#job-type-db_from_s3">db_from_s3</a> jobs. The default is <code>false</code> (i.e. case folding is enabled).</td>
</tr>
<tr>
<td>role_arn</td>
<td>String</td>
<td>No</td>
<td>The ARN of an IAM role that will be assumed when <a href="#creating-temporary-iam-user-credentials-for-redshift-serverless">generating temporary IAM user credentials</a>.</td>
</tr>
<tr>
<td>secret_id</td>
<td>String</td>
<td>No</td>
<td>Obtain missing fields from AWS Secrets Manager. <a href="#database-authentication-using-aws-secrets-manager">More information</a>.</td>
</tr>
<tr>
<td>ssl</td>
<td>Boolean</td>
<td>No</td>
<td>Set to <code>true</code> to enable SSL. Default is <code>false</code>.</td>
</tr>
<tr>
<td>subtype</td>
<td>String</td>
<td>No</td>
<td>Specifies the underlying DBAPI 2.0 driver. See <a href="#redshift-connector-subtypes">Redshift Connector Subtypes</a> below.</td>
</tr>
<tr>
<td>type</td>
<td>String</td>
<td>Yes</td>
<td><code>redshift-serverless</code>.</td>
</tr>
<tr>
<td>user</td>
<td>String</td>
<td>Yes*</td>
<td>Database user name.</td>
</tr>
<tr>
<td>workgroup</td>
<td>String</td>
<td>No</td>
<td>The name of the workgroup associated with the database. This is used when <a href="#creating-temporary-iam-user-credentials-for-redshift-serverless">generating temporary IAM user credentials</a>. If required and not specified, the first component of the <code>host</code> field is used.</td>
</tr>
</tbody>
</table>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>Fields with a <strong>Required</strong> column marked with <code>*</code> can have a value provided
directly in the connection specification or indirectly via AWS Secrets
Manager using the <code>secret_id</code> field.  See <a href="#database-authentication-using-aws-secrets-manager">Database Authentication Using AWS
Secrets Manager</a> for
more information.</p>
</div>
<h4 id="redshift-serverless-connector-subtypes">Redshift Serverless Connector Subtypes<a class="headerlink" href="#redshift-serverless-connector-subtypes" title="Permanent link">&para;</a></h4>
<p>The <code>subtype</code> field of the connection specification allows selection of different
database drivers.</p>
<table>
<thead>
<tr>
<th>Subtype</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>pg8000</td>
<td><a href="https://pypi.org/project/pg8000/">Pg8000</a> is the default if no subtype is specified.</td>
</tr>
<tr>
<td>redshift</td>
<td>This is the <a href="https://pypi.org/project/redshift-connector/">AWS Redshift connector</a>.</td>
</tr>
</tbody>
</table>
<h4 id="creating-temporary-iam-user-credentials-for-redshift-serverless">Creating Temporary IAM User Credentials for Redshift Serverless<a class="headerlink" href="#creating-temporary-iam-user-credentials-for-redshift-serverless" title="Permanent link">&para;</a></h4>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The AWS documentation on this leaves a lot to be desired.</p>
</div>
<p>If a password is not obtained from the <code>password</code> field or secrets manager, lava
will attempt to use the Redshift Serverless
<a href="https://docs.aws.amazon.com/redshift-serverless/latest/APIReference/API_GetCredentials.html">GetCredentials</a>
API to generate temporary IAM-based database user credentials.</p>
<p>Unlike the Redshift provisioned
<a href="https://docs.aws.amazon.com/redshift/latest/mgmt/generating-iam-credentials-steps.html">GetClusterCredentials</a>
API, the Redshift Serverless
<a href="https://docs.aws.amazon.com/redshift-serverless/latest/APIReference/API_GetCredentials.html">GetCredentials</a>
API does not allow the target database user name to be specified. The username
is derived automatically from the IAM principal as follows:</p>
<ul>
<li>
<p>For IAM users, the database username is <code>IAM:&lt;IAM-USER-NAME&gt;</code>.</p>
</li>
<li>
<p>For IAM roles, the database username is <code>IAMR:&lt;IAM-ROLE-NAME&gt;</code>.</p>
</li>
</ul>
<p>If the user does not already exist in the database, it will be automatically
created and given access to the public schema. This is daft but that's how it is.
The user can be created manually or given additional database permissions via
the normal GRANT mechanism, as required.</p>
<p>This can be very limiting in terms of fine grained access control from lava to
Redshift. To provide some flexibility, the Redshift Serverless connector can
assume a different IAM role prior to generating database access credentials by
specifying the <code>role_arn</code> (and optional <code>external_id</code>) elements in the
connection specification. The assumed role is then the one that will determine
the database user name.</p>
<p>For example, assume the lava worker normally operates under the IAM role
<code>lava-prod-worker-core</code>. If no <code>role_arn</code> is specified, the database user will
be <code>IAMR:lava-dev-worker-core</code>.</p>
<p>If <code>role_arn</code> is <code>arn:aws:iam::123456789123:role/rs01</code>, the database user will
be <code>IAMR:rs01</code>.</p>
<p>The IAM policy attached to the <code>lava-dev-worker-core</code> role will need to contain
something like this:</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-36-1"><span class="nt">&quot;Statement&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-36-2"><span class="w">    </span><span class="p">{</span>
</span><span id="__span-36-3"><span class="w">        </span><span class="nt">&quot;Sid&quot;</span><span class="p">:</span><span class="w"> </span><span class="nt">&quot;AssumeRoleForRedshiftServerlessAccess&quot;</span>
</span><span id="__span-36-4"><span class="w">        </span><span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
</span><span id="__span-36-5"><span class="w">        </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;sts:AssumeRole&quot;</span><span class="p">,</span>
</span><span id="__span-36-6"><span class="w">        </span><span class="nt">&quot;Resource&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-36-7"><span class="w">            </span><span class="s2">&quot;arn:aws:iam::123456789123:role/rs01&quot;</span>
</span><span id="__span-36-8"><span class="w">        </span><span class="p">]</span>
</span><span id="__span-36-9"><span class="w">    </span><span class="p">}</span>
</span><span id="__span-36-10"><span class="p">]</span>
</span></code></pre></div>
<p>The IAM policy attached to the <code>rs01</code> role will need to contain something like
this:</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-37-1"><span class="nt">&quot;Statement&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-37-2"><span class="w">    </span><span class="p">{</span>
</span><span id="__span-37-3"><span class="w">        </span><span class="nt">&quot;Sid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;GetRedshiftServerlessCreds&quot;</span><span class="p">,</span>
</span><span id="__span-37-4"><span class="w">        </span><span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
</span><span id="__span-37-5"><span class="w">        </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;redshift-serverless:GetCredentials&quot;</span><span class="p">,</span>
</span><span id="__span-37-6"><span class="w">        </span><span class="nt">&quot;Resource&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-37-7"><span class="w">            </span><span class="s2">&quot;arn:aws:redshift-serverless:ap-southeast-2:123456789123:workgroup/3741886a-223d-446f-a77c-a5d0e7b5ad32&quot;</span>
</span><span id="__span-37-8"><span class="w">        </span><span class="p">]</span>
</span><span id="__span-37-9"><span class="w">    </span><span class="p">}</span>
</span><span id="__span-37-10"><span class="p">]</span>
</span></code></pre></div>
<p>The trust policy for the <code>rs01</code> role will need to contain the elements necessary
to allow it to be assumed by <code>lava-dev-worker-core</code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Lava currently does not cache temporary credentials. Watch out for throttling
on the <code>GetCredentials</code> API.</p>
</div>
<h2 id="connector-type-redshift">Connector type: redshift<a class="headerlink" href="#connector-type-redshift" title="Permanent link">&para;</a></h2>
<p>This is the connector for Redshift provisioned clusters. It can also be used for
Redshift Serverless clusters <strong>except</strong> when IAM generated user credentials are
used. In that case, the <a href="#connector-type-redshift-serverless">redshift-serverless</a>
connector must be used.</p>
<p>This connector is similar to <a href="#connector-type-postgres">postgres</a>. Note
that some operations are specific to Redshift and are not supported on
conventional Postgres databases (e.g. the <code>COPY</code> and <code>UNLOAD</code> commands).</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>cluster_id</td>
<td>String</td>
<td>No</td>
<td>The Redshift cluster identifier. If required and not specified, the first component of the <code>host</code> name is used.</td>
</tr>
<tr>
<td>conn_id</td>
<td>String</td>
<td>Yes</td>
<td>Connection identifier.</td>
</tr>
<tr>
<td>database</td>
<td>String</td>
<td>Yes*</td>
<td>The name of the database within the database server.</td>
</tr>
<tr>
<td>description</td>
<td>String</td>
<td>No</td>
<td>Description.</td>
</tr>
<tr>
<td>enabled</td>
<td>Boolean</td>
<td>Yes</td>
<td>Whether or not the connection is enabled.</td>
</tr>
<tr>
<td>host</td>
<td>String</td>
<td>Yes*</td>
<td>The database host DNS name or IP address.</td>
</tr>
<tr>
<td>password_duration</td>
<td>String</td>
<td>No</td>
<td>The password duration when <a href="#creating-temporary-iam-user-credentials-for-redshift">generating temporary IAM user credentials</a> in the form <code>nnX</code> where <code>nn</code> is a number and <code>X</code> is <code>s</code> (seconds), <code>m</code> (minutes) or <code>h</code> (hours). If not specified, the <a href="10-installation-operation.html#configuration-for-the-redshift-connector">default worker configuration</a> is used. Limits imposed by the <a href="https://docs.aws.amazon.com/redshift/latest/mgmt/generating-iam-credentials-steps.html">GetClusterCredentials</a> API apply.</td>
</tr>
<tr>
<td>password</td>
<td>String</td>
<td>No*</td>
<td>The name of an encrypted SSM parameter containing the password. For a given <code>&lt;REALM&gt;</code>, the SSM parameter name must be of the form <code>/lava/&lt;REALM&gt;/...</code> and the value must be a <strong>secure string</strong> encrypted using the <code>lava-&lt;REALM&gt;-sys</code> KMS key. If not specified, the worker will attempt to <a href="#creating-temporary-iam-user-credentials-for-redshift">generate temporary IAM user credentials</a>.</td>
</tr>
<tr>
<td>port</td>
<td>Number</td>
<td>Yes*</td>
<td>The database port number.</td>
</tr>
<tr>
<td>preserve_case</td>
<td>Boolean</td>
<td>No</td>
<td>If <code>true</code>, don't fold database object names to lower case when quoting them for use in <a href="06-jobs-job-types.html#job-type-db_from_s3">db_from_s3</a> jobs. The default is <code>false</code> (i.e. case folding is enabled).</td>
</tr>
<tr>
<td>secret_id</td>
<td>String</td>
<td>No</td>
<td>Obtain missing fields from AWS Secrets Manager. <a href="#database-authentication-using-aws-secrets-manager">More information</a>.</td>
</tr>
<tr>
<td>ssl</td>
<td>Boolean</td>
<td>No</td>
<td>Set to <code>true</code> to enable SSL. Default is <code>false</code>.</td>
</tr>
<tr>
<td>subtype</td>
<td>String</td>
<td>No</td>
<td>Specifies the underlying DBAPI 2.0 driver. See <a href="#redshift-connector-subtypes">Redshift Connector Subtypes</a> below.</td>
</tr>
<tr>
<td>type</td>
<td>String</td>
<td>Yes</td>
<td><code>redshift</code>.</td>
</tr>
<tr>
<td>user</td>
<td>String</td>
<td>Yes*</td>
<td>Database user name.</td>
</tr>
</tbody>
</table>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>Fields with a <strong>Required</strong> column marked with <code>*</code> can have a value provided
directly in the connection specification or indirectly via AWS Secrets
Manager using the <code>secret_id</code> field.  See <a href="#database-authentication-using-aws-secrets-manager">Database Authentication Using AWS
Secrets Manager</a> for
more information.</p>
</div>
<h4 id="redshift-connector-subtypes">Redshift Connector Subtypes<a class="headerlink" href="#redshift-connector-subtypes" title="Permanent link">&para;</a></h4>
<p>The <code>subtype</code> field of the connection specification allows selection of different
database drivers.</p>
<table>
<thead>
<tr>
<th>Subtype</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>pg8000</td>
<td><a href="https://pypi.org/project/pg8000/">Pg8000</a> is the default if no subtype is specified.</td>
</tr>
<tr>
<td>redshift</td>
<td>This is the <a href="https://pypi.org/project/redshift-connector/">AWS Redshift connector</a>.</td>
</tr>
</tbody>
</table>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>As of version 8.1 (Klauea), the Redshift connector no longer supports
PyGreSQL. This is not a lava change. PyGreSQL just doesn't work with
Redshift any more.</p>
</div>
<h4 id="creating-temporary-iam-user-credentials-for-redshift">Creating Temporary IAM User Credentials for Redshift<a class="headerlink" href="#creating-temporary-iam-user-credentials-for-redshift" title="Permanent link">&para;</a></h4>
<p>If the <code>password</code> field is not present in the connection specification, lava
will attempt to use the Redshift
<a href="https://docs.aws.amazon.com/redshift/latest/mgmt/generating-iam-credentials-steps.html">GetClusterCredentials</a>
API to generate temporary IAM-based database user credentials.</p>
<p>The specified user must already exist in the database as lava (deliberately)
does not support <code>AutoCreate</code> of users.</p>
<p>Lava will specify the target cluster ID, database and target user in the
credentials request. This means that the IAM policy attached to the worker will
need to contain an element something like this:</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-38-1"><span class="nt">&quot;Statement&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-38-2"><span class="w">    </span><span class="p">{</span>
</span><span id="__span-38-3"><span class="w">        </span><span class="nt">&quot;Sid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;GetRedshiftCreds&quot;</span><span class="p">,</span>
</span><span id="__span-38-4"><span class="w">        </span><span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
</span><span id="__span-38-5"><span class="w">        </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;redshift:GetClusterCredentials&quot;</span><span class="p">,</span>
</span><span id="__span-38-6"><span class="w">        </span><span class="nt">&quot;Resource&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-38-7"><span class="w">            </span><span class="s2">&quot;arn:aws:redshift:ap-southeast-2:123456789012:dbuser:cluster_id/target_user&quot;</span><span class="p">,</span>
</span><span id="__span-38-8"><span class="w">            </span><span class="s2">&quot;arn:aws:redshift:ap-southeast-2:123456789012:dbname:cluster_id/mydb&quot;</span>
</span><span id="__span-38-9"><span class="w">        </span><span class="p">]</span>
</span><span id="__span-38-10"><span class="w">    </span><span class="p">}</span>
</span><span id="__span-38-11"><span class="p">]</span>
</span></code></pre></div>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>Lava currently does not cache temporary credentials. Watch out for
throttling on the <code>GetClusterCredentials</code> API.</p>
</div>
<h2 id="connector-type-ses">Connector type: ses<a class="headerlink" href="#connector-type-ses" title="Permanent link">&para;</a></h2>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This is a legacy implementation. It is now deprecated and will be removed in
a future release. Use the <a href="#connector-type-email">email</a>
connector instead.</p>
</div>
<p>The <strong>ses</strong> connector provides access to the AWS Simple Email Service (SES).</p>
<p>If can be used only with <a href="06-jobs-job-types.html#job-type-exe">exe</a> and <a href="06-jobs-job-types.html#job-type-pkg">pkg</a> jobs. It provides an environment variable
pointing to a script that will run the AWS CLI with appropriate
parameters to access the SES service.</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>conn_id</td>
<td>String</td>
<td>Yes</td>
<td>Connection identifier.</td>
</tr>
<tr>
<td>description</td>
<td>String</td>
<td>No</td>
<td>Description.</td>
</tr>
<tr>
<td>enabled</td>
<td>Boolean</td>
<td>Yes</td>
<td>Whether or not the connection is enabled.</td>
</tr>
<tr>
<td>from</td>
<td>String</td>
<td>No</td>
<td>The email address that is sending the email. This email address must be either individually verified with Amazon SES, or  from  a  domain that  has been verified with Amazon SES. If not specified, the value specified by the <a href="10-installation-operation.html#general-configuration-parameters">SES_FROM</a> realm configuration parameter is used. A value must be specified by one of these mechanisms.</td>
</tr>
<tr>
<td>region</td>
<td>String</td>
<td>No</td>
<td>The AWS region name for the SES service. If not specified, the value specified by the <a href="10-installation-operation.html#general-configuration-parameters">SES_REGION</a> realm configuration parameter is used, which itself defaults to <code>us-east-1</code>.</td>
</tr>
<tr>
<td>reply_to</td>
<td>String <em>or</em> List[String]</td>
<td>No</td>
<td>The reply-to email address(es) for messages.</td>
</tr>
<tr>
<td>return_path</td>
<td>String</td>
<td>No</td>
<td>The email address that bounces and complaints will be  forwarded  to when feedback forwarding is enabled.</td>
</tr>
</tbody>
</table>
<p>In an <a href="06-jobs-job-types.html#job-type-exe">exe</a> or package
<a href="06-jobs-job-types.html#job-type-pkg">pkg</a> job, the job specification will look something
like this:</p>
<p><div class="language-json highlight"><pre><span></span><code><span id="__span-39-1"><span class="p">{</span>
</span><span id="__span-39-2"><span class="w">    </span><span class="nt">&quot;job_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;...&quot;</span><span class="p">,</span>
</span><span id="__span-39-3"><span class="w">    </span><span class="nt">&quot;parameters&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-39-4"><span class="w">        </span><span class="nt">&quot;connections&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-39-5"><span class="w">            </span><span class="nt">&quot;email&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;email-connection-id&quot;</span>
</span><span id="__span-39-6"><span class="w">        </span><span class="p">}</span>
</span><span id="__span-39-7"><span class="w">    </span><span class="p">},</span>
</span><span id="__span-39-8"><span class="w">    </span><span class="nt">&quot;payload&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;my-payload.sh ...&quot;</span>
</span><span id="__span-39-9"><span class="p">}</span>
</span></code></pre></div>
Note the <code>email</code> connection. This will provide the job with an environment
variable <code>LAVA_CONN_EMAIL</code> which points to the executable handling the
connection.</p>
<p>If the job payload is a shell script, the connector would be invoked thus:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-40-1"><span class="c1"># Send an email with a text message body.</span>
</span><span id="__span-40-2"><span class="nv">$LAVA_CONN_EMAIL</span><span class="w"> </span>--to<span class="w"> </span>fred@somewhere.com<span class="w"> </span>--subject<span class="w"> </span><span class="s2">&quot;Hello Fred&quot;</span><span class="w"> </span>--text<span class="w"> </span>msg.txt
</span><span id="__span-40-3">
</span><span id="__span-40-4"><span class="c1"># But wait -- we can do HTML as well</span>
</span><span id="__span-40-5"><span class="nv">$LAVA_CONN_EMAIL</span><span class="w"> </span>--to<span class="w"> </span>fred@somewhere.com<span class="w"> </span>--subject<span class="w"> </span><span class="s2">&quot;Hello Fred&quot;</span><span class="w"> </span>--html<span class="w"> </span>msg.html
</span><span id="__span-40-6">
</span><span id="__span-40-7"><span class="c1"># Or read from stdin. The connector will look for &lt;HTML&gt; at start of message</span>
</span><span id="__span-40-8"><span class="c1"># to determine if message is text or HTML.</span>
</span><span id="__span-40-9"><span class="nv">$LAVA_CONN_EMAIL</span><span class="w"> </span>--to<span class="w"> </span>fred@somewhere.com<span class="w"> </span>--subject<span class="w"> </span><span class="s2">&quot;Hello Fred&quot;</span><span class="w"> </span>&lt;<span class="w"> </span>msg.xxx
</span></code></pre></div>
<p>The connector script accepts the following arguments:</p>
<ul>
<li>
<p><strong>--to</strong> <em>email</em> ...  <br />
<strong>--cc</strong> <em>email</em> ...  <br />
<strong>--bcc</strong> <em>email</em> ...    </p>
<p>One or more recipient email addresses.</p>
</li>
<li>
<p><strong>--subject</strong> <em>text</em></p>
<p>Message subject.</p>
</li>
<li>
<p><strong>--text</strong> <em>filename</em></p>
<p>File containing the text body of the message. Optional.</p>
</li>
<li>
<p><strong>--html</strong> <em>filename</em></p>
<p>File containing the HTML body of the message. Optional.</p>
</li>
</ul>
<p>If neither <strong>--text</strong> nor <strong>--html</strong> options are specified, the message body is
read from stdin. If the content begins with <code>&lt;HTML&gt;</code> (case insensitive), the
connector will send it as HTML otherwise as text.</p>
<h2 id="connector-type-sharepoint">Connector type: sharepoint<a class="headerlink" href="#connector-type-sharepoint" title="Permanent link">&para;</a></h2>
<p>The <strong>sharepoint</strong> connector manages connections to SharePoint sites.</p>
<p>It is possible for Microsoft to have made this process more complex and
unwieldy, but it is not obvious how.</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>client_id</td>
<td>String</td>
<td>Yes</td>
<td>The Application ID that the SharePoint registration portal assigned your app. This resembles a UUID.</td>
</tr>
<tr>
<td>client_secret</td>
<td>String</td>
<td>Yes</td>
<td>Name of the SSE parameter containing the client secret. For a given <code>&lt;REALM&gt;</code>, the SSM parameter name must be of the form <code>/lava/&lt;REALM&gt;/...</code> and the value must be a secure string encrypted using the <code>lava-&lt;REALM&gt;-sys</code> KMS key.</td>
</tr>
<tr>
<td>conn_id</td>
<td>String</td>
<td>Yes</td>
<td>Connection identifier.</td>
</tr>
<tr>
<td>description</td>
<td>String</td>
<td>No</td>
<td>Description.</td>
</tr>
<tr>
<td>enabled</td>
<td>Boolean</td>
<td>Yes</td>
<td>Whether or not the connection is enabled.</td>
</tr>
<tr>
<td>https_proxy</td>
<td>String</td>
<td>No</td>
<td>HTTPS proxy to use for accessing the SharePoint API endpoints. If not specified, the <code>HTTPS_PROXY</code> environment variable is used, if set.</td>
</tr>
<tr>
<td>org_base_url</td>
<td>String</td>
<td>Yes</td>
<td>The hostname component of the organisation's SharePoint base URL. e.g. <code>acme.sharepoint.com</code>.</td>
</tr>
<tr>
<td>password</td>
<td>String</td>
<td>Yes</td>
<td>Name of the SSM parameter containing the password for authenticating to SharePoint. For a given <code>&lt;REALM&gt;</code>, the SSM parameter name must be of the form <code>/lava/&lt;REALM&gt;/...</code> and the value must be a secure string encrypted using the <code>lava-&lt;REALM&gt;-sys</code> KMS key.</td>
</tr>
<tr>
<td>site_name</td>
<td>String</td>
<td>Yes</td>
<td>The SharePoint site name.</td>
</tr>
<tr>
<td>tenant</td>
<td>String</td>
<td>Yes</td>
<td>The Azure AD registered domain ID. This resembles a UUID.</td>
</tr>
<tr>
<td>type</td>
<td>String</td>
<td>Yes</td>
<td><code>sharepoint</code>.</td>
</tr>
<tr>
<td>user</td>
<td>String</td>
<td>No</td>
<td>User name for authenticating to SharePoint.</td>
</tr>
</tbody>
</table>
<p>The connector supports the
<a href="06-jobs-job-types.html#job-type-sharepoint_get_doc">sharepoint_get_doc</a>,
<a href="06-jobs-job-types.html#job-type-sharepoint_get_list">sharepoint_get_list</a>,
<a href="06-jobs-job-types.html#job-type-sharepoint_put_doc">sharepoint_put_doc</a>,
<a href="06-jobs-job-types.html#job-type-sharepoint_put_list">sharepoint_put_list</a> and
<a href="06-jobs-job-types.html#job-type-sharepoint_get_multi_doc">sharepoint_get_multi_doc</a> and
job types.</p>
<h3 id="using-sharepoint-connectors">Using SharePoint Connectors<a class="headerlink" href="#using-sharepoint-connectors" title="Permanent link">&para;</a></h3>
<p>The <code>sharepoint</code> connector provides two distinct interfaces:</p>
<ol>
<li>
<p>A <a href="#python-interface-for-sharepoint-connectors">native Python interface</a></p>
</li>
<li>
<p>A <a href="#executable-interface-for-sharepoint-connectors">command line interface</a>.</p>
</li>
</ol>
<h4 id="python-interface-for-sharepoint-connectors">Python Interface for SharePoint Connectors<a class="headerlink" href="#python-interface-for-sharepoint-connectors" title="Permanent link">&para;</a></h4>
<p>The sharepoint connector can be used with Python based
<a href="06-jobs-job-types.html#job-type-exe">exe</a> and <a href="06-jobs-job-types.html#job-type-pkg">pkg</a>
jobs that invoke the lava connection manager directly. In this case, the
connector returns a <code>lava.lib.sharepoint.Sharepoint</code> object as described in the
lava API documentation. In summary, this class has the following methods:</p>
<p><div class="language-python highlight"><pre><span></span><code><span id="__span-41-1"><span class="n">delete_all_list_items</span><span class="p">(</span><span class="n">list_id</span><span class="p">,</span> <span class="n">list_name</span><span class="p">)</span>
</span><span id="__span-41-2">
</span><span id="__span-41-3"><span class="n">get_doc</span><span class="p">(</span><span class="n">lib_name</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">out_file</span><span class="p">)</span>
</span><span id="__span-41-4">
</span><span id="__span-41-5"><span class="n">get_list</span><span class="p">(</span><span class="n">list_name</span><span class="p">,</span> <span class="n">out_file</span><span class="p">,</span> <span class="n">system_columns</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">data_columns</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="__span-41-6">    <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">csv_writer_args</span><span class="p">)</span>
</span><span id="__span-41-7">
</span><span id="__span-41-8"><span class="n">put_doc</span><span class="p">(</span><span class="n">lib_name</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">src_file</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</span><span id="__span-41-9">
</span><span id="__span-41-10"><span class="n">put_list</span><span class="p">(</span><span class="n">list_name</span><span class="p">,</span> <span class="n">src_file</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;append&#39;</span><span class="p">,</span> <span class="n">error_missing</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="__span-41-11">    <span class="n">data_columns</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">csv_reader_args</span><span class="p">)</span>
</span><span id="__span-41-12">
</span><span id="__span-41-13"><span class="n">get_multi_doc</span><span class="p">(</span><span class="n">lib_name</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">out_path</span><span class="p">,</span> <span class="n">glob</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</span><span id="__span-41-14">
</span><span id="__span-41-15"><span class="n">close</span><span class="p">()</span>
</span></code></pre></div>
Note that this is the low level connector. It does not handle moving files in or
out of S3 or Jinja rendering of parameters. It is up to the caller to do that as
required.</p>
<p>If the SharePoint connector key in the job's <code>connectors</code> map is <code>spoint</code>,
typical usage would be something like:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-42-1"><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
</span><span id="__span-42-2"><span class="kn">from</span><span class="w"> </span><span class="nn">lava.connection</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_sharepoint_connection</span>
</span><span id="__span-42-3">
</span><span id="__span-42-4"><span class="c1"># Get a lava.lib.sharepoint.Sharepoint instance</span>
</span><span id="__span-42-5"><span class="n">sp_conn</span> <span class="o">=</span> <span class="n">get_sharepoint_connection</span><span class="p">(</span>
</span><span id="__span-42-6">    <span class="n">conn_id</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;LAVA_CONNID_SPOINT&#39;</span><span class="p">],</span>
</span><span id="__span-42-7">    <span class="n">realm</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;LAVA_REALM&#39;</span><span class="p">]</span>
</span><span id="__span-42-8"><span class="p">)</span>
</span><span id="__span-42-9">
</span><span id="__span-42-10"><span class="c1"># Get a list from SharePoint and store it locally.</span>
</span><span id="__span-42-11"><span class="n">row_count</span> <span class="o">=</span> <span class="n">sp_conn</span><span class="o">.</span><span class="n">get_list</span><span class="p">(</span><span class="s1">&#39;postcodes&#39;</span><span class="p">,</span> <span class="s1">&#39;postcodes.csv&#39;</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
</span><span id="__span-42-12">
</span><span id="__span-42-13"><span class="c1"># Close the connection</span>
</span><span id="__span-42-14"><span class="n">sp_conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span></code></pre></div>
<h4 id="executable-interface-for-sharepoint-connectors">Executable Interface for SharePoint Connectors<a class="headerlink" href="#executable-interface-for-sharepoint-connectors" title="Permanent link">&para;</a></h4>
<p>When used with <a href="06-jobs-job-types.html#job-type-exe">exe</a>,
<a href="06-jobs-job-types.html#job-type-pkg">pkg</a> and
<a href="06-jobs-job-types.html#job-type-docker">docker</a> job types (e.g. shell scripts), the
connection is implemented by the <code>lava-sharepoint</code> command.</p>
<p>This is a somewhat higher level interface to the connector in that it can also
handle moving data in and out of S3. Jinja rendering is handled as per the
<a href="06-jobs-job-types.html#job-type-sharepoint_get_list">sharepoint_get_list</a>,
<a href="06-jobs-job-types.html#job-type-sharepoint_put_list">sharepoint_put_list</a>,
<a href="06-jobs-job-types.html#job-type-sharepoint_get_doc">sharepoint_get_doc</a>,
<a href="06-jobs-job-types.html#job-type-sharepoint_put_doc">sharepoint_put_doc</a> and
<a href="06-jobs-job-types.html#job-type-sharepoint_get_multi_doc">sharepoint_get_multi_doc</a>
job types.</p>
<p>If the SharePoint connector key in the job's <code>connectors</code> map is <code>spoint</code>,
usage is:</p>
<div class="language-bare highlight"><pre><span></span><code><span id="__span-43-1"><span class="err">usage:</span><span class="w"> </span><span class="err">$LAVA_CONN_SPOINT</span><span class="w"> </span><span class="err">[-J]</span><span class="w"> </span><span class="err">[-l</span><span class="w"> </span><span class="err">LEVEL]</span><span class="w"> </span><span class="err">{put-doc,put-list,get-doc,get-list,get-multi-doc}</span><span class="w"> </span><span class="err">...</span>
</span><span id="__span-43-2">
</span><span id="__span-43-3"><span class="err">sub-commands:</span>
</span><span id="__span-43-4"><span class="w">  </span><span class="err">{put-doc,put-list,get-doc,get-list,get-multi-doc}</span>
</span><span id="__span-43-5"><span class="w">    </span><span class="err">put-doc</span><span class="w">             </span><span class="err">Copy</span><span class="w"> </span><span class="err">a</span><span class="w"> </span><span class="err">file</span><span class="w"> </span><span class="err">into</span><span class="w"> </span><span class="err">a</span><span class="w"> </span><span class="err">SharePoint</span><span class="w"> </span><span class="err">document</span><span class="w"> </span><span class="err">library.</span>
</span><span id="__span-43-6"><span class="w">    </span><span class="err">put-list</span><span class="w">            </span><span class="err">Copy</span><span class="w"> </span><span class="err">a</span><span class="w"> </span><span class="err">file</span><span class="w"> </span><span class="err">into</span><span class="w"> </span><span class="err">a</span><span class="w"> </span><span class="err">SharePoint</span><span class="w"> </span><span class="err">list.</span>
</span><span id="__span-43-7"><span class="w">    </span><span class="err">get-doc</span><span class="w">             </span><span class="err">Copy</span><span class="w"> </span><span class="err">a</span><span class="w"> </span><span class="err">file</span><span class="w"> </span><span class="err">from</span><span class="w"> </span><span class="err">a</span><span class="w"> </span><span class="err">SharePoint</span><span class="w"> </span><span class="err">document</span><span class="w"> </span><span class="err">library.</span>
</span><span id="__span-43-8"><span class="w">    </span><span class="err">get-list</span><span class="w">            </span><span class="err">Copy</span><span class="w"> </span><span class="err">a</span><span class="w"> </span><span class="err">SharePoint</span><span class="w"> </span><span class="err">list</span><span class="w"> </span><span class="err">to</span><span class="w"> </span><span class="err">a</span><span class="w"> </span><span class="err">file</span>
</span><span id="__span-43-9"><span class="w">    </span><span class="err">get-multi-doc</span><span class="w">       </span><span class="err">Copy</span><span class="w"> </span><span class="err">multiple</span><span class="w"> </span><span class="err">files</span><span class="w"> </span><span class="err">from</span><span class="w"> </span><span class="err">a</span><span class="w"> </span><span class="err">SharePoint</span><span class="w"> </span><span class="err">document</span><span class="w"> </span><span class="err">library</span><span class="w"> </span><span class="err">path.</span>
</span><span id="__span-43-10">
</span><span id="__span-43-11"><span class="err">optional</span><span class="w"> </span><span class="err">arguments:</span>
</span><span id="__span-43-12"><span class="w">  </span><span class="err">-J,</span><span class="w"> </span><span class="err">--no-jinja</span><span class="w">        </span><span class="err">Disable</span><span class="w"> </span><span class="err">Jinja</span><span class="w"> </span><span class="err">rendering</span><span class="w"> </span><span class="err">of</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">transfer</span><span class="w"> </span><span class="err">parameters.</span>
</span><span id="__span-43-13">
</span><span id="__span-43-14"><span class="err">logging</span><span class="w"> </span><span class="err">arguments:</span>
</span><span id="__span-43-15"><span class="w">  </span><span class="err">-l</span><span class="w"> </span><span class="err">LEVEL,</span><span class="w"> </span><span class="err">--level</span><span class="w"> </span><span class="err">LEVEL</span>
</span><span id="__span-43-16"><span class="w">                        </span><span class="err">Print</span><span class="w"> </span><span class="err">messages</span><span class="w"> </span><span class="err">of</span><span class="w"> </span><span class="err">a</span><span class="w"> </span><span class="err">given</span><span class="w"> </span><span class="err">severity</span><span class="w"> </span><span class="err">level</span><span class="w"> </span><span class="err">or</span><span class="w"> </span><span class="err">above.</span><span class="w"> </span><span class="err">The</span>
</span><span id="__span-43-17"><span class="w">                        </span><span class="err">standard</span><span class="w"> </span><span class="err">logging</span><span class="w"> </span><span class="err">level</span><span class="w"> </span><span class="err">names</span><span class="w"> </span><span class="err">are</span><span class="w"> </span><span class="err">available</span><span class="w"> </span><span class="err">but</span><span class="w"> </span><span class="err">debug,</span>
</span><span id="__span-43-18"><span class="w">                        </span><span class="err">info,</span><span class="w"> </span><span class="err">warning</span><span class="w"> </span><span class="err">and</span><span class="w"> </span><span class="err">error</span><span class="w"> </span><span class="err">are</span><span class="w"> </span><span class="err">most</span><span class="w"> </span><span class="err">useful.</span><span class="w"> </span><span class="err">The</span><span class="w"> </span><span class="err">Default</span>
</span><span id="__span-43-19"><span class="w">                        </span><span class="err">is</span><span class="w"> </span><span class="err">info.</span>
</span></code></pre></div>
<p>Usage for the <code>get-doc</code> sub-command:</p>
<div class="language-bare highlight"><pre><span></span><code><span id="__span-44-1"><span class="err">usage:</span><span class="w"> </span><span class="err">$LAVA_CONN_SPOINT</span><span class="w"> </span><span class="err">get-doc</span><span class="w"> </span><span class="err">[options]</span><span class="w"> </span><span class="err">SharePoint-path</span><span class="w"> </span><span class="err">file</span>
</span><span id="__span-44-2">
</span><span id="__span-44-3"><span class="err">positional</span><span class="w"> </span><span class="err">arguments:</span>
</span><span id="__span-44-4"><span class="w">  </span><span class="err">SharePoint-path</span><span class="w">       </span><span class="err">Source</span><span class="w"> </span><span class="err">location.</span><span class="w"> </span><span class="err">Must</span><span class="w"> </span><span class="err">be</span><span class="w"> </span><span class="err">in</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">form</span><span class="w"> </span><span class="err">library:path.</span>
</span><span id="__span-44-5"><span class="w">                        </span><span class="err">This</span><span class="w"> </span><span class="err">will</span><span class="w"> </span><span class="err">be</span><span class="w"> </span><span class="err">jinja</span><span class="w"> </span><span class="err">rendered.</span>
</span><span id="__span-44-6"><span class="w">  </span><span class="err">file</span><span class="w">                  </span><span class="err">Target</span><span class="w"> </span><span class="err">file.</span><span class="w"> </span><span class="err">Values</span><span class="w"> </span><span class="err">starting</span><span class="w"> </span><span class="err">with</span><span class="w"> </span><span class="err">s3://</span><span class="w"> </span><span class="err">will</span><span class="w"> </span><span class="err">be</span><span class="w"> </span><span class="err">copied</span>
</span><span id="__span-44-7"><span class="w">                        </span><span class="err">to</span><span class="w"> </span><span class="err">S3.</span><span class="w"> </span><span class="err">This</span><span class="w"> </span><span class="err">will</span><span class="w"> </span><span class="err">be</span><span class="w"> </span><span class="err">jinja</span><span class="w"> </span><span class="err">rendered.</span>
</span><span id="__span-44-8">
</span><span id="__span-44-9"><span class="err">optional</span><span class="w"> </span><span class="err">arguments:</span>
</span><span id="__span-44-10"><span class="w">  </span><span class="err">-k</span><span class="w"> </span><span class="err">KMS_KEY_ID,</span><span class="w"> </span><span class="err">--kms-key-id</span><span class="w"> </span><span class="err">KMS_KEY_ID</span>
</span><span id="__span-44-11"><span class="w">                        </span><span class="err">AWS</span><span class="w"> </span><span class="err">KMS</span><span class="w"> </span><span class="err">key</span><span class="w"> </span><span class="err">to</span><span class="w"> </span><span class="err">use</span><span class="w"> </span><span class="err">for</span><span class="w"> </span><span class="err">uploading</span><span class="w"> </span><span class="err">data</span><span class="w"> </span><span class="err">to</span><span class="w"> </span><span class="err">S3.</span>
</span></code></pre></div>
<p>Usage for the <code>get-list</code> sub-command:</p>
<div class="language-bare highlight"><pre><span></span><code><span id="__span-45-1"><span class="err">usage:</span><span class="w"> </span><span class="err">$LAVA_CONN_SPOINT</span><span class="w"> </span><span class="err">get-list</span><span class="w"> </span><span class="err">[options]</span><span class="w"> </span><span class="err">SharePoint-list</span><span class="w"> </span><span class="err">file</span>
</span><span id="__span-45-2">
</span><span id="__span-45-3"><span class="err">positional</span><span class="w"> </span><span class="err">arguments:</span>
</span><span id="__span-45-4"><span class="w">  </span><span class="err">SharePoint-list</span><span class="w">       </span><span class="err">Source</span><span class="w"> </span><span class="err">SharePoint</span><span class="w"> </span><span class="err">list</span><span class="w"> </span><span class="err">name.</span><span class="w"> </span><span class="err">This</span><span class="w"> </span><span class="err">will</span><span class="w"> </span><span class="err">be</span><span class="w"> </span><span class="err">jinja</span>
</span><span id="__span-45-5"><span class="w">                        </span><span class="err">rendered.</span>
</span><span id="__span-45-6"><span class="w">  </span><span class="err">file</span><span class="w">                  </span><span class="err">Target</span><span class="w"> </span><span class="err">file.</span><span class="w"> </span><span class="err">Values</span><span class="w"> </span><span class="err">starting</span><span class="w"> </span><span class="err">with</span><span class="w"> </span><span class="err">s3://</span><span class="w"> </span><span class="err">will</span><span class="w"> </span><span class="err">be</span><span class="w"> </span><span class="err">copied</span>
</span><span id="__span-45-7"><span class="w">                        </span><span class="err">to</span><span class="w"> </span><span class="err">S3.</span><span class="w"> </span><span class="err">This</span><span class="w"> </span><span class="err">will</span><span class="w"> </span><span class="err">be</span><span class="w"> </span><span class="err">jinja</span><span class="w"> </span><span class="err">rendered.</span>
</span><span id="__span-45-8">
</span><span id="__span-45-9"><span class="err">optional</span><span class="w"> </span><span class="err">arguments:</span>
</span><span id="__span-45-10"><span class="w">  </span><span class="err">-k</span><span class="w"> </span><span class="err">KMS_KEY_ID,</span><span class="w"> </span><span class="err">--kms-key-id</span><span class="w"> </span><span class="err">KMS_KEY_ID</span>
</span><span id="__span-45-11"><span class="w">                        </span><span class="err">AWS</span><span class="w"> </span><span class="err">KMS</span><span class="w"> </span><span class="err">key</span><span class="w"> </span><span class="err">to</span><span class="w"> </span><span class="err">use</span><span class="w"> </span><span class="err">for</span><span class="w"> </span><span class="err">uploading</span><span class="w"> </span><span class="err">data</span><span class="w"> </span><span class="err">to</span><span class="w"> </span><span class="err">S3.</span>
</span><span id="__span-45-12"><span class="w">  </span><span class="err">-H,</span><span class="w"> </span><span class="err">--no-header</span><span class="w">       </span><span class="err">Don&#39;t</span><span class="w"> </span><span class="err">include</span><span class="w"> </span><span class="err">a</span><span class="w"> </span><span class="err">header</span><span class="w"> </span><span class="err">row.</span><span class="w"> </span><span class="err">A</span><span class="w"> </span><span class="err">header</span><span class="w"> </span><span class="err">is</span><span class="w"> </span><span class="err">included</span><span class="w"> </span><span class="err">by</span>
</span><span id="__span-45-13"><span class="w">                        </span><span class="err">default.</span>
</span><span id="__span-45-14"><span class="w">  </span><span class="err">--delimiter</span><span class="w"> </span><span class="err">DELIMITER</span>
</span><span id="__span-45-15"><span class="w">                        </span><span class="err">Output</span><span class="w"> </span><span class="err">field</span><span class="w"> </span><span class="err">delimiter.</span>
</span><span id="__span-45-16"><span class="w">  </span><span class="err">--double-quote</span><span class="w">        </span><span class="err">As</span><span class="w"> </span><span class="err">for</span><span class="w"> </span><span class="err">csv.writer.</span>
</span><span id="__span-45-17"><span class="w">  </span><span class="err">--escape-char</span><span class="w"> </span><span class="err">ESCAPECHAR</span>
</span><span id="__span-45-18"><span class="w">                        </span><span class="err">As</span><span class="w"> </span><span class="err">for</span><span class="w"> </span><span class="err">csv.writer.</span>
</span><span id="__span-45-19"><span class="w">  </span><span class="err">--quote-char</span><span class="w"> </span><span class="err">QUOTECHAR</span>
</span><span id="__span-45-20"><span class="w">                        </span><span class="err">As</span><span class="w"> </span><span class="err">for</span><span class="w"> </span><span class="err">csv.writer.</span>
</span><span id="__span-45-21"><span class="w">  </span><span class="err">--quoting</span><span class="w"> </span><span class="err">QUOTING</span><span class="w">     </span><span class="err">As</span><span class="w"> </span><span class="err">for</span><span class="w"> </span><span class="err">csv.writer</span><span class="w"> </span><span class="err">QUOTE_</span><span class="w"> </span><span class="err">parameters</span><span class="w"> </span><span class="err">(without</span><span class="w"> </span><span class="err">the</span>
</span><span id="__span-45-22"><span class="w">                        </span><span class="err">QUOTE_</span><span class="w"> </span><span class="err">prefix).</span>
</span></code></pre></div>
<p>Usage for the <code>get-doc</code> sub-command:</p>
<div class="language-bare highlight"><pre><span></span><code><span id="__span-46-1"><span class="err">usage:</span><span class="w"> </span><span class="err">$LAVA_CONN_SPOINT</span><span class="w"> </span><span class="err">get-doc</span><span class="w"> </span><span class="err">[options]</span><span class="w"> </span><span class="err">SharePoint-path</span><span class="w"> </span><span class="err">file</span>
</span><span id="__span-46-2">
</span><span id="__span-46-3"><span class="err">positional</span><span class="w"> </span><span class="err">arguments:</span>
</span><span id="__span-46-4"><span class="w">  </span><span class="err">SharePoint-path</span><span class="w">       </span><span class="err">Source</span><span class="w"> </span><span class="err">location.</span><span class="w"> </span><span class="err">Must</span><span class="w"> </span><span class="err">be</span><span class="w"> </span><span class="err">in</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">form</span><span class="w"> </span><span class="err">library:path.</span>
</span><span id="__span-46-5"><span class="w">                        </span><span class="err">This</span><span class="w"> </span><span class="err">will</span><span class="w"> </span><span class="err">be</span><span class="w"> </span><span class="err">jinja</span><span class="w"> </span><span class="err">rendered.</span>
</span><span id="__span-46-6"><span class="w">  </span><span class="err">file</span><span class="w">                  </span><span class="err">Target</span><span class="w"> </span><span class="err">file.</span><span class="w"> </span><span class="err">Values</span><span class="w"> </span><span class="err">starting</span><span class="w"> </span><span class="err">with</span><span class="w"> </span><span class="err">s3://</span><span class="w"> </span><span class="err">will</span><span class="w"> </span><span class="err">be</span><span class="w"> </span><span class="err">copied</span>
</span><span id="__span-46-7"><span class="w">                        </span><span class="err">to</span><span class="w"> </span><span class="err">S3.</span><span class="w"> </span><span class="err">This</span><span class="w"> </span><span class="err">will</span><span class="w"> </span><span class="err">be</span><span class="w"> </span><span class="err">jinja</span><span class="w"> </span><span class="err">rendered.</span>
</span><span id="__span-46-8">
</span><span id="__span-46-9"><span class="err">optional</span><span class="w"> </span><span class="err">arguments:</span>
</span><span id="__span-46-10"><span class="w">  </span><span class="err">-k</span><span class="w"> </span><span class="err">KMS_KEY_ID,</span><span class="w"> </span><span class="err">--kms-key-id</span><span class="w"> </span><span class="err">KMS_KEY_ID</span>
</span><span id="__span-46-11"><span class="w">                        </span><span class="err">AWS</span><span class="w"> </span><span class="err">KMS</span><span class="w"> </span><span class="err">key</span><span class="w"> </span><span class="err">to</span><span class="w"> </span><span class="err">use</span><span class="w"> </span><span class="err">for</span><span class="w"> </span><span class="err">uploading</span><span class="w"> </span><span class="err">data</span><span class="w"> </span><span class="err">to</span><span class="w"> </span><span class="err">S3.</span>
</span></code></pre></div>
<p>Usage for the <code>put-doc</code> sub-command:</p>
<div class="language-bare highlight"><pre><span></span><code><span id="__span-47-1"><span class="err">usage:</span><span class="w"> </span><span class="err">$LAVA_CONN_SPOINT</span><span class="w"> </span><span class="err">put-doc</span><span class="w"> </span><span class="err">[options]</span><span class="w"> </span><span class="err">file</span><span class="w"> </span><span class="err">SharePoint-path</span>
</span><span id="__span-47-2">
</span><span id="__span-47-3"><span class="err">positional</span><span class="w"> </span><span class="err">arguments:</span>
</span><span id="__span-47-4"><span class="w">  </span><span class="err">file</span><span class="w">                  </span><span class="err">Source</span><span class="w"> </span><span class="err">file.</span><span class="w"> </span><span class="err">Values</span><span class="w"> </span><span class="err">starting</span><span class="w"> </span><span class="err">with</span><span class="w"> </span><span class="err">s3://</span><span class="w"> </span><span class="err">will</span><span class="w"> </span><span class="err">be</span><span class="w"> </span><span class="err">copied</span>
</span><span id="__span-47-5"><span class="w">                        </span><span class="err">from</span><span class="w"> </span><span class="err">S3.</span><span class="w"> </span><span class="err">This</span><span class="w"> </span><span class="err">will</span><span class="w"> </span><span class="err">be</span><span class="w"> </span><span class="err">jinja</span><span class="w"> </span><span class="err">rendered.</span>
</span><span id="__span-47-6"><span class="w">  </span><span class="err">SharePoint-path</span><span class="w">       </span><span class="err">Target</span><span class="w"> </span><span class="err">location.</span><span class="w"> </span><span class="err">Must</span><span class="w"> </span><span class="err">be</span><span class="w"> </span><span class="err">in</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">form</span><span class="w"> </span><span class="err">library:path.</span>
</span><span id="__span-47-7"><span class="w">                        </span><span class="err">This</span><span class="w"> </span><span class="err">will</span><span class="w"> </span><span class="err">be</span><span class="w"> </span><span class="err">jinja</span><span class="w"> </span><span class="err">rendered.</span>
</span><span id="__span-47-8">
</span><span id="__span-47-9"><span class="err">optional</span><span class="w"> </span><span class="err">arguments:</span>
</span><span id="__span-47-10"><span class="w">  </span><span class="err">-t</span><span class="w"> </span><span class="err">TITLE,</span><span class="w"> </span><span class="err">--title</span><span class="w"> </span><span class="err">TITLE</span>
</span><span id="__span-47-11"><span class="w">                        </span><span class="err">Document</span><span class="w"> </span><span class="err">title.</span><span class="w"> </span><span class="err">This</span><span class="w"> </span><span class="err">will</span><span class="w"> </span><span class="err">be</span><span class="w"> </span><span class="err">jinja</span><span class="w"> </span><span class="err">rendered.</span>
</span></code></pre></div>
<p>Usage for the <code>get-multi-doc</code> sub-command:</p>
<div class="language-bare highlight"><pre><span></span><code><span id="__span-48-1"><span class="err">usage:</span><span class="w"> </span><span class="err">$LAVA_CONN_SPOINT</span><span class="w"> </span><span class="err">get-multi-doc</span><span class="w"> </span><span class="err">[options]</span><span class="w"> </span><span class="err">SharePoint-path</span><span class="w"> </span><span class="err">outpath</span><span class="w"> </span><span class="err">[glob]</span>
</span><span id="__span-48-2">
</span><span id="__span-48-3"><span class="err">positional</span><span class="w"> </span><span class="err">arguments:</span>
</span><span id="__span-48-4"><span class="w">  </span><span class="err">SharePoint-path</span><span class="w">       </span><span class="err">Source</span><span class="w"> </span><span class="err">location.</span><span class="w"> </span><span class="err">Must</span><span class="w"> </span><span class="err">be</span><span class="w"> </span><span class="err">in</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">form</span><span class="w"> </span><span class="err">library:path.</span>
</span><span id="__span-48-5"><span class="w">                        </span><span class="err">This</span><span class="w"> </span><span class="err">will</span><span class="w"> </span><span class="err">be</span><span class="w"> </span><span class="err">jinja</span><span class="w"> </span><span class="err">rendered.</span>
</span><span id="__span-48-6"><span class="w">  </span><span class="err">outpath</span><span class="w">               </span><span class="err">Target</span><span class="w"> </span><span class="err">path.</span><span class="w"> </span><span class="err">Values</span><span class="w"> </span><span class="err">starting</span><span class="w"> </span><span class="err">with</span><span class="w"> </span><span class="err">s3://</span><span class="w"> </span><span class="err">will</span><span class="w"> </span><span class="err">be</span><span class="w"> </span><span class="err">copied</span>
</span><span id="__span-48-7"><span class="w">                        </span><span class="err">to</span><span class="w"> </span><span class="err">S3</span><span class="w"> </span><span class="err">using</span><span class="w"> </span><span class="err">given</span><span class="w"> </span><span class="err">bucket</span><span class="w"> </span><span class="err">and</span><span class="w"> </span><span class="err">key</span><span class="w"> </span><span class="err">as</span><span class="w"> </span><span class="err">key</span><span class="w"> </span><span class="err">prefix.</span><span class="w"> </span><span class="err">This</span>
</span><span id="__span-48-8"><span class="w">                        </span><span class="err">will</span><span class="w"> </span><span class="err">be</span><span class="w"> </span><span class="err">jinja</span><span class="w"> </span><span class="err">rendered.</span>
</span><span id="__span-48-9"><span class="w">  </span><span class="err">glob</span><span class="w">                  </span><span class="err">Filter</span><span class="w"> </span><span class="err">files</span><span class="w"> </span><span class="err">in</span><span class="w"> </span><span class="err">sharepoint</span><span class="w"> </span><span class="err">path</span><span class="w"> </span><span class="err">on</span><span class="w"> </span><span class="err">this</span><span class="w"> </span><span class="err">given</span><span class="w"> </span><span class="err">glob.</span>
</span><span id="__span-48-10"><span class="w">                        </span><span class="err">This</span><span class="w"> </span><span class="err">will</span><span class="w"> </span><span class="err">be</span><span class="w"> </span><span class="err">jinja</span><span class="w"> </span><span class="err">rendered.</span>
</span><span id="__span-48-11">
</span><span id="__span-48-12"><span class="err">optional</span><span class="w"> </span><span class="err">arguments:</span>
</span><span id="__span-48-13"><span class="w">  </span><span class="err">-k</span><span class="w"> </span><span class="err">KMS_KEY_ID,</span><span class="w"> </span><span class="err">--kms-key-id</span><span class="w"> </span><span class="err">KMS_KEY_ID</span>
</span><span id="__span-48-14"><span class="w">                        </span><span class="err">AWS</span><span class="w"> </span><span class="err">KMS</span><span class="w"> </span><span class="err">key</span><span class="w"> </span><span class="err">to</span><span class="w"> </span><span class="err">use</span><span class="w"> </span><span class="err">for</span><span class="w"> </span><span class="err">uploading</span><span class="w"> </span><span class="err">data</span><span class="w"> </span><span class="err">to</span><span class="w"> </span><span class="err">S3.</span>
</span></code></pre></div>
<p>The following examples show how to use the connector in an
<a href="06-jobs-job-types.html#job-type-exe">exe</a> job using bash:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-49-1"><span class="ch">#!/bin/bash</span>
</span><span id="__span-49-2">
</span><span id="__span-49-3"><span class="c1"># Copy a list from S3 to SharePoint, replacing existing contents.</span>
</span><span id="__span-49-4"><span class="nv">$LAVA_CONN_SPOINT</span><span class="w"> </span>put-list<span class="w"> </span>--replace<span class="w"> </span>s3://my-bucket/data.csv<span class="w"> </span>My-List
</span><span id="__span-49-5">
</span><span id="__span-49-6"><span class="c1"># Get list back from SharePoint and place in S3. Include a header</span>
</span><span id="__span-49-7"><span class="nv">$LAVA_CONN_SPOINT</span><span class="w"> </span>get-list<span class="w"> </span>-k<span class="w"> </span>alias/data<span class="w"> </span>--delimiter<span class="w"> </span><span class="s2">&quot;,&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-49-8"><span class="w">    </span>My-List<span class="w"> </span>s3://my-bucket/data.csv
</span><span id="__span-49-9">
</span><span id="__span-49-10"><span class="c1"># Copy a document from S3 to SharePoint.</span>
</span><span id="__span-49-11"><span class="nv">$LAVA_CONN_SPOINT</span><span class="w"> </span>put-doc<span class="w"> </span>s3://my-bucket/lava.docx<span class="w"> </span><span class="s2">&quot;Lava Docs:/Lava/User Guide.docx&quot;</span>
</span><span id="__span-49-12">
</span><span id="__span-49-13"><span class="c1"># Get a document from SharePoint and place in S3.</span>
</span><span id="__span-49-14"><span class="nv">$LAVA_CONN_SPOINT</span><span class="w"> </span>get-doc<span class="w"> </span><span class="s2">&quot;Lava Docs:/Lava/User Guide.docx&quot;</span><span class="w"> </span>s3://my-bucket/lava.docx<span class="w"> </span>
</span><span id="__span-49-15">
</span><span id="__span-49-16"><span class="c1"># Get all docx files from SharePoint path and place in S3 base-prefix.</span>
</span><span id="__span-49-17"><span class="nv">$LAVA_CONN_SPOINT</span><span class="w"> </span>get-multi-doc<span class="w"> </span><span class="s2">&quot;Lava Docs:/Lava/&quot;</span><span class="w"> </span>s3://my-bucket/base-prefix<span class="w"> </span>*.docx
</span><span id="__span-49-18">
</span><span id="__span-49-19"><span class="c1"># Get all files from SharePoint path and place in S3 base-prefix.</span>
</span><span id="__span-49-20"><span class="nv">$LAVA_CONN_SPOINT</span><span class="w"> </span>get-multi-doc<span class="w"> </span><span class="s2">&quot;Lava Docs:/Lava/&quot;</span><span class="w"> </span>s3://my-bucket/base-prefix
</span></code></pre></div>
<h2 id="connector-type-slack">Connector type: slack<a class="headerlink" href="#connector-type-slack" title="Permanent link">&para;</a></h2>
<p>The <strong>slack</strong> connector uses
<a href="https://api.slack.com/messaging/webhooks">Slack webhooks</a> to send
messages to Slack channels. The target Slack workspace and channel are specified
in Slack itself when the webhook is created.</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>colour</td>
<td>Style</td>
<td>No</td>
<td>Default colour for the sidebar for Slack messages sent using <code>attachment</code> style. This can be any hex colour code or one of the Slack special values <code>good</code>, <code>warning</code> or <code>danger</code>. If not specified a default value is used.</td>
</tr>
<tr>
<td>conn_id</td>
<td>String</td>
<td>Yes</td>
<td>Connection identifier.</td>
</tr>
<tr>
<td>description</td>
<td>String</td>
<td>No</td>
<td>Description.</td>
</tr>
<tr>
<td>enabled</td>
<td>Boolean</td>
<td>Yes</td>
<td>Whether or not the connection is enabled.</td>
</tr>
<tr>
<td>from</td>
<td>String</td>
<td>No</td>
<td>An arbitrary source identifier for display in Slack messages. If not specified, a default value is constructed when required.</td>
</tr>
<tr>
<td>preamble</td>
<td>String</td>
<td>No</td>
<td>Default preamble at the start of Slack messages. Useful values include things such as <code>&lt;!here&gt;</code> and <code>&lt;!channel&gt;</code> which will cause Slack to insert <code>@here</code> and <code>@channel</code> alert tags respectively. If not specified, no preamble is used.</td>
</tr>
<tr>
<td>style</td>
<td>String</td>
<td>No</td>
<td>Display style for Slack messages. Options are <code>block</code> (default), <code>attachment</code> and <code>plain</code>. The first two use the corresponding block or attachment message construction mechanism provided by Slack to make messages more presentable.</td>
</tr>
<tr>
<td>type</td>
<td>String</td>
<td>Yes</td>
<td><code>slack</code>.</td>
</tr>
<tr>
<td>webhook_url</td>
<td>String</td>
<td>Yes</td>
<td>The <a href="https://api.slack.com/messaging/webhooks">webhook URL</a> provided by Slack for sending messages.</td>
</tr>
</tbody>
</table>
<h3 id="using-the-slack-connector">Using the Slack Connector<a class="headerlink" href="#using-the-slack-connector" title="Permanent link">&para;</a></h3>
<p>The <strong>slack</strong> connector provides two distinct interfaces:</p>
<ol>
<li>
<p>A <a href="#python-interface-for-slack-connectors">native Python interface</a></p>
</li>
<li>
<p>A <a href="#executable-interface-for-slack-connectors">command line interface</a>.</p>
</li>
</ol>
<h4 id="python-interface-for-slack-connectors">Python Interface for Slack Connectors<a class="headerlink" href="#python-interface-for-slack-connectors" title="Permanent link">&para;</a></h4>
<p>Python scripts can directly access the underlying Python interface of a <strong>slack</strong>
connector. In this case, the connector returns a <code>lava.lib.slack.Slack</code>
object as described in the lava API documentation.</p>
<p>As an example, consider an <a href="06-jobs-job-types.html#job-type-exe">exe</a> job specification
that looks something like this:</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-50-1"><span class="p">{</span>
</span><span id="__span-50-2"><span class="w">    </span><span class="nt">&quot;job_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;...&quot;</span><span class="p">,</span>
</span><span id="__span-50-3"><span class="w">    </span><span class="nt">&quot;parameters&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-50-4"><span class="w">        </span><span class="nt">&quot;connections&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-50-5"><span class="w">            </span><span class="nt">&quot;slack&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;slack-connection-id&quot;</span>
</span><span id="__span-50-6"><span class="w">        </span><span class="p">}</span>
</span><span id="__span-50-7"><span class="w">    </span><span class="p">},</span>
</span><span id="__span-50-8"><span class="w">    </span><span class="nt">&quot;payload&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;my-payload.py ...&quot;</span>
</span><span id="__span-50-9"><span class="p">}</span>
</span></code></pre></div>
<p>A Python program can use the <strong>slack</strong> connector like this:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-51-1"><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
</span><span id="__span-51-2"><span class="kn">from</span><span class="w"> </span><span class="nn">lava.connection</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_slack_connection</span>
</span><span id="__span-51-3">
</span><span id="__span-51-4"><span class="c1"># If running as a lava exe/pkg/docker, get some info provided by lava in the</span>
</span><span id="__span-51-5"><span class="c1"># environment. Assume our connector is labeled `slack` in the job spec.</span>
</span><span id="__span-51-6"><span class="n">realm</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;LAVA_REALM&#39;</span><span class="p">]</span>
</span><span id="__span-51-7"><span class="n">conn_id</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;LAVA_CONNID_SLACK&#39;</span><span class="p">]</span>
</span><span id="__span-51-8">
</span><span id="__span-51-9"><span class="c1"># Get a slack connection </span>
</span><span id="__span-51-10"><span class="n">slacker</span> <span class="o">=</span> <span class="n">get_slack_connection</span><span class="p">(</span><span class="n">conn_id</span><span class="p">,</span> <span class="n">realm</span><span class="p">)</span>
</span><span id="__span-51-11">
</span><span id="__span-51-12"><span class="c1"># Send a formatted message</span>
</span><span id="__span-51-13"><span class="n">slacker</span><span class="o">.</span><span class="n">send</span><span class="p">(</span>
</span><span id="__span-51-14">    <span class="n">subject</span><span class="o">=</span><span class="s1">&#39;Oh no&#39;</span><span class="p">,</span>
</span><span id="__span-51-15">    <span class="n">message</span><span class="o">=</span><span class="s1">&#39;Your oscillation overthruster has malfunctioned&#39;</span><span class="p">,</span>
</span><span id="__span-51-16">    <span class="n">style</span><span class="o">=</span><span class="s1">&#39;attachment&#39;</span><span class="p">,</span>  <span class="c1"># Overrides value in connection spec.</span>
</span><span id="__span-51-17">    <span class="n">colour</span><span class="o">=</span><span class="s1">&#39;#ff0000&#39;</span>  <span class="c1"># Nice bright red. Overrides value in connection spec.</span>
</span><span id="__span-51-18"><span class="p">)</span>
</span></code></pre></div>
<h4 id="executable-interface-for-slack-connectors">Executable Interface for Slack Connectors<a class="headerlink" href="#executable-interface-for-slack-connectors" title="Permanent link">&para;</a></h4>
<p>When used with <a href="06-jobs-job-types.html#job-type-exe">exe</a>,
<a href="06-jobs-job-types.html#job-type-pkg">pkg</a> and
<a href="06-jobs-job-types.html#job-type-docker">docker</a> job types (e.g. shell scripts), the
connection is implemented by the <code>lava-slack</code> command.</p>
<p>When used as a connection script within a lava job, the <code>-r REALM</code> and
<code>-c CONN_ID</code> arguments don't need to be provided by the job as these are
provided by lava in the connection script.</p>
<p>Also, values for the <code>---bar-colour</code>, <code>--from</code>, <code>--preamble</code> and <code>--style</code>
options will be supplied from the connection specification where possible.
These values can be overridden by providing the appropriate options to then
connection script.</p>
<div class="language-bare highlight"><pre><span></span><code><span id="__span-52-1"><span class="err">usage:</span><span class="w"> </span><span class="err">lava-slack</span><span class="w"> </span><span class="err">[-h]</span><span class="w"> </span><span class="err">[--profile</span><span class="w"> </span><span class="err">PROFILE]</span><span class="w"> </span><span class="err">[-v]</span><span class="w"> </span><span class="err">-c</span><span class="w"> </span><span class="err">CONN_ID</span><span class="w"> </span><span class="err">[-r</span><span class="w"> </span><span class="err">REALM]</span>
</span><span id="__span-52-2"><span class="w">                  </span><span class="err">[--bar-colour</span><span class="w"> </span><span class="err">COLOUR]</span><span class="w"> </span><span class="err">[--from</span><span class="w"> </span><span class="err">NAME]</span><span class="w"> </span><span class="err">[--preamble</span><span class="w"> </span><span class="err">PREAMBLE]</span>
</span><span id="__span-52-3"><span class="w">                  </span><span class="err">[-s</span><span class="w"> </span><span class="err">SUBJECT]</span><span class="w"> </span><span class="err">[--style</span><span class="w"> </span><span class="err">{block,plain,attachment}]</span>
</span><span id="__span-52-4"><span class="w">                  </span><span class="err">[--no-colour]</span><span class="w"> </span><span class="err">[-l</span><span class="w"> </span><span class="err">LEVEL]</span><span class="w"> </span><span class="err">[--log</span><span class="w"> </span><span class="err">LOG]</span><span class="w"> </span><span class="err">[--tag</span><span class="w"> </span><span class="err">TAG]</span>
</span><span id="__span-52-5"><span class="w">                  </span><span class="err">[FILENAME]</span>
</span><span id="__span-52-6">
</span><span id="__span-52-7"><span class="err">Send</span><span class="w"> </span><span class="err">Slack</span><span class="w"> </span><span class="err">messages</span><span class="w"> </span><span class="err">using</span><span class="w"> </span><span class="err">lava</span><span class="w"> </span><span class="err">slack</span><span class="w"> </span><span class="err">connections.</span>
</span><span id="__span-52-8">
</span><span id="__span-52-9"><span class="err">optional</span><span class="w"> </span><span class="err">arguments:</span>
</span><span id="__span-52-10"><span class="w">  </span><span class="err">-h,</span><span class="w"> </span><span class="err">--help</span><span class="w">            </span><span class="err">show</span><span class="w"> </span><span class="err">this</span><span class="w"> </span><span class="err">help</span><span class="w"> </span><span class="err">message</span><span class="w"> </span><span class="err">and</span><span class="w"> </span><span class="err">exit</span>
</span><span id="__span-52-11"><span class="w">  </span><span class="err">--profile</span><span class="w"> </span><span class="err">PROFILE</span><span class="w">     </span><span class="err">As</span><span class="w"> </span><span class="err">for</span><span class="w"> </span><span class="err">AWS</span><span class="w"> </span><span class="err">CLI.</span>
</span><span id="__span-52-12"><span class="w">  </span><span class="err">-v,</span><span class="w"> </span><span class="err">--version</span><span class="w">         </span><span class="err">show</span><span class="w"> </span><span class="err">program&#39;s</span><span class="w"> </span><span class="err">version</span><span class="w"> </span><span class="err">number</span><span class="w"> </span><span class="err">and</span><span class="w"> </span><span class="err">exit</span>
</span><span id="__span-52-13">
</span><span id="__span-52-14"><span class="err">lava</span><span class="w"> </span><span class="err">arguments:</span>
</span><span id="__span-52-15"><span class="w">  </span><span class="err">-c</span><span class="w"> </span><span class="err">CONN_ID,</span><span class="w"> </span><span class="err">--conn-id</span><span class="w"> </span><span class="err">CONN_ID</span>
</span><span id="__span-52-16"><span class="w">                        </span><span class="err">Lava</span><span class="w"> </span><span class="err">connection</span><span class="w"> </span><span class="err">ID.</span><span class="w"> </span><span class="err">Required.</span>
</span><span id="__span-52-17"><span class="w">  </span><span class="err">-r</span><span class="w"> </span><span class="err">REALM,</span><span class="w"> </span><span class="err">--realm</span><span class="w"> </span><span class="err">REALM</span>
</span><span id="__span-52-18"><span class="w">                        </span><span class="err">Lava</span><span class="w"> </span><span class="err">realm</span><span class="w"> </span><span class="err">name.</span><span class="w"> </span><span class="err">If</span><span class="w"> </span><span class="err">not</span><span class="w"> </span><span class="err">specified,</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">environment</span>
</span><span id="__span-52-19"><span class="w">                        </span><span class="err">variable</span><span class="w"> </span><span class="err">LAVA_REALM</span><span class="w"> </span><span class="err">must</span><span class="w"> </span><span class="err">be</span><span class="w"> </span><span class="err">set.</span>
</span><span id="__span-52-20">
</span><span id="__span-52-21"><span class="err">slack</span><span class="w"> </span><span class="err">arguments:</span>
</span><span id="__span-52-22"><span class="w">  </span><span class="err">--bar-colour</span><span class="w"> </span><span class="err">COLOUR</span><span class="w">   </span><span class="err">Colour</span><span class="w"> </span><span class="err">for</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">sidebar</span><span class="w"> </span><span class="err">for</span><span class="w"> </span><span class="err">messages</span><span class="w"> </span><span class="err">sent</span><span class="w"> </span><span class="err">using</span>
</span><span id="__span-52-23"><span class="w">                        </span><span class="err">attachment</span><span class="w"> </span><span class="err">style.</span><span class="w"> </span><span class="err">This</span><span class="w"> </span><span class="err">can</span><span class="w"> </span><span class="err">be</span><span class="w"> </span><span class="err">any</span><span class="w"> </span><span class="err">hex</span><span class="w"> </span><span class="err">colour</span><span class="w"> </span><span class="err">code</span><span class="w"> </span><span class="err">or</span>
</span><span id="__span-52-24"><span class="w">                        </span><span class="err">one</span><span class="w"> </span><span class="err">of</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">Slack</span><span class="w"> </span><span class="err">special</span><span class="w"> </span><span class="err">values</span><span class="w"> </span><span class="err">good,</span><span class="w"> </span><span class="err">warning</span><span class="w"> </span><span class="err">or</span>
</span><span id="__span-52-25"><span class="w">                        </span><span class="err">danger.</span>
</span><span id="__span-52-26"><span class="w">  </span><span class="err">--from</span><span class="w"> </span><span class="err">NAME</span><span class="w">           </span><span class="err">Message</span><span class="w"> </span><span class="err">sender.</span><span class="w"> </span><span class="err">If</span><span class="w"> </span><span class="err">not</span><span class="w"> </span><span class="err">specified,</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">value</span><span class="w"> </span><span class="err">specified</span>
</span><span id="__span-52-27"><span class="w">                        </span><span class="err">in</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">connection</span><span class="w"> </span><span class="err">specification,</span><span class="w"> </span><span class="err">if</span><span class="w"> </span><span class="err">any,</span><span class="w"> </span><span class="err">will</span><span class="w"> </span><span class="err">be</span><span class="w"> </span><span class="err">used.</span>
</span><span id="__span-52-28"><span class="w">  </span><span class="err">--preamble</span><span class="w"> </span><span class="err">PREAMBLE</span><span class="w">   </span><span class="err">An</span><span class="w"> </span><span class="err">optional</span><span class="w"> </span><span class="err">preamble</span><span class="w"> </span><span class="err">at</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">start</span><span class="w"> </span><span class="err">of</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">message.</span>
</span><span id="__span-52-29"><span class="w">                        </span><span class="err">Useful</span><span class="w"> </span><span class="err">values</span><span class="w"> </span><span class="err">include</span><span class="w"> </span><span class="err">things</span><span class="w"> </span><span class="err">such</span><span class="w"> </span><span class="err">as</span><span class="w"> </span><span class="err">&lt;!here&gt;</span><span class="w"> </span><span class="err">and</span>
</span><span id="__span-52-30"><span class="w">                        </span><span class="err">&lt;!channel&gt;</span><span class="w"> </span><span class="err">which</span><span class="w"> </span><span class="err">will</span><span class="w"> </span><span class="err">cause</span><span class="w"> </span><span class="err">Slack</span><span class="w"> </span><span class="err">to</span><span class="w"> </span><span class="err">insert</span><span class="w"> </span><span class="err">@here</span><span class="w"> </span><span class="err">and</span>
</span><span id="__span-52-31"><span class="w">                        </span><span class="err">@channel</span><span class="w"> </span><span class="err">alert</span><span class="w"> </span><span class="err">tags</span><span class="w"> </span><span class="err">respectively.</span>
</span><span id="__span-52-32"><span class="w">  </span><span class="err">-s</span><span class="w"> </span><span class="err">SUBJECT,</span><span class="w"> </span><span class="err">--subject</span><span class="w"> </span><span class="err">SUBJECT</span>
</span><span id="__span-52-33"><span class="w">                        </span><span class="err">Message</span><span class="w"> </span><span class="err">subject.</span>
</span><span id="__span-52-34"><span class="w">  </span><span class="err">--style</span><span class="w"> </span><span class="err">{block,plain,attachment}</span>
</span><span id="__span-52-35"><span class="w">                        </span><span class="err">Slack</span><span class="w"> </span><span class="err">message</span><span class="w"> </span><span class="err">style.</span><span class="w"> </span><span class="err">Must</span><span class="w"> </span><span class="err">be</span><span class="w"> </span><span class="err">one</span><span class="w"> </span><span class="err">of</span><span class="w"> </span><span class="err">attachment,</span><span class="w"> </span><span class="err">block,</span>
</span><span id="__span-52-36"><span class="w">                        </span><span class="err">plain.</span><span class="w"> </span><span class="err">If</span><span class="w"> </span><span class="err">not</span><span class="w"> </span><span class="err">specified,</span><span class="w"> </span><span class="err">any</span><span class="w"> </span><span class="err">value</span><span class="w"> </span><span class="err">specified</span><span class="w"> </span><span class="err">in</span><span class="w"> </span><span class="err">the</span>
</span><span id="__span-52-37"><span class="w">                        </span><span class="err">connection</span><span class="w"> </span><span class="err">specification</span><span class="w"> </span><span class="err">will</span><span class="w"> </span><span class="err">be</span><span class="w"> </span><span class="err">used</span><span class="w"> </span><span class="err">or</span><span class="w"> </span><span class="err">block</span><span class="w"> </span><span class="err">as</span><span class="w"> </span><span class="err">a</span>
</span><span id="__span-52-38"><span class="w">                        </span><span class="err">last</span><span class="w"> </span><span class="err">resort.</span>
</span><span id="__span-52-39">
</span><span id="__span-52-40"><span class="err">message</span><span class="w"> </span><span class="err">source</span><span class="w"> </span><span class="err">arguments:</span>
</span><span id="__span-52-41"><span class="w">  </span><span class="err">FILENAME</span><span class="w">              </span><span class="err">Name</span><span class="w"> </span><span class="err">of</span><span class="w"> </span><span class="err">file</span><span class="w"> </span><span class="err">containing</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">message</span><span class="w"> </span><span class="err">body.</span><span class="w"> </span><span class="err">If</span><span class="w"> </span><span class="err">not</span>
</span><span id="__span-52-42"><span class="w">                        </span><span class="err">specified</span><span class="w"> </span><span class="err">or</span><span class="w"> </span><span class="err">&quot;-&quot;,</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">body</span><span class="w"> </span><span class="err">will</span><span class="w"> </span><span class="err">be</span><span class="w"> </span><span class="err">read</span><span class="w"> </span><span class="err">from</span><span class="w"> </span><span class="err">stdin.</span>
</span><span id="__span-52-43"><span class="w">                        </span><span class="err">Only</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">first</span><span class="w"> </span><span class="err">3000</span><span class="w"> </span><span class="err">bytes</span><span class="w"> </span><span class="err">are</span><span class="w"> </span><span class="err">read.</span>
</span><span id="__span-52-44">
</span><span id="__span-52-45"><span class="err">logging</span><span class="w"> </span><span class="err">arguments:</span>
</span><span id="__span-52-46"><span class="w">  </span><span class="err">--no-colour,</span><span class="w"> </span><span class="err">--no-color</span>
</span><span id="__span-52-47"><span class="w">                        </span><span class="err">Don&#39;t</span><span class="w"> </span><span class="err">use</span><span class="w"> </span><span class="err">colour</span><span class="w"> </span><span class="err">in</span><span class="w"> </span><span class="err">information</span><span class="w"> </span><span class="err">messages.</span>
</span><span id="__span-52-48"><span class="w">  </span><span class="err">-l</span><span class="w"> </span><span class="err">LEVEL,</span><span class="w"> </span><span class="err">--level</span><span class="w"> </span><span class="err">LEVEL</span>
</span><span id="__span-52-49"><span class="w">                        </span><span class="err">Print</span><span class="w"> </span><span class="err">messages</span><span class="w"> </span><span class="err">of</span><span class="w"> </span><span class="err">a</span><span class="w"> </span><span class="err">given</span><span class="w"> </span><span class="err">severity</span><span class="w"> </span><span class="err">level</span><span class="w"> </span><span class="err">or</span><span class="w"> </span><span class="err">above.</span><span class="w"> </span><span class="err">The</span>
</span><span id="__span-52-50"><span class="w">                        </span><span class="err">standard</span><span class="w"> </span><span class="err">logging</span><span class="w"> </span><span class="err">level</span><span class="w"> </span><span class="err">names</span><span class="w"> </span><span class="err">are</span><span class="w"> </span><span class="err">available</span><span class="w"> </span><span class="err">but</span><span class="w"> </span><span class="err">debug,</span>
</span><span id="__span-52-51"><span class="w">                        </span><span class="err">info,</span><span class="w"> </span><span class="err">warning</span><span class="w"> </span><span class="err">and</span><span class="w"> </span><span class="err">error</span><span class="w"> </span><span class="err">are</span><span class="w"> </span><span class="err">most</span><span class="w"> </span><span class="err">useful.</span><span class="w"> </span><span class="err">The</span><span class="w"> </span><span class="err">default</span>
</span><span id="__span-52-52"><span class="w">                        </span><span class="err">is</span><span class="w"> </span><span class="err">info.</span>
</span><span id="__span-52-53"><span class="w">  </span><span class="err">--log</span><span class="w"> </span><span class="err">LOG</span><span class="w">             </span><span class="err">Log</span><span class="w"> </span><span class="err">to</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">specified</span><span class="w"> </span><span class="err">target.</span><span class="w"> </span><span class="err">This</span><span class="w"> </span><span class="err">can</span><span class="w"> </span><span class="err">be</span><span class="w"> </span><span class="err">either</span><span class="w"> </span><span class="err">a</span><span class="w"> </span><span class="err">file</span>
</span><span id="__span-52-54"><span class="w">                        </span><span class="err">name</span><span class="w"> </span><span class="err">or</span><span class="w"> </span><span class="err">a</span><span class="w"> </span><span class="err">syslog</span><span class="w"> </span><span class="err">facility</span><span class="w"> </span><span class="err">with</span><span class="w"> </span><span class="err">an</span><span class="w"> </span><span class="err">@</span><span class="w"> </span><span class="err">prefix</span><span class="w"> </span><span class="err">(e.g.</span>
</span><span id="__span-52-55"><span class="w">                        </span><span class="err">@local0).</span>
</span><span id="__span-52-56"><span class="w">  </span><span class="err">--tag</span><span class="w"> </span><span class="err">TAG</span><span class="w">             </span><span class="err">Tag</span><span class="w"> </span><span class="err">log</span><span class="w"> </span><span class="err">entries</span><span class="w"> </span><span class="err">with</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">specified</span><span class="w"> </span><span class="err">value.</span><span class="w"> </span><span class="err">The</span><span class="w"> </span><span class="err">default</span>
</span><span id="__span-52-57"><span class="w">                        </span><span class="err">is</span><span class="w"> </span><span class="err">lava-slack.</span>
</span></code></pre></div>
<p>As an example, consider an <a href="06-jobs-job-types.html#job-type-exe">exe</a> job specification
that looks something like this:</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-53-1"><span class="p">{</span>
</span><span id="__span-53-2"><span class="w">    </span><span class="nt">&quot;job_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;...&quot;</span><span class="p">,</span>
</span><span id="__span-53-3"><span class="w">    </span><span class="nt">&quot;parameters&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-53-4"><span class="w">        </span><span class="nt">&quot;connections&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-53-5"><span class="w">            </span><span class="nt">&quot;slack&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;slack-connection-id&quot;</span>
</span><span id="__span-53-6"><span class="w">        </span><span class="p">}</span>
</span><span id="__span-53-7"><span class="w">    </span><span class="p">},</span>
</span><span id="__span-53-8"><span class="w">    </span><span class="nt">&quot;payload&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;my-payload.sh ...&quot;</span>
</span><span id="__span-53-9"><span class="p">}</span>
</span></code></pre></div>
<p>Note the <code>slack</code> connection. This will provide the job with an environment
variable <code>LAVA_CONN_SLACK</code> which points to the executable handling the
connection.</p>
<p>If the job payload is a shell script, the connector would be invoked thus:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-54-1"><span class="c1"># Send a Slack message</span>
</span><span id="__span-54-2"><span class="nv">$LAVA_CONN_SLACK</span><span class="w"> </span>--subject<span class="w"> </span><span class="s2">&quot;Oh no&quot;</span><span class="w"> </span>&lt;&lt;!
</span><span id="__span-54-3"><span class="w">    </span>Dear<span class="w"> </span>Buckaroo,
</span><span id="__span-54-4">
</span><span id="__span-54-5"><span class="w">    </span>Your<span class="w"> </span>oscillation<span class="w"> </span>overthruster<span class="w"> </span>has<span class="w"> </span>malfunctioned.
</span><span id="__span-54-6">
</span><span id="__span-54-7"><span class="w">    </span>--<span class="w"> </span>John<span class="w"> </span>Bigboot
</span><span id="__span-54-8">!
</span></code></pre></div>
<h2 id="connector-type-smb">Connector type: smb<a class="headerlink" href="#connector-type-smb" title="Permanent link">&para;</a></h2>
<p>The <strong>smb</strong> connector manages connections to SMB file shares.</p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>The <strong>smb</strong> connector has undergone a significant upgrade in v8.0
(Incahuasi) to support the
<a href="https://github.com/jborean93/smbprotocol">smbprotocol</a> SMB implementation
as well as the existing
<a href="https://pysmb.readthedocs.io/en/latest/api/smb_SMBConnection.html">pysmb</a>.
The former has a number of advantages (e.g. DFS support). An effort has been
made to retain backward compatibility for lava jobs, notwithstanding the two
implementations have significant interface differences. Be warned, though,
that some more esoteric usage patterns could experience a backward
compatibility issue.</p>
</div>
<table>
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>conn_id</td>
<td>String</td>
<td>Yes</td>
<td>Connection identifier.</td>
</tr>
<tr>
<td>description</td>
<td>String</td>
<td>No</td>
<td>Description.</td>
</tr>
<tr>
<td>domain</td>
<td>String</td>
<td>No</td>
<td>The network domain. Defaults to an empty string.</td>
</tr>
<tr>
<td>enabled</td>
<td>Boolean</td>
<td>Yes</td>
<td>Whether or not the connection is enabled.</td>
</tr>
<tr>
<td>encrypt</td>
<td>Boolean</td>
<td>No</td>
<td>Whether to encrypt the connection between Lava and the SMB server. Only available with the <code>smbprotocol</code> connection subtype. Default <code>false</code>.</td>
</tr>
<tr>
<td>host</td>
<td>String</td>
<td>Yes</td>
<td>DNS name or IP address of the SMB host.</td>
</tr>
<tr>
<td>is_direct_tcp</td>
<td>Boolean</td>
<td>No</td>
<td>If <code>false</code>, use NetBIOS over TCP/IP. If <code>true</code> use SMB over TCP/IP. Default <code>false</code>.</td>
</tr>
<tr>
<td>my_name</td>
<td>String</td>
<td>No</td>
<td>Local NetBIOS machine name that will identify the origin of connections. If not specified, defaults to the first 15 characters of <code>lava-&lt;REALM&gt;</code></td>
</tr>
<tr>
<td>password</td>
<td>String</td>
<td>Yes</td>
<td>Name of the SSM parameter containing the password for authenticating to the SMB server. For a given <code>&lt;REALM&gt;</code>, the SSM parameter name must be of the form <code>/lava/&lt;REALM&gt;/...</code> and the value must be a secure string encrypted using the <code>lava-&lt;REALM&gt;-sys</code> KMS key.</td>
</tr>
<tr>
<td>port</td>
<td>Integer</td>
<td>No</td>
<td>Connection port number. If not specified, 139 is used if <code>is_direct_tcp</code> is <code>false</code> and 445 otherwise.</td>
</tr>
<tr>
<td>remote_name</td>
<td>String</td>
<td>Yes</td>
<td>NetBIOS machine name of the remote server.</td>
</tr>
<tr>
<td>subtype</td>
<td>String</td>
<td>No</td>
<td>Which connection type to use, <code>smbprotocol</code> or the default <code>pysmb</code>. To use encryption or DFS for the connection use the <code>smbprotocol</code> subtype.</td>
</tr>
<tr>
<td>type</td>
<td>String</td>
<td>Yes</td>
<td><code>smb</code>.</td>
</tr>
<tr>
<td>use_ntlm_v2</td>
<td>Boolean</td>
<td>No</td>
<td>Indicates whether pysmb should be NTLMv1 or NTLMv2 authentication algorithm for authentication. Default is <code>true</code>.</td>
</tr>
<tr>
<td>user</td>
<td>String</td>
<td>Yes</td>
<td>User name for authenticating to the SMB server.</td>
</tr>
</tbody>
</table>
<p>The connector supports the <a href="06-jobs-job-types.html#job-type-smb_get">smb_get</a> and
<a href="06-jobs-job-types.html#job-type-smb_put">smb_put</a> job types.</p>
<h3 id="use-with-python-based-executable-jobs">Use with Python-based Executable Jobs<a class="headerlink" href="#use-with-python-based-executable-jobs" title="Permanent link">&para;</a></h3>
<p>The connector can also be used with Python based
<a href="06-jobs-job-types.html#job-type-exe">exe</a> and <a href="06-jobs-job-types.html#job-type-pkg">pkg</a>
jobs that invoke the lava connection manager directly. In this case, the
connector returns a <code>lava.lib.smb.LavaSMBConnection</code> which provides a basic,
common interface to the different subtypes.</p>
<p>The <code>lava.lib.smb.LavaSMBConnection</code> interface class provides enough
functionality for most common use-cases (list path, put file, get file etc.).</p>
<p>The concrete implementation is handled by of one of two subclasses (depending on
the <code>subtype</code> given in the connection spec):</p>
<ul>
<li>
<p>a <code>lava.lib.smb.PySMBConnection</code> which implements <code>LavaSMBConnection</code> using
    the Python package
    <a href="https://pysmb.readthedocs.io/en/latest/api/smb_SMBConnection.html">pysmb</a>.
    This is the <strong>default</strong> if no connection <code>subtype</code> is given.</p>
</li>
<li>
<p>a <code>lava.lib.smb.SMBProtocolConnection</code> which implements <code>LavaSMBConnection</code>
    using the Python package
    <a href="https://github.com/jborean93/smbprotocol">smbprotocol</a>.</p>
</li>
</ul>
<p>Note that this is the low level connector. It does not handle moving files in or
out of S3 or Jinja rendering of parameters. It is up to the caller to do that as
required.</p>
<p>If the SMB connector key in the job's <code>connectors</code> map is <code>fserver</code>, typical
usage would be something like:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-55-1"><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
</span><span id="__span-55-2"><span class="kn">from</span><span class="w"> </span><span class="nn">lava.connection</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_smb_connection</span>
</span><span id="__span-55-3">
</span><span id="__span-55-4"><span class="c1"># Get an smb.SMBConnection.SMBConnection instance</span>
</span><span id="__span-55-5"><span class="n">smb_conn</span> <span class="o">=</span> <span class="n">get_smb_connection</span><span class="p">(</span>
</span><span id="__span-55-6">    <span class="n">conn_id</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;LAVA_CONNID_FSERVER&#39;</span><span class="p">],</span>
</span><span id="__span-55-7">    <span class="n">realm</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;LAVA_REALM&#39;</span><span class="p">]</span>
</span><span id="__span-55-8"><span class="p">)</span>
</span><span id="__span-55-9">
</span><span id="__span-55-10"><span class="c1"># Get a file from share &#39;Public&#39; and store locally</span>
</span><span id="__span-55-11"><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;local.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
</span><span id="__span-55-12">    <span class="n">attributes</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="n">smb_conn</span><span class="o">.</span><span class="n">retrieve_file</span><span class="p">(</span><span class="s1">&#39;Public&#39;</span><span class="p">,</span> <span class="s1">&#39;some_file.txt&#39;</span><span class="p">,</span> <span class="n">fp</span><span class="p">)</span>
</span><span id="__span-55-13">
</span><span id="__span-55-14"><span class="n">smb_conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span></code></pre></div>
<h3 id="use-with-other-executable-jobs">Use with Other Executable Jobs<a class="headerlink" href="#use-with-other-executable-jobs" title="Permanent link">&para;</a></h3>
<p>When used with other <a href="06-jobs-job-types.html#job-type-exe">exe</a> and
<a href="06-jobs-job-types.html#job-type-pkg">pkg</a> job types (e.g. shell scripts), the
connection is implemented by the <code>lava-smb</code> command.</p>
<p>This is a somewhat higher level interface to the connector in that it can also
handle moving data in and out of S3. Jinja rendering is handled as per the
<a href="06-jobs-job-types.html#job-type-smb_get">smb_get</a> and
<a href="06-jobs-job-types.html#job-type-smb_put">smb_put</a> job types.</p>
<p>If the SMB connector key in the job's <code>connectors</code> map is <code>fserver</code>, usage is:</p>
<div class="language-bare highlight"><pre><span></span><code><span id="__span-56-1"><span class="err">usage:</span><span class="w"> </span><span class="err">$LAVA_CONN_FSERVER</span><span class="w"> </span><span class="err">[-J]</span><span class="w"> </span><span class="err">[-l</span><span class="w"> </span><span class="err">LEVEL]</span><span class="w"> </span><span class="err">{put,get}</span><span class="w"> </span><span class="err">...</span>
</span><span id="__span-56-2">
</span><span id="__span-56-3"><span class="err">sub-commands:</span>
</span><span id="__span-56-4"><span class="w">  </span><span class="err">{put,get}</span>
</span><span id="__span-56-5"><span class="w">    </span><span class="err">put</span><span class="w">                 </span><span class="err">Copy</span><span class="w"> </span><span class="err">a</span><span class="w"> </span><span class="err">file</span><span class="w"> </span><span class="err">to</span><span class="w"> </span><span class="err">an</span><span class="w"> </span><span class="err">SMB</span><span class="w"> </span><span class="err">file</span><span class="w"> </span><span class="err">share.</span>
</span><span id="__span-56-6"><span class="w">    </span><span class="err">get</span><span class="w">                 </span><span class="err">Copy</span><span class="w"> </span><span class="err">a</span><span class="w"> </span><span class="err">file</span><span class="w"> </span><span class="err">from</span><span class="w"> </span><span class="err">an</span><span class="w"> </span><span class="err">SMB</span><span class="w"> </span><span class="err">file</span><span class="w"> </span><span class="err">share.</span>
</span><span id="__span-56-7">
</span><span id="__span-56-8"><span class="err">optional</span><span class="w"> </span><span class="err">arguments:</span>
</span><span id="__span-56-9"><span class="w">  </span><span class="err">-J,</span><span class="w"> </span><span class="err">--no-jinja</span><span class="w">        </span><span class="err">Disable</span><span class="w"> </span><span class="err">Jinja</span><span class="w"> </span><span class="err">rendering</span><span class="w"> </span><span class="err">of</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">transfer</span><span class="w"> </span><span class="err">parameters.</span>
</span><span id="__span-56-10">
</span><span id="__span-56-11"><span class="err">logging</span><span class="w"> </span><span class="err">arguments:</span>
</span><span id="__span-56-12"><span class="w">  </span><span class="err">-l</span><span class="w"> </span><span class="err">LEVEL,</span><span class="w"> </span><span class="err">--level</span><span class="w"> </span><span class="err">LEVEL</span>
</span><span id="__span-56-13"><span class="w">                        </span><span class="err">Print</span><span class="w"> </span><span class="err">messages</span><span class="w"> </span><span class="err">of</span><span class="w"> </span><span class="err">a</span><span class="w"> </span><span class="err">given</span><span class="w"> </span><span class="err">severity</span><span class="w"> </span><span class="err">level</span><span class="w"> </span><span class="err">or</span><span class="w"> </span><span class="err">above.</span><span class="w"> </span><span class="err">The</span>
</span><span id="__span-56-14"><span class="w">                        </span><span class="err">standard</span><span class="w"> </span><span class="err">logging</span><span class="w"> </span><span class="err">level</span><span class="w"> </span><span class="err">names</span><span class="w"> </span><span class="err">are</span><span class="w"> </span><span class="err">available</span><span class="w"> </span><span class="err">but</span><span class="w"> </span><span class="err">debug,</span>
</span><span id="__span-56-15"><span class="w">                        </span><span class="err">info,</span><span class="w"> </span><span class="err">warning</span><span class="w"> </span><span class="err">and</span><span class="w"> </span><span class="err">error</span><span class="w"> </span><span class="err">are</span><span class="w"> </span><span class="err">most</span><span class="w"> </span><span class="err">useful.</span><span class="w"> </span><span class="err">The</span><span class="w"> </span><span class="err">Default</span>
</span><span id="__span-56-16"><span class="w">                        </span><span class="err">is</span><span class="w"> </span><span class="err">info.</span>
</span></code></pre></div>
<p>Usage for the <code>get</code> sub-command:</p>
<div class="language-bare highlight"><pre><span></span><code><span id="__span-57-1"><span class="err">usage:</span><span class="w"> </span><span class="err">$LAVA_CONN_FSERVER</span><span class="w"> </span><span class="err">get</span><span class="w"> </span><span class="err">[options]</span><span class="w"> </span><span class="err">SMB-path</span><span class="w"> </span><span class="err">file</span>
</span><span id="__span-57-2">
</span><span id="__span-57-3"><span class="err">positional</span><span class="w"> </span><span class="err">arguments:</span>
</span><span id="__span-57-4"><span class="w">  </span><span class="err">SMB-path</span><span class="w">              </span><span class="err">Source</span><span class="w"> </span><span class="err">location.</span><span class="w"> </span><span class="err">Must</span><span class="w"> </span><span class="err">be</span><span class="w"> </span><span class="err">in</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">form</span><span class="w"> </span><span class="err">share-name:path.</span>
</span><span id="__span-57-5"><span class="w">                        </span><span class="err">This</span><span class="w"> </span><span class="err">will</span><span class="w"> </span><span class="err">be</span><span class="w"> </span><span class="err">jinja</span><span class="w"> </span><span class="err">rendered.</span>
</span><span id="__span-57-6"><span class="w">  </span><span class="err">file</span><span class="w">                  </span><span class="err">Target</span><span class="w"> </span><span class="err">file.</span><span class="w"> </span><span class="err">Values</span><span class="w"> </span><span class="err">starting</span><span class="w"> </span><span class="err">with</span><span class="w"> </span><span class="err">s3://</span><span class="w"> </span><span class="err">will</span><span class="w"> </span><span class="err">be</span><span class="w"> </span><span class="err">copied</span>
</span><span id="__span-57-7"><span class="w">                        </span><span class="err">to</span><span class="w"> </span><span class="err">S3.</span><span class="w"> </span><span class="err">This</span><span class="w"> </span><span class="err">will</span><span class="w"> </span><span class="err">be</span><span class="w"> </span><span class="err">jinja</span><span class="w"> </span><span class="err">rendered.</span>
</span><span id="__span-57-8">
</span><span id="__span-57-9"><span class="err">optional</span><span class="w"> </span><span class="err">arguments:</span>
</span><span id="__span-57-10"><span class="w">  </span><span class="err">-k</span><span class="w"> </span><span class="err">KMS_KEY_ID,</span><span class="w"> </span><span class="err">--kms-key-id</span><span class="w"> </span><span class="err">KMS_KEY_ID</span>
</span><span id="__span-57-11"><span class="w">                        </span><span class="err">AWS</span><span class="w"> </span><span class="err">KMS</span><span class="w"> </span><span class="err">key</span><span class="w"> </span><span class="err">to</span><span class="w"> </span><span class="err">use</span><span class="w"> </span><span class="err">for</span><span class="w"> </span><span class="err">uploading</span><span class="w"> </span><span class="err">data</span><span class="w"> </span><span class="err">to</span><span class="w"> </span><span class="err">S3.</span>
</span></code></pre></div>
<p>Usage for the <code>put</code> sub-command:</p>
<div class="language-bare highlight"><pre><span></span><code><span id="__span-58-1"><span class="err">usage:</span><span class="w"> </span><span class="err">$LAVA_CONN_FSERVER</span><span class="w"> </span><span class="err">put</span><span class="w"> </span><span class="err">[options]</span><span class="w"> </span><span class="err">file</span><span class="w"> </span><span class="err">SMB-path</span>
</span><span id="__span-58-2">
</span><span id="__span-58-3"><span class="err">positional</span><span class="w"> </span><span class="err">arguments:</span>
</span><span id="__span-58-4"><span class="w">  </span><span class="err">file</span><span class="w">         </span><span class="err">Source</span><span class="w"> </span><span class="err">file.</span><span class="w"> </span><span class="err">Values</span><span class="w"> </span><span class="err">starting</span><span class="w"> </span><span class="err">with</span><span class="w"> </span><span class="err">s3://</span><span class="w"> </span><span class="err">will</span><span class="w"> </span><span class="err">be</span><span class="w"> </span><span class="err">copied</span><span class="w"> </span><span class="err">from</span><span class="w"> </span><span class="err">S3.</span>
</span><span id="__span-58-5"><span class="w">               </span><span class="err">This</span><span class="w"> </span><span class="err">will</span><span class="w"> </span><span class="err">be</span><span class="w"> </span><span class="err">jinja</span><span class="w"> </span><span class="err">rendered.</span>
</span><span id="__span-58-6"><span class="w">  </span><span class="err">SMB-path</span><span class="w">     </span><span class="err">Target</span><span class="w"> </span><span class="err">location.</span><span class="w"> </span><span class="err">Must</span><span class="w"> </span><span class="err">be</span><span class="w"> </span><span class="err">in</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">form</span><span class="w"> </span><span class="err">share-name:path.</span><span class="w"> </span><span class="err">This</span><span class="w"> </span><span class="err">will</span>
</span><span id="__span-58-7"><span class="w">               </span><span class="err">be</span><span class="w"> </span><span class="err">jinja</span><span class="w"> </span><span class="err">rendered.</span>
</span><span id="__span-58-8">
</span><span id="__span-58-9"><span class="err">optional</span><span class="w"> </span><span class="err">arguments:</span>
</span><span id="__span-58-10"><span class="w">  </span><span class="err">-m,</span><span class="w"> </span><span class="err">--mkdir</span><span class="w">  </span><span class="err">Create</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">target</span><span class="w"> </span><span class="err">directory</span><span class="w"> </span><span class="err">if</span><span class="w"> </span><span class="err">it</span><span class="w"> </span><span class="err">doesn&#39;t</span><span class="w"> </span><span class="err">exist</span>
</span></code></pre></div>
<p>For example, the following code in an <a href="06-jobs-job-types.html#job-type-exe">exe</a>
job would transfer files between S3 and the <code>Public</code> share on an SMB server:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-59-1"><span class="ch">#!/bin/bash</span>
</span><span id="__span-59-2">
</span><span id="__span-59-3"><span class="c1"># Copy file from S3 to SMB</span>
</span><span id="__span-59-4"><span class="nv">$LAVA_CONN_FSERVER</span><span class="w"> </span>put<span class="w"> </span>--mkdir<span class="w"> </span><span class="se">\</span>
</span><span id="__span-59-5"><span class="w">    </span>s3://my-bucket/data.csv<span class="w"> </span>Public:/a/path/data.csv
</span><span id="__span-59-6">
</span><span id="__span-59-7"><span class="c1"># Copy file from SMB to S3</span>
</span><span id="__span-59-8"><span class="nv">$LAVA_CONN_FSERVER</span><span class="w"> </span>get<span class="w"> </span>--kms-key-id<span class="w"> </span>alias/data<span class="w"> </span><span class="se">\</span>
</span><span id="__span-59-9"><span class="w">    </span>Public:/a/path/data.csv<span class="w"> </span>s3://my-bucket/data.csv
</span></code></pre></div>
<h2 id="connector-type-sqlite3">Connector type: sqlite3<a class="headerlink" href="#connector-type-sqlite3" title="Permanent link">&para;</a></h2>
<p>The <strong>sqlite3</strong> connector handles connections to SQLite3 file based databases.</p>
<p>Its use in general lava jobs is pretty marginal at best. It is mostly present to
facilitate testing of lava itself.</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>conn_id</td>
<td>String</td>
<td>Yes</td>
<td>Connection identifier.</td>
</tr>
<tr>
<td>description</td>
<td>String</td>
<td>No</td>
<td>Description.</td>
</tr>
<tr>
<td>enabled</td>
<td>Boolean</td>
<td>Yes</td>
<td>Whether or not the connection is enabled.</td>
</tr>
<tr>
<td>host</td>
<td>String</td>
<td>Yes</td>
<td>The name of the file containing the SQLite3 database. If it starts with <code>s3://</code>, the file will be copied from S3 when the connection is created and returned to S3 when the connection is closed if it has been modified.</td>
</tr>
<tr>
<td>port</td>
<td>Number</td>
<td>Yes*</td>
<td>A value is required but is ignored.</td>
</tr>
<tr>
<td>preserve_case</td>
<td>Boolean</td>
<td>No</td>
<td>If <code>true</code>, don't fold database object names to lower case when quoting them for use in <a href="06-jobs-job-types.html#job-type-db_from_s3">db_from_s3</a> jobs. The default is <code>false</code> (i.e. case folding is enabled).</td>
</tr>
<tr>
<td>type</td>
<td>String</td>
<td>Yes</td>
<td><code>sqlite3</code>.</td>
</tr>
<tr>
<td>user</td>
<td>String</td>
<td>Yes*</td>
<td>A value is required but is ignored.</td>
</tr>
</tbody>
</table>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>Fields with a <strong>Required</strong> column marked with <code>*</code> must be present but the
value is ignored. This is an unfortunate interface idiosyncrasy resulting
from the need to maintain some internal compatibility with the other
database connectors.</p>
</div>
<p>When used with <a href="06-jobs-job-types.html#job-type-exe">exe</a> and
<a href="06-jobs-job-types.html#job-type-pkg">pkg</a> job types, the connection is implemented by
the <code>sqlite3</code> CLI.  It is invoked with the following options:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-60-1">sqlite3<span class="w"> </span>-bail<span class="w"> </span>-batch<span class="w"> </span>DATABASE-FILE
</span></code></pre></div>
<h2 id="connector-type-ssh-scp-sftp">Connector type: ssh, scp, sftp<a class="headerlink" href="#connector-type-ssh-scp-sftp" title="Permanent link">&para;</a></h2>
<p>This group of connectors provides support for the SSH family of clients.</p>
<p>When used with <a href="06-jobs-job-types.html#job-type-exe">exe</a> and
<a href="06-jobs-job-types.html#job-type-pkg">pkg</a> jobs, each connector provides an
environment variable pointing to a script that will run the corresponding CLI
with SSH keys managed in the background.</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>conn_id</td>
<td>String</td>
<td>Yes</td>
<td>Connection identifier.</td>
</tr>
<tr>
<td>description</td>
<td>String</td>
<td>No</td>
<td>Description.</td>
</tr>
<tr>
<td>enabled</td>
<td>Boolean</td>
<td>Yes</td>
<td>Whether or not the connection is enabled.</td>
</tr>
<tr>
<td>ssh_key</td>
<td>String</td>
<td>Yes</td>
<td>The name of an encrypted SSM parameter containing the SSH private key. There <strong>must not</strong> be any passphrase on the key. For a given <code>&lt;REALM&gt;</code>, the SSM parameter name must be of the form <code>/lava/&lt;REALM&gt;/...</code> and the value must be a <strong>secure string</strong> encrypted using the <code>lava-&lt;REALM&gt;-sys</code> KMS key.</td>
</tr>
<tr>
<td>ssh_options</td>
<td>List[String]</td>
<td>No</td>
<td>A list of SSH options as per <strong>ssh_config(5)</strong>. e.g. <code>StrictHostKeyChecking=no</code></td>
</tr>
<tr>
<td>type</td>
<td>String</td>
<td>Yes</td>
<td><code>ssh</code>, <code>sftp</code> or <code>scp</code>.</td>
</tr>
</tbody>
</table>
<p>The process for saving an SSH private key in the SSM parameter store using the
 AWS CLI looks like this:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-61-1"><span class="c1"># Create a new SSH key</span>
</span><span id="__span-61-2">ssh-keygen<span class="w"> </span>-f<span class="w"> </span>mykey
</span><span id="__span-61-3">
</span><span id="__span-61-4"><span class="c1"># Upload the private key to the SSM parameter store. Here realm name is &quot;dev&quot;</span>
</span><span id="__span-61-5">aws<span class="w"> </span>ssm<span class="w"> </span>put-parameter<span class="w"> </span>--name<span class="w"> </span><span class="s2">&quot;/lava/dev/ssh01/ssh-key&quot;</span><span class="w">  </span><span class="se">\</span>
</span><span id="__span-61-6"><span class="w">    </span>--description<span class="w"> </span><span class="s2">&quot;SSH key for ssh01&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-61-7"><span class="w">    </span>--type<span class="w"> </span>SecureString<span class="w"> </span><span class="se">\</span>
</span><span id="__span-61-8"><span class="w">    </span>--value<span class="w"> </span><span class="s2">&quot;</span><span class="k">$(</span>cat<span class="w"> </span>mykey<span class="k">)</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-61-9"><span class="w">    </span>--key-id<span class="w"> </span>alias/lava-dev-sys
</span></code></pre></div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      &copy; Origin Energy 2025
    </div>
  
</div>
      <div class="md-footer-social">
        <div class="md-copyright">
          <div class="md-copyright__highlight">
            v8.2.0 (Kilauea)
          </div>
        </div>
      </div>
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": ".", "features": ["navigation.instant", "content.code.copy", {"icon": {"repo": "material/github"}}], "search": "assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="assets/javascripts/bundle.f55a23d4.min.js"></script>
      
    
  </body>
</html>