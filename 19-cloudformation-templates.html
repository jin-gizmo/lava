
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="AWS based distributed scheduler and job runner">
      
      
        <meta name="author" content="Murray Andrews">
      
      
      
        <link rel="prev" href="18-api.html">
      
      
        <link rel="next" href="20-faq.html">
      
      
      <link rel="icon" href="img/lava-icons/png/256/lava-icon-256-transparent.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.23">
    
    
      
        <title>CloudFormation Templates - Lava User Guide</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.84d31ad4.min.css">
      
        
        <link rel="stylesheet" href="assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="css/extra.css">
    
    <script>__md_scope=new URL(".",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#cloudformation-templates" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="." title="Lava User Guide" class="md-header__button md-logo" aria-label="Lava User Guide" data-md-component="logo">
      
  <img src="img/lava-icons/svg/256/lava-icon-256-opaque.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Lava User Guide
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              CloudFormation Templates
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="custom" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        

<a href="https://github.com/jin-gizmo/lava" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    Lava on GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="." title="Lava User Guide" class="md-nav__button md-logo" aria-label="Lava User Guide" data-md-component="logo">
      
  <img src="img/lava-icons/svg/256/lava-icon-256-opaque.svg" alt="logo">

    </a>
    Lava User Guide
  </label>
  
    <div class="md-nav__source">
      

<a href="https://github.com/jin-gizmo/lava" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    Lava on GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="01-about-lava.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    About Lava
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="02-concepts.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Concepts
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="03-architecture.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Architecture
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="04-dynamodb-tables.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    DynamoDB Tables
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="05-job-dispatch.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Job Dispatch
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="06-jobs-job-types.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Jobs & Job Types
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="07-connectors.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Connectors
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="08-job-actions.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Job Actions
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="09-lava-state-manager.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lava State Manager
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="10-installation-operation.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Installation & Operation
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="11-lava-job-framework.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lava Job Framework
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="12-developing-lava-jobs.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Developing Lava Jobs
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="13-jinja-rendering-in-lava.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Jinja Rendering in Lava
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="14-enhancing-lava.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Enhancing Lava
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="15-lava-and-docker.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lava and Docker
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="16-commands-utilities.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Commands & Utilities
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="17-job-framework-samples.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Job Framework Samples
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="18-api.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    API
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    CloudFormation Templates
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="19-cloudformation-templates.html" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    CloudFormation Templates
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#lava-commoncfnjson" class="md-nav__link">
    <span class="md-ellipsis">
      lava-common.cfn.json
    </span>
  </a>
  
    <nav class="md-nav" aria-label="lava-common.cfn.json">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#outputs" class="md-nav__link">
    <span class="md-ellipsis">
      Outputs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#resources" class="md-nav__link">
    <span class="md-ellipsis">
      Resources
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#resource-details" class="md-nav__link">
    <span class="md-ellipsis">
      Resource Details
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lava-realmcfnjson" class="md-nav__link">
    <span class="md-ellipsis">
      lava-realm.cfn.json
    </span>
  </a>
  
    <nav class="md-nav" aria-label="lava-realm.cfn.json">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#parameters_1" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#outputs_1" class="md-nav__link">
    <span class="md-ellipsis">
      Outputs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#resources_1" class="md-nav__link">
    <span class="md-ellipsis">
      Resources
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#resource-details_1" class="md-nav__link">
    <span class="md-ellipsis">
      Resource Details
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lava-workercfnjson" class="md-nav__link">
    <span class="md-ellipsis">
      lava-worker.cfn.json
    </span>
  </a>
  
    <nav class="md-nav" aria-label="lava-worker.cfn.json">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#parameters_2" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#outputs_2" class="md-nav__link">
    <span class="md-ellipsis">
      Outputs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#resources_2" class="md-nav__link">
    <span class="md-ellipsis">
      Resources
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#resource-details_2" class="md-nav__link">
    <span class="md-ellipsis">
      Resource Details
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="20-faq.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    FAQ
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="21-release-notes.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Release Notes
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="22-credits.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Credits
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="23-known-issues.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Known Issues
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#lava-commoncfnjson" class="md-nav__link">
    <span class="md-ellipsis">
      lava-common.cfn.json
    </span>
  </a>
  
    <nav class="md-nav" aria-label="lava-common.cfn.json">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#outputs" class="md-nav__link">
    <span class="md-ellipsis">
      Outputs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#resources" class="md-nav__link">
    <span class="md-ellipsis">
      Resources
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#resource-details" class="md-nav__link">
    <span class="md-ellipsis">
      Resource Details
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lava-realmcfnjson" class="md-nav__link">
    <span class="md-ellipsis">
      lava-realm.cfn.json
    </span>
  </a>
  
    <nav class="md-nav" aria-label="lava-realm.cfn.json">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#parameters_1" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#outputs_1" class="md-nav__link">
    <span class="md-ellipsis">
      Outputs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#resources_1" class="md-nav__link">
    <span class="md-ellipsis">
      Resources
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#resource-details_1" class="md-nav__link">
    <span class="md-ellipsis">
      Resource Details
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lava-workercfnjson" class="md-nav__link">
    <span class="md-ellipsis">
      lava-worker.cfn.json
    </span>
  </a>
  
    <nav class="md-nav" aria-label="lava-worker.cfn.json">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#parameters_2" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#outputs_2" class="md-nav__link">
    <span class="md-ellipsis">
      Outputs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#resources_2" class="md-nav__link">
    <span class="md-ellipsis">
      Resources
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#resource-details_2" class="md-nav__link">
    <span class="md-ellipsis">
      Resource Details
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="cloudformation-templates">CloudFormation Templates<a class="headerlink" href="#cloudformation-templates" title="Permanent link">&para;</a></h1>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Pre-built versions of the CloudFormation templates are provided as part of
a <a href="https://github.com/jin-gizmo/lava/releases">release on GitHub</a>.</p>
</div>
<p>See also <a href="10-installation-operation.html#building-the-cloudformation-templates">Building the CloudFormation Templates</a>.</p>
<h2 id="lava-commoncfnjson">lava-common.cfn.json<a class="headerlink" href="#lava-commoncfnjson" title="Permanent link">&para;</a></h2>
<p>This template builds components that are shared across all lava realms. There should be a very limited number of these.</p>
<h3 id="parameters"><a href="#lava-commoncfnjson">Parameters</a><a class="headerlink" href="#parameters" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Version</td>
<td>String</td>
<td>Lava version (read only).</td>
</tr>
</tbody>
</table>
<h3 id="outputs"><a href="#lava-commoncfnjson">Outputs</a><a class="headerlink" href="#outputs" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Id</th>
<th>Export as</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Version</td>
<td><code class="language-json highlight"><span class="s2">&quot;lava:version&quot;</span></code></td>
<td>Lava common stack version</td>
</tr>
</tbody>
</table>
<h3 id="resources"><a href="#lava-commoncfnjson">Resources</a><a class="headerlink" href="#resources" title="Permanent link">&para;</a></h3>
<ul>
<li><a href="#logs-resources">Logs Resources</a></li>
<li><a href="#ssm-resources">SSM Resources</a></li>
</ul>
<h4 id="logs-resources"><a href="#lava-commoncfnjson">Logs Resources</a><a class="headerlink" href="#logs-resources" title="Permanent link">&para;</a></h4>
<table>
<thead>
<tr>
<th>Id</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="#logspolicytologevents">logsPolicyToLogEvents</a></td>
<td>ResourcePolicy</td>
<td>Allow EventBridge rules to write to log group aws/events/lava. This is generally not needed as EventBridge will have already added a broader permission but just in case.</td>
</tr>
</tbody>
</table>
<h4 id="ssm-resources"><a href="#lava-commoncfnjson">SSM Resources</a><a class="headerlink" href="#ssm-resources" title="Permanent link">&para;</a></h4>
<table>
<thead>
<tr>
<th>Id</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="#ssmdocumentlavareboot">ssmDocumentLavaReboot</a></td>
<td>Document</td>
<td>SSM command document to do controlled reboot on a lava instance.</td>
</tr>
<tr>
<td><a href="#ssmdocumentlavastop">ssmDocumentLavaStop</a></td>
<td>Document</td>
<td>SSM command document to stop lava daemons on a worker instance</td>
</tr>
<tr>
<td><a href="#ssmdocumentsecupdate">ssmDocumentSecUpdate</a></td>
<td>Document</td>
<td>SSM command document to check if security updates are available for a lava worker instance and install and reboot if there are.</td>
</tr>
</tbody>
</table>
<h3 id="resource-details"><a href="#lava-commoncfnjson">Resource Details</a><a class="headerlink" href="#resource-details" title="Permanent link">&para;</a></h3>
<h4 id="logspolicytologevents"><a href="#logs-resources">logsPolicyToLogEvents</a><a class="headerlink" href="#logspolicytologevents" title="Permanent link">&para;</a></h4>
<div class="tabbed-set tabbed-alternate" data-tabs="1:2"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio" /><input id="__tabbed_1_2" name="__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="__tabbed_1_1">Details</label><label for="__tabbed_1_2">Source</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<table>
<thead>
<tr>
<th>Property</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Type</td>
<td><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-logs-resourcepolicy.html" title="AWS documentation for this resource type">AWS::Logs::ResourcePolicy</a></td>
</tr>
<tr>
<td>Group</td>
<td><a href="#logs-resources">Logs Resources</a> (<a href="#logs-resources">Logs</a>)</td>
</tr>
<tr>
<td>Description</td>
<td>Allow EventBridge rules to write to log group aws/events/lava. This is generally not needed as EventBridge will have already added a broader permission but just in case.</td>
</tr>
</tbody>
</table>
</div>
<div class="tabbed-block">
<div class="language-json highlight"><pre><span></span><code><span id="__span-0-1"><span class="p">{</span>
</span><span id="__span-0-2"><span class="w">    </span><span class="nt">&quot;Properties&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-3"><span class="w">        </span><span class="nt">&quot;PolicyDocument&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-4"><span class="w">            </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;{\&quot;Statement\&quot;: [{\&quot;Action\&quot;: [\&quot;logs:CreateLogStream\&quot;, \&quot;logs:PutLogEvents\&quot;], \&quot;Effect\&quot;: \&quot;Allow\&quot;, \&quot;Principal\&quot;: {\&quot;Service\&quot;: [\&quot;delivery.logs.amazonaws.com\&quot;, \&quot;events.amazonaws.com\&quot;]}, \&quot;Resource\&quot;: \&quot;arn:aws:logs:${AWS::Region}:${AWS::AccountId}:log-group:/aws/events/lava:*\&quot;, \&quot;Sid\&quot;: \&quot;TrustEventsToStoreLavaLogEvent\&quot;}], \&quot;Version\&quot;: \&quot;2012-10-17\&quot;}&quot;</span>
</span><span id="__span-0-5"><span class="w">        </span><span class="p">},</span>
</span><span id="__span-0-6"><span class="w">        </span><span class="nt">&quot;PolicyName&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;TrustEventsToStoreLavaLogEvents&quot;</span>
</span><span id="__span-0-7"><span class="w">    </span><span class="p">},</span>
</span><span id="__span-0-8"><span class="w">    </span><span class="nt">&quot;Type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AWS::Logs::ResourcePolicy&quot;</span>
</span><span id="__span-0-9"><span class="p">}</span>
</span></code></pre></div>
</div>
</div>
</div>
<h4 id="ssmdocumentlavareboot"><a href="#ssm-resources">ssmDocumentLavaReboot</a><a class="headerlink" href="#ssmdocumentlavareboot" title="Permanent link">&para;</a></h4>
<div class="tabbed-set tabbed-alternate" data-tabs="2:2"><input checked="checked" id="__tabbed_2_1" name="__tabbed_2" type="radio" /><input id="__tabbed_2_2" name="__tabbed_2" type="radio" /><div class="tabbed-labels"><label for="__tabbed_2_1">Details</label><label for="__tabbed_2_2">Source</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<table>
<thead>
<tr>
<th>Property</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Type</td>
<td><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-ssm-document.html" title="AWS documentation for this resource type">AWS::SSM::Document</a></td>
</tr>
<tr>
<td>Group</td>
<td><a href="#ssm-resources">SSM Resources</a> (<a href="#ssm-resources">SSM</a>)</td>
</tr>
<tr>
<td>Description</td>
<td>SSM command document to do controlled reboot on a lava instance.</td>
</tr>
</tbody>
</table>
</div>
<div class="tabbed-block">
<div class="language-json highlight"><pre><span></span><code><span id="__span-1-1"><span class="p">{</span>
</span><span id="__span-1-2"><span class="w">    </span><span class="nt">&quot;Properties&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-1-3"><span class="w">        </span><span class="nt">&quot;Content&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-1-4"><span class="w">            </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Controlled reboot of a lava instance (includes security updates).&quot;</span><span class="p">,</span>
</span><span id="__span-1-5"><span class="w">            </span><span class="nt">&quot;mainSteps&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-1-6"><span class="w">                </span><span class="p">{</span>
</span><span id="__span-1-7"><span class="w">                    </span><span class="nt">&quot;action&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;aws:runShellScript&quot;</span><span class="p">,</span>
</span><span id="__span-1-8"><span class="w">                    </span><span class="nt">&quot;inputs&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-1-9"><span class="w">                        </span><span class="nt">&quot;runCommand&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-1-10"><span class="w">                            </span><span class="s2">&quot;LOG=&#39;logger -s -p local0.info -t lava-reboot&#39;&quot;</span><span class="p">,</span>
</span><span id="__span-1-11"><span class="w">                            </span><span class="s2">&quot;[ -f /tmp/no-reboot ] &amp;&amp; /bin/rm -f /tmp/no-reboot &amp;&amp; $LOG Reboot complete &amp;&amp; exit 0&quot;</span><span class="p">,</span>
</span><span id="__span-1-12"><span class="w">                            </span><span class="s2">&quot;$LOG Installing any available security updates&quot;</span><span class="p">,</span>
</span><span id="__span-1-13"><span class="w">                            </span><span class="s2">&quot;yum update --security -y&quot;</span><span class="p">,</span>
</span><span id="__span-1-14"><span class="w">                            </span><span class="s2">&quot;$LOG Stopping lava worker daemons&quot;</span><span class="p">,</span>
</span><span id="__span-1-15"><span class="w">                            </span><span class="s2">&quot;lava-stop --level &#39;{{LogLevel}}&#39; --log @local0 --signal &#39;{{Signal}}&#39; --wait &#39;{{Wait}}&#39;&quot;</span><span class="p">,</span>
</span><span id="__span-1-16"><span class="w">                            </span><span class="s2">&quot;touch /tmp/no-reboot || exit 1&quot;</span><span class="p">,</span>
</span><span id="__span-1-17"><span class="w">                            </span><span class="s2">&quot;$LOG Rebooting&quot;</span><span class="p">,</span>
</span><span id="__span-1-18"><span class="w">                            </span><span class="s2">&quot;exit 194&quot;</span>
</span><span id="__span-1-19"><span class="w">                        </span><span class="p">],</span>
</span><span id="__span-1-20"><span class="w">                        </span><span class="nt">&quot;timeoutSeconds&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;{{ExecutionTimeout}}&quot;</span>
</span><span id="__span-1-21"><span class="w">                    </span><span class="p">},</span>
</span><span id="__span-1-22"><span class="w">                    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;rebootWorkerInstance&quot;</span>
</span><span id="__span-1-23"><span class="w">                </span><span class="p">}</span>
</span><span id="__span-1-24"><span class="w">            </span><span class="p">],</span>
</span><span id="__span-1-25"><span class="w">            </span><span class="nt">&quot;parameters&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-1-26"><span class="w">                </span><span class="nt">&quot;ExecutionTimeout&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-1-27"><span class="w">                    </span><span class="nt">&quot;allowedPattern&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;^\\d+$&quot;</span><span class="p">,</span>
</span><span id="__span-1-28"><span class="w">                    </span><span class="nt">&quot;default&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;3600&quot;</span><span class="p">,</span>
</span><span id="__span-1-29"><span class="w">                    </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Execution timeout in seconds&quot;</span><span class="p">,</span>
</span><span id="__span-1-30"><span class="w">                    </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;String&quot;</span>
</span><span id="__span-1-31"><span class="w">                </span><span class="p">},</span>
</span><span id="__span-1-32"><span class="w">                </span><span class="nt">&quot;LogLevel&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-1-33"><span class="w">                    </span><span class="nt">&quot;allowedValues&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-1-34"><span class="w">                        </span><span class="s2">&quot;debug&quot;</span><span class="p">,</span>
</span><span id="__span-1-35"><span class="w">                        </span><span class="s2">&quot;info&quot;</span><span class="p">,</span>
</span><span id="__span-1-36"><span class="w">                        </span><span class="s2">&quot;warning&quot;</span>
</span><span id="__span-1-37"><span class="w">                    </span><span class="p">],</span>
</span><span id="__span-1-38"><span class="w">                    </span><span class="nt">&quot;default&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;info&quot;</span><span class="p">,</span>
</span><span id="__span-1-39"><span class="w">                    </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Logging level&quot;</span><span class="p">,</span>
</span><span id="__span-1-40"><span class="w">                    </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;String&quot;</span>
</span><span id="__span-1-41"><span class="w">                </span><span class="p">},</span>
</span><span id="__span-1-42"><span class="w">                </span><span class="nt">&quot;Signal&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-1-43"><span class="w">                    </span><span class="nt">&quot;allowedValues&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-1-44"><span class="w">                        </span><span class="s2">&quot;SIGHUP&quot;</span><span class="p">,</span>
</span><span id="__span-1-45"><span class="w">                        </span><span class="s2">&quot;SIGKILL&quot;</span>
</span><span id="__span-1-46"><span class="w">                    </span><span class="p">],</span>
</span><span id="__span-1-47"><span class="w">                    </span><span class="nt">&quot;default&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;SIGHUP&quot;</span><span class="p">,</span>
</span><span id="__span-1-48"><span class="w">                    </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;SIGHUP for controlled shutdown. SIGKILL for hard kill.&quot;</span><span class="p">,</span>
</span><span id="__span-1-49"><span class="w">                    </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;String&quot;</span>
</span><span id="__span-1-50"><span class="w">                </span><span class="p">},</span>
</span><span id="__span-1-51"><span class="w">                </span><span class="nt">&quot;Wait&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-1-52"><span class="w">                    </span><span class="nt">&quot;allowedPattern&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;^\\d+[hms]?$&quot;</span><span class="p">,</span>
</span><span id="__span-1-53"><span class="w">                    </span><span class="nt">&quot;default&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;15m&quot;</span><span class="p">,</span>
</span><span id="__span-1-54"><span class="w">                    </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Wait for specified duration for lava workers to stop voluntarily before killing them.&quot;</span><span class="p">,</span>
</span><span id="__span-1-55"><span class="w">                    </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;String&quot;</span>
</span><span id="__span-1-56"><span class="w">                </span><span class="p">}</span>
</span><span id="__span-1-57"><span class="w">            </span><span class="p">},</span>
</span><span id="__span-1-58"><span class="w">            </span><span class="nt">&quot;schemaVersion&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2.2&quot;</span>
</span><span id="__span-1-59"><span class="w">        </span><span class="p">},</span>
</span><span id="__span-1-60"><span class="w">        </span><span class="nt">&quot;DocumentFormat&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;JSON&quot;</span><span class="p">,</span>
</span><span id="__span-1-61"><span class="w">        </span><span class="nt">&quot;DocumentType&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Command&quot;</span><span class="p">,</span>
</span><span id="__span-1-62"><span class="w">        </span><span class="nt">&quot;Name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;lava-RebootWorkerInstance&quot;</span><span class="p">,</span>
</span><span id="__span-1-63"><span class="w">        </span><span class="nt">&quot;TargetType&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/AWS::EC2::Instance&quot;</span>
</span><span id="__span-1-64"><span class="w">    </span><span class="p">},</span>
</span><span id="__span-1-65"><span class="w">    </span><span class="nt">&quot;Type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AWS::SSM::Document&quot;</span>
</span><span id="__span-1-66"><span class="p">}</span>
</span></code></pre></div>
</div>
</div>
</div>
<h4 id="ssmdocumentlavastop"><a href="#ssm-resources">ssmDocumentLavaStop</a><a class="headerlink" href="#ssmdocumentlavastop" title="Permanent link">&para;</a></h4>
<div class="tabbed-set tabbed-alternate" data-tabs="3:2"><input checked="checked" id="__tabbed_3_1" name="__tabbed_3" type="radio" /><input id="__tabbed_3_2" name="__tabbed_3" type="radio" /><div class="tabbed-labels"><label for="__tabbed_3_1">Details</label><label for="__tabbed_3_2">Source</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<table>
<thead>
<tr>
<th>Property</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Type</td>
<td><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-ssm-document.html" title="AWS documentation for this resource type">AWS::SSM::Document</a></td>
</tr>
<tr>
<td>Group</td>
<td><a href="#ssm-resources">SSM Resources</a> (<a href="#ssm-resources">SSM</a>)</td>
</tr>
<tr>
<td>Description</td>
<td>SSM command document to stop lava daemons on a worker instance</td>
</tr>
</tbody>
</table>
</div>
<div class="tabbed-block">
<div class="language-json highlight"><pre><span></span><code><span id="__span-2-1"><span class="p">{</span>
</span><span id="__span-2-2"><span class="w">    </span><span class="nt">&quot;Properties&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-2-3"><span class="w">        </span><span class="nt">&quot;Content&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-2-4"><span class="w">            </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Signal lava daemons to stop and wait for them to finish.&quot;</span><span class="p">,</span>
</span><span id="__span-2-5"><span class="w">            </span><span class="nt">&quot;mainSteps&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-2-6"><span class="w">                </span><span class="p">{</span>
</span><span id="__span-2-7"><span class="w">                    </span><span class="nt">&quot;action&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;aws:runShellScript&quot;</span><span class="p">,</span>
</span><span id="__span-2-8"><span class="w">                    </span><span class="nt">&quot;inputs&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-2-9"><span class="w">                        </span><span class="nt">&quot;runCommand&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-2-10"><span class="w">                            </span><span class="s2">&quot;LOG=&#39;logger -s -p local0.info -t lava-stop&#39;&quot;</span><span class="p">,</span>
</span><span id="__span-2-11"><span class="w">                            </span><span class="s2">&quot;[ &#39;{{StopDispatch}}&#39; == &#39;yes&#39; ] &amp;&amp; STOP_DISPATCH=--no-dispatch&quot;</span><span class="p">,</span>
</span><span id="__span-2-12"><span class="w">                            </span><span class="s2">&quot;lava-stop --level &#39;{{LogLevel}}&#39; --log @local0 --signal &#39;{{Signal}}&#39; --wait &#39;{{Wait}}&#39; $STOP_DISPATCH&quot;</span><span class="p">,</span>
</span><span id="__span-2-13"><span class="w">                            </span><span class="s2">&quot;$LOG lava daemons stopped&quot;</span>
</span><span id="__span-2-14"><span class="w">                        </span><span class="p">],</span>
</span><span id="__span-2-15"><span class="w">                        </span><span class="nt">&quot;timeoutSeconds&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;{{ExecutionTimeout}}&quot;</span>
</span><span id="__span-2-16"><span class="w">                    </span><span class="p">},</span>
</span><span id="__span-2-17"><span class="w">                    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;stopWorkerDaemons&quot;</span>
</span><span id="__span-2-18"><span class="w">                </span><span class="p">}</span>
</span><span id="__span-2-19"><span class="w">            </span><span class="p">],</span>
</span><span id="__span-2-20"><span class="w">            </span><span class="nt">&quot;parameters&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-2-21"><span class="w">                </span><span class="nt">&quot;ExecutionTimeout&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-2-22"><span class="w">                    </span><span class="nt">&quot;allowedPattern&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;^\\d+$&quot;</span><span class="p">,</span>
</span><span id="__span-2-23"><span class="w">                    </span><span class="nt">&quot;default&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;3600&quot;</span><span class="p">,</span>
</span><span id="__span-2-24"><span class="w">                    </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Execution timeout in seconds&quot;</span><span class="p">,</span>
</span><span id="__span-2-25"><span class="w">                    </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;String&quot;</span>
</span><span id="__span-2-26"><span class="w">                </span><span class="p">},</span>
</span><span id="__span-2-27"><span class="w">                </span><span class="nt">&quot;LogLevel&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-2-28"><span class="w">                    </span><span class="nt">&quot;allowedValues&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-2-29"><span class="w">                        </span><span class="s2">&quot;debug&quot;</span><span class="p">,</span>
</span><span id="__span-2-30"><span class="w">                        </span><span class="s2">&quot;info&quot;</span><span class="p">,</span>
</span><span id="__span-2-31"><span class="w">                        </span><span class="s2">&quot;warning&quot;</span>
</span><span id="__span-2-32"><span class="w">                    </span><span class="p">],</span>
</span><span id="__span-2-33"><span class="w">                    </span><span class="nt">&quot;default&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;info&quot;</span><span class="p">,</span>
</span><span id="__span-2-34"><span class="w">                    </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Logging level&quot;</span><span class="p">,</span>
</span><span id="__span-2-35"><span class="w">                    </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;String&quot;</span>
</span><span id="__span-2-36"><span class="w">                </span><span class="p">},</span>
</span><span id="__span-2-37"><span class="w">                </span><span class="nt">&quot;Signal&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-2-38"><span class="w">                    </span><span class="nt">&quot;allowedValues&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-2-39"><span class="w">                        </span><span class="s2">&quot;SIGHUP&quot;</span><span class="p">,</span>
</span><span id="__span-2-40"><span class="w">                        </span><span class="s2">&quot;SIGKILL&quot;</span>
</span><span id="__span-2-41"><span class="w">                    </span><span class="p">],</span>
</span><span id="__span-2-42"><span class="w">                    </span><span class="nt">&quot;default&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;SIGHUP&quot;</span><span class="p">,</span>
</span><span id="__span-2-43"><span class="w">                    </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;SIGHUP for controlled shutdown. SIGKILL for hard kill.&quot;</span><span class="p">,</span>
</span><span id="__span-2-44"><span class="w">                    </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;String&quot;</span>
</span><span id="__span-2-45"><span class="w">                </span><span class="p">},</span>
</span><span id="__span-2-46"><span class="w">                </span><span class="nt">&quot;StopDispatch&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-2-47"><span class="w">                    </span><span class="nt">&quot;allowedValues&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-2-48"><span class="w">                        </span><span class="s2">&quot;yes&quot;</span><span class="p">,</span>
</span><span id="__span-2-49"><span class="w">                        </span><span class="s2">&quot;no&quot;</span>
</span><span id="__span-2-50"><span class="w">                    </span><span class="p">],</span>
</span><span id="__span-2-51"><span class="w">                    </span><span class="nt">&quot;default&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;yes&quot;</span><span class="p">,</span>
</span><span id="__span-2-52"><span class="w">                    </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Prevent scheduled dispatches from this instance?&quot;</span><span class="p">,</span>
</span><span id="__span-2-53"><span class="w">                    </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;String&quot;</span>
</span><span id="__span-2-54"><span class="w">                </span><span class="p">},</span>
</span><span id="__span-2-55"><span class="w">                </span><span class="nt">&quot;Wait&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-2-56"><span class="w">                    </span><span class="nt">&quot;allowedPattern&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;^[0-9]+[hms]?$&quot;</span><span class="p">,</span>
</span><span id="__span-2-57"><span class="w">                    </span><span class="nt">&quot;default&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;15m&quot;</span><span class="p">,</span>
</span><span id="__span-2-58"><span class="w">                    </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Wait for specified duration for lava workers to stop voluntarily before killing them.&quot;</span><span class="p">,</span>
</span><span id="__span-2-59"><span class="w">                    </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;String&quot;</span>
</span><span id="__span-2-60"><span class="w">                </span><span class="p">}</span>
</span><span id="__span-2-61"><span class="w">            </span><span class="p">},</span>
</span><span id="__span-2-62"><span class="w">            </span><span class="nt">&quot;schemaVersion&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2.2&quot;</span>
</span><span id="__span-2-63"><span class="w">        </span><span class="p">},</span>
</span><span id="__span-2-64"><span class="w">        </span><span class="nt">&quot;DocumentFormat&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;JSON&quot;</span><span class="p">,</span>
</span><span id="__span-2-65"><span class="w">        </span><span class="nt">&quot;DocumentType&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Command&quot;</span><span class="p">,</span>
</span><span id="__span-2-66"><span class="w">        </span><span class="nt">&quot;Name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;lava-StopWorkerDaemons&quot;</span><span class="p">,</span>
</span><span id="__span-2-67"><span class="w">        </span><span class="nt">&quot;TargetType&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/AWS::EC2::Instance&quot;</span>
</span><span id="__span-2-68"><span class="w">    </span><span class="p">},</span>
</span><span id="__span-2-69"><span class="w">    </span><span class="nt">&quot;Type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AWS::SSM::Document&quot;</span>
</span><span id="__span-2-70"><span class="p">}</span>
</span></code></pre></div>
</div>
</div>
</div>
<h4 id="ssmdocumentsecupdate"><a href="#ssm-resources">ssmDocumentSecUpdate</a><a class="headerlink" href="#ssmdocumentsecupdate" title="Permanent link">&para;</a></h4>
<div class="tabbed-set tabbed-alternate" data-tabs="4:2"><input checked="checked" id="__tabbed_4_1" name="__tabbed_4" type="radio" /><input id="__tabbed_4_2" name="__tabbed_4" type="radio" /><div class="tabbed-labels"><label for="__tabbed_4_1">Details</label><label for="__tabbed_4_2">Source</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<table>
<thead>
<tr>
<th>Property</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Type</td>
<td><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-ssm-document.html" title="AWS documentation for this resource type">AWS::SSM::Document</a></td>
</tr>
<tr>
<td>Group</td>
<td><a href="#ssm-resources">SSM Resources</a> (<a href="#ssm-resources">SSM</a>)</td>
</tr>
<tr>
<td>Description</td>
<td>SSM command document to check if security updates are available for a lava worker instance and install and reboot if there are.</td>
</tr>
</tbody>
</table>
</div>
<div class="tabbed-block">
<div class="language-json highlight"><pre><span></span><code><span id="__span-3-1"><span class="p">{</span>
</span><span id="__span-3-2"><span class="w">    </span><span class="nt">&quot;Properties&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-3-3"><span class="w">        </span><span class="nt">&quot;Content&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-3-4"><span class="w">            </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;If security updates available for lava instance, apply them and reboot&quot;</span><span class="p">,</span>
</span><span id="__span-3-5"><span class="w">            </span><span class="nt">&quot;mainSteps&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-3-6"><span class="w">                </span><span class="p">{</span>
</span><span id="__span-3-7"><span class="w">                    </span><span class="nt">&quot;action&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;aws:runShellScript&quot;</span><span class="p">,</span>
</span><span id="__span-3-8"><span class="w">                    </span><span class="nt">&quot;inputs&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-3-9"><span class="w">                        </span><span class="nt">&quot;runCommand&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-3-10"><span class="w">                            </span><span class="s2">&quot;LOG=&#39;logger -s -p local0.info -t lava-secupdate&#39;&quot;</span><span class="p">,</span>
</span><span id="__span-3-11"><span class="w">                            </span><span class="s2">&quot;$LOG Starting&quot;</span><span class="p">,</span>
</span><span id="__span-3-12"><span class="w">                            </span><span class="s2">&quot;INSTANCE=$(ec2-metadata -i | cut -d&#39; &#39; -f2)&quot;</span><span class="p">,</span>
</span><span id="__span-3-13"><span class="w">                            </span><span class="s2">&quot;export AWS_DEFAULT_REGION=$(ec2-metadata -z | cut -d&#39; &#39; -f2 | sed -e &#39;s/.$//&#39;)&quot;</span><span class="p">,</span>
</span><span id="__span-3-14"><span class="w">                            </span><span class="s2">&quot;NAME=$(aws ec2 describe-tags --filters \&quot;Name=resource-id,Values=$INSTANCE\&quot; \&quot;Name=key,Values=Name\&quot; --query &#39;Tags[0].Value&#39; --output text)&quot;</span><span class="p">,</span>
</span><span id="__span-3-15"><span class="w">                            </span><span class="s2">&quot;EVENT_MSG=&#39;{\&quot;Source\&quot;:\&quot;lava\&quot;,\&quot;DetailType\&quot;:\&quot;Lava Worker Instance Patching Notification\&quot;,\&quot;Detail\&quot;:\&quot;{\\\&quot;instance-id\\\&quot;:\\\&quot;&#39;$INSTANCE&#39;\\\&quot;,\\\&quot;instance-name\\\&quot;:\\\&quot;&#39;$NAME&#39;\\\&quot;,\\\&quot;info\\\&quot;:\\\&quot;Reboot complete\\\&quot;}\&quot;}&#39;&quot;</span><span class="p">,</span>
</span><span id="__span-3-16"><span class="w">                            </span><span class="s2">&quot;[ -f /tmp/no-reboot ] &amp;&amp; aws events put-events --entries \&quot;$EVENT_MSG\&quot;&quot;</span><span class="p">,</span>
</span><span id="__span-3-17"><span class="w">                            </span><span class="s2">&quot;[ -f /tmp/no-reboot ] &amp;&amp; /bin/rm -f /tmp/no-reboot &amp;&amp; $LOG Reboot complete &amp;&amp; exit 0&quot;</span><span class="p">,</span>
</span><span id="__span-3-18"><span class="w">                            </span><span class="s2">&quot;UPDAYS=$(awk &#39;{ printf(\&quot;%d\&quot;, $1/60/60/24); }&#39; /proc/uptime)&quot;</span><span class="p">,</span>
</span><span id="__span-3-19"><span class="w">                            </span><span class="s2">&quot;[ $UPDAYS -lt {{MinUpDays}} ] &amp;&amp; $LOG Instance has only been up $UPDAYS days - skip &amp;&amp; exit 0&quot;</span><span class="p">,</span>
</span><span id="__span-3-20"><span class="w">                            </span><span class="s2">&quot;yum check-update --security --quiet&quot;</span><span class="p">,</span>
</span><span id="__span-3-21"><span class="w">                            </span><span class="s2">&quot;[ $? -ne 100 ] &amp;&amp; $LOG No security updates available - skip &amp;&amp; exit 0&quot;</span><span class="p">,</span>
</span><span id="__span-3-22"><span class="w">                            </span><span class="s2">&quot;$LOG Installing security updates&quot;</span><span class="p">,</span>
</span><span id="__span-3-23"><span class="w">                            </span><span class="s2">&quot;yum update --security --quiet -y&quot;</span><span class="p">,</span>
</span><span id="__span-3-24"><span class="w">                            </span><span class="s2">&quot;needs-restarting -r &amp;&amp; $LOG No reboot required &amp;&amp; exit 0&quot;</span><span class="p">,</span>
</span><span id="__span-3-25"><span class="w">                            </span><span class="s2">&quot;$LOG Stopping lava worker daemons&quot;</span><span class="p">,</span>
</span><span id="__span-3-26"><span class="w">                            </span><span class="s2">&quot;lava-stop --level &#39;{{LogLevel}}&#39; --log @local0 --signal &#39;{{Signal}}&#39; --wait &#39;{{Wait}}&#39;&quot;</span><span class="p">,</span>
</span><span id="__span-3-27"><span class="w">                            </span><span class="s2">&quot;touch /tmp/no-reboot || exit 1&quot;</span><span class="p">,</span>
</span><span id="__span-3-28"><span class="w">                            </span><span class="s2">&quot;EVENT_MSG=&#39;{\&quot;Source\&quot;:\&quot;lava\&quot;,\&quot;DetailType\&quot;:\&quot;Lava Worker Instance Patching Notification\&quot;,\&quot;Detail\&quot;:\&quot;{\\\&quot;instance-id\\\&quot;:\\\&quot;&#39;$INSTANCE&#39;\\\&quot;,\\\&quot;instance-name\\\&quot;:\\\&quot;&#39;$NAME&#39;\\\&quot;,\\\&quot;info\\\&quot;:\\\&quot;Rebooting after security patching\\\&quot;}\&quot;}&#39;&quot;</span><span class="p">,</span>
</span><span id="__span-3-29"><span class="w">                            </span><span class="s2">&quot;aws events put-events --entries \&quot;$EVENT_MSG\&quot;&quot;</span><span class="p">,</span>
</span><span id="__span-3-30"><span class="w">                            </span><span class="s2">&quot;$LOG Rebooting&quot;</span><span class="p">,</span>
</span><span id="__span-3-31"><span class="w">                            </span><span class="s2">&quot;exit 194&quot;</span>
</span><span id="__span-3-32"><span class="w">                        </span><span class="p">],</span>
</span><span id="__span-3-33"><span class="w">                        </span><span class="nt">&quot;timeoutSeconds&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;{{ExecutionTimeout}}&quot;</span>
</span><span id="__span-3-34"><span class="w">                    </span><span class="p">},</span>
</span><span id="__span-3-35"><span class="w">                    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;secUpdates&quot;</span>
</span><span id="__span-3-36"><span class="w">                </span><span class="p">}</span>
</span><span id="__span-3-37"><span class="w">            </span><span class="p">],</span>
</span><span id="__span-3-38"><span class="w">            </span><span class="nt">&quot;parameters&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-3-39"><span class="w">                </span><span class="nt">&quot;ExecutionTimeout&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-3-40"><span class="w">                    </span><span class="nt">&quot;allowedPattern&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;^\\d+$&quot;</span><span class="p">,</span>
</span><span id="__span-3-41"><span class="w">                    </span><span class="nt">&quot;default&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;3600&quot;</span><span class="p">,</span>
</span><span id="__span-3-42"><span class="w">                    </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Execution timeout in seconds&quot;</span><span class="p">,</span>
</span><span id="__span-3-43"><span class="w">                    </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;String&quot;</span>
</span><span id="__span-3-44"><span class="w">                </span><span class="p">},</span>
</span><span id="__span-3-45"><span class="w">                </span><span class="nt">&quot;LogLevel&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-3-46"><span class="w">                    </span><span class="nt">&quot;allowedValues&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-3-47"><span class="w">                        </span><span class="s2">&quot;debug&quot;</span><span class="p">,</span>
</span><span id="__span-3-48"><span class="w">                        </span><span class="s2">&quot;info&quot;</span><span class="p">,</span>
</span><span id="__span-3-49"><span class="w">                        </span><span class="s2">&quot;warning&quot;</span>
</span><span id="__span-3-50"><span class="w">                    </span><span class="p">],</span>
</span><span id="__span-3-51"><span class="w">                    </span><span class="nt">&quot;default&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;info&quot;</span><span class="p">,</span>
</span><span id="__span-3-52"><span class="w">                    </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Logging level&quot;</span><span class="p">,</span>
</span><span id="__span-3-53"><span class="w">                    </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;String&quot;</span>
</span><span id="__span-3-54"><span class="w">                </span><span class="p">},</span>
</span><span id="__span-3-55"><span class="w">                </span><span class="nt">&quot;MinUpDays&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-3-56"><span class="w">                    </span><span class="nt">&quot;allowedPattern&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;^\\d+$&quot;</span><span class="p">,</span>
</span><span id="__span-3-57"><span class="w">                    </span><span class="nt">&quot;default&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;0&quot;</span><span class="p">,</span>
</span><span id="__span-3-58"><span class="w">                    </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Skip if instance hasn&#39;t been up for this many days.&quot;</span><span class="p">,</span>
</span><span id="__span-3-59"><span class="w">                    </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;String&quot;</span>
</span><span id="__span-3-60"><span class="w">                </span><span class="p">},</span>
</span><span id="__span-3-61"><span class="w">                </span><span class="nt">&quot;Signal&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-3-62"><span class="w">                    </span><span class="nt">&quot;allowedValues&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-3-63"><span class="w">                        </span><span class="s2">&quot;SIGHUP&quot;</span><span class="p">,</span>
</span><span id="__span-3-64"><span class="w">                        </span><span class="s2">&quot;SIGKILL&quot;</span>
</span><span id="__span-3-65"><span class="w">                    </span><span class="p">],</span>
</span><span id="__span-3-66"><span class="w">                    </span><span class="nt">&quot;default&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;SIGHUP&quot;</span><span class="p">,</span>
</span><span id="__span-3-67"><span class="w">                    </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;SIGHUP for controlled shutdown of lava daemons. SIGKILL for hard kill.&quot;</span><span class="p">,</span>
</span><span id="__span-3-68"><span class="w">                    </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;String&quot;</span>
</span><span id="__span-3-69"><span class="w">                </span><span class="p">},</span>
</span><span id="__span-3-70"><span class="w">                </span><span class="nt">&quot;Wait&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-3-71"><span class="w">                    </span><span class="nt">&quot;allowedPattern&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;^\\d+[hms]?$&quot;</span><span class="p">,</span>
</span><span id="__span-3-72"><span class="w">                    </span><span class="nt">&quot;default&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;15m&quot;</span><span class="p">,</span>
</span><span id="__span-3-73"><span class="w">                    </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Wait for specified duration for lava workers to stop voluntarily before killing them.&quot;</span><span class="p">,</span>
</span><span id="__span-3-74"><span class="w">                    </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;String&quot;</span>
</span><span id="__span-3-75"><span class="w">                </span><span class="p">}</span>
</span><span id="__span-3-76"><span class="w">            </span><span class="p">},</span>
</span><span id="__span-3-77"><span class="w">            </span><span class="nt">&quot;schemaVersion&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2.2&quot;</span>
</span><span id="__span-3-78"><span class="w">        </span><span class="p">},</span>
</span><span id="__span-3-79"><span class="w">        </span><span class="nt">&quot;DocumentFormat&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;JSON&quot;</span><span class="p">,</span>
</span><span id="__span-3-80"><span class="w">        </span><span class="nt">&quot;DocumentType&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Command&quot;</span><span class="p">,</span>
</span><span id="__span-3-81"><span class="w">        </span><span class="nt">&quot;Name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;lava-SecurityUpdate&quot;</span><span class="p">,</span>
</span><span id="__span-3-82"><span class="w">        </span><span class="nt">&quot;TargetType&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/AWS::EC2::Instance&quot;</span>
</span><span id="__span-3-83"><span class="w">    </span><span class="p">},</span>
</span><span id="__span-3-84"><span class="w">    </span><span class="nt">&quot;Type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AWS::SSM::Document&quot;</span>
</span><span id="__span-3-85"><span class="p">}</span>
</span></code></pre></div>
</div>
</div>
</div>
<h2 id="lava-realmcfnjson">lava-realm.cfn.json<a class="headerlink" href="#lava-realmcfnjson" title="Permanent link">&para;</a></h2>
<p>This template builds the core components for a new Lava realm. It does not create any Lava workers or add the required entry to the realms table.</p>
<h3 id="parameters_1"><a href="#lava-realmcfnjson">Parameters</a><a class="headerlink" href="#parameters_1" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Version</td>
<td>String</td>
<td>Lava version (read only).</td>
</tr>
<tr>
<td>autoscalingHeartbeatMinutes</td>
<td>Number</td>
<td>Send auto scaling heartbeats at this frequency when workers are terminating. Must be between 1 and 30.</td>
</tr>
<tr>
<td>createRealmsTable</td>
<td>String</td>
<td>Should the realms table be created?</td>
</tr>
<tr>
<td>kmsKeyAdmin</td>
<td>String</td>
<td>IAM user name of KMS key administrator Must be specified.</td>
</tr>
<tr>
<td>lambdaArchitecture</td>
<td>String</td>
<td>Lambda machine architecture</td>
</tr>
<tr>
<td>lambdaMemory</td>
<td>Number</td>
<td>Memory for the lambdas (Mb) A minimum of 160Mb is recommended for py3.11. Py3.12/3.13 will use more.</td>
</tr>
<tr>
<td>lambdaMetricsSchedule</td>
<td>String</td>
<td>Enable the scheduler for the metrics lambda?</td>
</tr>
<tr>
<td>lambdaRuntime</td>
<td>String</td>
<td>Lambda runtime</td>
</tr>
<tr>
<td>lambdaTimeout</td>
<td>Number</td>
<td>Timeout for the lambdas (seconds) Must be between 15 and 900.</td>
</tr>
<tr>
<td>lambdaVersion</td>
<td>String</td>
<td>Code version of lambda bundles (e.g. 2.3.1). If blank, no lambdas are deployed.</td>
</tr>
<tr>
<td>lavaBucketName</td>
<td>String</td>
<td>Name of S3 bucket for the realm. Must be specified.</td>
</tr>
<tr>
<td>lavaGroupTag</td>
<td>String</td>
<td>Value for the lava:group tag on resources (e.g. prod).</td>
</tr>
<tr>
<td>logBucketName</td>
<td>String</td>
<td>Name of S3 bucket for S3 logs. Must be specified.</td>
</tr>
<tr>
<td>readCapacityDataTables</td>
<td>Number</td>
<td>Read capacity for the Dynamo DB data tables. Must be &gt;= 1</td>
</tr>
<tr>
<td>readCapacityEventTable</td>
<td>Number</td>
<td>Read capacity for the Dynamo DB event table. Must be &gt;= 1</td>
</tr>
<tr>
<td>readCapacityStateTable</td>
<td>Number</td>
<td>Read capacity for the Dynamo DB state table. Must be &gt;= 1</td>
</tr>
<tr>
<td>realm</td>
<td>String</td>
<td>Name of the realm</td>
</tr>
<tr>
<td>s3CodeBucket</td>
<td>String</td>
<td>S3 bucket containining Lava code. Must be specified.</td>
</tr>
<tr>
<td>s3CodePrefix</td>
<td>String</td>
<td>Prefix in S3 bucket containining Lava code. Must be specified.</td>
</tr>
<tr>
<td>tmpExpiryDays</td>
<td>Number</td>
<td>Expire temp area of lava bucket after this many days. Must be &gt;=1</td>
</tr>
<tr>
<td>workerStopMinutes</td>
<td>Number</td>
<td>Allow workers this many minutes to stop gracefully. Must be between 0 and 720 (12 hours).</td>
</tr>
<tr>
<td>writeCapacityDataTables</td>
<td>Number</td>
<td>Write capacity for the Dynamo DB data tables. Must be &gt;= 1</td>
</tr>
<tr>
<td>writeCapacityEventTable</td>
<td>Number</td>
<td>Write capacity for the Dynamo DB event table. Must be &gt;= 1</td>
</tr>
<tr>
<td>writeCapacityStateTable</td>
<td>Number</td>
<td>Write capacity for the Dynamo DB state table. Must be &gt;= 1</td>
</tr>
</tbody>
</table>
<h3 id="outputs_1"><a href="#lava-realmcfnjson">Outputs</a><a class="headerlink" href="#outputs_1" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Id</th>
<th>Export as</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Version</td>
<td><code class="language-json highlight"><span class="p">{</span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;lava:${realm}:version&quot;</span><span class="p">}</span></code></td>
<td>Lava version</td>
</tr>
<tr>
<td>iamLavaWorkerPolicy</td>
<td><code class="language-json highlight"><span class="p">{</span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;lava:${realm}:iamLavaWorkerPolicyArn&quot;</span><span class="p">}</span></code></td>
<td>ARN of the lava worker IAM policy.</td>
</tr>
<tr>
<td>kmsUserKeyAlias</td>
<td><code class="language-json highlight"><span class="p">{</span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;lava:${realm}:kmsUserKeyAlias&quot;</span><span class="p">}</span></code></td>
<td>Alias for the KMS user key for the realm.</td>
</tr>
<tr>
<td>lambdaLavaStop</td>
<td><code class="language-json highlight"><span class="p">{</span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;lava:${realm}:lambdaLavaStop&quot;</span><span class="p">}</span></code></td>
<td>ARN of the lava stop lambda for controlled worker shutdown</td>
</tr>
<tr>
<td>lavaGroupTag</td>
<td><code class="language-json highlight"><span class="p">{</span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;lava:${realm}:lavaGroupTag&quot;</span><span class="p">}</span></code></td>
<td>Value for the lava:group tag on resources.</td>
</tr>
<tr>
<td>s3CodeBucket</td>
<td><code class="language-json highlight"><span class="p">{</span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;lava:${realm}:s3CodeBucket&quot;</span><span class="p">}</span></code></td>
<td>S3 bucket where Lava base code resides.</td>
</tr>
<tr>
<td>s3CodePrefix</td>
<td><code class="language-json highlight"><span class="p">{</span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;lava:${realm}:s3CodePrefix&quot;</span><span class="p">}</span></code></td>
<td>S3 prefix where Lava base code resides.</td>
</tr>
<tr>
<td>s3LavaBucket</td>
<td><code class="language-json highlight"><span class="p">{</span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;lava:${realm}:s3LavaBucketName&quot;</span><span class="p">}</span></code></td>
<td>Name of lava realm bucket for payloads and tmp space.</td>
</tr>
</tbody>
</table>
<h3 id="resources_1"><a href="#lava-realmcfnjson">Resources</a><a class="headerlink" href="#resources_1" title="Permanent link">&para;</a></h3>
<ul>
<li><a href="#dynamodb-resources">DynamoDB Resources</a></li>
<li><a href="#events-resources">Events Resources</a></li>
<li><a href="#iam-resources">IAM Resources</a></li>
<li><a href="#kms-resources">KMS Resources</a></li>
<li><a href="#lambda-resources">Lambda Resources</a></li>
<li><a href="#s3-resources">S3 Resources</a></li>
<li><a href="#sns-resources">SNS Resources</a></li>
</ul>
<h4 id="dynamodb-resources"><a href="#lava-realmcfnjson">DynamoDB Resources</a><a class="headerlink" href="#dynamodb-resources" title="Permanent link">&para;</a></h4>
<table>
<thead>
<tr>
<th>Id</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="#dyntableconnections">dynTableConnections</a></td>
<td>Table</td>
<td>Lava connections table. There must be one of these per lava realm.</td>
</tr>
<tr>
<td><a href="#dyntableevents">dynTableEvents</a></td>
<td>Table</td>
<td>Lava events table. There must be one of these per lava realm.</td>
</tr>
<tr>
<td><a href="#dyntablejobs">dynTableJobs</a></td>
<td>Table</td>
<td>Lava jobs table. There must be one of these per lava realm.</td>
</tr>
<tr>
<td><a href="#dyntablerealm">dynTableRealm</a></td>
<td>Table</td>
<td>Lava realms table. There must be one of these per AWS account.</td>
</tr>
<tr>
<td><a href="#dyntables3triggers">dynTableS3Triggers</a></td>
<td>Table</td>
<td>Lava s3triggers table. There can be one of these per lava realm.</td>
</tr>
<tr>
<td><a href="#dyntablestate">dynTableState</a></td>
<td>Table</td>
<td>Lava transient state table. There must be one of these per lava realm.</td>
</tr>
</tbody>
</table>
<h4 id="events-resources"><a href="#lava-realmcfnjson">Events Resources</a><a class="headerlink" href="#events-resources" title="Permanent link">&para;</a></h4>
<table>
<thead>
<tr>
<th>Id</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="#eventsschedulemetricslambda">eventsScheduleMetricsLambda</a></td>
<td>Rule</td>
<td>EventBridge rule for running metrics lambda function.</td>
</tr>
</tbody>
</table>
<h4 id="iam-resources"><a href="#lava-realmcfnjson">IAM Resources</a><a class="headerlink" href="#iam-resources" title="Permanent link">&para;</a></h4>
<table>
<thead>
<tr>
<th>Id</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="#iamdispatchlambdainstanceprofile">iamDispatchLambdaInstanceProfile</a></td>
<td>InstanceProfile</td>
<td></td>
</tr>
<tr>
<td><a href="#iamlavaadmingroup">iamLavaAdminGroup</a></td>
<td>Group</td>
<td>Admin group for lave realm.</td>
</tr>
<tr>
<td><a href="#iamlavaadminpolicy">iamLavaAdminPolicy</a></td>
<td>ManagedPolicy</td>
<td>Admin policy for lava realm - part 1.</td>
</tr>
<tr>
<td><a href="#iamlavaadminpolicy2">iamLavaAdminPolicy2</a></td>
<td>ManagedPolicy</td>
<td>Admin policy for lava realm - part 2.</td>
</tr>
<tr>
<td><a href="#iamlavadispatchlambdapolicy">iamLavaDispatchLambdaPolicy</a></td>
<td>ManagedPolicy</td>
<td>Policy for the dispatching lambdas for the lava realm.</td>
</tr>
<tr>
<td><a href="#iamlavadispatchlambdarole">iamLavaDispatchLambdaRole</a></td>
<td>Role</td>
<td>IAM role for dispatching Lambda functions.</td>
</tr>
<tr>
<td><a href="#iamlavametricslambdapolicy">iamLavaMetricsLambdaPolicy</a></td>
<td>ManagedPolicy</td>
<td>Policy for the metrics lambda for the lava realm.</td>
</tr>
<tr>
<td><a href="#iamlavametricslambdarole">iamLavaMetricsLambdaRole</a></td>
<td>Role</td>
<td>IAM role for metrics Lambda function.</td>
</tr>
<tr>
<td><a href="#iamlavaoperator">iamLavaOperator</a></td>
<td>Group</td>
<td>Operator group for lave realm.</td>
</tr>
<tr>
<td><a href="#iamlavaoperatorpolicy">iamLavaOperatorPolicy</a></td>
<td>ManagedPolicy</td>
<td>Operator (incremental) access policy for lava realm.</td>
</tr>
<tr>
<td><a href="#iamlavareadergroup">iamLavaReaderGroup</a></td>
<td>Group</td>
<td>Reader group for lave realm.</td>
</tr>
<tr>
<td><a href="#iamlavareaderpolicy">iamLavaReaderPolicy</a></td>
<td>ManagedPolicy</td>
<td>Read access policy for lava realm.</td>
</tr>
<tr>
<td><a href="#iamlavastoplambdapolicy">iamLavaStopLambdaPolicy</a></td>
<td>ManagedPolicy</td>
<td>Policy for the node stopper lambda for the lava realm.</td>
</tr>
<tr>
<td><a href="#iamlavastoplambdarole">iamLavaStopLambdaRole</a></td>
<td>Role</td>
<td>IAM role for node stopper Lambda function.</td>
</tr>
<tr>
<td><a href="#iamlavaworkerpolicy">iamLavaWorkerPolicy</a></td>
<td>ManagedPolicy</td>
<td>Worker policy for lava realm.</td>
</tr>
</tbody>
</table>
<h4 id="kms-resources"><a href="#lava-realmcfnjson">KMS Resources</a><a class="headerlink" href="#kms-resources" title="Permanent link">&para;</a></h4>
<table>
<thead>
<tr>
<th>Id</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="#kmssysalias">kmsSysAlias</a></td>
<td>Alias</td>
<td>System KMS key alias for lava realm.</td>
</tr>
<tr>
<td><a href="#kmssyskey">kmsSysKey</a></td>
<td>Key</td>
<td>System KMS key for lava realm.</td>
</tr>
<tr>
<td><a href="#kmsuseralias">kmsUserAlias</a></td>
<td>Alias</td>
<td>User KMS key alias for lava realm.</td>
</tr>
<tr>
<td><a href="#kmsuserkey">kmsUserKey</a></td>
<td>Key</td>
<td>User KMS key for lava realm.</td>
</tr>
</tbody>
</table>
<h4 id="lambda-resources"><a href="#lava-realmcfnjson">Lambda Resources</a><a class="headerlink" href="#lambda-resources" title="Permanent link">&para;</a></h4>
<table>
<thead>
<tr>
<th>Id</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="#lambdadispatch">lambdaDispatch</a></td>
<td>Function</td>
<td>Dispatch Lambda function for the realm.</td>
</tr>
<tr>
<td><a href="#lambdalavametrics">lambdaLavaMetrics</a></td>
<td>Function</td>
<td>Lambda function to produce CloudWatch metrics.</td>
</tr>
<tr>
<td><a href="#lambdalavametricspermission">lambdaLavaMetricsPermission</a></td>
<td>Permission</td>
<td>Allow EventBridge to run the schedule for the metrics lambda.</td>
</tr>
<tr>
<td><a href="#lambdalavastop">lambdaLavaStop</a></td>
<td>Function</td>
<td>Lambda function to stop daemons on a worker node</td>
</tr>
<tr>
<td><a href="#lambdas3trigger">lambdaS3Trigger</a></td>
<td>Function</td>
<td>S3trigger Lambda function for the realm.</td>
</tr>
<tr>
<td><a href="#lambdas3triggerpermission">lambdaS3TriggerPermission</a></td>
<td>Permission</td>
<td>Allow EventBridge rules to invoke the s3trigger lambda.</td>
</tr>
<tr>
<td><a href="#lamdadispatchpolicy">lamdaDispatchPolicy</a></td>
<td>Permission</td>
<td></td>
</tr>
</tbody>
</table>
<h4 id="s3-resources"><a href="#lava-realmcfnjson">S3 Resources</a><a class="headerlink" href="#s3-resources" title="Permanent link">&para;</a></h4>
<table>
<thead>
<tr>
<th>Id</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="#s3lavabucket">s3LavaBucket</a></td>
<td>Bucket</td>
<td>Lava realm bucket for payloads and tmp space.</td>
</tr>
</tbody>
</table>
<h4 id="sns-resources"><a href="#lava-realmcfnjson">SNS Resources</a><a class="headerlink" href="#sns-resources" title="Permanent link">&para;</a></h4>
<table>
<thead>
<tr>
<th>Id</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="#snsdispatchhelper">snsDispatchHelper</a></td>
<td>Topic</td>
<td>SNS topic for the dispatch helper lambda to receive dispatch requests.</td>
</tr>
<tr>
<td><a href="#snslavanotices">snsLavaNotices</a></td>
<td>Topic</td>
<td>SNS topic for lava notices. Whether or not it is used depends on lava jobs.</td>
</tr>
<tr>
<td><a href="#snssubscribedispatch">snsSubscribeDispatch</a></td>
<td>Subscription</td>
<td>Subscription for the dispatch helper Lambda to the dispatch helper SNS topic.</td>
</tr>
</tbody>
</table>
<h3 id="resource-details_1"><a href="#lava-realmcfnjson">Resource Details</a><a class="headerlink" href="#resource-details_1" title="Permanent link">&para;</a></h3>
<h4 id="dyntableconnections"><a href="#dynamodb-resources">dynTableConnections</a><a class="headerlink" href="#dyntableconnections" title="Permanent link">&para;</a></h4>
<div class="tabbed-set tabbed-alternate" data-tabs="5:2"><input checked="checked" id="__tabbed_5_1" name="__tabbed_5" type="radio" /><input id="__tabbed_5_2" name="__tabbed_5" type="radio" /><div class="tabbed-labels"><label for="__tabbed_5_1">Details</label><label for="__tabbed_5_2">Source</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<table>
<thead>
<tr>
<th>Property</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Type</td>
<td><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-dynamodb-table.html" title="AWS documentation for this resource type">AWS::DynamoDB::Table</a></td>
</tr>
<tr>
<td>Group</td>
<td><a href="#dynamodb-resources">DynamoDB Resources</a> (<a href="#dynamodb-resources">DynamoDB</a>)</td>
</tr>
<tr>
<td>Description</td>
<td>Lava connections table. There must be one of these per lava realm.</td>
</tr>
</tbody>
</table>
</div>
<div class="tabbed-block">
<div class="language-json highlight"><pre><span></span><code><span id="__span-4-1"><span class="p">{</span>
</span><span id="__span-4-2"><span class="w">    </span><span class="nt">&quot;Properties&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-4-3"><span class="w">        </span><span class="nt">&quot;AttributeDefinitions&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-4-4"><span class="w">            </span><span class="p">{</span>
</span><span id="__span-4-5"><span class="w">                </span><span class="nt">&quot;AttributeName&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;conn_id&quot;</span><span class="p">,</span>
</span><span id="__span-4-6"><span class="w">                </span><span class="nt">&quot;AttributeType&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;S&quot;</span>
</span><span id="__span-4-7"><span class="w">            </span><span class="p">}</span>
</span><span id="__span-4-8"><span class="w">        </span><span class="p">],</span>
</span><span id="__span-4-9"><span class="w">        </span><span class="nt">&quot;KeySchema&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-4-10"><span class="w">            </span><span class="p">{</span>
</span><span id="__span-4-11"><span class="w">                </span><span class="nt">&quot;AttributeName&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;conn_id&quot;</span><span class="p">,</span>
</span><span id="__span-4-12"><span class="w">                </span><span class="nt">&quot;KeyType&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;HASH&quot;</span>
</span><span id="__span-4-13"><span class="w">            </span><span class="p">}</span>
</span><span id="__span-4-14"><span class="w">        </span><span class="p">],</span>
</span><span id="__span-4-15"><span class="w">        </span><span class="nt">&quot;PointInTimeRecoverySpecification&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-4-16"><span class="w">            </span><span class="nt">&quot;PointInTimeRecoveryEnabled&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-4-17"><span class="w">        </span><span class="p">},</span>
</span><span id="__span-4-18"><span class="w">        </span><span class="nt">&quot;ProvisionedThroughput&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-4-19"><span class="w">            </span><span class="nt">&quot;ReadCapacityUnits&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-4-20"><span class="w">                </span><span class="nt">&quot;Ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;readCapacityDataTables&quot;</span>
</span><span id="__span-4-21"><span class="w">            </span><span class="p">},</span>
</span><span id="__span-4-22"><span class="w">            </span><span class="nt">&quot;WriteCapacityUnits&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-4-23"><span class="w">                </span><span class="nt">&quot;Ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;writeCapacityDataTables&quot;</span>
</span><span id="__span-4-24"><span class="w">            </span><span class="p">}</span>
</span><span id="__span-4-25"><span class="w">        </span><span class="p">},</span>
</span><span id="__span-4-26"><span class="w">        </span><span class="nt">&quot;TableName&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-4-27"><span class="w">            </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;lava.${realm}.connections&quot;</span>
</span><span id="__span-4-28"><span class="w">        </span><span class="p">},</span>
</span><span id="__span-4-29"><span class="w">        </span><span class="nt">&quot;Tags&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-4-30"><span class="w">            </span><span class="p">{</span>
</span><span id="__span-4-31"><span class="w">                </span><span class="nt">&quot;Key&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;lava:realm&quot;</span><span class="p">,</span>
</span><span id="__span-4-32"><span class="w">                </span><span class="nt">&quot;Value&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-4-33"><span class="w">                    </span><span class="nt">&quot;Ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;realm&quot;</span>
</span><span id="__span-4-34"><span class="w">                </span><span class="p">}</span>
</span><span id="__span-4-35"><span class="w">            </span><span class="p">},</span>
</span><span id="__span-4-36"><span class="w">            </span><span class="p">{</span>
</span><span id="__span-4-37"><span class="w">                </span><span class="nt">&quot;Key&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;lava:group&quot;</span><span class="p">,</span>
</span><span id="__span-4-38"><span class="w">                </span><span class="nt">&quot;Value&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-4-39"><span class="w">                    </span><span class="nt">&quot;Ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;lavaGroupTag&quot;</span>
</span><span id="__span-4-40"><span class="w">                </span><span class="p">}</span>
</span><span id="__span-4-41"><span class="w">            </span><span class="p">}</span>
</span><span id="__span-4-42"><span class="w">        </span><span class="p">]</span>
</span><span id="__span-4-43"><span class="w">    </span><span class="p">},</span>
</span><span id="__span-4-44"><span class="w">    </span><span class="nt">&quot;Type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AWS::DynamoDB::Table&quot;</span>
</span><span id="__span-4-45"><span class="p">}</span>
</span></code></pre></div>
</div>
</div>
</div>
<h4 id="dyntableevents"><a href="#dynamodb-resources">dynTableEvents</a><a class="headerlink" href="#dyntableevents" title="Permanent link">&para;</a></h4>
<div class="tabbed-set tabbed-alternate" data-tabs="6:2"><input checked="checked" id="__tabbed_6_1" name="__tabbed_6" type="radio" /><input id="__tabbed_6_2" name="__tabbed_6" type="radio" /><div class="tabbed-labels"><label for="__tabbed_6_1">Details</label><label for="__tabbed_6_2">Source</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<table>
<thead>
<tr>
<th>Property</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Type</td>
<td><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-dynamodb-table.html" title="AWS documentation for this resource type">AWS::DynamoDB::Table</a></td>
</tr>
<tr>
<td>Group</td>
<td><a href="#dynamodb-resources">DynamoDB Resources</a> (<a href="#dynamodb-resources">DynamoDB</a>)</td>
</tr>
<tr>
<td>Description</td>
<td>Lava events table. There must be one of these per lava realm.</td>
</tr>
</tbody>
</table>
</div>
<div class="tabbed-block">
<div class="language-json highlight"><pre><span></span><code><span id="__span-5-1"><span class="p">{</span>
</span><span id="__span-5-2"><span class="w">    </span><span class="nt">&quot;Properties&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-5-3"><span class="w">        </span><span class="nt">&quot;AttributeDefinitions&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-5-4"><span class="w">            </span><span class="p">{</span>
</span><span id="__span-5-5"><span class="w">                </span><span class="nt">&quot;AttributeName&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;job_id&quot;</span><span class="p">,</span>
</span><span id="__span-5-6"><span class="w">                </span><span class="nt">&quot;AttributeType&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;S&quot;</span>
</span><span id="__span-5-7"><span class="w">            </span><span class="p">},</span>
</span><span id="__span-5-8"><span class="w">            </span><span class="p">{</span>
</span><span id="__span-5-9"><span class="w">                </span><span class="nt">&quot;AttributeName&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;run_id&quot;</span><span class="p">,</span>
</span><span id="__span-5-10"><span class="w">                </span><span class="nt">&quot;AttributeType&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;S&quot;</span>
</span><span id="__span-5-11"><span class="w">            </span><span class="p">},</span>
</span><span id="__span-5-12"><span class="w">            </span><span class="p">{</span>
</span><span id="__span-5-13"><span class="w">                </span><span class="nt">&quot;AttributeName&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;tu_event&quot;</span><span class="p">,</span>
</span><span id="__span-5-14"><span class="w">                </span><span class="nt">&quot;AttributeType&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;S&quot;</span>
</span><span id="__span-5-15"><span class="w">            </span><span class="p">}</span>
</span><span id="__span-5-16"><span class="w">        </span><span class="p">],</span>
</span><span id="__span-5-17"><span class="w">        </span><span class="nt">&quot;KeySchema&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-5-18"><span class="w">            </span><span class="p">{</span>
</span><span id="__span-5-19"><span class="w">                </span><span class="nt">&quot;AttributeName&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;job_id&quot;</span><span class="p">,</span>
</span><span id="__span-5-20"><span class="w">                </span><span class="nt">&quot;KeyType&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;HASH&quot;</span>
</span><span id="__span-5-21"><span class="w">            </span><span class="p">},</span>
</span><span id="__span-5-22"><span class="w">            </span><span class="p">{</span>
</span><span id="__span-5-23"><span class="w">                </span><span class="nt">&quot;AttributeName&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;run_id&quot;</span><span class="p">,</span>
</span><span id="__span-5-24"><span class="w">                </span><span class="nt">&quot;KeyType&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;RANGE&quot;</span>
</span><span id="__span-5-25"><span class="w">            </span><span class="p">}</span>
</span><span id="__span-5-26"><span class="w">        </span><span class="p">],</span>
</span><span id="__span-5-27"><span class="w">        </span><span class="nt">&quot;LocalSecondaryIndexes&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-5-28"><span class="w">            </span><span class="p">{</span>
</span><span id="__span-5-29"><span class="w">                </span><span class="nt">&quot;IndexName&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;job_id-tu_event-index&quot;</span><span class="p">,</span>
</span><span id="__span-5-30"><span class="w">                </span><span class="nt">&quot;KeySchema&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-5-31"><span class="w">                    </span><span class="p">{</span>
</span><span id="__span-5-32"><span class="w">                        </span><span class="nt">&quot;AttributeName&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;job_id&quot;</span><span class="p">,</span>
</span><span id="__span-5-33"><span class="w">                        </span><span class="nt">&quot;KeyType&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;HASH&quot;</span>
</span><span id="__span-5-34"><span class="w">                    </span><span class="p">},</span>
</span><span id="__span-5-35"><span class="w">                    </span><span class="p">{</span>
</span><span id="__span-5-36"><span class="w">                        </span><span class="nt">&quot;AttributeName&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;tu_event&quot;</span><span class="p">,</span>
</span><span id="__span-5-37"><span class="w">                        </span><span class="nt">&quot;KeyType&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;RANGE&quot;</span>
</span><span id="__span-5-38"><span class="w">                    </span><span class="p">}</span>
</span><span id="__span-5-39"><span class="w">                </span><span class="p">],</span>
</span><span id="__span-5-40"><span class="w">                </span><span class="nt">&quot;Projection&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-5-41"><span class="w">                    </span><span class="nt">&quot;ProjectionType&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ALL&quot;</span>
</span><span id="__span-5-42"><span class="w">                </span><span class="p">}</span>
</span><span id="__span-5-43"><span class="w">            </span><span class="p">}</span>
</span><span id="__span-5-44"><span class="w">        </span><span class="p">],</span>
</span><span id="__span-5-45"><span class="w">        </span><span class="nt">&quot;ProvisionedThroughput&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-5-46"><span class="w">            </span><span class="nt">&quot;ReadCapacityUnits&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-5-47"><span class="w">                </span><span class="nt">&quot;Ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;readCapacityEventTable&quot;</span>
</span><span id="__span-5-48"><span class="w">            </span><span class="p">},</span>
</span><span id="__span-5-49"><span class="w">            </span><span class="nt">&quot;WriteCapacityUnits&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-5-50"><span class="w">                </span><span class="nt">&quot;Ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;writeCapacityEventTable&quot;</span>
</span><span id="__span-5-51"><span class="w">            </span><span class="p">}</span>
</span><span id="__span-5-52"><span class="w">        </span><span class="p">},</span>
</span><span id="__span-5-53"><span class="w">        </span><span class="nt">&quot;TableName&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-5-54"><span class="w">            </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;lava.${realm}.events&quot;</span>
</span><span id="__span-5-55"><span class="w">        </span><span class="p">},</span>
</span><span id="__span-5-56"><span class="w">        </span><span class="nt">&quot;Tags&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-5-57"><span class="w">            </span><span class="p">{</span>
</span><span id="__span-5-58"><span class="w">                </span><span class="nt">&quot;Key&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;lava:realm&quot;</span><span class="p">,</span>
</span><span id="__span-5-59"><span class="w">                </span><span class="nt">&quot;Value&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-5-60"><span class="w">                    </span><span class="nt">&quot;Ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;realm&quot;</span>
</span><span id="__span-5-61"><span class="w">                </span><span class="p">}</span>
</span><span id="__span-5-62"><span class="w">            </span><span class="p">},</span>
</span><span id="__span-5-63"><span class="w">            </span><span class="p">{</span>
</span><span id="__span-5-64"><span class="w">                </span><span class="nt">&quot;Key&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;lava:group&quot;</span><span class="p">,</span>
</span><span id="__span-5-65"><span class="w">                </span><span class="nt">&quot;Value&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-5-66"><span class="w">                    </span><span class="nt">&quot;Ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;lavaGroupTag&quot;</span>
</span><span id="__span-5-67"><span class="w">                </span><span class="p">}</span>
</span><span id="__span-5-68"><span class="w">            </span><span class="p">}</span>
</span><span id="__span-5-69"><span class="w">        </span><span class="p">],</span>
</span><span id="__span-5-70"><span class="w">        </span><span class="nt">&quot;TimeToLiveSpecification&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-5-71"><span class="w">            </span><span class="nt">&quot;AttributeName&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ttl&quot;</span><span class="p">,</span>
</span><span id="__span-5-72"><span class="w">            </span><span class="nt">&quot;Enabled&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-5-73"><span class="w">        </span><span class="p">}</span>
</span><span id="__span-5-74"><span class="w">    </span><span class="p">},</span>
</span><span id="__span-5-75"><span class="w">    </span><span class="nt">&quot;Type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AWS::DynamoDB::Table&quot;</span>
</span><span id="__span-5-76"><span class="p">}</span>
</span></code></pre></div>
</div>
</div>
</div>
<h4 id="dyntablejobs"><a href="#dynamodb-resources">dynTableJobs</a><a class="headerlink" href="#dyntablejobs" title="Permanent link">&para;</a></h4>
<div class="tabbed-set tabbed-alternate" data-tabs="7:2"><input checked="checked" id="__tabbed_7_1" name="__tabbed_7" type="radio" /><input id="__tabbed_7_2" name="__tabbed_7" type="radio" /><div class="tabbed-labels"><label for="__tabbed_7_1">Details</label><label for="__tabbed_7_2">Source</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<table>
<thead>
<tr>
<th>Property</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Type</td>
<td><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-dynamodb-table.html" title="AWS documentation for this resource type">AWS::DynamoDB::Table</a></td>
</tr>
<tr>
<td>Group</td>
<td><a href="#dynamodb-resources">DynamoDB Resources</a> (<a href="#dynamodb-resources">DynamoDB</a>)</td>
</tr>
<tr>
<td>Description</td>
<td>Lava jobs table. There must be one of these per lava realm.</td>
</tr>
</tbody>
</table>
</div>
<div class="tabbed-block">
<div class="language-json highlight"><pre><span></span><code><span id="__span-6-1"><span class="p">{</span>
</span><span id="__span-6-2"><span class="w">    </span><span class="nt">&quot;Properties&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-6-3"><span class="w">        </span><span class="nt">&quot;AttributeDefinitions&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-6-4"><span class="w">            </span><span class="p">{</span>
</span><span id="__span-6-5"><span class="w">                </span><span class="nt">&quot;AttributeName&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;dispatcher&quot;</span><span class="p">,</span>
</span><span id="__span-6-6"><span class="w">                </span><span class="nt">&quot;AttributeType&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;S&quot;</span>
</span><span id="__span-6-7"><span class="w">            </span><span class="p">},</span>
</span><span id="__span-6-8"><span class="w">            </span><span class="p">{</span>
</span><span id="__span-6-9"><span class="w">                </span><span class="nt">&quot;AttributeName&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;job_id&quot;</span><span class="p">,</span>
</span><span id="__span-6-10"><span class="w">                </span><span class="nt">&quot;AttributeType&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;S&quot;</span>
</span><span id="__span-6-11"><span class="w">            </span><span class="p">}</span>
</span><span id="__span-6-12"><span class="w">        </span><span class="p">],</span>
</span><span id="__span-6-13"><span class="w">        </span><span class="nt">&quot;GlobalSecondaryIndexes&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-6-14"><span class="w">            </span><span class="p">{</span>
</span><span id="__span-6-15"><span class="w">                </span><span class="nt">&quot;IndexName&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;dispatcher-index&quot;</span><span class="p">,</span>
</span><span id="__span-6-16"><span class="w">                </span><span class="nt">&quot;KeySchema&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-6-17"><span class="w">                    </span><span class="p">{</span>
</span><span id="__span-6-18"><span class="w">                        </span><span class="nt">&quot;AttributeName&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;dispatcher&quot;</span><span class="p">,</span>
</span><span id="__span-6-19"><span class="w">                        </span><span class="nt">&quot;KeyType&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;HASH&quot;</span>
</span><span id="__span-6-20"><span class="w">                    </span><span class="p">},</span>
</span><span id="__span-6-21"><span class="w">                    </span><span class="p">{</span>
</span><span id="__span-6-22"><span class="w">                        </span><span class="nt">&quot;AttributeName&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;job_id&quot;</span><span class="p">,</span>
</span><span id="__span-6-23"><span class="w">                        </span><span class="nt">&quot;KeyType&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;RANGE&quot;</span>
</span><span id="__span-6-24"><span class="w">                    </span><span class="p">}</span>
</span><span id="__span-6-25"><span class="w">                </span><span class="p">],</span>
</span><span id="__span-6-26"><span class="w">                </span><span class="nt">&quot;Projection&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-6-27"><span class="w">                    </span><span class="nt">&quot;NonKeyAttributes&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-6-28"><span class="w">                        </span><span class="s2">&quot;worker&quot;</span><span class="p">,</span>
</span><span id="__span-6-29"><span class="w">                        </span><span class="s2">&quot;schedule&quot;</span>
</span><span id="__span-6-30"><span class="w">                    </span><span class="p">],</span>
</span><span id="__span-6-31"><span class="w">                    </span><span class="nt">&quot;ProjectionType&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;INCLUDE&quot;</span>
</span><span id="__span-6-32"><span class="w">                </span><span class="p">},</span>
</span><span id="__span-6-33"><span class="w">                </span><span class="nt">&quot;ProvisionedThroughput&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-6-34"><span class="w">                    </span><span class="nt">&quot;ReadCapacityUnits&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-6-35"><span class="w">                        </span><span class="nt">&quot;Ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;readCapacityDataTables&quot;</span>
</span><span id="__span-6-36"><span class="w">                    </span><span class="p">},</span>
</span><span id="__span-6-37"><span class="w">                    </span><span class="nt">&quot;WriteCapacityUnits&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-6-38"><span class="w">                        </span><span class="nt">&quot;Ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;writeCapacityDataTables&quot;</span>
</span><span id="__span-6-39"><span class="w">                    </span><span class="p">}</span>
</span><span id="__span-6-40"><span class="w">                </span><span class="p">}</span>
</span><span id="__span-6-41"><span class="w">            </span><span class="p">}</span>
</span><span id="__span-6-42"><span class="w">        </span><span class="p">],</span>
</span><span id="__span-6-43"><span class="w">        </span><span class="nt">&quot;KeySchema&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-6-44"><span class="w">            </span><span class="p">{</span>
</span><span id="__span-6-45"><span class="w">                </span><span class="nt">&quot;AttributeName&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;job_id&quot;</span><span class="p">,</span>
</span><span id="__span-6-46"><span class="w">                </span><span class="nt">&quot;KeyType&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;HASH&quot;</span>
</span><span id="__span-6-47"><span class="w">            </span><span class="p">}</span>
</span><span id="__span-6-48"><span class="w">        </span><span class="p">],</span>
</span><span id="__span-6-49"><span class="w">        </span><span class="nt">&quot;PointInTimeRecoverySpecification&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-6-50"><span class="w">            </span><span class="nt">&quot;PointInTimeRecoveryEnabled&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-6-51"><span class="w">        </span><span class="p">},</span>
</span><span id="__span-6-52"><span class="w">        </span><span class="nt">&quot;ProvisionedThroughput&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-6-53"><span class="w">            </span><span class="nt">&quot;ReadCapacityUnits&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-6-54"><span class="w">                </span><span class="nt">&quot;Ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;readCapacityDataTables&quot;</span>
</span><span id="__span-6-55"><span class="w">            </span><span class="p">},</span>
</span><span id="__span-6-56"><span class="w">            </span><span class="nt">&quot;WriteCapacityUnits&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-6-57"><span class="w">                </span><span class="nt">&quot;Ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;writeCapacityDataTables&quot;</span>
</span><span id="__span-6-58"><span class="w">            </span><span class="p">}</span>
</span><span id="__span-6-59"><span class="w">        </span><span class="p">},</span>
</span><span id="__span-6-60"><span class="w">        </span><span class="nt">&quot;TableName&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-6-61"><span class="w">            </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;lava.${realm}.jobs&quot;</span>
</span><span id="__span-6-62"><span class="w">        </span><span class="p">},</span>
</span><span id="__span-6-63"><span class="w">        </span><span class="nt">&quot;Tags&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-6-64"><span class="w">            </span><span class="p">{</span>
</span><span id="__span-6-65"><span class="w">                </span><span class="nt">&quot;Key&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;lava:realm&quot;</span><span class="p">,</span>
</span><span id="__span-6-66"><span class="w">                </span><span class="nt">&quot;Value&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-6-67"><span class="w">                    </span><span class="nt">&quot;Ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;realm&quot;</span>
</span><span id="__span-6-68"><span class="w">                </span><span class="p">}</span>
</span><span id="__span-6-69"><span class="w">            </span><span class="p">},</span>
</span><span id="__span-6-70"><span class="w">            </span><span class="p">{</span>
</span><span id="__span-6-71"><span class="w">                </span><span class="nt">&quot;Key&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;lava:group&quot;</span><span class="p">,</span>
</span><span id="__span-6-72"><span class="w">                </span><span class="nt">&quot;Value&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-6-73"><span class="w">                    </span><span class="nt">&quot;Ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;lavaGroupTag&quot;</span>
</span><span id="__span-6-74"><span class="w">                </span><span class="p">}</span>
</span><span id="__span-6-75"><span class="w">            </span><span class="p">}</span>
</span><span id="__span-6-76"><span class="w">        </span><span class="p">]</span>
</span><span id="__span-6-77"><span class="w">    </span><span class="p">},</span>
</span><span id="__span-6-78"><span class="w">    </span><span class="nt">&quot;Type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AWS::DynamoDB::Table&quot;</span>
</span><span id="__span-6-79"><span class="p">}</span>
</span></code></pre></div>
</div>
</div>
</div>
<h4 id="dyntablerealm"><a href="#dynamodb-resources">dynTableRealm</a><a class="headerlink" href="#dyntablerealm" title="Permanent link">&para;</a></h4>
<div class="tabbed-set tabbed-alternate" data-tabs="8:2"><input checked="checked" id="__tabbed_8_1" name="__tabbed_8" type="radio" /><input id="__tabbed_8_2" name="__tabbed_8" type="radio" /><div class="tabbed-labels"><label for="__tabbed_8_1">Details</label><label for="__tabbed_8_2">Source</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<table>
<thead>
<tr>
<th>Property</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Type</td>
<td><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-dynamodb-table.html" title="AWS documentation for this resource type">AWS::DynamoDB::Table</a></td>
</tr>
<tr>
<td>Group</td>
<td><a href="#dynamodb-resources">DynamoDB Resources</a> (<a href="#dynamodb-resources">DynamoDB</a>)</td>
</tr>
<tr>
<td>Description</td>
<td>Lava realms table. There must be one of these per AWS account.</td>
</tr>
</tbody>
</table>
</div>
<div class="tabbed-block">
<div class="language-json highlight"><pre><span></span><code><span id="__span-7-1"><span class="p">{</span>
</span><span id="__span-7-2"><span class="w">    </span><span class="nt">&quot;Condition&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ifCreateRealmsTable&quot;</span><span class="p">,</span>
</span><span id="__span-7-3"><span class="w">    </span><span class="nt">&quot;Properties&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-7-4"><span class="w">        </span><span class="nt">&quot;AttributeDefinitions&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-7-5"><span class="w">            </span><span class="p">{</span>
</span><span id="__span-7-6"><span class="w">                </span><span class="nt">&quot;AttributeName&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;realm&quot;</span><span class="p">,</span>
</span><span id="__span-7-7"><span class="w">                </span><span class="nt">&quot;AttributeType&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;S&quot;</span>
</span><span id="__span-7-8"><span class="w">            </span><span class="p">}</span>
</span><span id="__span-7-9"><span class="w">        </span><span class="p">],</span>
</span><span id="__span-7-10"><span class="w">        </span><span class="nt">&quot;KeySchema&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-7-11"><span class="w">            </span><span class="p">{</span>
</span><span id="__span-7-12"><span class="w">                </span><span class="nt">&quot;AttributeName&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;realm&quot;</span><span class="p">,</span>
</span><span id="__span-7-13"><span class="w">                </span><span class="nt">&quot;KeyType&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;HASH&quot;</span>
</span><span id="__span-7-14"><span class="w">            </span><span class="p">}</span>
</span><span id="__span-7-15"><span class="w">        </span><span class="p">],</span>
</span><span id="__span-7-16"><span class="w">        </span><span class="nt">&quot;PointInTimeRecoverySpecification&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-7-17"><span class="w">            </span><span class="nt">&quot;PointInTimeRecoveryEnabled&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-7-18"><span class="w">        </span><span class="p">},</span>
</span><span id="__span-7-19"><span class="w">        </span><span class="nt">&quot;ProvisionedThroughput&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-7-20"><span class="w">            </span><span class="nt">&quot;ReadCapacityUnits&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-7-21"><span class="w">                </span><span class="nt">&quot;Ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;readCapacityDataTables&quot;</span>
</span><span id="__span-7-22"><span class="w">            </span><span class="p">},</span>
</span><span id="__span-7-23"><span class="w">            </span><span class="nt">&quot;WriteCapacityUnits&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-7-24"><span class="w">                </span><span class="nt">&quot;Ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;writeCapacityDataTables&quot;</span>
</span><span id="__span-7-25"><span class="w">            </span><span class="p">}</span>
</span><span id="__span-7-26"><span class="w">        </span><span class="p">},</span>
</span><span id="__span-7-27"><span class="w">        </span><span class="nt">&quot;TableName&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;lava.realms&quot;</span><span class="p">,</span>
</span><span id="__span-7-28"><span class="w">        </span><span class="nt">&quot;Tags&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-7-29"><span class="w">            </span><span class="p">{</span>
</span><span id="__span-7-30"><span class="w">                </span><span class="nt">&quot;Key&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;lava:group&quot;</span><span class="p">,</span>
</span><span id="__span-7-31"><span class="w">                </span><span class="nt">&quot;Value&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;*&quot;</span>
</span><span id="__span-7-32"><span class="w">            </span><span class="p">}</span>
</span><span id="__span-7-33"><span class="w">        </span><span class="p">]</span>
</span><span id="__span-7-34"><span class="w">    </span><span class="p">},</span>
</span><span id="__span-7-35"><span class="w">    </span><span class="nt">&quot;Type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AWS::DynamoDB::Table&quot;</span>
</span><span id="__span-7-36"><span class="p">}</span>
</span></code></pre></div>
</div>
</div>
</div>
<h4 id="dyntables3triggers"><a href="#dynamodb-resources">dynTableS3Triggers</a><a class="headerlink" href="#dyntables3triggers" title="Permanent link">&para;</a></h4>
<div class="tabbed-set tabbed-alternate" data-tabs="9:2"><input checked="checked" id="__tabbed_9_1" name="__tabbed_9" type="radio" /><input id="__tabbed_9_2" name="__tabbed_9" type="radio" /><div class="tabbed-labels"><label for="__tabbed_9_1">Details</label><label for="__tabbed_9_2">Source</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<table>
<thead>
<tr>
<th>Property</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Type</td>
<td><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-dynamodb-table.html" title="AWS documentation for this resource type">AWS::DynamoDB::Table</a></td>
</tr>
<tr>
<td>Group</td>
<td><a href="#dynamodb-resources">DynamoDB Resources</a> (<a href="#dynamodb-resources">DynamoDB</a>)</td>
</tr>
<tr>
<td>Description</td>
<td>Lava s3triggers table. There can be one of these per lava realm.</td>
</tr>
</tbody>
</table>
</div>
<div class="tabbed-block">
<div class="language-json highlight"><pre><span></span><code><span id="__span-8-1"><span class="p">{</span>
</span><span id="__span-8-2"><span class="w">    </span><span class="nt">&quot;Condition&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ifCreateLambdas&quot;</span><span class="p">,</span>
</span><span id="__span-8-3"><span class="w">    </span><span class="nt">&quot;Properties&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-4"><span class="w">        </span><span class="nt">&quot;AttributeDefinitions&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-8-5"><span class="w">            </span><span class="p">{</span>
</span><span id="__span-8-6"><span class="w">                </span><span class="nt">&quot;AttributeName&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;trigger_id&quot;</span><span class="p">,</span>
</span><span id="__span-8-7"><span class="w">                </span><span class="nt">&quot;AttributeType&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;S&quot;</span>
</span><span id="__span-8-8"><span class="w">            </span><span class="p">},</span>
</span><span id="__span-8-9"><span class="w">            </span><span class="p">{</span>
</span><span id="__span-8-10"><span class="w">                </span><span class="nt">&quot;AttributeName&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;bucket&quot;</span><span class="p">,</span>
</span><span id="__span-8-11"><span class="w">                </span><span class="nt">&quot;AttributeType&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;S&quot;</span>
</span><span id="__span-8-12"><span class="w">            </span><span class="p">},</span>
</span><span id="__span-8-13"><span class="w">            </span><span class="p">{</span>
</span><span id="__span-8-14"><span class="w">                </span><span class="nt">&quot;AttributeName&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;prefix&quot;</span><span class="p">,</span>
</span><span id="__span-8-15"><span class="w">                </span><span class="nt">&quot;AttributeType&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;S&quot;</span>
</span><span id="__span-8-16"><span class="w">            </span><span class="p">}</span>
</span><span id="__span-8-17"><span class="w">        </span><span class="p">],</span>
</span><span id="__span-8-18"><span class="w">        </span><span class="nt">&quot;GlobalSecondaryIndexes&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-8-19"><span class="w">            </span><span class="p">{</span>
</span><span id="__span-8-20"><span class="w">                </span><span class="nt">&quot;IndexName&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;s3trigger-index&quot;</span><span class="p">,</span>
</span><span id="__span-8-21"><span class="w">                </span><span class="nt">&quot;KeySchema&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-8-22"><span class="w">                    </span><span class="p">{</span>
</span><span id="__span-8-23"><span class="w">                        </span><span class="nt">&quot;AttributeName&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;bucket&quot;</span><span class="p">,</span>
</span><span id="__span-8-24"><span class="w">                        </span><span class="nt">&quot;KeyType&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;HASH&quot;</span>
</span><span id="__span-8-25"><span class="w">                    </span><span class="p">},</span>
</span><span id="__span-8-26"><span class="w">                    </span><span class="p">{</span>
</span><span id="__span-8-27"><span class="w">                        </span><span class="nt">&quot;AttributeName&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;prefix&quot;</span><span class="p">,</span>
</span><span id="__span-8-28"><span class="w">                        </span><span class="nt">&quot;KeyType&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;RANGE&quot;</span>
</span><span id="__span-8-29"><span class="w">                    </span><span class="p">}</span>
</span><span id="__span-8-30"><span class="w">                </span><span class="p">],</span>
</span><span id="__span-8-31"><span class="w">                </span><span class="nt">&quot;Projection&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-32"><span class="w">                    </span><span class="nt">&quot;ProjectionType&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ALL&quot;</span>
</span><span id="__span-8-33"><span class="w">                </span><span class="p">},</span>
</span><span id="__span-8-34"><span class="w">                </span><span class="nt">&quot;ProvisionedThroughput&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-35"><span class="w">                    </span><span class="nt">&quot;ReadCapacityUnits&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-36"><span class="w">                        </span><span class="nt">&quot;Ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;readCapacityDataTables&quot;</span>
</span><span id="__span-8-37"><span class="w">                    </span><span class="p">},</span>
</span><span id="__span-8-38"><span class="w">                    </span><span class="nt">&quot;WriteCapacityUnits&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-39"><span class="w">                        </span><span class="nt">&quot;Ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;writeCapacityDataTables&quot;</span>
</span><span id="__span-8-40"><span class="w">                    </span><span class="p">}</span>
</span><span id="__span-8-41"><span class="w">                </span><span class="p">}</span>
</span><span id="__span-8-42"><span class="w">            </span><span class="p">}</span>
</span><span id="__span-8-43"><span class="w">        </span><span class="p">],</span>
</span><span id="__span-8-44"><span class="w">        </span><span class="nt">&quot;KeySchema&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-8-45"><span class="w">            </span><span class="p">{</span>
</span><span id="__span-8-46"><span class="w">                </span><span class="nt">&quot;AttributeName&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;trigger_id&quot;</span><span class="p">,</span>
</span><span id="__span-8-47"><span class="w">                </span><span class="nt">&quot;KeyType&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;HASH&quot;</span>
</span><span id="__span-8-48"><span class="w">            </span><span class="p">}</span>
</span><span id="__span-8-49"><span class="w">        </span><span class="p">],</span>
</span><span id="__span-8-50"><span class="w">        </span><span class="nt">&quot;PointInTimeRecoverySpecification&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-51"><span class="w">            </span><span class="nt">&quot;PointInTimeRecoveryEnabled&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-8-52"><span class="w">        </span><span class="p">},</span>
</span><span id="__span-8-53"><span class="w">        </span><span class="nt">&quot;ProvisionedThroughput&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-54"><span class="w">            </span><span class="nt">&quot;ReadCapacityUnits&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-55"><span class="w">                </span><span class="nt">&quot;Ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;readCapacityDataTables&quot;</span>
</span><span id="__span-8-56"><span class="w">            </span><span class="p">},</span>
</span><span id="__span-8-57"><span class="w">            </span><span class="nt">&quot;WriteCapacityUnits&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-58"><span class="w">                </span><span class="nt">&quot;Ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;writeCapacityDataTables&quot;</span>
</span><span id="__span-8-59"><span class="w">            </span><span class="p">}</span>
</span><span id="__span-8-60"><span class="w">        </span><span class="p">},</span>
</span><span id="__span-8-61"><span class="w">        </span><span class="nt">&quot;TableName&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-62"><span class="w">            </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;lava.${realm}.s3triggers&quot;</span>
</span><span id="__span-8-63"><span class="w">        </span><span class="p">},</span>
</span><span id="__span-8-64"><span class="w">        </span><span class="nt">&quot;Tags&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-8-65"><span class="w">            </span><span class="p">{</span>
</span><span id="__span-8-66"><span class="w">                </span><span class="nt">&quot;Key&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;lava:realm&quot;</span><span class="p">,</span>
</span><span id="__span-8-67"><span class="w">                </span><span class="nt">&quot;Value&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-68"><span class="w">                    </span><span class="nt">&quot;Ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;realm&quot;</span>
</span><span id="__span-8-69"><span class="w">                </span><span class="p">}</span>
</span><span id="__span-8-70"><span class="w">            </span><span class="p">},</span>
</span><span id="__span-8-71"><span class="w">            </span><span class="p">{</span>
</span><span id="__span-8-72"><span class="w">                </span><span class="nt">&quot;Key&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;lava:group&quot;</span><span class="p">,</span>
</span><span id="__span-8-73"><span class="w">                </span><span class="nt">&quot;Value&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-74"><span class="w">                    </span><span class="nt">&quot;Ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;lavaGroupTag&quot;</span>
</span><span id="__span-8-75"><span class="w">                </span><span class="p">}</span>
</span><span id="__span-8-76"><span class="w">            </span><span class="p">}</span>
</span><span id="__span-8-77"><span class="w">        </span><span class="p">]</span>
</span><span id="__span-8-78"><span class="w">    </span><span class="p">},</span>
</span><span id="__span-8-79"><span class="w">    </span><span class="nt">&quot;Type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AWS::DynamoDB::Table&quot;</span>
</span><span id="__span-8-80"><span class="p">}</span>
</span></code></pre></div>
</div>
</div>
</div>
<h4 id="dyntablestate"><a href="#dynamodb-resources">dynTableState</a><a class="headerlink" href="#dyntablestate" title="Permanent link">&para;</a></h4>
<div class="tabbed-set tabbed-alternate" data-tabs="10:2"><input checked="checked" id="__tabbed_10_1" name="__tabbed_10" type="radio" /><input id="__tabbed_10_2" name="__tabbed_10" type="radio" /><div class="tabbed-labels"><label for="__tabbed_10_1">Details</label><label for="__tabbed_10_2">Source</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<table>
<thead>
<tr>
<th>Property</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Type</td>
<td><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-dynamodb-table.html" title="AWS documentation for this resource type">AWS::DynamoDB::Table</a></td>
</tr>
<tr>
<td>Group</td>
<td><a href="#dynamodb-resources">DynamoDB Resources</a> (<a href="#dynamodb-resources">DynamoDB</a>)</td>
</tr>
<tr>
<td>Description</td>
<td>Lava transient state table. There must be one of these per lava realm.</td>
</tr>
</tbody>
</table>
</div>
<div class="tabbed-block">
<div class="language-json highlight"><pre><span></span><code><span id="__span-9-1"><span class="p">{</span>
</span><span id="__span-9-2"><span class="w">    </span><span class="nt">&quot;Properties&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-9-3"><span class="w">        </span><span class="nt">&quot;AttributeDefinitions&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-9-4"><span class="w">            </span><span class="p">{</span>
</span><span id="__span-9-5"><span class="w">                </span><span class="nt">&quot;AttributeName&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;state_id&quot;</span><span class="p">,</span>
</span><span id="__span-9-6"><span class="w">                </span><span class="nt">&quot;AttributeType&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;S&quot;</span>
</span><span id="__span-9-7"><span class="w">            </span><span class="p">}</span>
</span><span id="__span-9-8"><span class="w">        </span><span class="p">],</span>
</span><span id="__span-9-9"><span class="w">        </span><span class="nt">&quot;KeySchema&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-9-10"><span class="w">            </span><span class="p">{</span>
</span><span id="__span-9-11"><span class="w">                </span><span class="nt">&quot;AttributeName&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;state_id&quot;</span><span class="p">,</span>
</span><span id="__span-9-12"><span class="w">                </span><span class="nt">&quot;KeyType&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;HASH&quot;</span>
</span><span id="__span-9-13"><span class="w">            </span><span class="p">}</span>
</span><span id="__span-9-14"><span class="w">        </span><span class="p">],</span>
</span><span id="__span-9-15"><span class="w">        </span><span class="nt">&quot;PointInTimeRecoverySpecification&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-9-16"><span class="w">            </span><span class="nt">&quot;PointInTimeRecoveryEnabled&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-9-17"><span class="w">        </span><span class="p">},</span>
</span><span id="__span-9-18"><span class="w">        </span><span class="nt">&quot;ProvisionedThroughput&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-9-19"><span class="w">            </span><span class="nt">&quot;ReadCapacityUnits&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-9-20"><span class="w">                </span><span class="nt">&quot;Ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;readCapacityStateTable&quot;</span>
</span><span id="__span-9-21"><span class="w">            </span><span class="p">},</span>
</span><span id="__span-9-22"><span class="w">            </span><span class="nt">&quot;WriteCapacityUnits&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-9-23"><span class="w">                </span><span class="nt">&quot;Ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;writeCapacityStateTable&quot;</span>
</span><span id="__span-9-24"><span class="w">            </span><span class="p">}</span>
</span><span id="__span-9-25"><span class="w">        </span><span class="p">},</span>
</span><span id="__span-9-26"><span class="w">        </span><span class="nt">&quot;TableName&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-9-27"><span class="w">            </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;lava.${realm}.state&quot;</span>
</span><span id="__span-9-28"><span class="w">        </span><span class="p">},</span>
</span><span id="__span-9-29"><span class="w">        </span><span class="nt">&quot;Tags&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-9-30"><span class="w">            </span><span class="p">{</span>
</span><span id="__span-9-31"><span class="w">                </span><span class="nt">&quot;Key&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;lava:realm&quot;</span><span class="p">,</span>
</span><span id="__span-9-32"><span class="w">                </span><span class="nt">&quot;Value&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-9-33"><span class="w">                    </span><span class="nt">&quot;Ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;realm&quot;</span>
</span><span id="__span-9-34"><span class="w">                </span><span class="p">}</span>
</span><span id="__span-9-35"><span class="w">            </span><span class="p">},</span>
</span><span id="__span-9-36"><span class="w">            </span><span class="p">{</span>
</span><span id="__span-9-37"><span class="w">                </span><span class="nt">&quot;Key&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;lava:group&quot;</span><span class="p">,</span>
</span><span id="__span-9-38"><span class="w">                </span><span class="nt">&quot;Value&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-9-39"><span class="w">                    </span><span class="nt">&quot;Ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;lavaGroupTag&quot;</span>
</span><span id="__span-9-40"><span class="w">                </span><span class="p">}</span>
</span><span id="__span-9-41"><span class="w">            </span><span class="p">}</span>
</span><span id="__span-9-42"><span class="w">        </span><span class="p">],</span>
</span><span id="__span-9-43"><span class="w">        </span><span class="nt">&quot;TimeToLiveSpecification&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-9-44"><span class="w">            </span><span class="nt">&quot;AttributeName&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ttl&quot;</span><span class="p">,</span>
</span><span id="__span-9-45"><span class="w">            </span><span class="nt">&quot;Enabled&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-9-46"><span class="w">        </span><span class="p">}</span>
</span><span id="__span-9-47"><span class="w">    </span><span class="p">},</span>
</span><span id="__span-9-48"><span class="w">    </span><span class="nt">&quot;Type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AWS::DynamoDB::Table&quot;</span>
</span><span id="__span-9-49"><span class="p">}</span>
</span></code></pre></div>
</div>
</div>
</div>
<h4 id="eventsschedulemetricslambda"><a href="#events-resources">eventsScheduleMetricsLambda</a><a class="headerlink" href="#eventsschedulemetricslambda" title="Permanent link">&para;</a></h4>
<div class="tabbed-set tabbed-alternate" data-tabs="11:2"><input checked="checked" id="__tabbed_11_1" name="__tabbed_11" type="radio" /><input id="__tabbed_11_2" name="__tabbed_11" type="radio" /><div class="tabbed-labels"><label for="__tabbed_11_1">Details</label><label for="__tabbed_11_2">Source</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<table>
<thead>
<tr>
<th>Property</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Type</td>
<td><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-events-rule.html" title="AWS documentation for this resource type">AWS::Events::Rule</a></td>
</tr>
<tr>
<td>Group</td>
<td><a href="#events-resources">Events Resources</a> (<a href="#events-resources">Events</a>)</td>
</tr>
<tr>
<td>Description</td>
<td>EventBridge rule for running metrics lambda function.</td>
</tr>
</tbody>
</table>
</div>
<div class="tabbed-block">
<div class="language-json highlight"><pre><span></span><code><span id="__span-10-1"><span class="p">{</span>
</span><span id="__span-10-2"><span class="w">    </span><span class="nt">&quot;Condition&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ifCreateLambdas&quot;</span><span class="p">,</span>
</span><span id="__span-10-3"><span class="w">    </span><span class="nt">&quot;Properties&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-4"><span class="w">        </span><span class="nt">&quot;Description&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-5"><span class="w">            </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Schedule lava-${realm}-metrics lambda&quot;</span>
</span><span id="__span-10-6"><span class="w">        </span><span class="p">},</span>
</span><span id="__span-10-7"><span class="w">        </span><span class="nt">&quot;EventBusName&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;default&quot;</span><span class="p">,</span>
</span><span id="__span-10-8"><span class="w">        </span><span class="nt">&quot;Name&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-9"><span class="w">            </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;lava-${realm}---metrics-schedule&quot;</span>
</span><span id="__span-10-10"><span class="w">        </span><span class="p">},</span>
</span><span id="__span-10-11"><span class="w">        </span><span class="nt">&quot;ScheduleExpression&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;rate(1 minute)&quot;</span><span class="p">,</span>
</span><span id="__span-10-12"><span class="w">        </span><span class="nt">&quot;State&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-13"><span class="w">            </span><span class="nt">&quot;Ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;lambdaMetricsSchedule&quot;</span>
</span><span id="__span-10-14"><span class="w">        </span><span class="p">},</span>
</span><span id="__span-10-15"><span class="w">        </span><span class="nt">&quot;Targets&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-10-16"><span class="w">            </span><span class="p">{</span>
</span><span id="__span-10-17"><span class="w">                </span><span class="nt">&quot;Arn&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-18"><span class="w">                    </span><span class="nt">&quot;Fn::GetAtt&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-10-19"><span class="w">                        </span><span class="s2">&quot;lambdaLavaMetrics&quot;</span><span class="p">,</span>
</span><span id="__span-10-20"><span class="w">                        </span><span class="s2">&quot;Arn&quot;</span>
</span><span id="__span-10-21"><span class="w">                    </span><span class="p">]</span>
</span><span id="__span-10-22"><span class="w">                </span><span class="p">},</span>
</span><span id="__span-10-23"><span class="w">                </span><span class="nt">&quot;Id&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-24"><span class="w">                    </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;lava-${realm}---metrics-lambda&quot;</span>
</span><span id="__span-10-25"><span class="w">                </span><span class="p">}</span>
</span><span id="__span-10-26"><span class="w">            </span><span class="p">}</span>
</span><span id="__span-10-27"><span class="w">        </span><span class="p">]</span>
</span><span id="__span-10-28"><span class="w">    </span><span class="p">},</span>
</span><span id="__span-10-29"><span class="w">    </span><span class="nt">&quot;Type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AWS::Events::Rule&quot;</span>
</span><span id="__span-10-30"><span class="p">}</span>
</span></code></pre></div>
</div>
</div>
</div>
<h4 id="iamdispatchlambdainstanceprofile"><a href="#iam-resources">iamDispatchLambdaInstanceProfile</a><a class="headerlink" href="#iamdispatchlambdainstanceprofile" title="Permanent link">&para;</a></h4>
<div class="tabbed-set tabbed-alternate" data-tabs="12:2"><input checked="checked" id="__tabbed_12_1" name="__tabbed_12" type="radio" /><input id="__tabbed_12_2" name="__tabbed_12" type="radio" /><div class="tabbed-labels"><label for="__tabbed_12_1">Details</label><label for="__tabbed_12_2">Source</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<table>
<thead>
<tr>
<th>Property</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Type</td>
<td><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-iam-instanceprofile.html" title="AWS documentation for this resource type">AWS::IAM::InstanceProfile</a></td>
</tr>
<tr>
<td>Group</td>
<td><a href="#iam-resources">IAM Resources</a> (<a href="#iam-resources">IAM</a>)</td>
</tr>
</tbody>
</table>
</div>
<div class="tabbed-block">
<div class="language-json highlight"><pre><span></span><code><span id="__span-11-1"><span class="p">{</span>
</span><span id="__span-11-2"><span class="w">    </span><span class="nt">&quot;Condition&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ifCreateLambdas&quot;</span><span class="p">,</span>
</span><span id="__span-11-3"><span class="w">    </span><span class="nt">&quot;Properties&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-4"><span class="w">        </span><span class="nt">&quot;Roles&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-11-5"><span class="w">            </span><span class="p">{</span>
</span><span id="__span-11-6"><span class="w">                </span><span class="nt">&quot;Ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;iamLavaDispatchLambdaRole&quot;</span>
</span><span id="__span-11-7"><span class="w">            </span><span class="p">}</span>
</span><span id="__span-11-8"><span class="w">        </span><span class="p">]</span>
</span><span id="__span-11-9"><span class="w">    </span><span class="p">},</span>
</span><span id="__span-11-10"><span class="w">    </span><span class="nt">&quot;Type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AWS::IAM::InstanceProfile&quot;</span>
</span><span id="__span-11-11"><span class="p">}</span>
</span></code></pre></div>
</div>
</div>
</div>
<h4 id="iamlavaadmingroup"><a href="#iam-resources">iamLavaAdminGroup</a><a class="headerlink" href="#iamlavaadmingroup" title="Permanent link">&para;</a></h4>
<div class="tabbed-set tabbed-alternate" data-tabs="13:2"><input checked="checked" id="__tabbed_13_1" name="__tabbed_13" type="radio" /><input id="__tabbed_13_2" name="__tabbed_13" type="radio" /><div class="tabbed-labels"><label for="__tabbed_13_1">Details</label><label for="__tabbed_13_2">Source</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<table>
<thead>
<tr>
<th>Property</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Type</td>
<td><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-iam-group.html" title="AWS documentation for this resource type">AWS::IAM::Group</a></td>
</tr>
<tr>
<td>Group</td>
<td><a href="#iam-resources">IAM Resources</a> (<a href="#iam-resources">IAM</a>)</td>
</tr>
<tr>
<td>Description</td>
<td>Admin group for lave realm.</td>
</tr>
</tbody>
</table>
</div>
<div class="tabbed-block">
<div class="language-json highlight"><pre><span></span><code><span id="__span-12-1"><span class="p">{</span>
</span><span id="__span-12-2"><span class="w">    </span><span class="nt">&quot;Properties&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-3"><span class="w">        </span><span class="nt">&quot;GroupName&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-4"><span class="w">            </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;lava-${realm}-admin&quot;</span>
</span><span id="__span-12-5"><span class="w">        </span><span class="p">},</span>
</span><span id="__span-12-6"><span class="w">        </span><span class="nt">&quot;ManagedPolicyArns&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-12-7"><span class="w">            </span><span class="p">{</span>
</span><span id="__span-12-8"><span class="w">                </span><span class="nt">&quot;Ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;iamLavaAdminPolicy&quot;</span>
</span><span id="__span-12-9"><span class="w">            </span><span class="p">},</span>
</span><span id="__span-12-10"><span class="w">            </span><span class="p">{</span>
</span><span id="__span-12-11"><span class="w">                </span><span class="nt">&quot;Ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;iamLavaAdminPolicy2&quot;</span>
</span><span id="__span-12-12"><span class="w">            </span><span class="p">}</span>
</span><span id="__span-12-13"><span class="w">        </span><span class="p">],</span>
</span><span id="__span-12-14"><span class="w">        </span><span class="nt">&quot;Path&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/&quot;</span>
</span><span id="__span-12-15"><span class="w">    </span><span class="p">},</span>
</span><span id="__span-12-16"><span class="w">    </span><span class="nt">&quot;Type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AWS::IAM::Group&quot;</span>
</span><span id="__span-12-17"><span class="p">}</span>
</span></code></pre></div>
</div>
</div>
</div>
<h4 id="iamlavaadminpolicy"><a href="#iam-resources">iamLavaAdminPolicy</a><a class="headerlink" href="#iamlavaadminpolicy" title="Permanent link">&para;</a></h4>
<div class="tabbed-set tabbed-alternate" data-tabs="14:2"><input checked="checked" id="__tabbed_14_1" name="__tabbed_14" type="radio" /><input id="__tabbed_14_2" name="__tabbed_14" type="radio" /><div class="tabbed-labels"><label for="__tabbed_14_1">Details</label><label for="__tabbed_14_2">Source</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<table>
<thead>
<tr>
<th>Property</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Type</td>
<td><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-iam-managedpolicy.html" title="AWS documentation for this resource type">AWS::IAM::ManagedPolicy</a></td>
</tr>
<tr>
<td>Group</td>
<td><a href="#iam-resources">IAM Resources</a> (<a href="#iam-resources">IAM</a>)</td>
</tr>
<tr>
<td>Description</td>
<td>Admin policy for lava realm - part 1.</td>
</tr>
</tbody>
</table>
</div>
<div class="tabbed-block">
<div class="language-json highlight"><pre><span></span><code><span id="__span-13-1"><span class="p">{</span>
</span><span id="__span-13-2"><span class="w">    </span><span class="nt">&quot;Properties&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-13-3"><span class="w">        </span><span class="nt">&quot;Description&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-13-4"><span class="w">            </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Admin policy for lava realm ${realm}&quot;</span>
</span><span id="__span-13-5"><span class="w">        </span><span class="p">},</span>
</span><span id="__span-13-6"><span class="w">        </span><span class="nt">&quot;ManagedPolicyName&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-13-7"><span class="w">            </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;lava-${realm}-admin&quot;</span>
</span><span id="__span-13-8"><span class="w">        </span><span class="p">},</span>
</span><span id="__span-13-9"><span class="w">        </span><span class="nt">&quot;PolicyDocument&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-13-10"><span class="w">            </span><span class="nt">&quot;Statement&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-13-11"><span class="w">                </span><span class="p">{</span>
</span><span id="__span-13-12"><span class="w">                    </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;s3:ListAllMyBuckets&quot;</span><span class="p">,</span>
</span><span id="__span-13-13"><span class="w">                    </span><span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
</span><span id="__span-13-14"><span class="w">                    </span><span class="nt">&quot;Resource&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;*&quot;</span><span class="p">,</span>
</span><span id="__span-13-15"><span class="w">                    </span><span class="nt">&quot;Sid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ListAllBuckets&quot;</span>
</span><span id="__span-13-16"><span class="w">                </span><span class="p">},</span>
</span><span id="__span-13-17"><span class="w">                </span><span class="p">{</span>
</span><span id="__span-13-18"><span class="w">                    </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-13-19"><span class="w">                        </span><span class="s2">&quot;s3:ListBucket&quot;</span><span class="p">,</span>
</span><span id="__span-13-20"><span class="w">                        </span><span class="s2">&quot;s3:GetBucket*&quot;</span><span class="p">,</span>
</span><span id="__span-13-21"><span class="w">                        </span><span class="s2">&quot;s3:GetEncryptionConfiguration&quot;</span><span class="p">,</span>
</span><span id="__span-13-22"><span class="w">                        </span><span class="s2">&quot;s3:GetInventoryConfiguration&quot;</span><span class="p">,</span>
</span><span id="__span-13-23"><span class="w">                        </span><span class="s2">&quot;s3:GetLifecycleConfiguration&quot;</span><span class="p">,</span>
</span><span id="__span-13-24"><span class="w">                        </span><span class="s2">&quot;s3:GetMetricsConfiguration&quot;</span>
</span><span id="__span-13-25"><span class="w">                    </span><span class="p">],</span>
</span><span id="__span-13-26"><span class="w">                    </span><span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
</span><span id="__span-13-27"><span class="w">                    </span><span class="nt">&quot;Resource&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-13-28"><span class="w">                        </span><span class="p">{</span>
</span><span id="__span-13-29"><span class="w">                            </span><span class="nt">&quot;Fn::GetAtt&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-13-30"><span class="w">                                </span><span class="s2">&quot;s3LavaBucket&quot;</span><span class="p">,</span>
</span><span id="__span-13-31"><span class="w">                                </span><span class="s2">&quot;Arn&quot;</span>
</span><span id="__span-13-32"><span class="w">                            </span><span class="p">]</span>
</span><span id="__span-13-33"><span class="w">                        </span><span class="p">}</span>
</span><span id="__span-13-34"><span class="w">                    </span><span class="p">],</span>
</span><span id="__span-13-35"><span class="w">                    </span><span class="nt">&quot;Sid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;GetLavaBucketInfo&quot;</span>
</span><span id="__span-13-36"><span class="w">                </span><span class="p">},</span>
</span><span id="__span-13-37"><span class="w">                </span><span class="p">{</span>
</span><span id="__span-13-38"><span class="w">                    </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-13-39"><span class="w">                        </span><span class="s2">&quot;s3:GetObject*&quot;</span><span class="p">,</span>
</span><span id="__span-13-40"><span class="w">                        </span><span class="s2">&quot;s3:PutObject&quot;</span><span class="p">,</span>
</span><span id="__span-13-41"><span class="w">                        </span><span class="s2">&quot;s3:ListMultipartUploadParts&quot;</span><span class="p">,</span>
</span><span id="__span-13-42"><span class="w">                        </span><span class="s2">&quot;s3:DeleteObject&quot;</span>
</span><span id="__span-13-43"><span class="w">                    </span><span class="p">],</span>
</span><span id="__span-13-44"><span class="w">                    </span><span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
</span><span id="__span-13-45"><span class="w">                    </span><span class="nt">&quot;Resource&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-13-46"><span class="w">                        </span><span class="p">{</span>
</span><span id="__span-13-47"><span class="w">                            </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;arn:aws:s3:::${s3LavaBucket}/*&quot;</span>
</span><span id="__span-13-48"><span class="w">                        </span><span class="p">}</span>
</span><span id="__span-13-49"><span class="w">                    </span><span class="p">],</span>
</span><span id="__span-13-50"><span class="w">                    </span><span class="nt">&quot;Sid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ReadWriteLavaBucket&quot;</span>
</span><span id="__span-13-51"><span class="w">                </span><span class="p">},</span>
</span><span id="__span-13-52"><span class="w">                </span><span class="p">{</span>
</span><span id="__span-13-53"><span class="w">                    </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;sqs:ListQueues&quot;</span><span class="p">,</span>
</span><span id="__span-13-54"><span class="w">                    </span><span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
</span><span id="__span-13-55"><span class="w">                    </span><span class="nt">&quot;Resource&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;*&quot;</span><span class="p">,</span>
</span><span id="__span-13-56"><span class="w">                    </span><span class="nt">&quot;Sid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ListSqsQueues&quot;</span>
</span><span id="__span-13-57"><span class="w">                </span><span class="p">},</span>
</span><span id="__span-13-58"><span class="w">                </span><span class="p">{</span>
</span><span id="__span-13-59"><span class="w">                    </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-13-60"><span class="w">                        </span><span class="s2">&quot;sqs:DeleteMessage&quot;</span><span class="p">,</span>
</span><span id="__span-13-61"><span class="w">                        </span><span class="s2">&quot;sqs:GetQueueUrl&quot;</span><span class="p">,</span>
</span><span id="__span-13-62"><span class="w">                        </span><span class="s2">&quot;sqs:ReceiveMessage&quot;</span><span class="p">,</span>
</span><span id="__span-13-63"><span class="w">                        </span><span class="s2">&quot;sqs:SendMessage&quot;</span><span class="p">,</span>
</span><span id="__span-13-64"><span class="w">                        </span><span class="s2">&quot;sqs:GetQueueAttributes&quot;</span><span class="p">,</span>
</span><span id="__span-13-65"><span class="w">                        </span><span class="s2">&quot;sqs:ListQueueTags&quot;</span>
</span><span id="__span-13-66"><span class="w">                    </span><span class="p">],</span>
</span><span id="__span-13-67"><span class="w">                    </span><span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
</span><span id="__span-13-68"><span class="w">                    </span><span class="nt">&quot;Resource&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-13-69"><span class="w">                        </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;arn:aws:sqs:${AWS::Region}:${AWS::AccountId}:lava-${realm}-*&quot;</span>
</span><span id="__span-13-70"><span class="w">                    </span><span class="p">},</span>
</span><span id="__span-13-71"><span class="w">                    </span><span class="nt">&quot;Sid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AccessSqsQueues&quot;</span>
</span><span id="__span-13-72"><span class="w">                </span><span class="p">},</span>
</span><span id="__span-13-73"><span class="w">                </span><span class="p">{</span>
</span><span id="__span-13-74"><span class="w">                    </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ssm:DescribeParameters&quot;</span><span class="p">,</span>
</span><span id="__span-13-75"><span class="w">                    </span><span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
</span><span id="__span-13-76"><span class="w">                    </span><span class="nt">&quot;Resource&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;*&quot;</span><span class="p">,</span>
</span><span id="__span-13-77"><span class="w">                    </span><span class="nt">&quot;Sid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;DescribeSsmParams&quot;</span>
</span><span id="__span-13-78"><span class="w">                </span><span class="p">},</span>
</span><span id="__span-13-79"><span class="w">                </span><span class="p">{</span>
</span><span id="__span-13-80"><span class="w">                    </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-13-81"><span class="w">                        </span><span class="s2">&quot;ssm:GetParameter&quot;</span><span class="p">,</span>
</span><span id="__span-13-82"><span class="w">                        </span><span class="s2">&quot;ssm:GetParameters&quot;</span><span class="p">,</span>
</span><span id="__span-13-83"><span class="w">                        </span><span class="s2">&quot;ssm:PutParameter&quot;</span><span class="p">,</span>
</span><span id="__span-13-84"><span class="w">                        </span><span class="s2">&quot;ssm:DeleteParameter&quot;</span><span class="p">,</span>
</span><span id="__span-13-85"><span class="w">                        </span><span class="s2">&quot;ssm:DeleteParameters&quot;</span>
</span><span id="__span-13-86"><span class="w">                    </span><span class="p">],</span>
</span><span id="__span-13-87"><span class="w">                    </span><span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
</span><span id="__span-13-88"><span class="w">                    </span><span class="nt">&quot;Resource&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-13-89"><span class="w">                        </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;arn:aws:ssm:${AWS::Region}:${AWS::AccountId}:parameter/lava/${realm}/*&quot;</span>
</span><span id="__span-13-90"><span class="w">                    </span><span class="p">},</span>
</span><span id="__span-13-91"><span class="w">                    </span><span class="nt">&quot;Sid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ManageSsmParams&quot;</span>
</span><span id="__span-13-92"><span class="w">                </span><span class="p">},</span>
</span><span id="__span-13-93"><span class="w">                </span><span class="p">{</span>
</span><span id="__span-13-94"><span class="w">                    </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-13-95"><span class="w">                        </span><span class="s2">&quot;secretsmanager:ListSecrets&quot;</span><span class="p">,</span>
</span><span id="__span-13-96"><span class="w">                        </span><span class="s2">&quot;secretsmanager:GetRandomPassword&quot;</span>
</span><span id="__span-13-97"><span class="w">                    </span><span class="p">],</span>
</span><span id="__span-13-98"><span class="w">                    </span><span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
</span><span id="__span-13-99"><span class="w">                    </span><span class="nt">&quot;Resource&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;*&quot;</span><span class="p">,</span>
</span><span id="__span-13-100"><span class="w">                    </span><span class="nt">&quot;Sid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ListSecrets&quot;</span>
</span><span id="__span-13-101"><span class="w">                </span><span class="p">},</span>
</span><span id="__span-13-102"><span class="w">                </span><span class="p">{</span>
</span><span id="__span-13-103"><span class="w">                    </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-13-104"><span class="w">                        </span><span class="s2">&quot;secretsmanager:CancelRotateSecret&quot;</span><span class="p">,</span>
</span><span id="__span-13-105"><span class="w">                        </span><span class="s2">&quot;secretsmanager:CreateSecret&quot;</span><span class="p">,</span>
</span><span id="__span-13-106"><span class="w">                        </span><span class="s2">&quot;secretsmanager:DeleteResourcePolicy&quot;</span><span class="p">,</span>
</span><span id="__span-13-107"><span class="w">                        </span><span class="s2">&quot;secretsmanager:DeleteSecret&quot;</span><span class="p">,</span>
</span><span id="__span-13-108"><span class="w">                        </span><span class="s2">&quot;secretsmanager:DescribeSecret&quot;</span><span class="p">,</span>
</span><span id="__span-13-109"><span class="w">                        </span><span class="s2">&quot;secretsmanager:GetResourcePolicy&quot;</span><span class="p">,</span>
</span><span id="__span-13-110"><span class="w">                        </span><span class="s2">&quot;secretsmanager:GetSecretValue&quot;</span><span class="p">,</span>
</span><span id="__span-13-111"><span class="w">                        </span><span class="s2">&quot;secretsmanager:ListSecretVersionIds&quot;</span><span class="p">,</span>
</span><span id="__span-13-112"><span class="w">                        </span><span class="s2">&quot;secretsmanager:PutResourcePolicy&quot;</span><span class="p">,</span>
</span><span id="__span-13-113"><span class="w">                        </span><span class="s2">&quot;secretsmanager:PutSecretValue&quot;</span><span class="p">,</span>
</span><span id="__span-13-114"><span class="w">                        </span><span class="s2">&quot;secretsmanager:RestoreSecret&quot;</span><span class="p">,</span>
</span><span id="__span-13-115"><span class="w">                        </span><span class="s2">&quot;secretsmanager:RotateSecret&quot;</span><span class="p">,</span>
</span><span id="__span-13-116"><span class="w">                        </span><span class="s2">&quot;secretsmanager:TagResource&quot;</span><span class="p">,</span>
</span><span id="__span-13-117"><span class="w">                        </span><span class="s2">&quot;secretsmanager:UntagResource&quot;</span><span class="p">,</span>
</span><span id="__span-13-118"><span class="w">                        </span><span class="s2">&quot;secretsmanager:UpdateSecret&quot;</span><span class="p">,</span>
</span><span id="__span-13-119"><span class="w">                        </span><span class="s2">&quot;secretsmanager:UpdateSecretVersionStage&quot;</span><span class="p">,</span>
</span><span id="__span-13-120"><span class="w">                        </span><span class="s2">&quot;secretsmanager:ValidateResourcePolicy&quot;</span>
</span><span id="__span-13-121"><span class="w">                    </span><span class="p">],</span>
</span><span id="__span-13-122"><span class="w">                    </span><span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
</span><span id="__span-13-123"><span class="w">                    </span><span class="nt">&quot;Resource&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-13-124"><span class="w">                        </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;arn:aws:secretsmanager:${AWS::Region}:${AWS::AccountId}:secret:/lava/${realm}/*&quot;</span>
</span><span id="__span-13-125"><span class="w">                    </span><span class="p">},</span>
</span><span id="__span-13-126"><span class="w">                    </span><span class="nt">&quot;Sid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ManageSecrets&quot;</span>
</span><span id="__span-13-127"><span class="w">                </span><span class="p">},</span>
</span><span id="__span-13-128"><span class="w">                </span><span class="p">{</span>
</span><span id="__span-13-129"><span class="w">                    </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-13-130"><span class="w">                        </span><span class="s2">&quot;dynamodb:ListTables&quot;</span><span class="p">,</span>
</span><span id="__span-13-131"><span class="w">                        </span><span class="s2">&quot;dynamodb:ListBackups&quot;</span>
</span><span id="__span-13-132"><span class="w">                    </span><span class="p">],</span>
</span><span id="__span-13-133"><span class="w">                    </span><span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
</span><span id="__span-13-134"><span class="w">                    </span><span class="nt">&quot;Resource&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;*&quot;</span><span class="p">,</span>
</span><span id="__span-13-135"><span class="w">                    </span><span class="nt">&quot;Sid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ListAllDynamoTables&quot;</span>
</span><span id="__span-13-136"><span class="w">                </span><span class="p">},</span>
</span><span id="__span-13-137"><span class="w">                </span><span class="p">{</span>
</span><span id="__span-13-138"><span class="w">                    </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-13-139"><span class="w">                        </span><span class="s2">&quot;dynamodb:ListTagsOfResource&quot;</span><span class="p">,</span>
</span><span id="__span-13-140"><span class="w">                        </span><span class="s2">&quot;dynamodb:GetItem&quot;</span><span class="p">,</span>
</span><span id="__span-13-141"><span class="w">                        </span><span class="s2">&quot;dynamodb:BatchGetItem&quot;</span><span class="p">,</span>
</span><span id="__span-13-142"><span class="w">                        </span><span class="s2">&quot;dynamodb:DescribeTable&quot;</span><span class="p">,</span>
</span><span id="__span-13-143"><span class="w">                        </span><span class="s2">&quot;dynamodb:DescribeTimeToLive&quot;</span><span class="p">,</span>
</span><span id="__span-13-144"><span class="w">                        </span><span class="s2">&quot;dynamodb:DescribeContinuousBackups&quot;</span><span class="p">,</span>
</span><span id="__span-13-145"><span class="w">                        </span><span class="s2">&quot;dynamodb:Query&quot;</span><span class="p">,</span>
</span><span id="__span-13-146"><span class="w">                        </span><span class="s2">&quot;dynamodb:Scan&quot;</span>
</span><span id="__span-13-147"><span class="w">                    </span><span class="p">],</span>
</span><span id="__span-13-148"><span class="w">                    </span><span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
</span><span id="__span-13-149"><span class="w">                    </span><span class="nt">&quot;Resource&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-13-150"><span class="w">                        </span><span class="p">{</span>
</span><span id="__span-13-151"><span class="w">                            </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;arn:aws:dynamodb:${AWS::Region}:${AWS::AccountId}:table/lava.realms&quot;</span>
</span><span id="__span-13-152"><span class="w">                        </span><span class="p">},</span>
</span><span id="__span-13-153"><span class="w">                        </span><span class="p">{</span>
</span><span id="__span-13-154"><span class="w">                            </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;arn:aws:dynamodb:${AWS::Region}:${AWS::AccountId}:table/lava.${realm}.*&quot;</span>
</span><span id="__span-13-155"><span class="w">                        </span><span class="p">},</span>
</span><span id="__span-13-156"><span class="w">                        </span><span class="p">{</span>
</span><span id="__span-13-157"><span class="w">                            </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;arn:aws:dynamodb:${AWS::Region}:${AWS::AccountId}:table/lava.${realm}.jobs/index/*&quot;</span>
</span><span id="__span-13-158"><span class="w">                        </span><span class="p">},</span>
</span><span id="__span-13-159"><span class="w">                        </span><span class="p">{</span>
</span><span id="__span-13-160"><span class="w">                            </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;arn:aws:dynamodb:${AWS::Region}:${AWS::AccountId}:table/lava.${realm}.events/index/*&quot;</span>
</span><span id="__span-13-161"><span class="w">                        </span><span class="p">}</span>
</span><span id="__span-13-162"><span class="w">                    </span><span class="p">],</span>
</span><span id="__span-13-163"><span class="w">                    </span><span class="nt">&quot;Sid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AccessDynamoDBLavaTables&quot;</span>
</span><span id="__span-13-164"><span class="w">                </span><span class="p">},</span>
</span><span id="__span-13-165"><span class="w">                </span><span class="p">{</span>
</span><span id="__span-13-166"><span class="w">                    </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-13-167"><span class="w">                        </span><span class="s2">&quot;dynamodb:BatchWriteItem&quot;</span><span class="p">,</span>
</span><span id="__span-13-168"><span class="w">                        </span><span class="s2">&quot;dynamodb:DeleteItem&quot;</span><span class="p">,</span>
</span><span id="__span-13-169"><span class="w">                        </span><span class="s2">&quot;dynamodb:PutItem&quot;</span><span class="p">,</span>
</span><span id="__span-13-170"><span class="w">                        </span><span class="s2">&quot;dynamodb:UpdateItem&quot;</span><span class="p">,</span>
</span><span id="__span-13-171"><span class="w">                        </span><span class="s2">&quot;dynamodb:PartiQLUpdate&quot;</span><span class="p">,</span>
</span><span id="__span-13-172"><span class="w">                        </span><span class="s2">&quot;dynamodb:PartiQLInsert&quot;</span><span class="p">,</span>
</span><span id="__span-13-173"><span class="w">                        </span><span class="s2">&quot;dynamodb:PartiQLDelete&quot;</span>
</span><span id="__span-13-174"><span class="w">                    </span><span class="p">],</span>
</span><span id="__span-13-175"><span class="w">                    </span><span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
</span><span id="__span-13-176"><span class="w">                    </span><span class="nt">&quot;Resource&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-13-177"><span class="w">                        </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;arn:aws:dynamodb:${AWS::Region}:${AWS::AccountId}:table/lava.${realm}.*&quot;</span>
</span><span id="__span-13-178"><span class="w">                    </span><span class="p">},</span>
</span><span id="__span-13-179"><span class="w">                    </span><span class="nt">&quot;Sid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;UpdateDynamoDBLavaTables&quot;</span>
</span><span id="__span-13-180"><span class="w">                </span><span class="p">},</span>
</span><span id="__span-13-181"><span class="w">                </span><span class="p">{</span>
</span><span id="__span-13-182"><span class="w">                    </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-13-183"><span class="w">                        </span><span class="s2">&quot;kms:ListKeys&quot;</span><span class="p">,</span>
</span><span id="__span-13-184"><span class="w">                        </span><span class="s2">&quot;kms:ListAliases&quot;</span>
</span><span id="__span-13-185"><span class="w">                    </span><span class="p">],</span>
</span><span id="__span-13-186"><span class="w">                    </span><span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
</span><span id="__span-13-187"><span class="w">                    </span><span class="nt">&quot;Resource&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;*&quot;</span><span class="p">,</span>
</span><span id="__span-13-188"><span class="w">                    </span><span class="nt">&quot;Sid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ListKMSkeys&quot;</span>
</span><span id="__span-13-189"><span class="w">                </span><span class="p">},</span>
</span><span id="__span-13-190"><span class="w">                </span><span class="p">{</span>
</span><span id="__span-13-191"><span class="w">                    </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-13-192"><span class="w">                        </span><span class="s2">&quot;kms:Encrypt&quot;</span><span class="p">,</span>
</span><span id="__span-13-193"><span class="w">                        </span><span class="s2">&quot;kms:Decrypt&quot;</span><span class="p">,</span>
</span><span id="__span-13-194"><span class="w">                        </span><span class="s2">&quot;kms:ReEncrypt*&quot;</span><span class="p">,</span>
</span><span id="__span-13-195"><span class="w">                        </span><span class="s2">&quot;kms:GenerateDataKey*&quot;</span><span class="p">,</span>
</span><span id="__span-13-196"><span class="w">                        </span><span class="s2">&quot;kms:DescribeKey&quot;</span>
</span><span id="__span-13-197"><span class="w">                    </span><span class="p">],</span>
</span><span id="__span-13-198"><span class="w">                    </span><span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
</span><span id="__span-13-199"><span class="w">                    </span><span class="nt">&quot;Resource&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-13-200"><span class="w">                        </span><span class="p">{</span>
</span><span id="__span-13-201"><span class="w">                            </span><span class="nt">&quot;Fn::GetAtt&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-13-202"><span class="w">                                </span><span class="s2">&quot;kmsSysKey&quot;</span><span class="p">,</span>
</span><span id="__span-13-203"><span class="w">                                </span><span class="s2">&quot;Arn&quot;</span>
</span><span id="__span-13-204"><span class="w">                            </span><span class="p">]</span>
</span><span id="__span-13-205"><span class="w">                        </span><span class="p">},</span>
</span><span id="__span-13-206"><span class="w">                        </span><span class="p">{</span>
</span><span id="__span-13-207"><span class="w">                            </span><span class="nt">&quot;Fn::GetAtt&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-13-208"><span class="w">                                </span><span class="s2">&quot;kmsUserKey&quot;</span><span class="p">,</span>
</span><span id="__span-13-209"><span class="w">                                </span><span class="s2">&quot;Arn&quot;</span>
</span><span id="__span-13-210"><span class="w">                            </span><span class="p">]</span>
</span><span id="__span-13-211"><span class="w">                        </span><span class="p">}</span>
</span><span id="__span-13-212"><span class="w">                    </span><span class="p">],</span>
</span><span id="__span-13-213"><span class="w">                    </span><span class="nt">&quot;Sid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;UseKMSkeys&quot;</span>
</span><span id="__span-13-214"><span class="w">                </span><span class="p">},</span>
</span><span id="__span-13-215"><span class="w">                </span><span class="p">{</span>
</span><span id="__span-13-216"><span class="w">                    </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-13-217"><span class="w">                        </span><span class="s2">&quot;kms:CreateGrant&quot;</span><span class="p">,</span>
</span><span id="__span-13-218"><span class="w">                        </span><span class="s2">&quot;kms:ListGrants&quot;</span><span class="p">,</span>
</span><span id="__span-13-219"><span class="w">                        </span><span class="s2">&quot;kms:RevokeGrant&quot;</span>
</span><span id="__span-13-220"><span class="w">                    </span><span class="p">],</span>
</span><span id="__span-13-221"><span class="w">                    </span><span class="nt">&quot;Condition&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-13-222"><span class="w">                        </span><span class="nt">&quot;Bool&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-13-223"><span class="w">                            </span><span class="nt">&quot;kms:GrantIsForAWSResource&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;true&quot;</span>
</span><span id="__span-13-224"><span class="w">                        </span><span class="p">}</span>
</span><span id="__span-13-225"><span class="w">                    </span><span class="p">},</span>
</span><span id="__span-13-226"><span class="w">                    </span><span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
</span><span id="__span-13-227"><span class="w">                    </span><span class="nt">&quot;Resource&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-13-228"><span class="w">                        </span><span class="p">{</span>
</span><span id="__span-13-229"><span class="w">                            </span><span class="nt">&quot;Fn::GetAtt&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-13-230"><span class="w">                                </span><span class="s2">&quot;kmsSysKey&quot;</span><span class="p">,</span>
</span><span id="__span-13-231"><span class="w">                                </span><span class="s2">&quot;Arn&quot;</span>
</span><span id="__span-13-232"><span class="w">                            </span><span class="p">]</span>
</span><span id="__span-13-233"><span class="w">                        </span><span class="p">},</span>
</span><span id="__span-13-234"><span class="w">                        </span><span class="p">{</span>
</span><span id="__span-13-235"><span class="w">                            </span><span class="nt">&quot;Fn::GetAtt&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-13-236"><span class="w">                                </span><span class="s2">&quot;kmsUserKey&quot;</span><span class="p">,</span>
</span><span id="__span-13-237"><span class="w">                                </span><span class="s2">&quot;Arn&quot;</span>
</span><span id="__span-13-238"><span class="w">                            </span><span class="p">]</span>
</span><span id="__span-13-239"><span class="w">                        </span><span class="p">}</span>
</span><span id="__span-13-240"><span class="w">                    </span><span class="p">],</span>
</span><span id="__span-13-241"><span class="w">                    </span><span class="nt">&quot;Sid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;KMSattachPersistentResources&quot;</span>
</span><span id="__span-13-242"><span class="w">                </span><span class="p">},</span>
</span><span id="__span-13-243"><span class="w">                </span><span class="p">{</span>
</span><span id="__span-13-244"><span class="w">                    </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;sns:ListTopics&quot;</span><span class="p">,</span>
</span><span id="__span-13-245"><span class="w">                    </span><span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
</span><span id="__span-13-246"><span class="w">                    </span><span class="nt">&quot;Resource&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;*&quot;</span><span class="p">,</span>
</span><span id="__span-13-247"><span class="w">                    </span><span class="nt">&quot;Sid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ListSNStopics&quot;</span>
</span><span id="__span-13-248"><span class="w">                </span><span class="p">},</span>
</span><span id="__span-13-249"><span class="w">                </span><span class="p">{</span>
</span><span id="__span-13-250"><span class="w">                    </span><span class="nt">&quot;Fn::If&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-13-251"><span class="w">                        </span><span class="s2">&quot;ifCreateLambdas&quot;</span><span class="p">,</span>
</span><span id="__span-13-252"><span class="w">                        </span><span class="p">{</span>
</span><span id="__span-13-253"><span class="w">                            </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-13-254"><span class="w">                                </span><span class="s2">&quot;sns:Publish&quot;</span><span class="p">,</span>
</span><span id="__span-13-255"><span class="w">                                </span><span class="s2">&quot;sns:GetTopicAttributes&quot;</span>
</span><span id="__span-13-256"><span class="w">                            </span><span class="p">],</span>
</span><span id="__span-13-257"><span class="w">                            </span><span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
</span><span id="__span-13-258"><span class="w">                            </span><span class="nt">&quot;Resource&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-13-259"><span class="w">                                </span><span class="nt">&quot;Ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;snsDispatchHelper&quot;</span>
</span><span id="__span-13-260"><span class="w">                            </span><span class="p">},</span>
</span><span id="__span-13-261"><span class="w">                            </span><span class="nt">&quot;Sid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;PublishToSNSdispatchHelper&quot;</span>
</span><span id="__span-13-262"><span class="w">                        </span><span class="p">},</span>
</span><span id="__span-13-263"><span class="w">                        </span><span class="p">{</span>
</span><span id="__span-13-264"><span class="w">                            </span><span class="nt">&quot;Ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AWS::NoValue&quot;</span>
</span><span id="__span-13-265"><span class="w">                        </span><span class="p">}</span>
</span><span id="__span-13-266"><span class="w">                    </span><span class="p">]</span>
</span><span id="__span-13-267"><span class="w">                </span><span class="p">},</span>
</span><span id="__span-13-268"><span class="w">                </span><span class="p">{</span>
</span><span id="__span-13-269"><span class="w">                    </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ecr:GetAuthorizationToken&quot;</span><span class="p">,</span>
</span><span id="__span-13-270"><span class="w">                    </span><span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
</span><span id="__span-13-271"><span class="w">                    </span><span class="nt">&quot;Resource&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;*&quot;</span><span class="p">,</span>
</span><span id="__span-13-272"><span class="w">                    </span><span class="nt">&quot;Sid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;getEcrAuthToken&quot;</span>
</span><span id="__span-13-273"><span class="w">                </span><span class="p">},</span>
</span><span id="__span-13-274"><span class="w">                </span><span class="p">{</span>
</span><span id="__span-13-275"><span class="w">                    </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-13-276"><span class="w">                        </span><span class="s2">&quot;ecr:DescribeRegistry&quot;</span><span class="p">,</span>
</span><span id="__span-13-277"><span class="w">                        </span><span class="s2">&quot;ecr:DescribeRepositories&quot;</span>
</span><span id="__span-13-278"><span class="w">                    </span><span class="p">],</span>
</span><span id="__span-13-279"><span class="w">                    </span><span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
</span><span id="__span-13-280"><span class="w">                    </span><span class="nt">&quot;Resource&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;*&quot;</span><span class="p">,</span>
</span><span id="__span-13-281"><span class="w">                    </span><span class="nt">&quot;Sid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ecrDescribeRepos&quot;</span>
</span><span id="__span-13-282"><span class="w">                </span><span class="p">},</span>
</span><span id="__span-13-283"><span class="w">                </span><span class="p">{</span>
</span><span id="__span-13-284"><span class="w">                    </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-13-285"><span class="w">                        </span><span class="s2">&quot;ecr:GetLifecyclePolicyPreview&quot;</span><span class="p">,</span>
</span><span id="__span-13-286"><span class="w">                        </span><span class="s2">&quot;ecr:GetDownloadUrlForLayer&quot;</span><span class="p">,</span>
</span><span id="__span-13-287"><span class="w">                        </span><span class="s2">&quot;ecr:BatchGetImage&quot;</span><span class="p">,</span>
</span><span id="__span-13-288"><span class="w">                        </span><span class="s2">&quot;ecr:DescribeImages&quot;</span><span class="p">,</span>
</span><span id="__span-13-289"><span class="w">                        </span><span class="s2">&quot;ecr:ListTagsForResource&quot;</span><span class="p">,</span>
</span><span id="__span-13-290"><span class="w">                        </span><span class="s2">&quot;ecr:ListImages&quot;</span><span class="p">,</span>
</span><span id="__span-13-291"><span class="w">                        </span><span class="s2">&quot;ecr:BatchCheckLayerAvailability&quot;</span><span class="p">,</span>
</span><span id="__span-13-292"><span class="w">                        </span><span class="s2">&quot;ecr:GetLifecyclePolicy&quot;</span><span class="p">,</span>
</span><span id="__span-13-293"><span class="w">                        </span><span class="s2">&quot;ecr:GetRepositoryPolicy&quot;</span>
</span><span id="__span-13-294"><span class="w">                    </span><span class="p">],</span>
</span><span id="__span-13-295"><span class="w">                    </span><span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
</span><span id="__span-13-296"><span class="w">                    </span><span class="nt">&quot;Resource&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-13-297"><span class="w">                        </span><span class="p">{</span>
</span><span id="__span-13-298"><span class="w">                            </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;arn:aws:ecr:${AWS::Region}:${AWS::AccountId}:repository/dist/lava/*&quot;</span>
</span><span id="__span-13-299"><span class="w">                        </span><span class="p">},</span>
</span><span id="__span-13-300"><span class="w">                        </span><span class="p">{</span>
</span><span id="__span-13-301"><span class="w">                            </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;arn:aws:ecr:${AWS::Region}:${AWS::AccountId}:repository/lava/${realm}/*&quot;</span>
</span><span id="__span-13-302"><span class="w">                        </span><span class="p">}</span>
</span><span id="__span-13-303"><span class="w">                    </span><span class="p">],</span>
</span><span id="__span-13-304"><span class="w">                    </span><span class="nt">&quot;Sid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ReadEcrLavaRepos&quot;</span>
</span><span id="__span-13-305"><span class="w">                </span><span class="p">},</span>
</span><span id="__span-13-306"><span class="w">                </span><span class="p">{</span>
</span><span id="__span-13-307"><span class="w">                    </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-13-308"><span class="w">                        </span><span class="s2">&quot;ecr:BatchDeleteImage&quot;</span><span class="p">,</span>
</span><span id="__span-13-309"><span class="w">                        </span><span class="s2">&quot;ecr:CompleteLayerUpload&quot;</span><span class="p">,</span>
</span><span id="__span-13-310"><span class="w">                        </span><span class="s2">&quot;ecr:CreateRepository&quot;</span><span class="p">,</span>
</span><span id="__span-13-311"><span class="w">                        </span><span class="s2">&quot;ecr:DeleteLifecyclePolicy&quot;</span><span class="p">,</span>
</span><span id="__span-13-312"><span class="w">                        </span><span class="s2">&quot;ecr:DeleteRepository&quot;</span><span class="p">,</span>
</span><span id="__span-13-313"><span class="w">                        </span><span class="s2">&quot;ecr:InitiateLayerUpload&quot;</span><span class="p">,</span>
</span><span id="__span-13-314"><span class="w">                        </span><span class="s2">&quot;ecr:PutImage&quot;</span><span class="p">,</span>
</span><span id="__span-13-315"><span class="w">                        </span><span class="s2">&quot;ecr:PutImageScanningConfiguration&quot;</span><span class="p">,</span>
</span><span id="__span-13-316"><span class="w">                        </span><span class="s2">&quot;ecr:PutImageTagMutability&quot;</span><span class="p">,</span>
</span><span id="__span-13-317"><span class="w">                        </span><span class="s2">&quot;ecr:PutLifecyclePolicy&quot;</span><span class="p">,</span>
</span><span id="__span-13-318"><span class="w">                        </span><span class="s2">&quot;ecr:StartImageScan&quot;</span><span class="p">,</span>
</span><span id="__span-13-319"><span class="w">                        </span><span class="s2">&quot;ecr:StartLifecyclePolicyPreview&quot;</span><span class="p">,</span>
</span><span id="__span-13-320"><span class="w">                        </span><span class="s2">&quot;ecr:TagResource&quot;</span><span class="p">,</span>
</span><span id="__span-13-321"><span class="w">                        </span><span class="s2">&quot;ecr:UntagResource&quot;</span><span class="p">,</span>
</span><span id="__span-13-322"><span class="w">                        </span><span class="s2">&quot;ecr:UploadLayerPart&quot;</span>
</span><span id="__span-13-323"><span class="w">                    </span><span class="p">],</span>
</span><span id="__span-13-324"><span class="w">                    </span><span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
</span><span id="__span-13-325"><span class="w">                    </span><span class="nt">&quot;Resource&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-13-326"><span class="w">                        </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;arn:aws:ecr:${AWS::Region}:${AWS::AccountId}:repository/lava/${realm}/*&quot;</span>
</span><span id="__span-13-327"><span class="w">                    </span><span class="p">},</span>
</span><span id="__span-13-328"><span class="w">                    </span><span class="nt">&quot;Sid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;WriteEcrRealmRepo&quot;</span>
</span><span id="__span-13-329"><span class="w">                </span><span class="p">},</span>
</span><span id="__span-13-330"><span class="w">                </span><span class="p">{</span>
</span><span id="__span-13-331"><span class="w">                    </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-13-332"><span class="w">                        </span><span class="s2">&quot;events:List*&quot;</span><span class="p">,</span>
</span><span id="__span-13-333"><span class="w">                        </span><span class="s2">&quot;events:TestEventPattern&quot;</span>
</span><span id="__span-13-334"><span class="w">                    </span><span class="p">],</span>
</span><span id="__span-13-335"><span class="w">                    </span><span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
</span><span id="__span-13-336"><span class="w">                    </span><span class="nt">&quot;Resource&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;*&quot;</span><span class="p">,</span>
</span><span id="__span-13-337"><span class="w">                    </span><span class="nt">&quot;Sid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;EventsListAll&quot;</span>
</span><span id="__span-13-338"><span class="w">                </span><span class="p">},</span>
</span><span id="__span-13-339"><span class="w">                </span><span class="p">{</span>
</span><span id="__span-13-340"><span class="w">                    </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-13-341"><span class="w">                        </span><span class="s2">&quot;events:DeleteRule&quot;</span><span class="p">,</span>
</span><span id="__span-13-342"><span class="w">                        </span><span class="s2">&quot;events:DescribeRule&quot;</span><span class="p">,</span>
</span><span id="__span-13-343"><span class="w">                        </span><span class="s2">&quot;events:DisableRule&quot;</span><span class="p">,</span>
</span><span id="__span-13-344"><span class="w">                        </span><span class="s2">&quot;events:EnableRule&quot;</span><span class="p">,</span>
</span><span id="__span-13-345"><span class="w">                        </span><span class="s2">&quot;events:PutEvents&quot;</span><span class="p">,</span>
</span><span id="__span-13-346"><span class="w">                        </span><span class="s2">&quot;events:PutRule&quot;</span><span class="p">,</span>
</span><span id="__span-13-347"><span class="w">                        </span><span class="s2">&quot;events:PutTargets&quot;</span><span class="p">,</span>
</span><span id="__span-13-348"><span class="w">                        </span><span class="s2">&quot;events:RemoveTargets&quot;</span><span class="p">,</span>
</span><span id="__span-13-349"><span class="w">                        </span><span class="s2">&quot;events:TagResource&quot;</span><span class="p">,</span>
</span><span id="__span-13-350"><span class="w">                        </span><span class="s2">&quot;events:UntagResource&quot;</span>
</span><span id="__span-13-351"><span class="w">                    </span><span class="p">],</span>
</span><span id="__span-13-352"><span class="w">                    </span><span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
</span><span id="__span-13-353"><span class="w">                    </span><span class="nt">&quot;Resource&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-13-354"><span class="w">                        </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;arn:aws:events:${AWS::Region}:${AWS::AccountId}:rule/lava.${realm}.*&quot;</span>
</span><span id="__span-13-355"><span class="w">                    </span><span class="p">},</span>
</span><span id="__span-13-356"><span class="w">                    </span><span class="nt">&quot;Sid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;EventsReadWriteRules&quot;</span>
</span><span id="__span-13-357"><span class="w">                </span><span class="p">},</span>
</span><span id="__span-13-358"><span class="w">                </span><span class="p">{</span>
</span><span id="__span-13-359"><span class="w">                    </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-13-360"><span class="w">                        </span><span class="s2">&quot;logs:DescribeLogGroups&quot;</span><span class="p">,</span>
</span><span id="__span-13-361"><span class="w">                        </span><span class="s2">&quot;logs:GetLogRecord&quot;</span><span class="p">,</span>
</span><span id="__span-13-362"><span class="w">                        </span><span class="s2">&quot;logs:GetQueryResults&quot;</span><span class="p">,</span>
</span><span id="__span-13-363"><span class="w">                        </span><span class="s2">&quot;logs:StopQuery&quot;</span>
</span><span id="__span-13-364"><span class="w">                    </span><span class="p">],</span>
</span><span id="__span-13-365"><span class="w">                    </span><span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
</span><span id="__span-13-366"><span class="w">                    </span><span class="nt">&quot;Resource&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;*&quot;</span><span class="p">,</span>
</span><span id="__span-13-367"><span class="w">                    </span><span class="nt">&quot;Sid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AccessLogGroups&quot;</span>
</span><span id="__span-13-368"><span class="w">                </span><span class="p">}</span>
</span><span id="__span-13-369"><span class="w">            </span><span class="p">],</span>
</span><span id="__span-13-370"><span class="w">            </span><span class="nt">&quot;Version&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2012-10-17&quot;</span>
</span><span id="__span-13-371"><span class="w">        </span><span class="p">}</span>
</span><span id="__span-13-372"><span class="w">    </span><span class="p">},</span>
</span><span id="__span-13-373"><span class="w">    </span><span class="nt">&quot;Type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AWS::IAM::ManagedPolicy&quot;</span>
</span><span id="__span-13-374"><span class="p">}</span>
</span></code></pre></div>
</div>
</div>
</div>
<h4 id="iamlavaadminpolicy2"><a href="#iam-resources">iamLavaAdminPolicy2</a><a class="headerlink" href="#iamlavaadminpolicy2" title="Permanent link">&para;</a></h4>
<div class="tabbed-set tabbed-alternate" data-tabs="15:2"><input checked="checked" id="__tabbed_15_1" name="__tabbed_15" type="radio" /><input id="__tabbed_15_2" name="__tabbed_15" type="radio" /><div class="tabbed-labels"><label for="__tabbed_15_1">Details</label><label for="__tabbed_15_2">Source</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<table>
<thead>
<tr>
<th>Property</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Type</td>
<td><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-iam-managedpolicy.html" title="AWS documentation for this resource type">AWS::IAM::ManagedPolicy</a></td>
</tr>
<tr>
<td>Group</td>
<td><a href="#iam-resources">IAM Resources</a> (<a href="#iam-resources">IAM</a>)</td>
</tr>
<tr>
<td>Description</td>
<td>Admin policy for lava realm - part 2.</td>
</tr>
</tbody>
</table>
</div>
<div class="tabbed-block">
<div class="language-json highlight"><pre><span></span><code><span id="__span-14-1"><span class="p">{</span>
</span><span id="__span-14-2"><span class="w">    </span><span class="nt">&quot;Properties&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-14-3"><span class="w">        </span><span class="nt">&quot;Description&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-14-4"><span class="w">            </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Admin policy for lava realm ${realm} - part 2&quot;</span>
</span><span id="__span-14-5"><span class="w">        </span><span class="p">},</span>
</span><span id="__span-14-6"><span class="w">        </span><span class="nt">&quot;ManagedPolicyName&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-14-7"><span class="w">            </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;lava-${realm}-admin2&quot;</span>
</span><span id="__span-14-8"><span class="w">        </span><span class="p">},</span>
</span><span id="__span-14-9"><span class="w">        </span><span class="nt">&quot;PolicyDocument&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-14-10"><span class="w">            </span><span class="nt">&quot;Statement&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-14-11"><span class="w">                </span><span class="p">{</span>
</span><span id="__span-14-12"><span class="w">                    </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-14-13"><span class="w">                        </span><span class="s2">&quot;logs:DescribeLogStreams&quot;</span><span class="p">,</span>
</span><span id="__span-14-14"><span class="w">                        </span><span class="s2">&quot;logs:FilterLogEvents&quot;</span><span class="p">,</span>
</span><span id="__span-14-15"><span class="w">                        </span><span class="s2">&quot;logs:GetLogEvents&quot;</span><span class="p">,</span>
</span><span id="__span-14-16"><span class="w">                        </span><span class="s2">&quot;logs:GetLogGroupFields&quot;</span><span class="p">,</span>
</span><span id="__span-14-17"><span class="w">                        </span><span class="s2">&quot;logs:StartQuery&quot;</span>
</span><span id="__span-14-18"><span class="w">                    </span><span class="p">],</span>
</span><span id="__span-14-19"><span class="w">                    </span><span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
</span><span id="__span-14-20"><span class="w">                    </span><span class="nt">&quot;Resource&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-14-21"><span class="w">                        </span><span class="p">{</span>
</span><span id="__span-14-22"><span class="w">                            </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;arn:aws:logs:${AWS::Region}:${AWS::AccountId}:log-group:/var/log/lava/${realm}&quot;</span>
</span><span id="__span-14-23"><span class="w">                        </span><span class="p">},</span>
</span><span id="__span-14-24"><span class="w">                        </span><span class="p">{</span>
</span><span id="__span-14-25"><span class="w">                            </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;arn:aws:logs:${AWS::Region}:${AWS::AccountId}:log-group:/var/log/lava/${realm}:*&quot;</span>
</span><span id="__span-14-26"><span class="w">                        </span><span class="p">}</span>
</span><span id="__span-14-27"><span class="w">                    </span><span class="p">],</span>
</span><span id="__span-14-28"><span class="w">                    </span><span class="nt">&quot;Sid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ReadLavaWorkerLogs&quot;</span>
</span><span id="__span-14-29"><span class="w">                </span><span class="p">}</span>
</span><span id="__span-14-30"><span class="w">            </span><span class="p">],</span>
</span><span id="__span-14-31"><span class="w">            </span><span class="nt">&quot;Version&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2012-10-17&quot;</span>
</span><span id="__span-14-32"><span class="w">        </span><span class="p">}</span>
</span><span id="__span-14-33"><span class="w">    </span><span class="p">},</span>
</span><span id="__span-14-34"><span class="w">    </span><span class="nt">&quot;Type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AWS::IAM::ManagedPolicy&quot;</span>
</span><span id="__span-14-35"><span class="p">}</span>
</span></code></pre></div>
</div>
</div>
</div>
<h4 id="iamlavadispatchlambdapolicy"><a href="#iam-resources">iamLavaDispatchLambdaPolicy</a><a class="headerlink" href="#iamlavadispatchlambdapolicy" title="Permanent link">&para;</a></h4>
<div class="tabbed-set tabbed-alternate" data-tabs="16:2"><input checked="checked" id="__tabbed_16_1" name="__tabbed_16" type="radio" /><input id="__tabbed_16_2" name="__tabbed_16" type="radio" /><div class="tabbed-labels"><label for="__tabbed_16_1">Details</label><label for="__tabbed_16_2">Source</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<table>
<thead>
<tr>
<th>Property</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Type</td>
<td><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-iam-managedpolicy.html" title="AWS documentation for this resource type">AWS::IAM::ManagedPolicy</a></td>
</tr>
<tr>
<td>Group</td>
<td><a href="#iam-resources">IAM Resources</a> (<a href="#iam-resources">IAM</a>)</td>
</tr>
<tr>
<td>Description</td>
<td>Policy for the dispatching lambdas for the lava realm.</td>
</tr>
</tbody>
</table>
</div>
<div class="tabbed-block">
<div class="language-json highlight"><pre><span></span><code><span id="__span-15-1"><span class="p">{</span>
</span><span id="__span-15-2"><span class="w">    </span><span class="nt">&quot;Condition&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ifCreateLambdas&quot;</span><span class="p">,</span>
</span><span id="__span-15-3"><span class="w">    </span><span class="nt">&quot;Properties&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-4"><span class="w">        </span><span class="nt">&quot;Description&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-5"><span class="w">            </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Policy for dispatching Lambdas for ${realm} realm&quot;</span>
</span><span id="__span-15-6"><span class="w">        </span><span class="p">},</span>
</span><span id="__span-15-7"><span class="w">        </span><span class="nt">&quot;ManagedPolicyName&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-8"><span class="w">            </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;lava-${realm}-dispatch-lambdas&quot;</span>
</span><span id="__span-15-9"><span class="w">        </span><span class="p">},</span>
</span><span id="__span-15-10"><span class="w">        </span><span class="nt">&quot;PolicyDocument&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-11"><span class="w">            </span><span class="nt">&quot;Statement&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-15-12"><span class="w">                </span><span class="p">{</span>
</span><span id="__span-15-13"><span class="w">                    </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;sqs:ListQueues&quot;</span><span class="p">,</span>
</span><span id="__span-15-14"><span class="w">                    </span><span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
</span><span id="__span-15-15"><span class="w">                    </span><span class="nt">&quot;Resource&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;*&quot;</span><span class="p">,</span>
</span><span id="__span-15-16"><span class="w">                    </span><span class="nt">&quot;Sid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ListSqsQueues&quot;</span>
</span><span id="__span-15-17"><span class="w">                </span><span class="p">},</span>
</span><span id="__span-15-18"><span class="w">                </span><span class="p">{</span>
</span><span id="__span-15-19"><span class="w">                    </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-15-20"><span class="w">                        </span><span class="s2">&quot;sqs:GetQueueUrl&quot;</span><span class="p">,</span>
</span><span id="__span-15-21"><span class="w">                        </span><span class="s2">&quot;sqs:GetQueueAttributes&quot;</span><span class="p">,</span>
</span><span id="__span-15-22"><span class="w">                        </span><span class="s2">&quot;sqs:SendMessage&quot;</span>
</span><span id="__span-15-23"><span class="w">                    </span><span class="p">],</span>
</span><span id="__span-15-24"><span class="w">                    </span><span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
</span><span id="__span-15-25"><span class="w">                    </span><span class="nt">&quot;Resource&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-26"><span class="w">                        </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;arn:aws:sqs:${AWS::Region}:${AWS::AccountId}:lava-${realm}-*&quot;</span>
</span><span id="__span-15-27"><span class="w">                    </span><span class="p">},</span>
</span><span id="__span-15-28"><span class="w">                    </span><span class="nt">&quot;Sid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AccessSqsQueues&quot;</span>
</span><span id="__span-15-29"><span class="w">                </span><span class="p">},</span>
</span><span id="__span-15-30"><span class="w">                </span><span class="p">{</span>
</span><span id="__span-15-31"><span class="w">                    </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-15-32"><span class="w">                        </span><span class="s2">&quot;dynamodb:GetItem&quot;</span><span class="p">,</span>
</span><span id="__span-15-33"><span class="w">                        </span><span class="s2">&quot;dynamodb:Query&quot;</span>
</span><span id="__span-15-34"><span class="w">                    </span><span class="p">],</span>
</span><span id="__span-15-35"><span class="w">                    </span><span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
</span><span id="__span-15-36"><span class="w">                    </span><span class="nt">&quot;Resource&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-15-37"><span class="w">                        </span><span class="p">{</span>
</span><span id="__span-15-38"><span class="w">                            </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;arn:aws:dynamodb:${AWS::Region}:${AWS::AccountId}:table/lava.${realm}.*&quot;</span>
</span><span id="__span-15-39"><span class="w">                        </span><span class="p">}</span>
</span><span id="__span-15-40"><span class="w">                    </span><span class="p">],</span>
</span><span id="__span-15-41"><span class="w">                    </span><span class="nt">&quot;Sid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AccessDynamoDBLavaTables&quot;</span>
</span><span id="__span-15-42"><span class="w">                </span><span class="p">},</span>
</span><span id="__span-15-43"><span class="w">                </span><span class="p">{</span>
</span><span id="__span-15-44"><span class="w">                    </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-15-45"><span class="w">                        </span><span class="s2">&quot;logs:CreateLogGroup&quot;</span><span class="p">,</span>
</span><span id="__span-15-46"><span class="w">                        </span><span class="s2">&quot;logs:CreateLogStream&quot;</span><span class="p">,</span>
</span><span id="__span-15-47"><span class="w">                        </span><span class="s2">&quot;logs:PutLogEvents&quot;</span><span class="p">,</span>
</span><span id="__span-15-48"><span class="w">                        </span><span class="s2">&quot;logs:DescribeLogStreams&quot;</span>
</span><span id="__span-15-49"><span class="w">                    </span><span class="p">],</span>
</span><span id="__span-15-50"><span class="w">                    </span><span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
</span><span id="__span-15-51"><span class="w">                    </span><span class="nt">&quot;Resource&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;*&quot;</span><span class="p">,</span>
</span><span id="__span-15-52"><span class="w">                    </span><span class="nt">&quot;Sid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;LogToCloudWatch&quot;</span>
</span><span id="__span-15-53"><span class="w">                </span><span class="p">},</span>
</span><span id="__span-15-54"><span class="w">                </span><span class="p">{</span>
</span><span id="__span-15-55"><span class="w">                    </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-15-56"><span class="w">                        </span><span class="s2">&quot;kms:Decrypt&quot;</span><span class="p">,</span>
</span><span id="__span-15-57"><span class="w">                        </span><span class="s2">&quot;kms:Encrypt&quot;</span><span class="p">,</span>
</span><span id="__span-15-58"><span class="w">                        </span><span class="s2">&quot;kms:GenerateDataKey*&quot;</span>
</span><span id="__span-15-59"><span class="w">                    </span><span class="p">],</span>
</span><span id="__span-15-60"><span class="w">                    </span><span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
</span><span id="__span-15-61"><span class="w">                    </span><span class="nt">&quot;Resource&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-62"><span class="w">                        </span><span class="nt">&quot;Fn::GetAtt&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-15-63"><span class="w">                            </span><span class="s2">&quot;kmsUserKey&quot;</span><span class="p">,</span>
</span><span id="__span-15-64"><span class="w">                            </span><span class="s2">&quot;Arn&quot;</span>
</span><span id="__span-15-65"><span class="w">                        </span><span class="p">]</span>
</span><span id="__span-15-66"><span class="w">                    </span><span class="p">},</span>
</span><span id="__span-15-67"><span class="w">                    </span><span class="nt">&quot;Sid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;UseKmsUserKey&quot;</span>
</span><span id="__span-15-68"><span class="w">                </span><span class="p">}</span>
</span><span id="__span-15-69"><span class="w">            </span><span class="p">],</span>
</span><span id="__span-15-70"><span class="w">            </span><span class="nt">&quot;Version&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2012-10-17&quot;</span>
</span><span id="__span-15-71"><span class="w">        </span><span class="p">}</span>
</span><span id="__span-15-72"><span class="w">    </span><span class="p">},</span>
</span><span id="__span-15-73"><span class="w">    </span><span class="nt">&quot;Type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AWS::IAM::ManagedPolicy&quot;</span>
</span><span id="__span-15-74"><span class="p">}</span>
</span></code></pre></div>
</div>
</div>
</div>
<h4 id="iamlavadispatchlambdarole"><a href="#iam-resources">iamLavaDispatchLambdaRole</a><a class="headerlink" href="#iamlavadispatchlambdarole" title="Permanent link">&para;</a></h4>
<div class="tabbed-set tabbed-alternate" data-tabs="17:2"><input checked="checked" id="__tabbed_17_1" name="__tabbed_17" type="radio" /><input id="__tabbed_17_2" name="__tabbed_17" type="radio" /><div class="tabbed-labels"><label for="__tabbed_17_1">Details</label><label for="__tabbed_17_2">Source</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<table>
<thead>
<tr>
<th>Property</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Type</td>
<td><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-iam-role.html" title="AWS documentation for this resource type">AWS::IAM::Role</a></td>
</tr>
<tr>
<td>Group</td>
<td><a href="#iam-resources">IAM Resources</a> (<a href="#iam-resources">IAM</a>)</td>
</tr>
<tr>
<td>Description</td>
<td>IAM role for dispatching Lambda functions.</td>
</tr>
</tbody>
</table>
</div>
<div class="tabbed-block">
<div class="language-json highlight"><pre><span></span><code><span id="__span-16-1"><span class="p">{</span>
</span><span id="__span-16-2"><span class="w">    </span><span class="nt">&quot;Condition&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ifCreateLambdas&quot;</span><span class="p">,</span>
</span><span id="__span-16-3"><span class="w">    </span><span class="nt">&quot;Properties&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-16-4"><span class="w">        </span><span class="nt">&quot;AssumeRolePolicyDocument&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-16-5"><span class="w">            </span><span class="nt">&quot;Statement&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-16-6"><span class="w">                </span><span class="p">{</span>
</span><span id="__span-16-7"><span class="w">                    </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;sts:AssumeRole&quot;</span><span class="p">,</span>
</span><span id="__span-16-8"><span class="w">                    </span><span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
</span><span id="__span-16-9"><span class="w">                    </span><span class="nt">&quot;Principal&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-16-10"><span class="w">                        </span><span class="nt">&quot;Service&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;lambda.amazonaws.com&quot;</span>
</span><span id="__span-16-11"><span class="w">                    </span><span class="p">}</span>
</span><span id="__span-16-12"><span class="w">                </span><span class="p">}</span>
</span><span id="__span-16-13"><span class="w">            </span><span class="p">],</span>
</span><span id="__span-16-14"><span class="w">            </span><span class="nt">&quot;Version&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2012-10-17&quot;</span>
</span><span id="__span-16-15"><span class="w">        </span><span class="p">},</span>
</span><span id="__span-16-16"><span class="w">        </span><span class="nt">&quot;ManagedPolicyArns&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-16-17"><span class="w">            </span><span class="p">{</span>
</span><span id="__span-16-18"><span class="w">                </span><span class="nt">&quot;Ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;iamLavaDispatchLambdaPolicy&quot;</span>
</span><span id="__span-16-19"><span class="w">            </span><span class="p">}</span>
</span><span id="__span-16-20"><span class="w">        </span><span class="p">],</span>
</span><span id="__span-16-21"><span class="w">        </span><span class="nt">&quot;RoleName&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-16-22"><span class="w">            </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;lava-${realm}-dispatch-lambda&quot;</span>
</span><span id="__span-16-23"><span class="w">        </span><span class="p">}</span>
</span><span id="__span-16-24"><span class="w">    </span><span class="p">},</span>
</span><span id="__span-16-25"><span class="w">    </span><span class="nt">&quot;Type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AWS::IAM::Role&quot;</span>
</span><span id="__span-16-26"><span class="p">}</span>
</span></code></pre></div>
</div>
</div>
</div>
<h4 id="iamlavametricslambdapolicy"><a href="#iam-resources">iamLavaMetricsLambdaPolicy</a><a class="headerlink" href="#iamlavametricslambdapolicy" title="Permanent link">&para;</a></h4>
<div class="tabbed-set tabbed-alternate" data-tabs="18:2"><input checked="checked" id="__tabbed_18_1" name="__tabbed_18" type="radio" /><input id="__tabbed_18_2" name="__tabbed_18" type="radio" /><div class="tabbed-labels"><label for="__tabbed_18_1">Details</label><label for="__tabbed_18_2">Source</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<table>
<thead>
<tr>
<th>Property</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Type</td>
<td><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-iam-managedpolicy.html" title="AWS documentation for this resource type">AWS::IAM::ManagedPolicy</a></td>
</tr>
<tr>
<td>Group</td>
<td><a href="#iam-resources">IAM Resources</a> (<a href="#iam-resources">IAM</a>)</td>
</tr>
<tr>
<td>Description</td>
<td>Policy for the metrics lambda for the lava realm.</td>
</tr>
</tbody>
</table>
</div>
<div class="tabbed-block">
<div class="language-json highlight"><pre><span></span><code><span id="__span-17-1"><span class="p">{</span>
</span><span id="__span-17-2"><span class="w">    </span><span class="nt">&quot;Condition&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ifCreateLambdas&quot;</span><span class="p">,</span>
</span><span id="__span-17-3"><span class="w">    </span><span class="nt">&quot;Properties&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-17-4"><span class="w">        </span><span class="nt">&quot;Description&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-17-5"><span class="w">            </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Policy for metrics Lambda for ${realm} realm&quot;</span>
</span><span id="__span-17-6"><span class="w">        </span><span class="p">},</span>
</span><span id="__span-17-7"><span class="w">        </span><span class="nt">&quot;ManagedPolicyName&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-17-8"><span class="w">            </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;lava-${realm}-metricslambda&quot;</span>
</span><span id="__span-17-9"><span class="w">        </span><span class="p">},</span>
</span><span id="__span-17-10"><span class="w">        </span><span class="nt">&quot;PolicyDocument&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-17-11"><span class="w">            </span><span class="nt">&quot;Statement&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-17-12"><span class="w">                </span><span class="p">{</span>
</span><span id="__span-17-13"><span class="w">                    </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-17-14"><span class="w">                        </span><span class="s2">&quot;logs:CreateLogGroup&quot;</span><span class="p">,</span>
</span><span id="__span-17-15"><span class="w">                        </span><span class="s2">&quot;logs:CreateLogStream&quot;</span><span class="p">,</span>
</span><span id="__span-17-16"><span class="w">                        </span><span class="s2">&quot;logs:PutLogEvents&quot;</span><span class="p">,</span>
</span><span id="__span-17-17"><span class="w">                        </span><span class="s2">&quot;logs:DescribeLogStreams&quot;</span>
</span><span id="__span-17-18"><span class="w">                    </span><span class="p">],</span>
</span><span id="__span-17-19"><span class="w">                    </span><span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
</span><span id="__span-17-20"><span class="w">                    </span><span class="nt">&quot;Resource&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;*&quot;</span><span class="p">,</span>
</span><span id="__span-17-21"><span class="w">                    </span><span class="nt">&quot;Sid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;LogToCloudWatch&quot;</span>
</span><span id="__span-17-22"><span class="w">                </span><span class="p">},</span>
</span><span id="__span-17-23"><span class="w">                </span><span class="p">{</span>
</span><span id="__span-17-24"><span class="w">                    </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;autoscaling:DescribeAutoScalingGroups&quot;</span><span class="p">,</span>
</span><span id="__span-17-25"><span class="w">                    </span><span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
</span><span id="__span-17-26"><span class="w">                    </span><span class="nt">&quot;Resource&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;*&quot;</span>
</span><span id="__span-17-27"><span class="w">                </span><span class="p">},</span>
</span><span id="__span-17-28"><span class="w">                </span><span class="p">{</span>
</span><span id="__span-17-29"><span class="w">                    </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;cloudwatch:PutMetricData&quot;</span><span class="p">,</span>
</span><span id="__span-17-30"><span class="w">                    </span><span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
</span><span id="__span-17-31"><span class="w">                    </span><span class="nt">&quot;Resource&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;*&quot;</span><span class="p">,</span>
</span><span id="__span-17-32"><span class="w">                    </span><span class="nt">&quot;Sid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;PutCloudWatchMetricData&quot;</span>
</span><span id="__span-17-33"><span class="w">                </span><span class="p">},</span>
</span><span id="__span-17-34"><span class="w">                </span><span class="p">{</span>
</span><span id="__span-17-35"><span class="w">                    </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;sqs:ListQueues&quot;</span><span class="p">,</span>
</span><span id="__span-17-36"><span class="w">                    </span><span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
</span><span id="__span-17-37"><span class="w">                    </span><span class="nt">&quot;Resource&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;*&quot;</span><span class="p">,</span>
</span><span id="__span-17-38"><span class="w">                    </span><span class="nt">&quot;Sid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ListSqsQueues&quot;</span>
</span><span id="__span-17-39"><span class="w">                </span><span class="p">},</span>
</span><span id="__span-17-40"><span class="w">                </span><span class="p">{</span>
</span><span id="__span-17-41"><span class="w">                    </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-17-42"><span class="w">                        </span><span class="s2">&quot;sqs:GetQueueUrl&quot;</span><span class="p">,</span>
</span><span id="__span-17-43"><span class="w">                        </span><span class="s2">&quot;sqs:GetQueueAttributes&quot;</span>
</span><span id="__span-17-44"><span class="w">                    </span><span class="p">],</span>
</span><span id="__span-17-45"><span class="w">                    </span><span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
</span><span id="__span-17-46"><span class="w">                    </span><span class="nt">&quot;Resource&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-17-47"><span class="w">                        </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;arn:aws:sqs:${AWS::Region}:${AWS::AccountId}:lava-${realm}-*&quot;</span>
</span><span id="__span-17-48"><span class="w">                    </span><span class="p">},</span>
</span><span id="__span-17-49"><span class="w">                    </span><span class="nt">&quot;Sid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AccessSqsQueues&quot;</span>
</span><span id="__span-17-50"><span class="w">                </span><span class="p">}</span>
</span><span id="__span-17-51"><span class="w">            </span><span class="p">],</span>
</span><span id="__span-17-52"><span class="w">            </span><span class="nt">&quot;Version&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2012-10-17&quot;</span>
</span><span id="__span-17-53"><span class="w">        </span><span class="p">}</span>
</span><span id="__span-17-54"><span class="w">    </span><span class="p">},</span>
</span><span id="__span-17-55"><span class="w">    </span><span class="nt">&quot;Type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AWS::IAM::ManagedPolicy&quot;</span>
</span><span id="__span-17-56"><span class="p">}</span>
</span></code></pre></div>
</div>
</div>
</div>
<h4 id="iamlavametricslambdarole"><a href="#iam-resources">iamLavaMetricsLambdaRole</a><a class="headerlink" href="#iamlavametricslambdarole" title="Permanent link">&para;</a></h4>
<div class="tabbed-set tabbed-alternate" data-tabs="19:2"><input checked="checked" id="__tabbed_19_1" name="__tabbed_19" type="radio" /><input id="__tabbed_19_2" name="__tabbed_19" type="radio" /><div class="tabbed-labels"><label for="__tabbed_19_1">Details</label><label for="__tabbed_19_2">Source</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<table>
<thead>
<tr>
<th>Property</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Type</td>
<td><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-iam-role.html" title="AWS documentation for this resource type">AWS::IAM::Role</a></td>
</tr>
<tr>
<td>Group</td>
<td><a href="#iam-resources">IAM Resources</a> (<a href="#iam-resources">IAM</a>)</td>
</tr>
<tr>
<td>Description</td>
<td>IAM role for metrics Lambda function.</td>
</tr>
</tbody>
</table>
</div>
<div class="tabbed-block">
<div class="language-json highlight"><pre><span></span><code><span id="__span-18-1"><span class="p">{</span>
</span><span id="__span-18-2"><span class="w">    </span><span class="nt">&quot;Condition&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ifCreateLambdas&quot;</span><span class="p">,</span>
</span><span id="__span-18-3"><span class="w">    </span><span class="nt">&quot;Properties&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-18-4"><span class="w">        </span><span class="nt">&quot;AssumeRolePolicyDocument&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-18-5"><span class="w">            </span><span class="nt">&quot;Statement&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-18-6"><span class="w">                </span><span class="p">{</span>
</span><span id="__span-18-7"><span class="w">                    </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;sts:AssumeRole&quot;</span><span class="p">,</span>
</span><span id="__span-18-8"><span class="w">                    </span><span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
</span><span id="__span-18-9"><span class="w">                    </span><span class="nt">&quot;Principal&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-18-10"><span class="w">                        </span><span class="nt">&quot;Service&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;lambda.amazonaws.com&quot;</span>
</span><span id="__span-18-11"><span class="w">                    </span><span class="p">}</span>
</span><span id="__span-18-12"><span class="w">                </span><span class="p">}</span>
</span><span id="__span-18-13"><span class="w">            </span><span class="p">],</span>
</span><span id="__span-18-14"><span class="w">            </span><span class="nt">&quot;Version&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2012-10-17&quot;</span>
</span><span id="__span-18-15"><span class="w">        </span><span class="p">},</span>
</span><span id="__span-18-16"><span class="w">        </span><span class="nt">&quot;ManagedPolicyArns&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-18-17"><span class="w">            </span><span class="p">{</span>
</span><span id="__span-18-18"><span class="w">                </span><span class="nt">&quot;Ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;iamLavaMetricsLambdaPolicy&quot;</span>
</span><span id="__span-18-19"><span class="w">            </span><span class="p">}</span>
</span><span id="__span-18-20"><span class="w">        </span><span class="p">],</span>
</span><span id="__span-18-21"><span class="w">        </span><span class="nt">&quot;RoleName&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-18-22"><span class="w">            </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;lava-${realm}-metrics-lambda&quot;</span>
</span><span id="__span-18-23"><span class="w">        </span><span class="p">}</span>
</span><span id="__span-18-24"><span class="w">    </span><span class="p">},</span>
</span><span id="__span-18-25"><span class="w">    </span><span class="nt">&quot;Type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AWS::IAM::Role&quot;</span>
</span><span id="__span-18-26"><span class="p">}</span>
</span></code></pre></div>
</div>
</div>
</div>
<h4 id="iamlavaoperator"><a href="#iam-resources">iamLavaOperator</a><a class="headerlink" href="#iamlavaoperator" title="Permanent link">&para;</a></h4>
<div class="tabbed-set tabbed-alternate" data-tabs="20:2"><input checked="checked" id="__tabbed_20_1" name="__tabbed_20" type="radio" /><input id="__tabbed_20_2" name="__tabbed_20" type="radio" /><div class="tabbed-labels"><label for="__tabbed_20_1">Details</label><label for="__tabbed_20_2">Source</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<table>
<thead>
<tr>
<th>Property</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Type</td>
<td><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-iam-group.html" title="AWS documentation for this resource type">AWS::IAM::Group</a></td>
</tr>
<tr>
<td>Group</td>
<td><a href="#iam-resources">IAM Resources</a> (<a href="#iam-resources">IAM</a>)</td>
</tr>
<tr>
<td>Description</td>
<td>Operator group for lave realm.</td>
</tr>
</tbody>
</table>
</div>
<div class="tabbed-block">
<div class="language-json highlight"><pre><span></span><code><span id="__span-19-1"><span class="p">{</span>
</span><span id="__span-19-2"><span class="w">    </span><span class="nt">&quot;Properties&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-19-3"><span class="w">        </span><span class="nt">&quot;GroupName&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-19-4"><span class="w">            </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;lava-${realm}-operator&quot;</span>
</span><span id="__span-19-5"><span class="w">        </span><span class="p">},</span>
</span><span id="__span-19-6"><span class="w">        </span><span class="nt">&quot;ManagedPolicyArns&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-19-7"><span class="w">            </span><span class="p">{</span>
</span><span id="__span-19-8"><span class="w">                </span><span class="nt">&quot;Ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;iamLavaReaderPolicy&quot;</span>
</span><span id="__span-19-9"><span class="w">            </span><span class="p">},</span>
</span><span id="__span-19-10"><span class="w">            </span><span class="p">{</span>
</span><span id="__span-19-11"><span class="w">                </span><span class="nt">&quot;Ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;iamLavaOperatorPolicy&quot;</span>
</span><span id="__span-19-12"><span class="w">            </span><span class="p">}</span>
</span><span id="__span-19-13"><span class="w">        </span><span class="p">],</span>
</span><span id="__span-19-14"><span class="w">        </span><span class="nt">&quot;Path&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/&quot;</span>
</span><span id="__span-19-15"><span class="w">    </span><span class="p">},</span>
</span><span id="__span-19-16"><span class="w">    </span><span class="nt">&quot;Type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AWS::IAM::Group&quot;</span>
</span><span id="__span-19-17"><span class="p">}</span>
</span></code></pre></div>
</div>
</div>
</div>
<h4 id="iamlavaoperatorpolicy"><a href="#iam-resources">iamLavaOperatorPolicy</a><a class="headerlink" href="#iamlavaoperatorpolicy" title="Permanent link">&para;</a></h4>
<div class="tabbed-set tabbed-alternate" data-tabs="21:2"><input checked="checked" id="__tabbed_21_1" name="__tabbed_21" type="radio" /><input id="__tabbed_21_2" name="__tabbed_21" type="radio" /><div class="tabbed-labels"><label for="__tabbed_21_1">Details</label><label for="__tabbed_21_2">Source</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<table>
<thead>
<tr>
<th>Property</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Type</td>
<td><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-iam-managedpolicy.html" title="AWS documentation for this resource type">AWS::IAM::ManagedPolicy</a></td>
</tr>
<tr>
<td>Group</td>
<td><a href="#iam-resources">IAM Resources</a> (<a href="#iam-resources">IAM</a>)</td>
</tr>
<tr>
<td>Description</td>
<td>Operator (incremental) access policy for lava realm.</td>
</tr>
</tbody>
</table>
</div>
<div class="tabbed-block">
<div class="language-json highlight"><pre><span></span><code><span id="__span-20-1"><span class="p">{</span>
</span><span id="__span-20-2"><span class="w">    </span><span class="nt">&quot;Properties&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-3"><span class="w">        </span><span class="nt">&quot;Description&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-4"><span class="w">            </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Operator add-on policy for lava realm ${realm} : Operator = Reader + this policy&quot;</span>
</span><span id="__span-20-5"><span class="w">        </span><span class="p">},</span>
</span><span id="__span-20-6"><span class="w">        </span><span class="nt">&quot;ManagedPolicyName&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-7"><span class="w">            </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;lava-${realm}-operator&quot;</span>
</span><span id="__span-20-8"><span class="w">        </span><span class="p">},</span>
</span><span id="__span-20-9"><span class="w">        </span><span class="nt">&quot;PolicyDocument&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-10"><span class="w">            </span><span class="nt">&quot;Statement&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-20-11"><span class="w">                </span><span class="p">{</span>
</span><span id="__span-20-12"><span class="w">                    </span><span class="nt">&quot;Fn::If&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-20-13"><span class="w">                        </span><span class="s2">&quot;ifCreateLambdas&quot;</span><span class="p">,</span>
</span><span id="__span-20-14"><span class="w">                        </span><span class="p">{</span>
</span><span id="__span-20-15"><span class="w">                            </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-20-16"><span class="w">                                </span><span class="s2">&quot;sns:Publish&quot;</span><span class="p">,</span>
</span><span id="__span-20-17"><span class="w">                                </span><span class="s2">&quot;sns:GetTopicAttributes&quot;</span>
</span><span id="__span-20-18"><span class="w">                            </span><span class="p">],</span>
</span><span id="__span-20-19"><span class="w">                            </span><span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
</span><span id="__span-20-20"><span class="w">                            </span><span class="nt">&quot;Resource&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-21"><span class="w">                                </span><span class="nt">&quot;Ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;snsDispatchHelper&quot;</span>
</span><span id="__span-20-22"><span class="w">                            </span><span class="p">},</span>
</span><span id="__span-20-23"><span class="w">                            </span><span class="nt">&quot;Sid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;PublishToSNSdispatchHelper&quot;</span>
</span><span id="__span-20-24"><span class="w">                        </span><span class="p">},</span>
</span><span id="__span-20-25"><span class="w">                        </span><span class="p">{</span>
</span><span id="__span-20-26"><span class="w">                            </span><span class="nt">&quot;Ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AWS::NoValue&quot;</span>
</span><span id="__span-20-27"><span class="w">                        </span><span class="p">}</span>
</span><span id="__span-20-28"><span class="w">                    </span><span class="p">]</span>
</span><span id="__span-20-29"><span class="w">                </span><span class="p">},</span>
</span><span id="__span-20-30"><span class="w">                </span><span class="p">{</span>
</span><span id="__span-20-31"><span class="w">                    </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-20-32"><span class="w">                        </span><span class="s2">&quot;logs:DescribeLogGroups&quot;</span><span class="p">,</span>
</span><span id="__span-20-33"><span class="w">                        </span><span class="s2">&quot;logs:GetLogRecord&quot;</span><span class="p">,</span>
</span><span id="__span-20-34"><span class="w">                        </span><span class="s2">&quot;logs:GetQueryResults&quot;</span><span class="p">,</span>
</span><span id="__span-20-35"><span class="w">                        </span><span class="s2">&quot;logs:StopQuery&quot;</span>
</span><span id="__span-20-36"><span class="w">                    </span><span class="p">],</span>
</span><span id="__span-20-37"><span class="w">                    </span><span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
</span><span id="__span-20-38"><span class="w">                    </span><span class="nt">&quot;Resource&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;*&quot;</span><span class="p">,</span>
</span><span id="__span-20-39"><span class="w">                    </span><span class="nt">&quot;Sid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AccessLogGroups&quot;</span>
</span><span id="__span-20-40"><span class="w">                </span><span class="p">},</span>
</span><span id="__span-20-41"><span class="w">                </span><span class="p">{</span>
</span><span id="__span-20-42"><span class="w">                    </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-20-43"><span class="w">                        </span><span class="s2">&quot;logs:DescribeLogStreams&quot;</span><span class="p">,</span>
</span><span id="__span-20-44"><span class="w">                        </span><span class="s2">&quot;logs:FilterLogEvents&quot;</span><span class="p">,</span>
</span><span id="__span-20-45"><span class="w">                        </span><span class="s2">&quot;logs:GetLogEvents&quot;</span><span class="p">,</span>
</span><span id="__span-20-46"><span class="w">                        </span><span class="s2">&quot;logs:GetLogGroupFields&quot;</span><span class="p">,</span>
</span><span id="__span-20-47"><span class="w">                        </span><span class="s2">&quot;logs:StartQuery&quot;</span>
</span><span id="__span-20-48"><span class="w">                    </span><span class="p">],</span>
</span><span id="__span-20-49"><span class="w">                    </span><span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
</span><span id="__span-20-50"><span class="w">                    </span><span class="nt">&quot;Resource&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-20-51"><span class="w">                        </span><span class="p">{</span>
</span><span id="__span-20-52"><span class="w">                            </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;arn:aws:logs:${AWS::Region}:${AWS::AccountId}:log-group:/var/log/lava/${realm}&quot;</span>
</span><span id="__span-20-53"><span class="w">                        </span><span class="p">},</span>
</span><span id="__span-20-54"><span class="w">                        </span><span class="p">{</span>
</span><span id="__span-20-55"><span class="w">                            </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;arn:aws:logs:${AWS::Region}:${AWS::AccountId}:log-group:/var/log/lava/${realm}:*&quot;</span>
</span><span id="__span-20-56"><span class="w">                        </span><span class="p">}</span>
</span><span id="__span-20-57"><span class="w">                    </span><span class="p">],</span>
</span><span id="__span-20-58"><span class="w">                    </span><span class="nt">&quot;Sid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ReadLavaWorkerLogs&quot;</span>
</span><span id="__span-20-59"><span class="w">                </span><span class="p">},</span>
</span><span id="__span-20-60"><span class="w">                </span><span class="p">{</span>
</span><span id="__span-20-61"><span class="w">                    </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-20-62"><span class="w">                        </span><span class="s2">&quot;sqs:ListQueues&quot;</span>
</span><span id="__span-20-63"><span class="w">                    </span><span class="p">],</span>
</span><span id="__span-20-64"><span class="w">                    </span><span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
</span><span id="__span-20-65"><span class="w">                    </span><span class="nt">&quot;Resource&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;*&quot;</span><span class="p">,</span>
</span><span id="__span-20-66"><span class="w">                    </span><span class="nt">&quot;Sid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ListSqsQueues&quot;</span>
</span><span id="__span-20-67"><span class="w">                </span><span class="p">},</span>
</span><span id="__span-20-68"><span class="w">                </span><span class="p">{</span>
</span><span id="__span-20-69"><span class="w">                    </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-20-70"><span class="w">                        </span><span class="s2">&quot;sqs:GetQueueUrl&quot;</span><span class="p">,</span>
</span><span id="__span-20-71"><span class="w">                        </span><span class="s2">&quot;sqs:GetQueueAttributes&quot;</span><span class="p">,</span>
</span><span id="__span-20-72"><span class="w">                        </span><span class="s2">&quot;sqs:ListQueueTags&quot;</span>
</span><span id="__span-20-73"><span class="w">                    </span><span class="p">],</span>
</span><span id="__span-20-74"><span class="w">                    </span><span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
</span><span id="__span-20-75"><span class="w">                    </span><span class="nt">&quot;Resource&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-76"><span class="w">                        </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;arn:aws:sqs:${AWS::Region}:${AWS::AccountId}:lava-${realm}-*&quot;</span>
</span><span id="__span-20-77"><span class="w">                    </span><span class="p">},</span>
</span><span id="__span-20-78"><span class="w">                    </span><span class="nt">&quot;Sid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ReadSqsQueues&quot;</span>
</span><span id="__span-20-79"><span class="w">                </span><span class="p">}</span>
</span><span id="__span-20-80"><span class="w">            </span><span class="p">],</span>
</span><span id="__span-20-81"><span class="w">            </span><span class="nt">&quot;Version&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2012-10-17&quot;</span>
</span><span id="__span-20-82"><span class="w">        </span><span class="p">}</span>
</span><span id="__span-20-83"><span class="w">    </span><span class="p">},</span>
</span><span id="__span-20-84"><span class="w">    </span><span class="nt">&quot;Type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AWS::IAM::ManagedPolicy&quot;</span>
</span><span id="__span-20-85"><span class="p">}</span>
</span></code></pre></div>
</div>
</div>
</div>
<h4 id="iamlavareadergroup"><a href="#iam-resources">iamLavaReaderGroup</a><a class="headerlink" href="#iamlavareadergroup" title="Permanent link">&para;</a></h4>
<div class="tabbed-set tabbed-alternate" data-tabs="22:2"><input checked="checked" id="__tabbed_22_1" name="__tabbed_22" type="radio" /><input id="__tabbed_22_2" name="__tabbed_22" type="radio" /><div class="tabbed-labels"><label for="__tabbed_22_1">Details</label><label for="__tabbed_22_2">Source</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<table>
<thead>
<tr>
<th>Property</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Type</td>
<td><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-iam-group.html" title="AWS documentation for this resource type">AWS::IAM::Group</a></td>
</tr>
<tr>
<td>Group</td>
<td><a href="#iam-resources">IAM Resources</a> (<a href="#iam-resources">IAM</a>)</td>
</tr>
<tr>
<td>Description</td>
<td>Reader group for lave realm.</td>
</tr>
</tbody>
</table>
</div>
<div class="tabbed-block">
<div class="language-json highlight"><pre><span></span><code><span id="__span-21-1"><span class="p">{</span>
</span><span id="__span-21-2"><span class="w">    </span><span class="nt">&quot;Properties&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-21-3"><span class="w">        </span><span class="nt">&quot;GroupName&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-21-4"><span class="w">            </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;lava-${realm}-reader&quot;</span>
</span><span id="__span-21-5"><span class="w">        </span><span class="p">},</span>
</span><span id="__span-21-6"><span class="w">        </span><span class="nt">&quot;ManagedPolicyArns&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-21-7"><span class="w">            </span><span class="p">{</span>
</span><span id="__span-21-8"><span class="w">                </span><span class="nt">&quot;Ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;iamLavaReaderPolicy&quot;</span>
</span><span id="__span-21-9"><span class="w">            </span><span class="p">}</span>
</span><span id="__span-21-10"><span class="w">        </span><span class="p">],</span>
</span><span id="__span-21-11"><span class="w">        </span><span class="nt">&quot;Path&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/&quot;</span>
</span><span id="__span-21-12"><span class="w">    </span><span class="p">},</span>
</span><span id="__span-21-13"><span class="w">    </span><span class="nt">&quot;Type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AWS::IAM::Group&quot;</span>
</span><span id="__span-21-14"><span class="p">}</span>
</span></code></pre></div>
</div>
</div>
</div>
<h4 id="iamlavareaderpolicy"><a href="#iam-resources">iamLavaReaderPolicy</a><a class="headerlink" href="#iamlavareaderpolicy" title="Permanent link">&para;</a></h4>
<div class="tabbed-set tabbed-alternate" data-tabs="23:2"><input checked="checked" id="__tabbed_23_1" name="__tabbed_23" type="radio" /><input id="__tabbed_23_2" name="__tabbed_23" type="radio" /><div class="tabbed-labels"><label for="__tabbed_23_1">Details</label><label for="__tabbed_23_2">Source</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<table>
<thead>
<tr>
<th>Property</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Type</td>
<td><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-iam-managedpolicy.html" title="AWS documentation for this resource type">AWS::IAM::ManagedPolicy</a></td>
</tr>
<tr>
<td>Group</td>
<td><a href="#iam-resources">IAM Resources</a> (<a href="#iam-resources">IAM</a>)</td>
</tr>
<tr>
<td>Description</td>
<td>Read access policy for lava realm.</td>
</tr>
</tbody>
</table>
</div>
<div class="tabbed-block">
<div class="language-json highlight"><pre><span></span><code><span id="__span-22-1"><span class="p">{</span>
</span><span id="__span-22-2"><span class="w">    </span><span class="nt">&quot;Properties&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-22-3"><span class="w">        </span><span class="nt">&quot;Description&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-22-4"><span class="w">            </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Reader policy for lava realm ${realm}&quot;</span>
</span><span id="__span-22-5"><span class="w">        </span><span class="p">},</span>
</span><span id="__span-22-6"><span class="w">        </span><span class="nt">&quot;ManagedPolicyName&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-22-7"><span class="w">            </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;lava-${realm}-reader&quot;</span>
</span><span id="__span-22-8"><span class="w">        </span><span class="p">},</span>
</span><span id="__span-22-9"><span class="w">        </span><span class="nt">&quot;PolicyDocument&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-22-10"><span class="w">            </span><span class="nt">&quot;Statement&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-22-11"><span class="w">                </span><span class="p">{</span>
</span><span id="__span-22-12"><span class="w">                    </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-22-13"><span class="w">                        </span><span class="s2">&quot;s3:ListBucket&quot;</span>
</span><span id="__span-22-14"><span class="w">                    </span><span class="p">],</span>
</span><span id="__span-22-15"><span class="w">                    </span><span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
</span><span id="__span-22-16"><span class="w">                    </span><span class="nt">&quot;Resource&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-22-17"><span class="w">                        </span><span class="p">{</span>
</span><span id="__span-22-18"><span class="w">                            </span><span class="nt">&quot;Fn::GetAtt&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-22-19"><span class="w">                                </span><span class="s2">&quot;s3LavaBucket&quot;</span><span class="p">,</span>
</span><span id="__span-22-20"><span class="w">                                </span><span class="s2">&quot;Arn&quot;</span>
</span><span id="__span-22-21"><span class="w">                            </span><span class="p">]</span>
</span><span id="__span-22-22"><span class="w">                        </span><span class="p">}</span>
</span><span id="__span-22-23"><span class="w">                    </span><span class="p">],</span>
</span><span id="__span-22-24"><span class="w">                    </span><span class="nt">&quot;Sid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;GetLavaBucketInfo&quot;</span>
</span><span id="__span-22-25"><span class="w">                </span><span class="p">},</span>
</span><span id="__span-22-26"><span class="w">                </span><span class="p">{</span>
</span><span id="__span-22-27"><span class="w">                    </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-22-28"><span class="w">                        </span><span class="s2">&quot;s3:GetObject*&quot;</span>
</span><span id="__span-22-29"><span class="w">                    </span><span class="p">],</span>
</span><span id="__span-22-30"><span class="w">                    </span><span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
</span><span id="__span-22-31"><span class="w">                    </span><span class="nt">&quot;Resource&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-22-32"><span class="w">                        </span><span class="p">{</span>
</span><span id="__span-22-33"><span class="w">                            </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;arn:aws:s3:::${s3LavaBucket}/*&quot;</span>
</span><span id="__span-22-34"><span class="w">                        </span><span class="p">}</span>
</span><span id="__span-22-35"><span class="w">                    </span><span class="p">],</span>
</span><span id="__span-22-36"><span class="w">                    </span><span class="nt">&quot;Sid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ReadLavaBucket&quot;</span>
</span><span id="__span-22-37"><span class="w">                </span><span class="p">},</span>
</span><span id="__span-22-38"><span class="w">                </span><span class="p">{</span>
</span><span id="__span-22-39"><span class="w">                    </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-22-40"><span class="w">                        </span><span class="s2">&quot;dynamodb:ListTables&quot;</span>
</span><span id="__span-22-41"><span class="w">                    </span><span class="p">],</span>
</span><span id="__span-22-42"><span class="w">                    </span><span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
</span><span id="__span-22-43"><span class="w">                    </span><span class="nt">&quot;Resource&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;*&quot;</span><span class="p">,</span>
</span><span id="__span-22-44"><span class="w">                    </span><span class="nt">&quot;Sid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ListAllDynamoTables&quot;</span>
</span><span id="__span-22-45"><span class="w">                </span><span class="p">},</span>
</span><span id="__span-22-46"><span class="w">                </span><span class="p">{</span>
</span><span id="__span-22-47"><span class="w">                    </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-22-48"><span class="w">                        </span><span class="s2">&quot;dynamodb:GetItem&quot;</span><span class="p">,</span>
</span><span id="__span-22-49"><span class="w">                        </span><span class="s2">&quot;dynamodb:BatchGetItem&quot;</span><span class="p">,</span>
</span><span id="__span-22-50"><span class="w">                        </span><span class="s2">&quot;dynamodb:DescribeTable&quot;</span><span class="p">,</span>
</span><span id="__span-22-51"><span class="w">                        </span><span class="s2">&quot;dynamodb:DescribeContinuousBackups&quot;</span><span class="p">,</span>
</span><span id="__span-22-52"><span class="w">                        </span><span class="s2">&quot;dynamodb:Query&quot;</span><span class="p">,</span>
</span><span id="__span-22-53"><span class="w">                        </span><span class="s2">&quot;dynamodb:Scan&quot;</span>
</span><span id="__span-22-54"><span class="w">                    </span><span class="p">],</span>
</span><span id="__span-22-55"><span class="w">                    </span><span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
</span><span id="__span-22-56"><span class="w">                    </span><span class="nt">&quot;Resource&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-22-57"><span class="w">                        </span><span class="p">{</span>
</span><span id="__span-22-58"><span class="w">                            </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;arn:aws:dynamodb:${AWS::Region}:${AWS::AccountId}:table/lava.realms&quot;</span>
</span><span id="__span-22-59"><span class="w">                        </span><span class="p">},</span>
</span><span id="__span-22-60"><span class="w">                        </span><span class="p">{</span>
</span><span id="__span-22-61"><span class="w">                            </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;arn:aws:dynamodb:${AWS::Region}:${AWS::AccountId}:table/lava.${realm}.*&quot;</span>
</span><span id="__span-22-62"><span class="w">                        </span><span class="p">},</span>
</span><span id="__span-22-63"><span class="w">                        </span><span class="p">{</span>
</span><span id="__span-22-64"><span class="w">                            </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;arn:aws:dynamodb:${AWS::Region}:${AWS::AccountId}:table/lava.${realm}.jobs/index/*&quot;</span>
</span><span id="__span-22-65"><span class="w">                        </span><span class="p">},</span>
</span><span id="__span-22-66"><span class="w">                        </span><span class="p">{</span>
</span><span id="__span-22-67"><span class="w">                            </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;arn:aws:dynamodb:${AWS::Region}:${AWS::AccountId}:table/lava.${realm}.events/index/*&quot;</span>
</span><span id="__span-22-68"><span class="w">                        </span><span class="p">}</span>
</span><span id="__span-22-69"><span class="w">                    </span><span class="p">],</span>
</span><span id="__span-22-70"><span class="w">                    </span><span class="nt">&quot;Sid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AccessDynamoDBLavaTables&quot;</span>
</span><span id="__span-22-71"><span class="w">                </span><span class="p">},</span>
</span><span id="__span-22-72"><span class="w">                </span><span class="p">{</span>
</span><span id="__span-22-73"><span class="w">                    </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-22-74"><span class="w">                        </span><span class="s2">&quot;kms:ListKeys&quot;</span><span class="p">,</span>
</span><span id="__span-22-75"><span class="w">                        </span><span class="s2">&quot;kms:ListAliases&quot;</span>
</span><span id="__span-22-76"><span class="w">                    </span><span class="p">],</span>
</span><span id="__span-22-77"><span class="w">                    </span><span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
</span><span id="__span-22-78"><span class="w">                    </span><span class="nt">&quot;Resource&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;*&quot;</span><span class="p">,</span>
</span><span id="__span-22-79"><span class="w">                    </span><span class="nt">&quot;Sid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ListKMSkeys&quot;</span>
</span><span id="__span-22-80"><span class="w">                </span><span class="p">},</span>
</span><span id="__span-22-81"><span class="w">                </span><span class="p">{</span>
</span><span id="__span-22-82"><span class="w">                    </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-22-83"><span class="w">                        </span><span class="s2">&quot;kms:Decrypt&quot;</span><span class="p">,</span>
</span><span id="__span-22-84"><span class="w">                        </span><span class="s2">&quot;kms:DescribeKey&quot;</span>
</span><span id="__span-22-85"><span class="w">                    </span><span class="p">],</span>
</span><span id="__span-22-86"><span class="w">                    </span><span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
</span><span id="__span-22-87"><span class="w">                    </span><span class="nt">&quot;Resource&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-22-88"><span class="w">                        </span><span class="p">{</span>
</span><span id="__span-22-89"><span class="w">                            </span><span class="nt">&quot;Fn::GetAtt&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-22-90"><span class="w">                                </span><span class="s2">&quot;kmsUserKey&quot;</span><span class="p">,</span>
</span><span id="__span-22-91"><span class="w">                                </span><span class="s2">&quot;Arn&quot;</span>
</span><span id="__span-22-92"><span class="w">                            </span><span class="p">]</span>
</span><span id="__span-22-93"><span class="w">                        </span><span class="p">}</span>
</span><span id="__span-22-94"><span class="w">                    </span><span class="p">],</span>
</span><span id="__span-22-95"><span class="w">                    </span><span class="nt">&quot;Sid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;UseKMSkeys&quot;</span>
</span><span id="__span-22-96"><span class="w">                </span><span class="p">},</span>
</span><span id="__span-22-97"><span class="w">                </span><span class="p">{</span>
</span><span id="__span-22-98"><span class="w">                    </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ecr:GetAuthorizationToken&quot;</span><span class="p">,</span>
</span><span id="__span-22-99"><span class="w">                    </span><span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
</span><span id="__span-22-100"><span class="w">                    </span><span class="nt">&quot;Resource&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;*&quot;</span><span class="p">,</span>
</span><span id="__span-22-101"><span class="w">                    </span><span class="nt">&quot;Sid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;getEcrAuthToken&quot;</span>
</span><span id="__span-22-102"><span class="w">                </span><span class="p">},</span>
</span><span id="__span-22-103"><span class="w">                </span><span class="p">{</span>
</span><span id="__span-22-104"><span class="w">                    </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-22-105"><span class="w">                        </span><span class="s2">&quot;ecr:DescribeRegistry&quot;</span><span class="p">,</span>
</span><span id="__span-22-106"><span class="w">                        </span><span class="s2">&quot;ecr:DescribeRepositories&quot;</span>
</span><span id="__span-22-107"><span class="w">                    </span><span class="p">],</span>
</span><span id="__span-22-108"><span class="w">                    </span><span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
</span><span id="__span-22-109"><span class="w">                    </span><span class="nt">&quot;Resource&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;*&quot;</span><span class="p">,</span>
</span><span id="__span-22-110"><span class="w">                    </span><span class="nt">&quot;Sid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ecrDescribeRepos&quot;</span>
</span><span id="__span-22-111"><span class="w">                </span><span class="p">},</span>
</span><span id="__span-22-112"><span class="w">                </span><span class="p">{</span>
</span><span id="__span-22-113"><span class="w">                    </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-22-114"><span class="w">                        </span><span class="s2">&quot;ecr:GetLifecyclePolicyPreview&quot;</span><span class="p">,</span>
</span><span id="__span-22-115"><span class="w">                        </span><span class="s2">&quot;ecr:GetDownloadUrlForLayer&quot;</span><span class="p">,</span>
</span><span id="__span-22-116"><span class="w">                        </span><span class="s2">&quot;ecr:BatchGetImage&quot;</span><span class="p">,</span>
</span><span id="__span-22-117"><span class="w">                        </span><span class="s2">&quot;ecr:DescribeImages&quot;</span><span class="p">,</span>
</span><span id="__span-22-118"><span class="w">                        </span><span class="s2">&quot;ecr:ListTagsForResource&quot;</span><span class="p">,</span>
</span><span id="__span-22-119"><span class="w">                        </span><span class="s2">&quot;ecr:ListImages&quot;</span><span class="p">,</span>
</span><span id="__span-22-120"><span class="w">                        </span><span class="s2">&quot;ecr:BatchCheckLayerAvailability&quot;</span><span class="p">,</span>
</span><span id="__span-22-121"><span class="w">                        </span><span class="s2">&quot;ecr:GetLifecyclePolicy&quot;</span><span class="p">,</span>
</span><span id="__span-22-122"><span class="w">                        </span><span class="s2">&quot;ecr:GetRepositoryPolicy&quot;</span>
</span><span id="__span-22-123"><span class="w">                    </span><span class="p">],</span>
</span><span id="__span-22-124"><span class="w">                    </span><span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
</span><span id="__span-22-125"><span class="w">                    </span><span class="nt">&quot;Resource&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-22-126"><span class="w">                        </span><span class="p">{</span>
</span><span id="__span-22-127"><span class="w">                            </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;arn:aws:ecr:${AWS::Region}:${AWS::AccountId}:repository/dist/lava/*&quot;</span>
</span><span id="__span-22-128"><span class="w">                        </span><span class="p">},</span>
</span><span id="__span-22-129"><span class="w">                        </span><span class="p">{</span>
</span><span id="__span-22-130"><span class="w">                            </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;arn:aws:ecr:${AWS::Region}:${AWS::AccountId}:repository/lava/${realm}/*&quot;</span>
</span><span id="__span-22-131"><span class="w">                        </span><span class="p">}</span>
</span><span id="__span-22-132"><span class="w">                    </span><span class="p">],</span>
</span><span id="__span-22-133"><span class="w">                    </span><span class="nt">&quot;Sid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ReadEcrLavaRepos&quot;</span>
</span><span id="__span-22-134"><span class="w">                </span><span class="p">},</span>
</span><span id="__span-22-135"><span class="w">                </span><span class="p">{</span>
</span><span id="__span-22-136"><span class="w">                    </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-22-137"><span class="w">                        </span><span class="s2">&quot;events:List*&quot;</span><span class="p">,</span>
</span><span id="__span-22-138"><span class="w">                        </span><span class="s2">&quot;events:TestEventPattern&quot;</span>
</span><span id="__span-22-139"><span class="w">                    </span><span class="p">],</span>
</span><span id="__span-22-140"><span class="w">                    </span><span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
</span><span id="__span-22-141"><span class="w">                    </span><span class="nt">&quot;Resource&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;*&quot;</span><span class="p">,</span>
</span><span id="__span-22-142"><span class="w">                    </span><span class="nt">&quot;Sid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;EventsListAll&quot;</span>
</span><span id="__span-22-143"><span class="w">                </span><span class="p">},</span>
</span><span id="__span-22-144"><span class="w">                </span><span class="p">{</span>
</span><span id="__span-22-145"><span class="w">                    </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;events:DescribeRule&quot;</span><span class="p">,</span>
</span><span id="__span-22-146"><span class="w">                    </span><span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
</span><span id="__span-22-147"><span class="w">                    </span><span class="nt">&quot;Resource&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-22-148"><span class="w">                        </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;arn:aws:events:${AWS::Region}:${AWS::AccountId}:rule/lava.${realm}.*&quot;</span>
</span><span id="__span-22-149"><span class="w">                    </span><span class="p">},</span>
</span><span id="__span-22-150"><span class="w">                    </span><span class="nt">&quot;Sid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;EventsReadRules&quot;</span>
</span><span id="__span-22-151"><span class="w">                </span><span class="p">}</span>
</span><span id="__span-22-152"><span class="w">            </span><span class="p">],</span>
</span><span id="__span-22-153"><span class="w">            </span><span class="nt">&quot;Version&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2012-10-17&quot;</span>
</span><span id="__span-22-154"><span class="w">        </span><span class="p">}</span>
</span><span id="__span-22-155"><span class="w">    </span><span class="p">},</span>
</span><span id="__span-22-156"><span class="w">    </span><span class="nt">&quot;Type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AWS::IAM::ManagedPolicy&quot;</span>
</span><span id="__span-22-157"><span class="p">}</span>
</span></code></pre></div>
</div>
</div>
</div>
<h4 id="iamlavastoplambdapolicy"><a href="#iam-resources">iamLavaStopLambdaPolicy</a><a class="headerlink" href="#iamlavastoplambdapolicy" title="Permanent link">&para;</a></h4>
<div class="tabbed-set tabbed-alternate" data-tabs="24:2"><input checked="checked" id="__tabbed_24_1" name="__tabbed_24" type="radio" /><input id="__tabbed_24_2" name="__tabbed_24" type="radio" /><div class="tabbed-labels"><label for="__tabbed_24_1">Details</label><label for="__tabbed_24_2">Source</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<table>
<thead>
<tr>
<th>Property</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Type</td>
<td><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-iam-managedpolicy.html" title="AWS documentation for this resource type">AWS::IAM::ManagedPolicy</a></td>
</tr>
<tr>
<td>Group</td>
<td><a href="#iam-resources">IAM Resources</a> (<a href="#iam-resources">IAM</a>)</td>
</tr>
<tr>
<td>Description</td>
<td>Policy for the node stopper lambda for the lava realm.</td>
</tr>
</tbody>
</table>
</div>
<div class="tabbed-block">
<div class="language-json highlight"><pre><span></span><code><span id="__span-23-1"><span class="p">{</span>
</span><span id="__span-23-2"><span class="w">    </span><span class="nt">&quot;Condition&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ifCreateLambdas&quot;</span><span class="p">,</span>
</span><span id="__span-23-3"><span class="w">    </span><span class="nt">&quot;Properties&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-23-4"><span class="w">        </span><span class="nt">&quot;Description&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-23-5"><span class="w">            </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Policy for node stopping Lambda for ${realm} realm&quot;</span>
</span><span id="__span-23-6"><span class="w">        </span><span class="p">},</span>
</span><span id="__span-23-7"><span class="w">        </span><span class="nt">&quot;ManagedPolicyName&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-23-8"><span class="w">            </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;lava-${realm}-stop-lambda&quot;</span>
</span><span id="__span-23-9"><span class="w">        </span><span class="p">},</span>
</span><span id="__span-23-10"><span class="w">        </span><span class="nt">&quot;PolicyDocument&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-23-11"><span class="w">            </span><span class="nt">&quot;Statement&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-23-12"><span class="w">                </span><span class="p">{</span>
</span><span id="__span-23-13"><span class="w">                    </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-23-14"><span class="w">                        </span><span class="s2">&quot;logs:CreateLogGroup&quot;</span><span class="p">,</span>
</span><span id="__span-23-15"><span class="w">                        </span><span class="s2">&quot;logs:CreateLogStream&quot;</span><span class="p">,</span>
</span><span id="__span-23-16"><span class="w">                        </span><span class="s2">&quot;logs:PutLogEvents&quot;</span><span class="p">,</span>
</span><span id="__span-23-17"><span class="w">                        </span><span class="s2">&quot;logs:DescribeLogStreams&quot;</span>
</span><span id="__span-23-18"><span class="w">                    </span><span class="p">],</span>
</span><span id="__span-23-19"><span class="w">                    </span><span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
</span><span id="__span-23-20"><span class="w">                    </span><span class="nt">&quot;Resource&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;*&quot;</span><span class="p">,</span>
</span><span id="__span-23-21"><span class="w">                    </span><span class="nt">&quot;Sid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;LogToCloudWatch&quot;</span>
</span><span id="__span-23-22"><span class="w">                </span><span class="p">},</span>
</span><span id="__span-23-23"><span class="w">                </span><span class="p">{</span>
</span><span id="__span-23-24"><span class="w">                    </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-23-25"><span class="w">                        </span><span class="s2">&quot;ssm:SendCommand&quot;</span>
</span><span id="__span-23-26"><span class="w">                    </span><span class="p">],</span>
</span><span id="__span-23-27"><span class="w">                    </span><span class="nt">&quot;Condition&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-23-28"><span class="w">                        </span><span class="nt">&quot;StringLike&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-23-29"><span class="w">                            </span><span class="nt">&quot;ssm:resourceTag/LavaRealm&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-23-30"><span class="w">                                </span><span class="p">{</span>
</span><span id="__span-23-31"><span class="w">                                    </span><span class="nt">&quot;Ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;realm&quot;</span>
</span><span id="__span-23-32"><span class="w">                                </span><span class="p">}</span>
</span><span id="__span-23-33"><span class="w">                            </span><span class="p">]</span>
</span><span id="__span-23-34"><span class="w">                        </span><span class="p">}</span>
</span><span id="__span-23-35"><span class="w">                    </span><span class="p">},</span>
</span><span id="__span-23-36"><span class="w">                    </span><span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
</span><span id="__span-23-37"><span class="w">                    </span><span class="nt">&quot;Resource&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-23-38"><span class="w">                        </span><span class="s2">&quot;arn:aws:ec2:*:*:instance/*&quot;</span>
</span><span id="__span-23-39"><span class="w">                    </span><span class="p">],</span>
</span><span id="__span-23-40"><span class="w">                    </span><span class="nt">&quot;Sid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;SsmSendCommandToInstance&quot;</span>
</span><span id="__span-23-41"><span class="w">                </span><span class="p">},</span>
</span><span id="__span-23-42"><span class="w">                </span><span class="p">{</span>
</span><span id="__span-23-43"><span class="w">                    </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ssm:SendCommand&quot;</span><span class="p">,</span>
</span><span id="__span-23-44"><span class="w">                    </span><span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
</span><span id="__span-23-45"><span class="w">                    </span><span class="nt">&quot;Resource&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-23-46"><span class="w">                        </span><span class="p">{</span>
</span><span id="__span-23-47"><span class="w">                            </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;arn:aws:ssm:${AWS::Region}::document/AWS-RunShellScript&quot;</span>
</span><span id="__span-23-48"><span class="w">                        </span><span class="p">}</span>
</span><span id="__span-23-49"><span class="w">                    </span><span class="p">],</span>
</span><span id="__span-23-50"><span class="w">                    </span><span class="nt">&quot;Sid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;SsmSendCommandDocument&quot;</span>
</span><span id="__span-23-51"><span class="w">                </span><span class="p">},</span>
</span><span id="__span-23-52"><span class="w">                </span><span class="p">{</span>
</span><span id="__span-23-53"><span class="w">                    </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ec2:Describe*&quot;</span><span class="p">,</span>
</span><span id="__span-23-54"><span class="w">                    </span><span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
</span><span id="__span-23-55"><span class="w">                    </span><span class="nt">&quot;Resource&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;*&quot;</span>
</span><span id="__span-23-56"><span class="w">                </span><span class="p">}</span>
</span><span id="__span-23-57"><span class="w">            </span><span class="p">],</span>
</span><span id="__span-23-58"><span class="w">            </span><span class="nt">&quot;Version&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2012-10-17&quot;</span>
</span><span id="__span-23-59"><span class="w">        </span><span class="p">}</span>
</span><span id="__span-23-60"><span class="w">    </span><span class="p">},</span>
</span><span id="__span-23-61"><span class="w">    </span><span class="nt">&quot;Type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AWS::IAM::ManagedPolicy&quot;</span>
</span><span id="__span-23-62"><span class="p">}</span>
</span></code></pre></div>
</div>
</div>
</div>
<h4 id="iamlavastoplambdarole"><a href="#iam-resources">iamLavaStopLambdaRole</a><a class="headerlink" href="#iamlavastoplambdarole" title="Permanent link">&para;</a></h4>
<div class="tabbed-set tabbed-alternate" data-tabs="25:2"><input checked="checked" id="__tabbed_25_1" name="__tabbed_25" type="radio" /><input id="__tabbed_25_2" name="__tabbed_25" type="radio" /><div class="tabbed-labels"><label for="__tabbed_25_1">Details</label><label for="__tabbed_25_2">Source</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<table>
<thead>
<tr>
<th>Property</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Type</td>
<td><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-iam-role.html" title="AWS documentation for this resource type">AWS::IAM::Role</a></td>
</tr>
<tr>
<td>Group</td>
<td><a href="#iam-resources">IAM Resources</a> (<a href="#iam-resources">IAM</a>)</td>
</tr>
<tr>
<td>Description</td>
<td>IAM role for node stopper Lambda function.</td>
</tr>
</tbody>
</table>
</div>
<div class="tabbed-block">
<div class="language-json highlight"><pre><span></span><code><span id="__span-24-1"><span class="p">{</span>
</span><span id="__span-24-2"><span class="w">    </span><span class="nt">&quot;Condition&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ifCreateLambdas&quot;</span><span class="p">,</span>
</span><span id="__span-24-3"><span class="w">    </span><span class="nt">&quot;Properties&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-24-4"><span class="w">        </span><span class="nt">&quot;AssumeRolePolicyDocument&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-24-5"><span class="w">            </span><span class="nt">&quot;Statement&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-24-6"><span class="w">                </span><span class="p">{</span>
</span><span id="__span-24-7"><span class="w">                    </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;sts:AssumeRole&quot;</span><span class="p">,</span>
</span><span id="__span-24-8"><span class="w">                    </span><span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
</span><span id="__span-24-9"><span class="w">                    </span><span class="nt">&quot;Principal&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-24-10"><span class="w">                        </span><span class="nt">&quot;Service&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;lambda.amazonaws.com&quot;</span>
</span><span id="__span-24-11"><span class="w">                    </span><span class="p">}</span>
</span><span id="__span-24-12"><span class="w">                </span><span class="p">}</span>
</span><span id="__span-24-13"><span class="w">            </span><span class="p">],</span>
</span><span id="__span-24-14"><span class="w">            </span><span class="nt">&quot;Version&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2012-10-17&quot;</span>
</span><span id="__span-24-15"><span class="w">        </span><span class="p">},</span>
</span><span id="__span-24-16"><span class="w">        </span><span class="nt">&quot;ManagedPolicyArns&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-24-17"><span class="w">            </span><span class="p">{</span>
</span><span id="__span-24-18"><span class="w">                </span><span class="nt">&quot;Ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;iamLavaStopLambdaPolicy&quot;</span>
</span><span id="__span-24-19"><span class="w">            </span><span class="p">}</span>
</span><span id="__span-24-20"><span class="w">        </span><span class="p">],</span>
</span><span id="__span-24-21"><span class="w">        </span><span class="nt">&quot;RoleName&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-24-22"><span class="w">            </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;lava-${realm}-stop-lambda&quot;</span>
</span><span id="__span-24-23"><span class="w">        </span><span class="p">}</span>
</span><span id="__span-24-24"><span class="w">    </span><span class="p">},</span>
</span><span id="__span-24-25"><span class="w">    </span><span class="nt">&quot;Type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AWS::IAM::Role&quot;</span>
</span><span id="__span-24-26"><span class="p">}</span>
</span></code></pre></div>
</div>
</div>
</div>
<h4 id="iamlavaworkerpolicy"><a href="#iam-resources">iamLavaWorkerPolicy</a><a class="headerlink" href="#iamlavaworkerpolicy" title="Permanent link">&para;</a></h4>
<div class="tabbed-set tabbed-alternate" data-tabs="26:2"><input checked="checked" id="__tabbed_26_1" name="__tabbed_26" type="radio" /><input id="__tabbed_26_2" name="__tabbed_26" type="radio" /><div class="tabbed-labels"><label for="__tabbed_26_1">Details</label><label for="__tabbed_26_2">Source</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<table>
<thead>
<tr>
<th>Property</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Type</td>
<td><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-iam-managedpolicy.html" title="AWS documentation for this resource type">AWS::IAM::ManagedPolicy</a></td>
</tr>
<tr>
<td>Group</td>
<td><a href="#iam-resources">IAM Resources</a> (<a href="#iam-resources">IAM</a>)</td>
</tr>
<tr>
<td>Description</td>
<td>Worker policy for lava realm.</td>
</tr>
</tbody>
</table>
</div>
<div class="tabbed-block">
<div class="language-json highlight"><pre><span></span><code><span id="__span-25-1"><span class="p">{</span>
</span><span id="__span-25-2"><span class="w">    </span><span class="nt">&quot;Properties&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-25-3"><span class="w">        </span><span class="nt">&quot;Description&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-25-4"><span class="w">            </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Worker policy for lava realm ${realm}&quot;</span>
</span><span id="__span-25-5"><span class="w">        </span><span class="p">},</span>
</span><span id="__span-25-6"><span class="w">        </span><span class="nt">&quot;ManagedPolicyName&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-25-7"><span class="w">            </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;lava-${realm}-worker&quot;</span>
</span><span id="__span-25-8"><span class="w">        </span><span class="p">},</span>
</span><span id="__span-25-9"><span class="w">        </span><span class="nt">&quot;PolicyDocument&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-25-10"><span class="w">            </span><span class="nt">&quot;Statement&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-25-11"><span class="w">                </span><span class="p">{</span>
</span><span id="__span-25-12"><span class="w">                    </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;s3:ListAllMyBuckets&quot;</span><span class="p">,</span>
</span><span id="__span-25-13"><span class="w">                    </span><span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
</span><span id="__span-25-14"><span class="w">                    </span><span class="nt">&quot;Resource&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;*&quot;</span><span class="p">,</span>
</span><span id="__span-25-15"><span class="w">                    </span><span class="nt">&quot;Sid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ListAllBuckets&quot;</span>
</span><span id="__span-25-16"><span class="w">                </span><span class="p">},</span>
</span><span id="__span-25-17"><span class="w">                </span><span class="p">{</span>
</span><span id="__span-25-18"><span class="w">                    </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-25-19"><span class="w">                        </span><span class="s2">&quot;s3:ListBucket&quot;</span>
</span><span id="__span-25-20"><span class="w">                    </span><span class="p">],</span>
</span><span id="__span-25-21"><span class="w">                    </span><span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
</span><span id="__span-25-22"><span class="w">                    </span><span class="nt">&quot;Resource&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-25-23"><span class="w">                        </span><span class="p">{</span>
</span><span id="__span-25-24"><span class="w">                            </span><span class="nt">&quot;Fn::GetAtt&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-25-25"><span class="w">                                </span><span class="s2">&quot;s3LavaBucket&quot;</span><span class="p">,</span>
</span><span id="__span-25-26"><span class="w">                                </span><span class="s2">&quot;Arn&quot;</span>
</span><span id="__span-25-27"><span class="w">                            </span><span class="p">]</span>
</span><span id="__span-25-28"><span class="w">                        </span><span class="p">}</span>
</span><span id="__span-25-29"><span class="w">                    </span><span class="p">],</span>
</span><span id="__span-25-30"><span class="w">                    </span><span class="nt">&quot;Sid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;GetLavaBucketInfo&quot;</span>
</span><span id="__span-25-31"><span class="w">                </span><span class="p">},</span>
</span><span id="__span-25-32"><span class="w">                </span><span class="p">{</span>
</span><span id="__span-25-33"><span class="w">                    </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-25-34"><span class="w">                        </span><span class="s2">&quot;s3:GetObject*&quot;</span>
</span><span id="__span-25-35"><span class="w">                    </span><span class="p">],</span>
</span><span id="__span-25-36"><span class="w">                    </span><span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
</span><span id="__span-25-37"><span class="w">                    </span><span class="nt">&quot;Resource&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-25-38"><span class="w">                        </span><span class="p">{</span>
</span><span id="__span-25-39"><span class="w">                            </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;arn:aws:s3:::${s3LavaBucket}/*&quot;</span>
</span><span id="__span-25-40"><span class="w">                        </span><span class="p">}</span>
</span><span id="__span-25-41"><span class="w">                    </span><span class="p">],</span>
</span><span id="__span-25-42"><span class="w">                    </span><span class="nt">&quot;Sid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ReadLavaBucket&quot;</span>
</span><span id="__span-25-43"><span class="w">                </span><span class="p">},</span>
</span><span id="__span-25-44"><span class="w">                </span><span class="p">{</span>
</span><span id="__span-25-45"><span class="w">                    </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;s3:PutObject&quot;</span><span class="p">,</span>
</span><span id="__span-25-46"><span class="w">                    </span><span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
</span><span id="__span-25-47"><span class="w">                    </span><span class="nt">&quot;Resource&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-25-48"><span class="w">                        </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;arn:aws:s3:::${s3LavaBucket}/tmp/*&quot;</span>
</span><span id="__span-25-49"><span class="w">                    </span><span class="p">},</span>
</span><span id="__span-25-50"><span class="w">                    </span><span class="nt">&quot;Sid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;WriteLavaBucketTmp&quot;</span>
</span><span id="__span-25-51"><span class="w">                </span><span class="p">},</span>
</span><span id="__span-25-52"><span class="w">                </span><span class="p">{</span>
</span><span id="__span-25-53"><span class="w">                    </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-25-54"><span class="w">                        </span><span class="s2">&quot;s3:ListBucket&quot;</span>
</span><span id="__span-25-55"><span class="w">                    </span><span class="p">],</span>
</span><span id="__span-25-56"><span class="w">                    </span><span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
</span><span id="__span-25-57"><span class="w">                    </span><span class="nt">&quot;Resource&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-25-58"><span class="w">                        </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;arn:aws:s3:::${s3CodeBucket}&quot;</span>
</span><span id="__span-25-59"><span class="w">                    </span><span class="p">},</span>
</span><span id="__span-25-60"><span class="w">                    </span><span class="nt">&quot;Sid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;GetCodeBucketInfo&quot;</span>
</span><span id="__span-25-61"><span class="w">                </span><span class="p">},</span>
</span><span id="__span-25-62"><span class="w">                </span><span class="p">{</span>
</span><span id="__span-25-63"><span class="w">                    </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;s3:GetObject*&quot;</span><span class="p">,</span>
</span><span id="__span-25-64"><span class="w">                    </span><span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
</span><span id="__span-25-65"><span class="w">                    </span><span class="nt">&quot;Resource&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-25-66"><span class="w">                        </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;arn:aws:s3:::${s3CodeBucket}/${s3CodePrefix}/*&quot;</span>
</span><span id="__span-25-67"><span class="w">                    </span><span class="p">},</span>
</span><span id="__span-25-68"><span class="w">                    </span><span class="nt">&quot;Sid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ReadCodeBucket&quot;</span>
</span><span id="__span-25-69"><span class="w">                </span><span class="p">},</span>
</span><span id="__span-25-70"><span class="w">                </span><span class="p">{</span>
</span><span id="__span-25-71"><span class="w">                    </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;sqs:ListQueues&quot;</span><span class="p">,</span>
</span><span id="__span-25-72"><span class="w">                    </span><span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
</span><span id="__span-25-73"><span class="w">                    </span><span class="nt">&quot;Resource&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;*&quot;</span><span class="p">,</span>
</span><span id="__span-25-74"><span class="w">                    </span><span class="nt">&quot;Sid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ListSqsQueues&quot;</span>
</span><span id="__span-25-75"><span class="w">                </span><span class="p">},</span>
</span><span id="__span-25-76"><span class="w">                </span><span class="p">{</span>
</span><span id="__span-25-77"><span class="w">                    </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-25-78"><span class="w">                        </span><span class="s2">&quot;sqs:DeleteMessage&quot;</span><span class="p">,</span>
</span><span id="__span-25-79"><span class="w">                        </span><span class="s2">&quot;sqs:GetQueueUrl&quot;</span><span class="p">,</span>
</span><span id="__span-25-80"><span class="w">                        </span><span class="s2">&quot;sqs:GetQueueAttributes&quot;</span><span class="p">,</span>
</span><span id="__span-25-81"><span class="w">                        </span><span class="s2">&quot;sqs:ReceiveMessage&quot;</span><span class="p">,</span>
</span><span id="__span-25-82"><span class="w">                        </span><span class="s2">&quot;sqs:SendMessage&quot;</span>
</span><span id="__span-25-83"><span class="w">                    </span><span class="p">],</span>
</span><span id="__span-25-84"><span class="w">                    </span><span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
</span><span id="__span-25-85"><span class="w">                    </span><span class="nt">&quot;Resource&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-25-86"><span class="w">                        </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;arn:aws:sqs:${AWS::Region}:${AWS::AccountId}:lava-${realm}-*&quot;</span>
</span><span id="__span-25-87"><span class="w">                    </span><span class="p">},</span>
</span><span id="__span-25-88"><span class="w">                    </span><span class="nt">&quot;Sid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AccessSqsQueues&quot;</span>
</span><span id="__span-25-89"><span class="w">                </span><span class="p">},</span>
</span><span id="__span-25-90"><span class="w">                </span><span class="p">{</span>
</span><span id="__span-25-91"><span class="w">                    </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-25-92"><span class="w">                        </span><span class="s2">&quot;ssm:GetParameter&quot;</span><span class="p">,</span>
</span><span id="__span-25-93"><span class="w">                        </span><span class="s2">&quot;ssm:GetParameters&quot;</span>
</span><span id="__span-25-94"><span class="w">                    </span><span class="p">],</span>
</span><span id="__span-25-95"><span class="w">                    </span><span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
</span><span id="__span-25-96"><span class="w">                    </span><span class="nt">&quot;Resource&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-25-97"><span class="w">                        </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;arn:aws:ssm:${AWS::Region}:${AWS::AccountId}:parameter/lava/${realm}/*&quot;</span>
</span><span id="__span-25-98"><span class="w">                    </span><span class="p">},</span>
</span><span id="__span-25-99"><span class="w">                    </span><span class="nt">&quot;Sid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ReadSsmParams&quot;</span>
</span><span id="__span-25-100"><span class="w">                </span><span class="p">},</span>
</span><span id="__span-25-101"><span class="w">                </span><span class="p">{</span>
</span><span id="__span-25-102"><span class="w">                    </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-25-103"><span class="w">                        </span><span class="s2">&quot;secretsmanager:DescribeSecret&quot;</span><span class="p">,</span>
</span><span id="__span-25-104"><span class="w">                        </span><span class="s2">&quot;secretsmanager:GetSecretValue&quot;</span><span class="p">,</span>
</span><span id="__span-25-105"><span class="w">                        </span><span class="s2">&quot;secretsmanager:ListSecretVersionIds&quot;</span>
</span><span id="__span-25-106"><span class="w">                    </span><span class="p">],</span>
</span><span id="__span-25-107"><span class="w">                    </span><span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
</span><span id="__span-25-108"><span class="w">                    </span><span class="nt">&quot;Resource&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-25-109"><span class="w">                        </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;arn:aws:secretsmanager:${AWS::Region}:${AWS::AccountId}:secret:/lava/${realm}/*&quot;</span>
</span><span id="__span-25-110"><span class="w">                    </span><span class="p">},</span>
</span><span id="__span-25-111"><span class="w">                    </span><span class="nt">&quot;Sid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ReadSecrets&quot;</span>
</span><span id="__span-25-112"><span class="w">                </span><span class="p">},</span>
</span><span id="__span-25-113"><span class="w">                </span><span class="p">{</span>
</span><span id="__span-25-114"><span class="w">                    </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-25-115"><span class="w">                        </span><span class="s2">&quot;dynamodb:GetItem&quot;</span><span class="p">,</span>
</span><span id="__span-25-116"><span class="w">                        </span><span class="s2">&quot;dynamodb:Query&quot;</span><span class="p">,</span>
</span><span id="__span-25-117"><span class="w">                        </span><span class="s2">&quot;dynamodb:Scan&quot;</span>
</span><span id="__span-25-118"><span class="w">                    </span><span class="p">],</span>
</span><span id="__span-25-119"><span class="w">                    </span><span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
</span><span id="__span-25-120"><span class="w">                    </span><span class="nt">&quot;Resource&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-25-121"><span class="w">                        </span><span class="p">{</span>
</span><span id="__span-25-122"><span class="w">                            </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;arn:aws:dynamodb:${AWS::Region}:${AWS::AccountId}:table/lava.realms&quot;</span>
</span><span id="__span-25-123"><span class="w">                        </span><span class="p">},</span>
</span><span id="__span-25-124"><span class="w">                        </span><span class="p">{</span>
</span><span id="__span-25-125"><span class="w">                            </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;arn:aws:dynamodb:${AWS::Region}:${AWS::AccountId}:table/lava.${realm}.*&quot;</span>
</span><span id="__span-25-126"><span class="w">                        </span><span class="p">},</span>
</span><span id="__span-25-127"><span class="w">                        </span><span class="p">{</span>
</span><span id="__span-25-128"><span class="w">                            </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;arn:aws:dynamodb:${AWS::Region}:${AWS::AccountId}:table/lava.${realm}.jobs/index/*&quot;</span>
</span><span id="__span-25-129"><span class="w">                        </span><span class="p">},</span>
</span><span id="__span-25-130"><span class="w">                        </span><span class="p">{</span>
</span><span id="__span-25-131"><span class="w">                            </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;arn:aws:dynamodb:${AWS::Region}:${AWS::AccountId}:table/lava.${realm}.events/index/*&quot;</span>
</span><span id="__span-25-132"><span class="w">                        </span><span class="p">}</span>
</span><span id="__span-25-133"><span class="w">                    </span><span class="p">],</span>
</span><span id="__span-25-134"><span class="w">                    </span><span class="nt">&quot;Sid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AccessDynamoDBLavaTables&quot;</span>
</span><span id="__span-25-135"><span class="w">                </span><span class="p">},</span>
</span><span id="__span-25-136"><span class="w">                </span><span class="p">{</span>
</span><span id="__span-25-137"><span class="w">                    </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-25-138"><span class="w">                        </span><span class="s2">&quot;dynamodb:BatchWriteItem&quot;</span><span class="p">,</span>
</span><span id="__span-25-139"><span class="w">                        </span><span class="s2">&quot;dynamodb:PutItem&quot;</span><span class="p">,</span>
</span><span id="__span-25-140"><span class="w">                        </span><span class="s2">&quot;dynamodb:UpdateItem&quot;</span>
</span><span id="__span-25-141"><span class="w">                    </span><span class="p">],</span>
</span><span id="__span-25-142"><span class="w">                    </span><span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
</span><span id="__span-25-143"><span class="w">                    </span><span class="nt">&quot;Resource&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-25-144"><span class="w">                        </span><span class="p">{</span>
</span><span id="__span-25-145"><span class="w">                            </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;arn:aws:dynamodb:${AWS::Region}:${AWS::AccountId}:table/lava.${realm}.events&quot;</span>
</span><span id="__span-25-146"><span class="w">                        </span><span class="p">},</span>
</span><span id="__span-25-147"><span class="w">                        </span><span class="p">{</span>
</span><span id="__span-25-148"><span class="w">                            </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;arn:aws:dynamodb:${AWS::Region}:${AWS::AccountId}:table/lava.${realm}.events/index/*&quot;</span>
</span><span id="__span-25-149"><span class="w">                        </span><span class="p">},</span>
</span><span id="__span-25-150"><span class="w">                        </span><span class="p">{</span>
</span><span id="__span-25-151"><span class="w">                            </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;arn:aws:dynamodb:${AWS::Region}:${AWS::AccountId}:table/lava.${realm}.state&quot;</span>
</span><span id="__span-25-152"><span class="w">                        </span><span class="p">}</span>
</span><span id="__span-25-153"><span class="w">                    </span><span class="p">],</span>
</span><span id="__span-25-154"><span class="w">                    </span><span class="nt">&quot;Sid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;WriteDynamoDBLavaTables&quot;</span>
</span><span id="__span-25-155"><span class="w">                </span><span class="p">},</span>
</span><span id="__span-25-156"><span class="w">                </span><span class="p">{</span>
</span><span id="__span-25-157"><span class="w">                    </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;cloudwatch:PutMetricData&quot;</span><span class="p">,</span>
</span><span id="__span-25-158"><span class="w">                    </span><span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
</span><span id="__span-25-159"><span class="w">                    </span><span class="nt">&quot;Resource&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;*&quot;</span><span class="p">,</span>
</span><span id="__span-25-160"><span class="w">                    </span><span class="nt">&quot;Sid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;PutCloudWatchMetricData&quot;</span>
</span><span id="__span-25-161"><span class="w">                </span><span class="p">},</span>
</span><span id="__span-25-162"><span class="w">                </span><span class="p">{</span>
</span><span id="__span-25-163"><span class="w">                    </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-25-164"><span class="w">                        </span><span class="s2">&quot;logs:CreateLogGroup&quot;</span><span class="p">,</span>
</span><span id="__span-25-165"><span class="w">                        </span><span class="s2">&quot;logs:CreateLogStream&quot;</span><span class="p">,</span>
</span><span id="__span-25-166"><span class="w">                        </span><span class="s2">&quot;logs:PutLogEvents&quot;</span><span class="p">,</span>
</span><span id="__span-25-167"><span class="w">                        </span><span class="s2">&quot;logs:DescribeLogGroups&quot;</span><span class="p">,</span>
</span><span id="__span-25-168"><span class="w">                        </span><span class="s2">&quot;logs:DescribeLogStreams&quot;</span>
</span><span id="__span-25-169"><span class="w">                    </span><span class="p">],</span>
</span><span id="__span-25-170"><span class="w">                    </span><span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
</span><span id="__span-25-171"><span class="w">                    </span><span class="nt">&quot;Resource&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;*&quot;</span><span class="p">,</span>
</span><span id="__span-25-172"><span class="w">                    </span><span class="nt">&quot;Sid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;LogToCloudWatch&quot;</span>
</span><span id="__span-25-173"><span class="w">                </span><span class="p">},</span>
</span><span id="__span-25-174"><span class="w">                </span><span class="p">{</span>
</span><span id="__span-25-175"><span class="w">                    </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-25-176"><span class="w">                        </span><span class="s2">&quot;iam:ListUsers&quot;</span><span class="p">,</span>
</span><span id="__span-25-177"><span class="w">                        </span><span class="s2">&quot;iam:GetGroup&quot;</span>
</span><span id="__span-25-178"><span class="w">                    </span><span class="p">],</span>
</span><span id="__span-25-179"><span class="w">                    </span><span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
</span><span id="__span-25-180"><span class="w">                    </span><span class="nt">&quot;Resource&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;*&quot;</span><span class="p">,</span>
</span><span id="__span-25-181"><span class="w">                    </span><span class="nt">&quot;Sid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;iamLimitedRead&quot;</span>
</span><span id="__span-25-182"><span class="w">                </span><span class="p">},</span>
</span><span id="__span-25-183"><span class="w">                </span><span class="p">{</span>
</span><span id="__span-25-184"><span class="w">                    </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-25-185"><span class="w">                        </span><span class="s2">&quot;iam:ListSSHPublicKeys&quot;</span><span class="p">,</span>
</span><span id="__span-25-186"><span class="w">                        </span><span class="s2">&quot;iam:GetSSHPublicKey&quot;</span>
</span><span id="__span-25-187"><span class="w">                    </span><span class="p">],</span>
</span><span id="__span-25-188"><span class="w">                    </span><span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
</span><span id="__span-25-189"><span class="w">                    </span><span class="nt">&quot;Resource&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;*&quot;</span><span class="p">,</span>
</span><span id="__span-25-190"><span class="w">                    </span><span class="nt">&quot;Sid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;iamGetSshPublicKeys&quot;</span>
</span><span id="__span-25-191"><span class="w">                </span><span class="p">},</span>
</span><span id="__span-25-192"><span class="w">                </span><span class="p">{</span>
</span><span id="__span-25-193"><span class="w">                    </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;sns:Publish&quot;</span><span class="p">,</span>
</span><span id="__span-25-194"><span class="w">                    </span><span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
</span><span id="__span-25-195"><span class="w">                    </span><span class="nt">&quot;Resource&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-25-196"><span class="w">                        </span><span class="p">{</span>
</span><span id="__span-25-197"><span class="w">                            </span><span class="nt">&quot;Ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;snsLavaNotices&quot;</span>
</span><span id="__span-25-198"><span class="w">                        </span><span class="p">},</span>
</span><span id="__span-25-199"><span class="w">                        </span><span class="p">{</span>
</span><span id="__span-25-200"><span class="w">                            </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;arn:aws:sns:${AWS::Region}:${AWS::AccountId}:mbot&quot;</span>
</span><span id="__span-25-201"><span class="w">                        </span><span class="p">}</span>
</span><span id="__span-25-202"><span class="w">                    </span><span class="p">],</span>
</span><span id="__span-25-203"><span class="w">                    </span><span class="nt">&quot;Sid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;PublishSNS&quot;</span>
</span><span id="__span-25-204"><span class="w">                </span><span class="p">},</span>
</span><span id="__span-25-205"><span class="w">                </span><span class="p">{</span>
</span><span id="__span-25-206"><span class="w">                    </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ec2:Describe*&quot;</span><span class="p">,</span>
</span><span id="__span-25-207"><span class="w">                    </span><span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
</span><span id="__span-25-208"><span class="w">                    </span><span class="nt">&quot;Resource&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;*&quot;</span><span class="p">,</span>
</span><span id="__span-25-209"><span class="w">                    </span><span class="nt">&quot;Sid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;DescribeEc2&quot;</span>
</span><span id="__span-25-210"><span class="w">                </span><span class="p">},</span>
</span><span id="__span-25-211"><span class="w">                </span><span class="p">{</span>
</span><span id="__span-25-212"><span class="w">                    </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-25-213"><span class="w">                        </span><span class="s2">&quot;ses:SendEmail&quot;</span><span class="p">,</span>
</span><span id="__span-25-214"><span class="w">                        </span><span class="s2">&quot;ses:SendRawEmail&quot;</span><span class="p">,</span>
</span><span id="__span-25-215"><span class="w">                        </span><span class="s2">&quot;ses:ListIdentities&quot;</span>
</span><span id="__span-25-216"><span class="w">                    </span><span class="p">],</span>
</span><span id="__span-25-217"><span class="w">                    </span><span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
</span><span id="__span-25-218"><span class="w">                    </span><span class="nt">&quot;Resource&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;*&quot;</span><span class="p">,</span>
</span><span id="__span-25-219"><span class="w">                    </span><span class="nt">&quot;Sid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;SendSesEmail&quot;</span>
</span><span id="__span-25-220"><span class="w">                </span><span class="p">},</span>
</span><span id="__span-25-221"><span class="w">                </span><span class="p">{</span>
</span><span id="__span-25-222"><span class="w">                    </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-25-223"><span class="w">                        </span><span class="s2">&quot;kms:Decrypt&quot;</span>
</span><span id="__span-25-224"><span class="w">                    </span><span class="p">],</span>
</span><span id="__span-25-225"><span class="w">                    </span><span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
</span><span id="__span-25-226"><span class="w">                    </span><span class="nt">&quot;Resource&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-25-227"><span class="w">                        </span><span class="nt">&quot;Fn::GetAtt&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-25-228"><span class="w">                            </span><span class="s2">&quot;kmsSysKey&quot;</span><span class="p">,</span>
</span><span id="__span-25-229"><span class="w">                            </span><span class="s2">&quot;Arn&quot;</span>
</span><span id="__span-25-230"><span class="w">                        </span><span class="p">]</span>
</span><span id="__span-25-231"><span class="w">                    </span><span class="p">},</span>
</span><span id="__span-25-232"><span class="w">                    </span><span class="nt">&quot;Sid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;UseKmsSysKey&quot;</span>
</span><span id="__span-25-233"><span class="w">                </span><span class="p">},</span>
</span><span id="__span-25-234"><span class="w">                </span><span class="p">{</span>
</span><span id="__span-25-235"><span class="w">                    </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-25-236"><span class="w">                        </span><span class="s2">&quot;kms:Decrypt&quot;</span><span class="p">,</span>
</span><span id="__span-25-237"><span class="w">                        </span><span class="s2">&quot;kms:Encrypt&quot;</span><span class="p">,</span>
</span><span id="__span-25-238"><span class="w">                        </span><span class="s2">&quot;kms:GenerateDataKey*&quot;</span>
</span><span id="__span-25-239"><span class="w">                    </span><span class="p">],</span>
</span><span id="__span-25-240"><span class="w">                    </span><span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
</span><span id="__span-25-241"><span class="w">                    </span><span class="nt">&quot;Resource&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-25-242"><span class="w">                        </span><span class="nt">&quot;Fn::GetAtt&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-25-243"><span class="w">                            </span><span class="s2">&quot;kmsUserKey&quot;</span><span class="p">,</span>
</span><span id="__span-25-244"><span class="w">                            </span><span class="s2">&quot;Arn&quot;</span>
</span><span id="__span-25-245"><span class="w">                        </span><span class="p">]</span>
</span><span id="__span-25-246"><span class="w">                    </span><span class="p">},</span>
</span><span id="__span-25-247"><span class="w">                    </span><span class="nt">&quot;Sid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;UseKmsUserKey&quot;</span>
</span><span id="__span-25-248"><span class="w">                </span><span class="p">},</span>
</span><span id="__span-25-249"><span class="w">                </span><span class="p">{</span>
</span><span id="__span-25-250"><span class="w">                    </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ecr:GetAuthorizationToken&quot;</span><span class="p">,</span>
</span><span id="__span-25-251"><span class="w">                    </span><span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
</span><span id="__span-25-252"><span class="w">                    </span><span class="nt">&quot;Resource&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;*&quot;</span><span class="p">,</span>
</span><span id="__span-25-253"><span class="w">                    </span><span class="nt">&quot;Sid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;getEcrAuthToken&quot;</span>
</span><span id="__span-25-254"><span class="w">                </span><span class="p">},</span>
</span><span id="__span-25-255"><span class="w">                </span><span class="p">{</span>
</span><span id="__span-25-256"><span class="w">                    </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-25-257"><span class="w">                        </span><span class="s2">&quot;ecr:GetLifecyclePolicyPreview&quot;</span><span class="p">,</span>
</span><span id="__span-25-258"><span class="w">                        </span><span class="s2">&quot;ecr:GetDownloadUrlForLayer&quot;</span><span class="p">,</span>
</span><span id="__span-25-259"><span class="w">                        </span><span class="s2">&quot;ecr:BatchGetImage&quot;</span><span class="p">,</span>
</span><span id="__span-25-260"><span class="w">                        </span><span class="s2">&quot;ecr:DescribeImages&quot;</span><span class="p">,</span>
</span><span id="__span-25-261"><span class="w">                        </span><span class="s2">&quot;ecr:DescribeRepositories&quot;</span><span class="p">,</span>
</span><span id="__span-25-262"><span class="w">                        </span><span class="s2">&quot;ecr:ListTagsForResource&quot;</span><span class="p">,</span>
</span><span id="__span-25-263"><span class="w">                        </span><span class="s2">&quot;ecr:ListImages&quot;</span><span class="p">,</span>
</span><span id="__span-25-264"><span class="w">                        </span><span class="s2">&quot;ecr:BatchCheckLayerAvailability&quot;</span><span class="p">,</span>
</span><span id="__span-25-265"><span class="w">                        </span><span class="s2">&quot;ecr:GetLifecyclePolicy&quot;</span><span class="p">,</span>
</span><span id="__span-25-266"><span class="w">                        </span><span class="s2">&quot;ecr:GetRepositoryPolicy&quot;</span>
</span><span id="__span-25-267"><span class="w">                    </span><span class="p">],</span>
</span><span id="__span-25-268"><span class="w">                    </span><span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
</span><span id="__span-25-269"><span class="w">                    </span><span class="nt">&quot;Resource&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-25-270"><span class="w">                        </span><span class="p">{</span>
</span><span id="__span-25-271"><span class="w">                            </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;arn:aws:ecr:${AWS::Region}:${AWS::AccountId}:repository/dist/lava/*&quot;</span>
</span><span id="__span-25-272"><span class="w">                        </span><span class="p">},</span>
</span><span id="__span-25-273"><span class="w">                        </span><span class="p">{</span>
</span><span id="__span-25-274"><span class="w">                            </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;arn:aws:ecr:${AWS::Region}:${AWS::AccountId}:repository/lava/${realm}/*&quot;</span>
</span><span id="__span-25-275"><span class="w">                        </span><span class="p">}</span>
</span><span id="__span-25-276"><span class="w">                    </span><span class="p">],</span>
</span><span id="__span-25-277"><span class="w">                    </span><span class="nt">&quot;Sid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ReadEcrLavaRepos&quot;</span>
</span><span id="__span-25-278"><span class="w">                </span><span class="p">},</span>
</span><span id="__span-25-279"><span class="w">                </span><span class="p">{</span>
</span><span id="__span-25-280"><span class="w">                    </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-25-281"><span class="w">                        </span><span class="s2">&quot;autoscaling:CompleteLifecycleAction&quot;</span><span class="p">,</span>
</span><span id="__span-25-282"><span class="w">                        </span><span class="s2">&quot;autoscaling:RecordLifecycleActionHeartbeat&quot;</span>
</span><span id="__span-25-283"><span class="w">                    </span><span class="p">],</span>
</span><span id="__span-25-284"><span class="w">                    </span><span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
</span><span id="__span-25-285"><span class="w">                    </span><span class="nt">&quot;Resource&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-25-286"><span class="w">                        </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;arn:aws:autoscaling:${AWS::Region}:${AWS::AccountId}:autoScalingGroup:*:autoScalingGroupName/lava-${realm}-*&quot;</span>
</span><span id="__span-25-287"><span class="w">                    </span><span class="p">},</span>
</span><span id="__span-25-288"><span class="w">                    </span><span class="nt">&quot;Sid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AutoscalingLifecycleMgmt&quot;</span>
</span><span id="__span-25-289"><span class="w">                </span><span class="p">},</span>
</span><span id="__span-25-290"><span class="w">                </span><span class="p">{</span>
</span><span id="__span-25-291"><span class="w">                    </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-25-292"><span class="w">                        </span><span class="s2">&quot;events:PutEvents&quot;</span>
</span><span id="__span-25-293"><span class="w">                    </span><span class="p">],</span>
</span><span id="__span-25-294"><span class="w">                    </span><span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
</span><span id="__span-25-295"><span class="w">                    </span><span class="nt">&quot;Resource&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-25-296"><span class="w">                        </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;arn:aws:events:${AWS::Region}:${AWS::AccountId}:event-bus/default&quot;</span>
</span><span id="__span-25-297"><span class="w">                    </span><span class="p">},</span>
</span><span id="__span-25-298"><span class="w">                    </span><span class="nt">&quot;Sid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;PutEvents&quot;</span>
</span><span id="__span-25-299"><span class="w">                </span><span class="p">}</span>
</span><span id="__span-25-300"><span class="w">            </span><span class="p">],</span>
</span><span id="__span-25-301"><span class="w">            </span><span class="nt">&quot;Version&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2012-10-17&quot;</span>
</span><span id="__span-25-302"><span class="w">        </span><span class="p">}</span>
</span><span id="__span-25-303"><span class="w">    </span><span class="p">},</span>
</span><span id="__span-25-304"><span class="w">    </span><span class="nt">&quot;Type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AWS::IAM::ManagedPolicy&quot;</span>
</span><span id="__span-25-305"><span class="p">}</span>
</span></code></pre></div>
</div>
</div>
</div>
<h4 id="kmssysalias"><a href="#kms-resources">kmsSysAlias</a><a class="headerlink" href="#kmssysalias" title="Permanent link">&para;</a></h4>
<div class="tabbed-set tabbed-alternate" data-tabs="27:2"><input checked="checked" id="__tabbed_27_1" name="__tabbed_27" type="radio" /><input id="__tabbed_27_2" name="__tabbed_27" type="radio" /><div class="tabbed-labels"><label for="__tabbed_27_1">Details</label><label for="__tabbed_27_2">Source</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<table>
<thead>
<tr>
<th>Property</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Type</td>
<td><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-kms-alias.html" title="AWS documentation for this resource type">AWS::KMS::Alias</a></td>
</tr>
<tr>
<td>Group</td>
<td><a href="#kms-resources">KMS Resources</a> (<a href="#kms-resources">KMS</a>)</td>
</tr>
<tr>
<td>Description</td>
<td>System KMS key alias for lava realm.</td>
</tr>
</tbody>
</table>
</div>
<div class="tabbed-block">
<div class="language-json highlight"><pre><span></span><code><span id="__span-26-1"><span class="p">{</span>
</span><span id="__span-26-2"><span class="w">    </span><span class="nt">&quot;Properties&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-26-3"><span class="w">        </span><span class="nt">&quot;AliasName&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-26-4"><span class="w">            </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;alias/lava-${realm}-sys&quot;</span>
</span><span id="__span-26-5"><span class="w">        </span><span class="p">},</span>
</span><span id="__span-26-6"><span class="w">        </span><span class="nt">&quot;TargetKeyId&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-26-7"><span class="w">            </span><span class="nt">&quot;Ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;kmsSysKey&quot;</span>
</span><span id="__span-26-8"><span class="w">        </span><span class="p">}</span>
</span><span id="__span-26-9"><span class="w">    </span><span class="p">},</span>
</span><span id="__span-26-10"><span class="w">    </span><span class="nt">&quot;Type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AWS::KMS::Alias&quot;</span>
</span><span id="__span-26-11"><span class="p">}</span>
</span></code></pre></div>
</div>
</div>
</div>
<h4 id="kmssyskey"><a href="#kms-resources">kmsSysKey</a><a class="headerlink" href="#kmssyskey" title="Permanent link">&para;</a></h4>
<div class="tabbed-set tabbed-alternate" data-tabs="28:2"><input checked="checked" id="__tabbed_28_1" name="__tabbed_28" type="radio" /><input id="__tabbed_28_2" name="__tabbed_28" type="radio" /><div class="tabbed-labels"><label for="__tabbed_28_1">Details</label><label for="__tabbed_28_2">Source</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<table>
<thead>
<tr>
<th>Property</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Type</td>
<td><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-kms-key.html" title="AWS documentation for this resource type">AWS::KMS::Key</a></td>
</tr>
<tr>
<td>Group</td>
<td><a href="#kms-resources">KMS Resources</a> (<a href="#kms-resources">KMS</a>)</td>
</tr>
<tr>
<td>Description</td>
<td>System KMS key for lava realm.</td>
</tr>
</tbody>
</table>
</div>
<div class="tabbed-block">
<div class="language-json highlight"><pre><span></span><code><span id="__span-27-1"><span class="p">{</span>
</span><span id="__span-27-2"><span class="w">    </span><span class="nt">&quot;Properties&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-27-3"><span class="w">        </span><span class="nt">&quot;Description&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-27-4"><span class="w">            </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;System key for lava realm ${realm}&quot;</span>
</span><span id="__span-27-5"><span class="w">        </span><span class="p">},</span>
</span><span id="__span-27-6"><span class="w">        </span><span class="nt">&quot;EnableKeyRotation&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-27-7"><span class="w">        </span><span class="nt">&quot;Enabled&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-27-8"><span class="w">        </span><span class="nt">&quot;KeyPolicy&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-27-9"><span class="w">            </span><span class="nt">&quot;Id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;key-consolepolicy-3&quot;</span><span class="p">,</span>
</span><span id="__span-27-10"><span class="w">            </span><span class="nt">&quot;Statement&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-27-11"><span class="w">                </span><span class="p">{</span>
</span><span id="__span-27-12"><span class="w">                    </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;kms:*&quot;</span><span class="p">,</span>
</span><span id="__span-27-13"><span class="w">                    </span><span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
</span><span id="__span-27-14"><span class="w">                    </span><span class="nt">&quot;Principal&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-27-15"><span class="w">                        </span><span class="nt">&quot;AWS&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-27-16"><span class="w">                            </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;arn:aws:iam::${AWS::AccountId}:root&quot;</span>
</span><span id="__span-27-17"><span class="w">                        </span><span class="p">}</span>
</span><span id="__span-27-18"><span class="w">                    </span><span class="p">},</span>
</span><span id="__span-27-19"><span class="w">                    </span><span class="nt">&quot;Resource&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;*&quot;</span><span class="p">,</span>
</span><span id="__span-27-20"><span class="w">                    </span><span class="nt">&quot;Sid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Enable IAM User Permissions&quot;</span>
</span><span id="__span-27-21"><span class="w">                </span><span class="p">},</span>
</span><span id="__span-27-22"><span class="w">                </span><span class="p">{</span>
</span><span id="__span-27-23"><span class="w">                    </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-27-24"><span class="w">                        </span><span class="s2">&quot;kms:Create*&quot;</span><span class="p">,</span>
</span><span id="__span-27-25"><span class="w">                        </span><span class="s2">&quot;kms:Describe*&quot;</span><span class="p">,</span>
</span><span id="__span-27-26"><span class="w">                        </span><span class="s2">&quot;kms:Enable*&quot;</span><span class="p">,</span>
</span><span id="__span-27-27"><span class="w">                        </span><span class="s2">&quot;kms:List*&quot;</span><span class="p">,</span>
</span><span id="__span-27-28"><span class="w">                        </span><span class="s2">&quot;kms:Put*&quot;</span><span class="p">,</span>
</span><span id="__span-27-29"><span class="w">                        </span><span class="s2">&quot;kms:Update*&quot;</span><span class="p">,</span>
</span><span id="__span-27-30"><span class="w">                        </span><span class="s2">&quot;kms:Revoke*&quot;</span><span class="p">,</span>
</span><span id="__span-27-31"><span class="w">                        </span><span class="s2">&quot;kms:Disable*&quot;</span><span class="p">,</span>
</span><span id="__span-27-32"><span class="w">                        </span><span class="s2">&quot;kms:Get*&quot;</span><span class="p">,</span>
</span><span id="__span-27-33"><span class="w">                        </span><span class="s2">&quot;kms:Delete*&quot;</span><span class="p">,</span>
</span><span id="__span-27-34"><span class="w">                        </span><span class="s2">&quot;kms:TagResource&quot;</span><span class="p">,</span>
</span><span id="__span-27-35"><span class="w">                        </span><span class="s2">&quot;kms:UntagResource&quot;</span><span class="p">,</span>
</span><span id="__span-27-36"><span class="w">                        </span><span class="s2">&quot;kms:ScheduleKeyDeletion&quot;</span><span class="p">,</span>
</span><span id="__span-27-37"><span class="w">                        </span><span class="s2">&quot;kms:CancelKeyDeletion&quot;</span>
</span><span id="__span-27-38"><span class="w">                    </span><span class="p">],</span>
</span><span id="__span-27-39"><span class="w">                    </span><span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
</span><span id="__span-27-40"><span class="w">                    </span><span class="nt">&quot;Principal&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-27-41"><span class="w">                        </span><span class="nt">&quot;AWS&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-27-42"><span class="w">                            </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;arn:aws:iam::${AWS::AccountId}:user/${kmsKeyAdmin}&quot;</span>
</span><span id="__span-27-43"><span class="w">                        </span><span class="p">}</span>
</span><span id="__span-27-44"><span class="w">                    </span><span class="p">},</span>
</span><span id="__span-27-45"><span class="w">                    </span><span class="nt">&quot;Resource&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;*&quot;</span><span class="p">,</span>
</span><span id="__span-27-46"><span class="w">                    </span><span class="nt">&quot;Sid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow access for Key Administrators&quot;</span>
</span><span id="__span-27-47"><span class="w">                </span><span class="p">}</span>
</span><span id="__span-27-48"><span class="w">            </span><span class="p">],</span>
</span><span id="__span-27-49"><span class="w">            </span><span class="nt">&quot;Version&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2012-10-17&quot;</span>
</span><span id="__span-27-50"><span class="w">        </span><span class="p">}</span>
</span><span id="__span-27-51"><span class="w">    </span><span class="p">},</span>
</span><span id="__span-27-52"><span class="w">    </span><span class="nt">&quot;Type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AWS::KMS::Key&quot;</span>
</span><span id="__span-27-53"><span class="p">}</span>
</span></code></pre></div>
</div>
</div>
</div>
<h4 id="kmsuseralias"><a href="#kms-resources">kmsUserAlias</a><a class="headerlink" href="#kmsuseralias" title="Permanent link">&para;</a></h4>
<div class="tabbed-set tabbed-alternate" data-tabs="29:2"><input checked="checked" id="__tabbed_29_1" name="__tabbed_29" type="radio" /><input id="__tabbed_29_2" name="__tabbed_29" type="radio" /><div class="tabbed-labels"><label for="__tabbed_29_1">Details</label><label for="__tabbed_29_2">Source</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<table>
<thead>
<tr>
<th>Property</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Type</td>
<td><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-kms-alias.html" title="AWS documentation for this resource type">AWS::KMS::Alias</a></td>
</tr>
<tr>
<td>Group</td>
<td><a href="#kms-resources">KMS Resources</a> (<a href="#kms-resources">KMS</a>)</td>
</tr>
<tr>
<td>Description</td>
<td>User KMS key alias for lava realm.</td>
</tr>
</tbody>
</table>
</div>
<div class="tabbed-block">
<div class="language-json highlight"><pre><span></span><code><span id="__span-28-1"><span class="p">{</span>
</span><span id="__span-28-2"><span class="w">    </span><span class="nt">&quot;Properties&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-28-3"><span class="w">        </span><span class="nt">&quot;AliasName&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-28-4"><span class="w">            </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;alias/lava-${realm}-user&quot;</span>
</span><span id="__span-28-5"><span class="w">        </span><span class="p">},</span>
</span><span id="__span-28-6"><span class="w">        </span><span class="nt">&quot;TargetKeyId&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-28-7"><span class="w">            </span><span class="nt">&quot;Ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;kmsUserKey&quot;</span>
</span><span id="__span-28-8"><span class="w">        </span><span class="p">}</span>
</span><span id="__span-28-9"><span class="w">    </span><span class="p">},</span>
</span><span id="__span-28-10"><span class="w">    </span><span class="nt">&quot;Type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AWS::KMS::Alias&quot;</span>
</span><span id="__span-28-11"><span class="p">}</span>
</span></code></pre></div>
</div>
</div>
</div>
<h4 id="kmsuserkey"><a href="#kms-resources">kmsUserKey</a><a class="headerlink" href="#kmsuserkey" title="Permanent link">&para;</a></h4>
<div class="tabbed-set tabbed-alternate" data-tabs="30:2"><input checked="checked" id="__tabbed_30_1" name="__tabbed_30" type="radio" /><input id="__tabbed_30_2" name="__tabbed_30" type="radio" /><div class="tabbed-labels"><label for="__tabbed_30_1">Details</label><label for="__tabbed_30_2">Source</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<table>
<thead>
<tr>
<th>Property</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Type</td>
<td><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-kms-key.html" title="AWS documentation for this resource type">AWS::KMS::Key</a></td>
</tr>
<tr>
<td>Group</td>
<td><a href="#kms-resources">KMS Resources</a> (<a href="#kms-resources">KMS</a>)</td>
</tr>
<tr>
<td>Description</td>
<td>User KMS key for lava realm.</td>
</tr>
</tbody>
</table>
</div>
<div class="tabbed-block">
<div class="language-json highlight"><pre><span></span><code><span id="__span-29-1"><span class="p">{</span>
</span><span id="__span-29-2"><span class="w">    </span><span class="nt">&quot;Properties&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-29-3"><span class="w">        </span><span class="nt">&quot;Description&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-29-4"><span class="w">            </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;User key for lava realm ${realm}&quot;</span>
</span><span id="__span-29-5"><span class="w">        </span><span class="p">},</span>
</span><span id="__span-29-6"><span class="w">        </span><span class="nt">&quot;EnableKeyRotation&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-29-7"><span class="w">        </span><span class="nt">&quot;Enabled&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-29-8"><span class="w">        </span><span class="nt">&quot;KeyPolicy&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-29-9"><span class="w">            </span><span class="nt">&quot;Id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;key-consolepolicy-3&quot;</span><span class="p">,</span>
</span><span id="__span-29-10"><span class="w">            </span><span class="nt">&quot;Statement&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-29-11"><span class="w">                </span><span class="p">{</span>
</span><span id="__span-29-12"><span class="w">                    </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;kms:*&quot;</span><span class="p">,</span>
</span><span id="__span-29-13"><span class="w">                    </span><span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
</span><span id="__span-29-14"><span class="w">                    </span><span class="nt">&quot;Principal&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-29-15"><span class="w">                        </span><span class="nt">&quot;AWS&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-29-16"><span class="w">                            </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;arn:aws:iam::${AWS::AccountId}:root&quot;</span>
</span><span id="__span-29-17"><span class="w">                        </span><span class="p">}</span>
</span><span id="__span-29-18"><span class="w">                    </span><span class="p">},</span>
</span><span id="__span-29-19"><span class="w">                    </span><span class="nt">&quot;Resource&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;*&quot;</span><span class="p">,</span>
</span><span id="__span-29-20"><span class="w">                    </span><span class="nt">&quot;Sid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Enable IAM User Permissions&quot;</span>
</span><span id="__span-29-21"><span class="w">                </span><span class="p">},</span>
</span><span id="__span-29-22"><span class="w">                </span><span class="p">{</span>
</span><span id="__span-29-23"><span class="w">                    </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-29-24"><span class="w">                        </span><span class="s2">&quot;kms:Create*&quot;</span><span class="p">,</span>
</span><span id="__span-29-25"><span class="w">                        </span><span class="s2">&quot;kms:Describe*&quot;</span><span class="p">,</span>
</span><span id="__span-29-26"><span class="w">                        </span><span class="s2">&quot;kms:Enable*&quot;</span><span class="p">,</span>
</span><span id="__span-29-27"><span class="w">                        </span><span class="s2">&quot;kms:List*&quot;</span><span class="p">,</span>
</span><span id="__span-29-28"><span class="w">                        </span><span class="s2">&quot;kms:Put*&quot;</span><span class="p">,</span>
</span><span id="__span-29-29"><span class="w">                        </span><span class="s2">&quot;kms:Update*&quot;</span><span class="p">,</span>
</span><span id="__span-29-30"><span class="w">                        </span><span class="s2">&quot;kms:Revoke*&quot;</span><span class="p">,</span>
</span><span id="__span-29-31"><span class="w">                        </span><span class="s2">&quot;kms:Disable*&quot;</span><span class="p">,</span>
</span><span id="__span-29-32"><span class="w">                        </span><span class="s2">&quot;kms:Get*&quot;</span><span class="p">,</span>
</span><span id="__span-29-33"><span class="w">                        </span><span class="s2">&quot;kms:Delete*&quot;</span><span class="p">,</span>
</span><span id="__span-29-34"><span class="w">                        </span><span class="s2">&quot;kms:TagResource&quot;</span><span class="p">,</span>
</span><span id="__span-29-35"><span class="w">                        </span><span class="s2">&quot;kms:UntagResource&quot;</span><span class="p">,</span>
</span><span id="__span-29-36"><span class="w">                        </span><span class="s2">&quot;kms:ScheduleKeyDeletion&quot;</span><span class="p">,</span>
</span><span id="__span-29-37"><span class="w">                        </span><span class="s2">&quot;kms:CancelKeyDeletion&quot;</span>
</span><span id="__span-29-38"><span class="w">                    </span><span class="p">],</span>
</span><span id="__span-29-39"><span class="w">                    </span><span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
</span><span id="__span-29-40"><span class="w">                    </span><span class="nt">&quot;Principal&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-29-41"><span class="w">                        </span><span class="nt">&quot;AWS&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-29-42"><span class="w">                            </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;arn:aws:iam::${AWS::AccountId}:user/${kmsKeyAdmin}&quot;</span>
</span><span id="__span-29-43"><span class="w">                        </span><span class="p">}</span>
</span><span id="__span-29-44"><span class="w">                    </span><span class="p">},</span>
</span><span id="__span-29-45"><span class="w">                    </span><span class="nt">&quot;Resource&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;*&quot;</span><span class="p">,</span>
</span><span id="__span-29-46"><span class="w">                    </span><span class="nt">&quot;Sid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow access for Key Administrators&quot;</span>
</span><span id="__span-29-47"><span class="w">                </span><span class="p">}</span>
</span><span id="__span-29-48"><span class="w">            </span><span class="p">],</span>
</span><span id="__span-29-49"><span class="w">            </span><span class="nt">&quot;Version&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2012-10-17&quot;</span>
</span><span id="__span-29-50"><span class="w">        </span><span class="p">}</span>
</span><span id="__span-29-51"><span class="w">    </span><span class="p">},</span>
</span><span id="__span-29-52"><span class="w">    </span><span class="nt">&quot;Type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AWS::KMS::Key&quot;</span>
</span><span id="__span-29-53"><span class="p">}</span>
</span></code></pre></div>
</div>
</div>
</div>
<h4 id="lambdadispatch"><a href="#lambda-resources">lambdaDispatch</a><a class="headerlink" href="#lambdadispatch" title="Permanent link">&para;</a></h4>
<div class="tabbed-set tabbed-alternate" data-tabs="31:2"><input checked="checked" id="__tabbed_31_1" name="__tabbed_31" type="radio" /><input id="__tabbed_31_2" name="__tabbed_31" type="radio" /><div class="tabbed-labels"><label for="__tabbed_31_1">Details</label><label for="__tabbed_31_2">Source</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<table>
<thead>
<tr>
<th>Property</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Type</td>
<td><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-lambda-function.html" title="AWS documentation for this resource type">AWS::Lambda::Function</a></td>
</tr>
<tr>
<td>Group</td>
<td><a href="#lambda-resources">Lambda Resources</a> (<a href="#lambda-resources">Lambda</a>)</td>
</tr>
<tr>
<td>Description</td>
<td>Dispatch Lambda function for the realm.</td>
</tr>
</tbody>
</table>
</div>
<div class="tabbed-block">
<div class="language-json highlight"><pre><span></span><code><span id="__span-30-1"><span class="p">{</span>
</span><span id="__span-30-2"><span class="w">    </span><span class="nt">&quot;Condition&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ifCreateLambdas&quot;</span><span class="p">,</span>
</span><span id="__span-30-3"><span class="w">    </span><span class="nt">&quot;Properties&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-4"><span class="w">        </span><span class="nt">&quot;Architectures&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-30-5"><span class="w">            </span><span class="p">{</span>
</span><span id="__span-30-6"><span class="w">                </span><span class="nt">&quot;Ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;lambdaArchitecture&quot;</span>
</span><span id="__span-30-7"><span class="w">            </span><span class="p">}</span>
</span><span id="__span-30-8"><span class="w">        </span><span class="p">],</span>
</span><span id="__span-30-9"><span class="w">        </span><span class="nt">&quot;Code&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-10"><span class="w">            </span><span class="nt">&quot;S3Bucket&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-11"><span class="w">                </span><span class="nt">&quot;Ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;s3CodeBucket&quot;</span>
</span><span id="__span-30-12"><span class="w">            </span><span class="p">},</span>
</span><span id="__span-30-13"><span class="w">            </span><span class="nt">&quot;S3Key&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-14"><span class="w">                </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;${s3CodePrefix}/_dist_/lambda/dispatch-${lambdaVersion}.zip&quot;</span>
</span><span id="__span-30-15"><span class="w">            </span><span class="p">}</span>
</span><span id="__span-30-16"><span class="w">        </span><span class="p">},</span>
</span><span id="__span-30-17"><span class="w">        </span><span class="nt">&quot;Description&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-18"><span class="w">            </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Dispatch Lambda function for the lava ${realm} realm.&quot;</span>
</span><span id="__span-30-19"><span class="w">        </span><span class="p">},</span>
</span><span id="__span-30-20"><span class="w">        </span><span class="nt">&quot;Environment&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-21"><span class="w">            </span><span class="nt">&quot;Variables&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-22"><span class="w">                </span><span class="nt">&quot;LAVA_REALM&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-23"><span class="w">                    </span><span class="nt">&quot;Ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;realm&quot;</span>
</span><span id="__span-30-24"><span class="w">                </span><span class="p">},</span>
</span><span id="__span-30-25"><span class="w">                </span><span class="nt">&quot;LOGLEVEL&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;info&quot;</span>
</span><span id="__span-30-26"><span class="w">            </span><span class="p">}</span>
</span><span id="__span-30-27"><span class="w">        </span><span class="p">},</span>
</span><span id="__span-30-28"><span class="w">        </span><span class="nt">&quot;FunctionName&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-29"><span class="w">            </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;lava-${realm}-dispatch&quot;</span>
</span><span id="__span-30-30"><span class="w">        </span><span class="p">},</span>
</span><span id="__span-30-31"><span class="w">        </span><span class="nt">&quot;Handler&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;dispatch.lambda_handler&quot;</span><span class="p">,</span>
</span><span id="__span-30-32"><span class="w">        </span><span class="nt">&quot;MemorySize&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-33"><span class="w">            </span><span class="nt">&quot;Ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;lambdaMemory&quot;</span>
</span><span id="__span-30-34"><span class="w">        </span><span class="p">},</span>
</span><span id="__span-30-35"><span class="w">        </span><span class="nt">&quot;Role&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-36"><span class="w">            </span><span class="nt">&quot;Fn::GetAtt&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-30-37"><span class="w">                </span><span class="s2">&quot;iamLavaDispatchLambdaRole&quot;</span><span class="p">,</span>
</span><span id="__span-30-38"><span class="w">                </span><span class="s2">&quot;Arn&quot;</span>
</span><span id="__span-30-39"><span class="w">            </span><span class="p">]</span>
</span><span id="__span-30-40"><span class="w">        </span><span class="p">},</span>
</span><span id="__span-30-41"><span class="w">        </span><span class="nt">&quot;Runtime&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-42"><span class="w">            </span><span class="nt">&quot;Ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;lambdaRuntime&quot;</span>
</span><span id="__span-30-43"><span class="w">        </span><span class="p">},</span>
</span><span id="__span-30-44"><span class="w">        </span><span class="nt">&quot;Tags&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-30-45"><span class="w">            </span><span class="p">{</span>
</span><span id="__span-30-46"><span class="w">                </span><span class="nt">&quot;Key&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;lava:function&quot;</span><span class="p">,</span>
</span><span id="__span-30-47"><span class="w">                </span><span class="nt">&quot;Value&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;realm.dispatch-helper&quot;</span>
</span><span id="__span-30-48"><span class="w">            </span><span class="p">}</span>
</span><span id="__span-30-49"><span class="w">        </span><span class="p">],</span>
</span><span id="__span-30-50"><span class="w">        </span><span class="nt">&quot;Timeout&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-51"><span class="w">            </span><span class="nt">&quot;Ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;lambdaTimeout&quot;</span>
</span><span id="__span-30-52"><span class="w">        </span><span class="p">}</span>
</span><span id="__span-30-53"><span class="w">    </span><span class="p">},</span>
</span><span id="__span-30-54"><span class="w">    </span><span class="nt">&quot;Type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AWS::Lambda::Function&quot;</span>
</span><span id="__span-30-55"><span class="p">}</span>
</span></code></pre></div>
</div>
</div>
</div>
<h4 id="lambdalavametrics"><a href="#lambda-resources">lambdaLavaMetrics</a><a class="headerlink" href="#lambdalavametrics" title="Permanent link">&para;</a></h4>
<div class="tabbed-set tabbed-alternate" data-tabs="32:2"><input checked="checked" id="__tabbed_32_1" name="__tabbed_32" type="radio" /><input id="__tabbed_32_2" name="__tabbed_32" type="radio" /><div class="tabbed-labels"><label for="__tabbed_32_1">Details</label><label for="__tabbed_32_2">Source</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<table>
<thead>
<tr>
<th>Property</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Type</td>
<td><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-lambda-function.html" title="AWS documentation for this resource type">AWS::Lambda::Function</a></td>
</tr>
<tr>
<td>Group</td>
<td><a href="#lambda-resources">Lambda Resources</a> (<a href="#lambda-resources">Lambda</a>)</td>
</tr>
<tr>
<td>Description</td>
<td>Lambda function to produce CloudWatch metrics.</td>
</tr>
</tbody>
</table>
</div>
<div class="tabbed-block">
<div class="language-json highlight"><pre><span></span><code><span id="__span-31-1"><span class="p">{</span>
</span><span id="__span-31-2"><span class="w">    </span><span class="nt">&quot;Condition&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ifCreateLambdas&quot;</span><span class="p">,</span>
</span><span id="__span-31-3"><span class="w">    </span><span class="nt">&quot;Properties&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-31-4"><span class="w">        </span><span class="nt">&quot;Architectures&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-31-5"><span class="w">            </span><span class="p">{</span>
</span><span id="__span-31-6"><span class="w">                </span><span class="nt">&quot;Ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;lambdaArchitecture&quot;</span>
</span><span id="__span-31-7"><span class="w">            </span><span class="p">}</span>
</span><span id="__span-31-8"><span class="w">        </span><span class="p">],</span>
</span><span id="__span-31-9"><span class="w">        </span><span class="nt">&quot;Code&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-31-10"><span class="w">            </span><span class="nt">&quot;S3Bucket&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-31-11"><span class="w">                </span><span class="nt">&quot;Ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;s3CodeBucket&quot;</span>
</span><span id="__span-31-12"><span class="w">            </span><span class="p">},</span>
</span><span id="__span-31-13"><span class="w">            </span><span class="nt">&quot;S3Key&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-31-14"><span class="w">                </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;${s3CodePrefix}/_dist_/lambda/metrics-${lambdaVersion}.zip&quot;</span>
</span><span id="__span-31-15"><span class="w">            </span><span class="p">}</span>
</span><span id="__span-31-16"><span class="w">        </span><span class="p">},</span>
</span><span id="__span-31-17"><span class="w">        </span><span class="nt">&quot;Description&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-31-18"><span class="w">            </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Lambda function to produce CloudWatch metrics for the lava ${realm} realm.&quot;</span>
</span><span id="__span-31-19"><span class="w">        </span><span class="p">},</span>
</span><span id="__span-31-20"><span class="w">        </span><span class="nt">&quot;Environment&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-31-21"><span class="w">            </span><span class="nt">&quot;Variables&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-31-22"><span class="w">                </span><span class="nt">&quot;LAVA_REALM&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-31-23"><span class="w">                    </span><span class="nt">&quot;Ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;realm&quot;</span>
</span><span id="__span-31-24"><span class="w">                </span><span class="p">},</span>
</span><span id="__span-31-25"><span class="w">                </span><span class="nt">&quot;LOGLEVEL&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;info&quot;</span>
</span><span id="__span-31-26"><span class="w">            </span><span class="p">}</span>
</span><span id="__span-31-27"><span class="w">        </span><span class="p">},</span>
</span><span id="__span-31-28"><span class="w">        </span><span class="nt">&quot;FunctionName&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-31-29"><span class="w">            </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;lava-${realm}-metrics&quot;</span>
</span><span id="__span-31-30"><span class="w">        </span><span class="p">},</span>
</span><span id="__span-31-31"><span class="w">        </span><span class="nt">&quot;Handler&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;metrics.lambda_handler&quot;</span><span class="p">,</span>
</span><span id="__span-31-32"><span class="w">        </span><span class="nt">&quot;MemorySize&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-31-33"><span class="w">            </span><span class="nt">&quot;Ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;lambdaMemory&quot;</span>
</span><span id="__span-31-34"><span class="w">        </span><span class="p">},</span>
</span><span id="__span-31-35"><span class="w">        </span><span class="nt">&quot;Role&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-31-36"><span class="w">            </span><span class="nt">&quot;Fn::GetAtt&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-31-37"><span class="w">                </span><span class="s2">&quot;iamLavaMetricsLambdaRole&quot;</span><span class="p">,</span>
</span><span id="__span-31-38"><span class="w">                </span><span class="s2">&quot;Arn&quot;</span>
</span><span id="__span-31-39"><span class="w">            </span><span class="p">]</span>
</span><span id="__span-31-40"><span class="w">        </span><span class="p">},</span>
</span><span id="__span-31-41"><span class="w">        </span><span class="nt">&quot;Runtime&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-31-42"><span class="w">            </span><span class="nt">&quot;Ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;lambdaRuntime&quot;</span>
</span><span id="__span-31-43"><span class="w">        </span><span class="p">},</span>
</span><span id="__span-31-44"><span class="w">        </span><span class="nt">&quot;Tags&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-31-45"><span class="w">            </span><span class="p">{</span>
</span><span id="__span-31-46"><span class="w">                </span><span class="nt">&quot;Key&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;lava:function&quot;</span><span class="p">,</span>
</span><span id="__span-31-47"><span class="w">                </span><span class="nt">&quot;Value&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;realm.metrics&quot;</span>
</span><span id="__span-31-48"><span class="w">            </span><span class="p">}</span>
</span><span id="__span-31-49"><span class="w">        </span><span class="p">],</span>
</span><span id="__span-31-50"><span class="w">        </span><span class="nt">&quot;Timeout&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-31-51"><span class="w">            </span><span class="nt">&quot;Ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;lambdaTimeout&quot;</span>
</span><span id="__span-31-52"><span class="w">        </span><span class="p">}</span>
</span><span id="__span-31-53"><span class="w">    </span><span class="p">},</span>
</span><span id="__span-31-54"><span class="w">    </span><span class="nt">&quot;Type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AWS::Lambda::Function&quot;</span>
</span><span id="__span-31-55"><span class="p">}</span>
</span></code></pre></div>
</div>
</div>
</div>
<h4 id="lambdalavametricspermission"><a href="#lambda-resources">lambdaLavaMetricsPermission</a><a class="headerlink" href="#lambdalavametricspermission" title="Permanent link">&para;</a></h4>
<div class="tabbed-set tabbed-alternate" data-tabs="33:2"><input checked="checked" id="__tabbed_33_1" name="__tabbed_33" type="radio" /><input id="__tabbed_33_2" name="__tabbed_33" type="radio" /><div class="tabbed-labels"><label for="__tabbed_33_1">Details</label><label for="__tabbed_33_2">Source</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<table>
<thead>
<tr>
<th>Property</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Type</td>
<td><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-lambda-permission.html" title="AWS documentation for this resource type">AWS::Lambda::Permission</a></td>
</tr>
<tr>
<td>Group</td>
<td><a href="#lambda-resources">Lambda Resources</a> (<a href="#lambda-resources">Lambda</a>)</td>
</tr>
<tr>
<td>Description</td>
<td>Allow EventBridge to run the schedule for the metrics lambda.</td>
</tr>
</tbody>
</table>
</div>
<div class="tabbed-block">
<div class="language-json highlight"><pre><span></span><code><span id="__span-32-1"><span class="p">{</span>
</span><span id="__span-32-2"><span class="w">    </span><span class="nt">&quot;Condition&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ifCreateLambdas&quot;</span><span class="p">,</span>
</span><span id="__span-32-3"><span class="w">    </span><span class="nt">&quot;Properties&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-32-4"><span class="w">        </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;lambda:InvokeFunction&quot;</span><span class="p">,</span>
</span><span id="__span-32-5"><span class="w">        </span><span class="nt">&quot;FunctionName&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-32-6"><span class="w">            </span><span class="nt">&quot;Fn::GetAtt&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-32-7"><span class="w">                </span><span class="s2">&quot;lambdaLavaMetrics&quot;</span><span class="p">,</span>
</span><span id="__span-32-8"><span class="w">                </span><span class="s2">&quot;Arn&quot;</span>
</span><span id="__span-32-9"><span class="w">            </span><span class="p">]</span>
</span><span id="__span-32-10"><span class="w">        </span><span class="p">},</span>
</span><span id="__span-32-11"><span class="w">        </span><span class="nt">&quot;Principal&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;events.amazonaws.com&quot;</span><span class="p">,</span>
</span><span id="__span-32-12"><span class="w">        </span><span class="nt">&quot;SourceArn&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-32-13"><span class="w">            </span><span class="nt">&quot;Fn::GetAtt&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-32-14"><span class="w">                </span><span class="s2">&quot;eventsScheduleMetricsLambda&quot;</span><span class="p">,</span>
</span><span id="__span-32-15"><span class="w">                </span><span class="s2">&quot;Arn&quot;</span>
</span><span id="__span-32-16"><span class="w">            </span><span class="p">]</span>
</span><span id="__span-32-17"><span class="w">        </span><span class="p">}</span>
</span><span id="__span-32-18"><span class="w">    </span><span class="p">},</span>
</span><span id="__span-32-19"><span class="w">    </span><span class="nt">&quot;Type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AWS::Lambda::Permission&quot;</span>
</span><span id="__span-32-20"><span class="p">}</span>
</span></code></pre></div>
</div>
</div>
</div>
<h4 id="lambdalavastop"><a href="#lambda-resources">lambdaLavaStop</a><a class="headerlink" href="#lambdalavastop" title="Permanent link">&para;</a></h4>
<div class="tabbed-set tabbed-alternate" data-tabs="34:2"><input checked="checked" id="__tabbed_34_1" name="__tabbed_34" type="radio" /><input id="__tabbed_34_2" name="__tabbed_34" type="radio" /><div class="tabbed-labels"><label for="__tabbed_34_1">Details</label><label for="__tabbed_34_2">Source</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<table>
<thead>
<tr>
<th>Property</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Type</td>
<td><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-lambda-function.html" title="AWS documentation for this resource type">AWS::Lambda::Function</a></td>
</tr>
<tr>
<td>Group</td>
<td><a href="#lambda-resources">Lambda Resources</a> (<a href="#lambda-resources">Lambda</a>)</td>
</tr>
<tr>
<td>Description</td>
<td>Lambda function to stop daemons on a worker node</td>
</tr>
</tbody>
</table>
</div>
<div class="tabbed-block">
<div class="language-json highlight"><pre><span></span><code><span id="__span-33-1"><span class="p">{</span>
</span><span id="__span-33-2"><span class="w">    </span><span class="nt">&quot;Condition&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ifCreateLambdas&quot;</span><span class="p">,</span>
</span><span id="__span-33-3"><span class="w">    </span><span class="nt">&quot;Properties&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-33-4"><span class="w">        </span><span class="nt">&quot;Architectures&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-33-5"><span class="w">            </span><span class="p">{</span>
</span><span id="__span-33-6"><span class="w">                </span><span class="nt">&quot;Ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;lambdaArchitecture&quot;</span>
</span><span id="__span-33-7"><span class="w">            </span><span class="p">}</span>
</span><span id="__span-33-8"><span class="w">        </span><span class="p">],</span>
</span><span id="__span-33-9"><span class="w">        </span><span class="nt">&quot;Code&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-33-10"><span class="w">            </span><span class="nt">&quot;S3Bucket&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-33-11"><span class="w">                </span><span class="nt">&quot;Ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;s3CodeBucket&quot;</span>
</span><span id="__span-33-12"><span class="w">            </span><span class="p">},</span>
</span><span id="__span-33-13"><span class="w">            </span><span class="nt">&quot;S3Key&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-33-14"><span class="w">                </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;${s3CodePrefix}/_dist_/lambda/stop-${lambdaVersion}.zip&quot;</span>
</span><span id="__span-33-15"><span class="w">            </span><span class="p">}</span>
</span><span id="__span-33-16"><span class="w">        </span><span class="p">},</span>
</span><span id="__span-33-17"><span class="w">        </span><span class="nt">&quot;Description&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-33-18"><span class="w">            </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Worker node stop Lambda function for the lava ${realm} realm.&quot;</span>
</span><span id="__span-33-19"><span class="w">        </span><span class="p">},</span>
</span><span id="__span-33-20"><span class="w">        </span><span class="nt">&quot;Environment&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-33-21"><span class="w">            </span><span class="nt">&quot;Variables&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-33-22"><span class="w">                </span><span class="nt">&quot;LAVA_REALM&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-33-23"><span class="w">                    </span><span class="nt">&quot;Ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;realm&quot;</span>
</span><span id="__span-33-24"><span class="w">                </span><span class="p">},</span>
</span><span id="__span-33-25"><span class="w">                </span><span class="nt">&quot;LIFECYCLE_HEARTBEAT&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-33-26"><span class="w">                    </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;${autoscalingHeartbeatMinutes}m&quot;</span>
</span><span id="__span-33-27"><span class="w">                </span><span class="p">},</span>
</span><span id="__span-33-28"><span class="w">                </span><span class="nt">&quot;LOGLEVEL&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;info&quot;</span><span class="p">,</span>
</span><span id="__span-33-29"><span class="w">                </span><span class="nt">&quot;WAIT_TIME&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-33-30"><span class="w">                    </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;${workerStopMinutes}m&quot;</span>
</span><span id="__span-33-31"><span class="w">                </span><span class="p">}</span>
</span><span id="__span-33-32"><span class="w">            </span><span class="p">}</span>
</span><span id="__span-33-33"><span class="w">        </span><span class="p">},</span>
</span><span id="__span-33-34"><span class="w">        </span><span class="nt">&quot;FunctionName&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-33-35"><span class="w">            </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;lava-${realm}-stop&quot;</span>
</span><span id="__span-33-36"><span class="w">        </span><span class="p">},</span>
</span><span id="__span-33-37"><span class="w">        </span><span class="nt">&quot;Handler&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;stop.lambda_handler&quot;</span><span class="p">,</span>
</span><span id="__span-33-38"><span class="w">        </span><span class="nt">&quot;MemorySize&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-33-39"><span class="w">            </span><span class="nt">&quot;Ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;lambdaMemory&quot;</span>
</span><span id="__span-33-40"><span class="w">        </span><span class="p">},</span>
</span><span id="__span-33-41"><span class="w">        </span><span class="nt">&quot;Role&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-33-42"><span class="w">            </span><span class="nt">&quot;Fn::GetAtt&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-33-43"><span class="w">                </span><span class="s2">&quot;iamLavaStopLambdaRole&quot;</span><span class="p">,</span>
</span><span id="__span-33-44"><span class="w">                </span><span class="s2">&quot;Arn&quot;</span>
</span><span id="__span-33-45"><span class="w">            </span><span class="p">]</span>
</span><span id="__span-33-46"><span class="w">        </span><span class="p">},</span>
</span><span id="__span-33-47"><span class="w">        </span><span class="nt">&quot;Runtime&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-33-48"><span class="w">            </span><span class="nt">&quot;Ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;lambdaRuntime&quot;</span>
</span><span id="__span-33-49"><span class="w">        </span><span class="p">},</span>
</span><span id="__span-33-50"><span class="w">        </span><span class="nt">&quot;Tags&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-33-51"><span class="w">            </span><span class="p">{</span>
</span><span id="__span-33-52"><span class="w">                </span><span class="nt">&quot;Key&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;lava:function&quot;</span><span class="p">,</span>
</span><span id="__span-33-53"><span class="w">                </span><span class="nt">&quot;Value&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;realm.worker-stop&quot;</span>
</span><span id="__span-33-54"><span class="w">            </span><span class="p">}</span>
</span><span id="__span-33-55"><span class="w">        </span><span class="p">],</span>
</span><span id="__span-33-56"><span class="w">        </span><span class="nt">&quot;Timeout&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-33-57"><span class="w">            </span><span class="nt">&quot;Ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;lambdaTimeout&quot;</span>
</span><span id="__span-33-58"><span class="w">        </span><span class="p">}</span>
</span><span id="__span-33-59"><span class="w">    </span><span class="p">},</span>
</span><span id="__span-33-60"><span class="w">    </span><span class="nt">&quot;Type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AWS::Lambda::Function&quot;</span>
</span><span id="__span-33-61"><span class="p">}</span>
</span></code></pre></div>
</div>
</div>
</div>
<h4 id="lambdas3trigger"><a href="#lambda-resources">lambdaS3Trigger</a><a class="headerlink" href="#lambdas3trigger" title="Permanent link">&para;</a></h4>
<div class="tabbed-set tabbed-alternate" data-tabs="35:2"><input checked="checked" id="__tabbed_35_1" name="__tabbed_35" type="radio" /><input id="__tabbed_35_2" name="__tabbed_35" type="radio" /><div class="tabbed-labels"><label for="__tabbed_35_1">Details</label><label for="__tabbed_35_2">Source</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<table>
<thead>
<tr>
<th>Property</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Type</td>
<td><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-lambda-function.html" title="AWS documentation for this resource type">AWS::Lambda::Function</a></td>
</tr>
<tr>
<td>Group</td>
<td><a href="#lambda-resources">Lambda Resources</a> (<a href="#lambda-resources">Lambda</a>)</td>
</tr>
<tr>
<td>Description</td>
<td>S3trigger Lambda function for the realm.</td>
</tr>
</tbody>
</table>
</div>
<div class="tabbed-block">
<div class="language-json highlight"><pre><span></span><code><span id="__span-34-1"><span class="p">{</span>
</span><span id="__span-34-2"><span class="w">    </span><span class="nt">&quot;Condition&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ifCreateLambdas&quot;</span><span class="p">,</span>
</span><span id="__span-34-3"><span class="w">    </span><span class="nt">&quot;Properties&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-4"><span class="w">        </span><span class="nt">&quot;Architectures&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-34-5"><span class="w">            </span><span class="p">{</span>
</span><span id="__span-34-6"><span class="w">                </span><span class="nt">&quot;Ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;lambdaArchitecture&quot;</span>
</span><span id="__span-34-7"><span class="w">            </span><span class="p">}</span>
</span><span id="__span-34-8"><span class="w">        </span><span class="p">],</span>
</span><span id="__span-34-9"><span class="w">        </span><span class="nt">&quot;Code&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-10"><span class="w">            </span><span class="nt">&quot;S3Bucket&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-11"><span class="w">                </span><span class="nt">&quot;Ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;s3CodeBucket&quot;</span>
</span><span id="__span-34-12"><span class="w">            </span><span class="p">},</span>
</span><span id="__span-34-13"><span class="w">            </span><span class="nt">&quot;S3Key&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-14"><span class="w">                </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;${s3CodePrefix}/_dist_/lambda/s3trigger-${lambdaVersion}.zip&quot;</span>
</span><span id="__span-34-15"><span class="w">            </span><span class="p">}</span>
</span><span id="__span-34-16"><span class="w">        </span><span class="p">},</span>
</span><span id="__span-34-17"><span class="w">        </span><span class="nt">&quot;Description&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-18"><span class="w">            </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;S3trigger Lambda function for the lava ${realm} realm.&quot;</span>
</span><span id="__span-34-19"><span class="w">        </span><span class="p">},</span>
</span><span id="__span-34-20"><span class="w">        </span><span class="nt">&quot;Environment&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-21"><span class="w">            </span><span class="nt">&quot;Variables&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-22"><span class="w">                </span><span class="nt">&quot;LAVA_REALM&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-23"><span class="w">                    </span><span class="nt">&quot;Ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;realm&quot;</span>
</span><span id="__span-34-24"><span class="w">                </span><span class="p">},</span>
</span><span id="__span-34-25"><span class="w">                </span><span class="nt">&quot;LOGLEVEL&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;info&quot;</span>
</span><span id="__span-34-26"><span class="w">            </span><span class="p">}</span>
</span><span id="__span-34-27"><span class="w">        </span><span class="p">},</span>
</span><span id="__span-34-28"><span class="w">        </span><span class="nt">&quot;FunctionName&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-29"><span class="w">            </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;lava-${realm}-s3trigger&quot;</span>
</span><span id="__span-34-30"><span class="w">        </span><span class="p">},</span>
</span><span id="__span-34-31"><span class="w">        </span><span class="nt">&quot;Handler&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;s3trigger.lambda_handler&quot;</span><span class="p">,</span>
</span><span id="__span-34-32"><span class="w">        </span><span class="nt">&quot;MemorySize&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-33"><span class="w">            </span><span class="nt">&quot;Ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;lambdaMemory&quot;</span>
</span><span id="__span-34-34"><span class="w">        </span><span class="p">},</span>
</span><span id="__span-34-35"><span class="w">        </span><span class="nt">&quot;Role&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-36"><span class="w">            </span><span class="nt">&quot;Fn::GetAtt&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-34-37"><span class="w">                </span><span class="s2">&quot;iamLavaDispatchLambdaRole&quot;</span><span class="p">,</span>
</span><span id="__span-34-38"><span class="w">                </span><span class="s2">&quot;Arn&quot;</span>
</span><span id="__span-34-39"><span class="w">            </span><span class="p">]</span>
</span><span id="__span-34-40"><span class="w">        </span><span class="p">},</span>
</span><span id="__span-34-41"><span class="w">        </span><span class="nt">&quot;Runtime&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-42"><span class="w">            </span><span class="nt">&quot;Ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;lambdaRuntime&quot;</span>
</span><span id="__span-34-43"><span class="w">        </span><span class="p">},</span>
</span><span id="__span-34-44"><span class="w">        </span><span class="nt">&quot;Tags&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-34-45"><span class="w">            </span><span class="p">{</span>
</span><span id="__span-34-46"><span class="w">                </span><span class="nt">&quot;Key&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;lava:function&quot;</span><span class="p">,</span>
</span><span id="__span-34-47"><span class="w">                </span><span class="nt">&quot;Value&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;realm.s3trigger&quot;</span>
</span><span id="__span-34-48"><span class="w">            </span><span class="p">}</span>
</span><span id="__span-34-49"><span class="w">        </span><span class="p">],</span>
</span><span id="__span-34-50"><span class="w">        </span><span class="nt">&quot;Timeout&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-51"><span class="w">            </span><span class="nt">&quot;Ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;lambdaTimeout&quot;</span>
</span><span id="__span-34-52"><span class="w">        </span><span class="p">}</span>
</span><span id="__span-34-53"><span class="w">    </span><span class="p">},</span>
</span><span id="__span-34-54"><span class="w">    </span><span class="nt">&quot;Type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AWS::Lambda::Function&quot;</span>
</span><span id="__span-34-55"><span class="p">}</span>
</span></code></pre></div>
</div>
</div>
</div>
<h4 id="lambdas3triggerpermission"><a href="#lambda-resources">lambdaS3TriggerPermission</a><a class="headerlink" href="#lambdas3triggerpermission" title="Permanent link">&para;</a></h4>
<div class="tabbed-set tabbed-alternate" data-tabs="36:2"><input checked="checked" id="__tabbed_36_1" name="__tabbed_36" type="radio" /><input id="__tabbed_36_2" name="__tabbed_36" type="radio" /><div class="tabbed-labels"><label for="__tabbed_36_1">Details</label><label for="__tabbed_36_2">Source</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<table>
<thead>
<tr>
<th>Property</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Type</td>
<td><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-lambda-permission.html" title="AWS documentation for this resource type">AWS::Lambda::Permission</a></td>
</tr>
<tr>
<td>Group</td>
<td><a href="#lambda-resources">Lambda Resources</a> (<a href="#lambda-resources">Lambda</a>)</td>
</tr>
<tr>
<td>Description</td>
<td>Allow EventBridge rules to invoke the s3trigger lambda.</td>
</tr>
</tbody>
</table>
</div>
<div class="tabbed-block">
<div class="language-json highlight"><pre><span></span><code><span id="__span-35-1"><span class="p">{</span>
</span><span id="__span-35-2"><span class="w">    </span><span class="nt">&quot;Condition&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ifCreateLambdas&quot;</span><span class="p">,</span>
</span><span id="__span-35-3"><span class="w">    </span><span class="nt">&quot;Properties&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-35-4"><span class="w">        </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;lambda:InvokeFunction&quot;</span><span class="p">,</span>
</span><span id="__span-35-5"><span class="w">        </span><span class="nt">&quot;FunctionName&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-35-6"><span class="w">            </span><span class="nt">&quot;Fn::GetAtt&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-35-7"><span class="w">                </span><span class="s2">&quot;lambdaS3Trigger&quot;</span><span class="p">,</span>
</span><span id="__span-35-8"><span class="w">                </span><span class="s2">&quot;Arn&quot;</span>
</span><span id="__span-35-9"><span class="w">            </span><span class="p">]</span>
</span><span id="__span-35-10"><span class="w">        </span><span class="p">},</span>
</span><span id="__span-35-11"><span class="w">        </span><span class="nt">&quot;Principal&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;events.amazonaws.com&quot;</span><span class="p">,</span>
</span><span id="__span-35-12"><span class="w">        </span><span class="nt">&quot;SourceAccount&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-35-13"><span class="w">            </span><span class="nt">&quot;Ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AWS::AccountId&quot;</span>
</span><span id="__span-35-14"><span class="w">        </span><span class="p">},</span>
</span><span id="__span-35-15"><span class="w">        </span><span class="nt">&quot;SourceArn&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-35-16"><span class="w">            </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;arn:aws:events:${AWS::Region}:${AWS::AccountId}:rule/lava.${realm}.*&quot;</span>
</span><span id="__span-35-17"><span class="w">        </span><span class="p">}</span>
</span><span id="__span-35-18"><span class="w">    </span><span class="p">},</span>
</span><span id="__span-35-19"><span class="w">    </span><span class="nt">&quot;Type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AWS::Lambda::Permission&quot;</span>
</span><span id="__span-35-20"><span class="p">}</span>
</span></code></pre></div>
</div>
</div>
</div>
<h4 id="lamdadispatchpolicy"><a href="#lambda-resources">lamdaDispatchPolicy</a><a class="headerlink" href="#lamdadispatchpolicy" title="Permanent link">&para;</a></h4>
<div class="tabbed-set tabbed-alternate" data-tabs="37:2"><input checked="checked" id="__tabbed_37_1" name="__tabbed_37" type="radio" /><input id="__tabbed_37_2" name="__tabbed_37" type="radio" /><div class="tabbed-labels"><label for="__tabbed_37_1">Details</label><label for="__tabbed_37_2">Source</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<table>
<thead>
<tr>
<th>Property</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Type</td>
<td><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-lambda-permission.html" title="AWS documentation for this resource type">AWS::Lambda::Permission</a></td>
</tr>
<tr>
<td>Group</td>
<td><a href="#lambda-resources">Lambda Resources</a> (<a href="#lambda-resources">Lambda</a>)</td>
</tr>
</tbody>
</table>
</div>
<div class="tabbed-block">
<div class="language-json highlight"><pre><span></span><code><span id="__span-36-1"><span class="p">{</span>
</span><span id="__span-36-2"><span class="w">    </span><span class="nt">&quot;Condition&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ifCreateLambdas&quot;</span><span class="p">,</span>
</span><span id="__span-36-3"><span class="w">    </span><span class="nt">&quot;DependsOn&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;lambdaDispatch&quot;</span><span class="p">,</span>
</span><span id="__span-36-4"><span class="w">    </span><span class="nt">&quot;Properties&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-36-5"><span class="w">        </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;lambda:InvokeFunction&quot;</span><span class="p">,</span>
</span><span id="__span-36-6"><span class="w">        </span><span class="nt">&quot;FunctionName&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-36-7"><span class="w">            </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;lava-${realm}-dispatch&quot;</span>
</span><span id="__span-36-8"><span class="w">        </span><span class="p">},</span>
</span><span id="__span-36-9"><span class="w">        </span><span class="nt">&quot;Principal&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;sns.amazonaws.com&quot;</span><span class="p">,</span>
</span><span id="__span-36-10"><span class="w">        </span><span class="nt">&quot;SourceArn&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-36-11"><span class="w">            </span><span class="nt">&quot;Ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;snsDispatchHelper&quot;</span>
</span><span id="__span-36-12"><span class="w">        </span><span class="p">}</span>
</span><span id="__span-36-13"><span class="w">    </span><span class="p">},</span>
</span><span id="__span-36-14"><span class="w">    </span><span class="nt">&quot;Type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AWS::Lambda::Permission&quot;</span>
</span><span id="__span-36-15"><span class="p">}</span>
</span></code></pre></div>
</div>
</div>
</div>
<h4 id="s3lavabucket"><a href="#s3-resources">s3LavaBucket</a><a class="headerlink" href="#s3lavabucket" title="Permanent link">&para;</a></h4>
<div class="tabbed-set tabbed-alternate" data-tabs="38:2"><input checked="checked" id="__tabbed_38_1" name="__tabbed_38" type="radio" /><input id="__tabbed_38_2" name="__tabbed_38" type="radio" /><div class="tabbed-labels"><label for="__tabbed_38_1">Details</label><label for="__tabbed_38_2">Source</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<table>
<thead>
<tr>
<th>Property</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Type</td>
<td><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-s3-bucket.html" title="AWS documentation for this resource type">AWS::S3::Bucket</a></td>
</tr>
<tr>
<td>Group</td>
<td><a href="#s3-resources">S3 Resources</a> (<a href="#s3-resources">S3</a>)</td>
</tr>
<tr>
<td>Description</td>
<td>Lava realm bucket for payloads and tmp space.</td>
</tr>
</tbody>
</table>
</div>
<div class="tabbed-block">
<div class="language-json highlight"><pre><span></span><code><span id="__span-37-1"><span class="p">{</span>
</span><span id="__span-37-2"><span class="w">    </span><span class="nt">&quot;Properties&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-37-3"><span class="w">        </span><span class="nt">&quot;AccessControl&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Private&quot;</span><span class="p">,</span>
</span><span id="__span-37-4"><span class="w">        </span><span class="nt">&quot;BucketEncryption&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-37-5"><span class="w">            </span><span class="nt">&quot;ServerSideEncryptionConfiguration&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-37-6"><span class="w">                </span><span class="p">{</span>
</span><span id="__span-37-7"><span class="w">                    </span><span class="nt">&quot;ServerSideEncryptionByDefault&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-37-8"><span class="w">                        </span><span class="nt">&quot;KMSMasterKeyID&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-37-9"><span class="w">                            </span><span class="nt">&quot;Ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;kmsUserKey&quot;</span>
</span><span id="__span-37-10"><span class="w">                        </span><span class="p">},</span>
</span><span id="__span-37-11"><span class="w">                        </span><span class="nt">&quot;SSEAlgorithm&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;aws:kms&quot;</span>
</span><span id="__span-37-12"><span class="w">                    </span><span class="p">}</span>
</span><span id="__span-37-13"><span class="w">                </span><span class="p">}</span>
</span><span id="__span-37-14"><span class="w">            </span><span class="p">]</span>
</span><span id="__span-37-15"><span class="w">        </span><span class="p">},</span>
</span><span id="__span-37-16"><span class="w">        </span><span class="nt">&quot;BucketName&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-37-17"><span class="w">            </span><span class="nt">&quot;Ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;lavaBucketName&quot;</span>
</span><span id="__span-37-18"><span class="w">        </span><span class="p">},</span>
</span><span id="__span-37-19"><span class="w">        </span><span class="nt">&quot;LifecycleConfiguration&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-37-20"><span class="w">            </span><span class="nt">&quot;Rules&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-37-21"><span class="w">                </span><span class="p">{</span>
</span><span id="__span-37-22"><span class="w">                    </span><span class="nt">&quot;AbortIncompleteMultipartUpload&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-37-23"><span class="w">                        </span><span class="nt">&quot;DaysAfterInitiation&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span>
</span><span id="__span-37-24"><span class="w">                    </span><span class="p">},</span>
</span><span id="__span-37-25"><span class="w">                    </span><span class="nt">&quot;Id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AbortIncompleteMultipartUpload&quot;</span><span class="p">,</span>
</span><span id="__span-37-26"><span class="w">                    </span><span class="nt">&quot;Status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Enabled&quot;</span>
</span><span id="__span-37-27"><span class="w">                </span><span class="p">},</span>
</span><span id="__span-37-28"><span class="w">                </span><span class="p">{</span>
</span><span id="__span-37-29"><span class="w">                    </span><span class="nt">&quot;ExpirationInDays&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-37-30"><span class="w">                        </span><span class="nt">&quot;Ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;tmpExpiryDays&quot;</span>
</span><span id="__span-37-31"><span class="w">                    </span><span class="p">},</span>
</span><span id="__span-37-32"><span class="w">                    </span><span class="nt">&quot;Id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Expire tmp area&quot;</span><span class="p">,</span>
</span><span id="__span-37-33"><span class="w">                    </span><span class="nt">&quot;Prefix&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;tmp/&quot;</span><span class="p">,</span>
</span><span id="__span-37-34"><span class="w">                    </span><span class="nt">&quot;Status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Enabled&quot;</span>
</span><span id="__span-37-35"><span class="w">                </span><span class="p">}</span>
</span><span id="__span-37-36"><span class="w">            </span><span class="p">]</span>
</span><span id="__span-37-37"><span class="w">        </span><span class="p">},</span>
</span><span id="__span-37-38"><span class="w">        </span><span class="nt">&quot;LoggingConfiguration&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-37-39"><span class="w">            </span><span class="nt">&quot;DestinationBucketName&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-37-40"><span class="w">                </span><span class="nt">&quot;Ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;logBucketName&quot;</span>
</span><span id="__span-37-41"><span class="w">            </span><span class="p">},</span>
</span><span id="__span-37-42"><span class="w">            </span><span class="nt">&quot;LogFilePrefix&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-37-43"><span class="w">                </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;${lavaBucketName}/&quot;</span>
</span><span id="__span-37-44"><span class="w">            </span><span class="p">}</span>
</span><span id="__span-37-45"><span class="w">        </span><span class="p">},</span>
</span><span id="__span-37-46"><span class="w">        </span><span class="nt">&quot;PublicAccessBlockConfiguration&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-37-47"><span class="w">            </span><span class="nt">&quot;BlockPublicAcls&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-37-48"><span class="w">            </span><span class="nt">&quot;BlockPublicPolicy&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-37-49"><span class="w">            </span><span class="nt">&quot;IgnorePublicAcls&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-37-50"><span class="w">            </span><span class="nt">&quot;RestrictPublicBuckets&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-37-51"><span class="w">        </span><span class="p">}</span>
</span><span id="__span-37-52"><span class="w">    </span><span class="p">},</span>
</span><span id="__span-37-53"><span class="w">    </span><span class="nt">&quot;Type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AWS::S3::Bucket&quot;</span>
</span><span id="__span-37-54"><span class="p">}</span>
</span></code></pre></div>
</div>
</div>
</div>
<h4 id="snsdispatchhelper"><a href="#sns-resources">snsDispatchHelper</a><a class="headerlink" href="#snsdispatchhelper" title="Permanent link">&para;</a></h4>
<div class="tabbed-set tabbed-alternate" data-tabs="39:2"><input checked="checked" id="__tabbed_39_1" name="__tabbed_39" type="radio" /><input id="__tabbed_39_2" name="__tabbed_39" type="radio" /><div class="tabbed-labels"><label for="__tabbed_39_1">Details</label><label for="__tabbed_39_2">Source</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<table>
<thead>
<tr>
<th>Property</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Type</td>
<td><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-sns-topic.html" title="AWS documentation for this resource type">AWS::SNS::Topic</a></td>
</tr>
<tr>
<td>Group</td>
<td><a href="#sns-resources">SNS Resources</a> (<a href="#sns-resources">SNS</a>)</td>
</tr>
<tr>
<td>Description</td>
<td>SNS topic for the dispatch helper lambda to receive dispatch requests.</td>
</tr>
</tbody>
</table>
</div>
<div class="tabbed-block">
<div class="language-json highlight"><pre><span></span><code><span id="__span-38-1"><span class="p">{</span>
</span><span id="__span-38-2"><span class="w">    </span><span class="nt">&quot;Condition&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ifCreateLambdas&quot;</span><span class="p">,</span>
</span><span id="__span-38-3"><span class="w">    </span><span class="nt">&quot;Properties&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-38-4"><span class="w">        </span><span class="nt">&quot;DisplayName&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;LavaDsptch&quot;</span><span class="p">,</span>
</span><span id="__span-38-5"><span class="w">        </span><span class="nt">&quot;KmsMasterKeyId&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-38-6"><span class="w">            </span><span class="nt">&quot;Ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;kmsUserAlias&quot;</span>
</span><span id="__span-38-7"><span class="w">        </span><span class="p">},</span>
</span><span id="__span-38-8"><span class="w">        </span><span class="nt">&quot;Tags&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-38-9"><span class="w">            </span><span class="p">{</span>
</span><span id="__span-38-10"><span class="w">                </span><span class="nt">&quot;Key&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;lava:function&quot;</span><span class="p">,</span>
</span><span id="__span-38-11"><span class="w">                </span><span class="nt">&quot;Value&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;realm.dispatch-helper&quot;</span>
</span><span id="__span-38-12"><span class="w">            </span><span class="p">}</span>
</span><span id="__span-38-13"><span class="w">        </span><span class="p">],</span>
</span><span id="__span-38-14"><span class="w">        </span><span class="nt">&quot;TopicName&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-38-15"><span class="w">            </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;lava-${realm}-dispatch&quot;</span>
</span><span id="__span-38-16"><span class="w">        </span><span class="p">}</span>
</span><span id="__span-38-17"><span class="w">    </span><span class="p">},</span>
</span><span id="__span-38-18"><span class="w">    </span><span class="nt">&quot;Type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AWS::SNS::Topic&quot;</span>
</span><span id="__span-38-19"><span class="p">}</span>
</span></code></pre></div>
</div>
</div>
</div>
<h4 id="snslavanotices"><a href="#sns-resources">snsLavaNotices</a><a class="headerlink" href="#snslavanotices" title="Permanent link">&para;</a></h4>
<div class="tabbed-set tabbed-alternate" data-tabs="40:2"><input checked="checked" id="__tabbed_40_1" name="__tabbed_40" type="radio" /><input id="__tabbed_40_2" name="__tabbed_40" type="radio" /><div class="tabbed-labels"><label for="__tabbed_40_1">Details</label><label for="__tabbed_40_2">Source</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<table>
<thead>
<tr>
<th>Property</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Type</td>
<td><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-sns-topic.html" title="AWS documentation for this resource type">AWS::SNS::Topic</a></td>
</tr>
<tr>
<td>Group</td>
<td><a href="#sns-resources">SNS Resources</a> (<a href="#sns-resources">SNS</a>)</td>
</tr>
<tr>
<td>Description</td>
<td>SNS topic for lava notices. Whether or not it is used depends on lava jobs.</td>
</tr>
</tbody>
</table>
</div>
<div class="tabbed-block">
<div class="language-json highlight"><pre><span></span><code><span id="__span-39-1"><span class="p">{</span>
</span><span id="__span-39-2"><span class="w">    </span><span class="nt">&quot;Properties&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-39-3"><span class="w">        </span><span class="nt">&quot;DisplayName&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;LavaNotice&quot;</span><span class="p">,</span>
</span><span id="__span-39-4"><span class="w">        </span><span class="nt">&quot;Tags&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-39-5"><span class="w">            </span><span class="p">{</span>
</span><span id="__span-39-6"><span class="w">                </span><span class="nt">&quot;Key&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;lava:function&quot;</span><span class="p">,</span>
</span><span id="__span-39-7"><span class="w">                </span><span class="nt">&quot;Value&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;realm.notices&quot;</span>
</span><span id="__span-39-8"><span class="w">            </span><span class="p">}</span>
</span><span id="__span-39-9"><span class="w">        </span><span class="p">],</span>
</span><span id="__span-39-10"><span class="w">        </span><span class="nt">&quot;TopicName&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-39-11"><span class="w">            </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;lava-${realm}-notices&quot;</span>
</span><span id="__span-39-12"><span class="w">        </span><span class="p">}</span>
</span><span id="__span-39-13"><span class="w">    </span><span class="p">},</span>
</span><span id="__span-39-14"><span class="w">    </span><span class="nt">&quot;Type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AWS::SNS::Topic&quot;</span>
</span><span id="__span-39-15"><span class="p">}</span>
</span></code></pre></div>
</div>
</div>
</div>
<h4 id="snssubscribedispatch"><a href="#sns-resources">snsSubscribeDispatch</a><a class="headerlink" href="#snssubscribedispatch" title="Permanent link">&para;</a></h4>
<div class="tabbed-set tabbed-alternate" data-tabs="41:2"><input checked="checked" id="__tabbed_41_1" name="__tabbed_41" type="radio" /><input id="__tabbed_41_2" name="__tabbed_41" type="radio" /><div class="tabbed-labels"><label for="__tabbed_41_1">Details</label><label for="__tabbed_41_2">Source</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<table>
<thead>
<tr>
<th>Property</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Type</td>
<td><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-sns-subscription.html" title="AWS documentation for this resource type">AWS::SNS::Subscription</a></td>
</tr>
<tr>
<td>Group</td>
<td><a href="#sns-resources">SNS Resources</a> (<a href="#sns-resources">SNS</a>)</td>
</tr>
<tr>
<td>Description</td>
<td>Subscription for the dispatch helper Lambda to the dispatch helper SNS topic.</td>
</tr>
</tbody>
</table>
</div>
<div class="tabbed-block">
<div class="language-json highlight"><pre><span></span><code><span id="__span-40-1"><span class="p">{</span>
</span><span id="__span-40-2"><span class="w">    </span><span class="nt">&quot;Condition&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ifCreateLambdas&quot;</span><span class="p">,</span>
</span><span id="__span-40-3"><span class="w">    </span><span class="nt">&quot;Properties&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-4"><span class="w">        </span><span class="nt">&quot;Endpoint&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-5"><span class="w">            </span><span class="nt">&quot;Fn::GetAtt&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-40-6"><span class="w">                </span><span class="s2">&quot;lambdaDispatch&quot;</span><span class="p">,</span>
</span><span id="__span-40-7"><span class="w">                </span><span class="s2">&quot;Arn&quot;</span>
</span><span id="__span-40-8"><span class="w">            </span><span class="p">]</span>
</span><span id="__span-40-9"><span class="w">        </span><span class="p">},</span>
</span><span id="__span-40-10"><span class="w">        </span><span class="nt">&quot;Protocol&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;lambda&quot;</span><span class="p">,</span>
</span><span id="__span-40-11"><span class="w">        </span><span class="nt">&quot;TopicArn&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-12"><span class="w">            </span><span class="nt">&quot;Ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;snsDispatchHelper&quot;</span>
</span><span id="__span-40-13"><span class="w">        </span><span class="p">}</span>
</span><span id="__span-40-14"><span class="w">    </span><span class="p">},</span>
</span><span id="__span-40-15"><span class="w">    </span><span class="nt">&quot;Type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AWS::SNS::Subscription&quot;</span>
</span><span id="__span-40-16"><span class="p">}</span>
</span></code></pre></div>
</div>
</div>
</div>
<h2 id="lava-workercfnjson">lava-worker.cfn.json<a class="headerlink" href="#lava-workercfnjson" title="Permanent link">&para;</a></h2>
<p>This template builds the core components for a new Lava worker. The realm must have been created previously.</p>
<h3 id="parameters_2"><a href="#lava-workercfnjson">Parameters</a><a class="headerlink" href="#parameters_2" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Version</td>
<td>String</td>
<td>Lava version (read only).</td>
</tr>
<tr>
<td>alarmTopic</td>
<td>String</td>
<td>Name of SNS topic for alarms. SNS topic name must be specified.</td>
</tr>
<tr>
<td>amiId</td>
<td>String</td>
<td>Image ID for the latest lava (preferred) or SAK AMI.</td>
</tr>
<tr>
<td>autoscalingActionTopic</td>
<td>String</td>
<td>Name of SNS topic for normal autoscaling activity.</td>
</tr>
<tr>
<td>autoscalingControlledTermination</td>
<td>String</td>
<td>Autoscaling controlled termination on worker nodes?</td>
</tr>
<tr>
<td>createHeartBeatAlarm</td>
<td>String</td>
<td>Should I create a worker heartbeat alarm?</td>
</tr>
<tr>
<td>createWorkerInstance</td>
<td>String</td>
<td>Should I create resources required for a worker compute instance?</td>
</tr>
<tr>
<td>dockerVolumeSize</td>
<td>Number</td>
<td>Size in GB of volume for docker. Set to 0 to remove. Volume size must be between 0 and 2000 GB.</td>
</tr>
<tr>
<td>keyPairName</td>
<td>AWS::EC2::KeyPair::KeyName</td>
<td>Key pair name for the instances. Key pair name must be specified.</td>
</tr>
<tr>
<td>maxAllowedQueueDepth</td>
<td>Number</td>
<td>Create an alarm if queue depth exceeds this value. 0 for no alarm.</td>
</tr>
<tr>
<td>messageRetentionPeriod</td>
<td>Number</td>
<td>Message retention period on the worker queue (seconds). Default 1 day. Must be &gt;= 1800 (30 minutes).</td>
</tr>
<tr>
<td>queueDepthMinutes</td>
<td>Number</td>
<td>Minutes queue depth exceeds max before alarm (1..300).</td>
</tr>
<tr>
<td>realm</td>
<td>String</td>
<td>Name of the realm</td>
</tr>
<tr>
<td>realmLambdasDeployed</td>
<td>String</td>
<td>Are the realm lambda functions deployed?</td>
</tr>
<tr>
<td>rootVolumeSize</td>
<td>Number</td>
<td>Size in GB of root volume. Set to 0 for AMI default. Volume size must be &gt;=0.</td>
</tr>
<tr>
<td>secGroups</td>
<td>List&lt;AWS::EC2::SecurityGroup::Id&gt;</td>
<td>Security groups for the worker.</td>
</tr>
<tr>
<td>subnets</td>
<td>List&lt;AWS::EC2::Subnet::Id&gt;</td>
<td>Subnets for worker instances.</td>
</tr>
<tr>
<td>swapSize</td>
<td>Number</td>
<td>Swap size in Gibibytes (0 = no swapping). Swap size must be &gt;= 0.</td>
</tr>
<tr>
<td>tmpVolumeSize</td>
<td>Number</td>
<td>Size in GB of second volume mounted on /tmp. Set to 0 to remove. Volume size must be between 0 and 2000 GB.</td>
</tr>
<tr>
<td>visibilityTimeout</td>
<td>Number</td>
<td>Visibility timeout on the worker queue (seconds). Default 1 hour. Must be &gt;= 300 (5 minutes).</td>
</tr>
<tr>
<td>worker</td>
<td>String</td>
<td>Name of the worker</td>
</tr>
<tr>
<td>workerAllowedInstances</td>
<td>CommaDelimitedList</td>
<td>Comma separated list of allowed instance types (GLOBs allowed)</td>
</tr>
<tr>
<td>workerBacklogScalingTarget</td>
<td>Number</td>
<td>Autoscaling worker backlog (0 == disable backlog scaling)</td>
</tr>
<tr>
<td>workerBurstable</td>
<td>String</td>
<td>Include burstable instance types (e.g. t-series) for workers (included / excluded / required)</td>
</tr>
<tr>
<td>workerInstanceType</td>
<td>String</td>
<td>EC2 instance type. Leave blank for capability based provisioning.</td>
</tr>
<tr>
<td>workerInstancesDesired</td>
<td>Number</td>
<td>How many worker nodes should I run now? Must be between 0 and 10.</td>
</tr>
<tr>
<td>workerInstancesMax</td>
<td>Number</td>
<td>Maximum number of worker instances (must be 1 for dispatcher nodes). Must be between 0 and 10.</td>
</tr>
<tr>
<td>workerInstancesMin</td>
<td>Number</td>
<td>Minimum number of worker instances. Must be between 0 and 5.</td>
</tr>
<tr>
<td>workerLocalStorage</td>
<td>String</td>
<td>Local (not EBS) storage for workers (included / excluded / required)</td>
</tr>
<tr>
<td>workerMemoryMax</td>
<td>Number</td>
<td>Maximum memory in MiB (0 == no limit)</td>
</tr>
<tr>
<td>workerMemoryMin</td>
<td>Number</td>
<td>Minimum memory in MiB for the worker</td>
</tr>
<tr>
<td>workerPublicIp</td>
<td>String</td>
<td>Assign public IP to workers.</td>
</tr>
<tr>
<td>workerVCpuMax</td>
<td>Number</td>
<td>Maximum number of vCPUs for the worker (0 == no limit)</td>
</tr>
<tr>
<td>workerVCpuMin</td>
<td>Number</td>
<td>Minimum number of vCPUs for the worker</td>
</tr>
</tbody>
</table>
<h3 id="outputs_2"><a href="#lava-workercfnjson">Outputs</a><a class="headerlink" href="#outputs_2" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Id</th>
<th>Export as</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Version</td>
<td><code class="language-json highlight"><span class="p">{</span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;lava:${realm}:${worker}:version&quot;</span><span class="p">}</span></code></td>
<td>Lava version</td>
</tr>
</tbody>
</table>
<h3 id="resources_2"><a href="#lava-workercfnjson">Resources</a><a class="headerlink" href="#resources_2" title="Permanent link">&para;</a></h3>
<ul>
<li><a href="#cloudwatch-resources">CloudWatch Resources</a></li>
<li><a href="#autoscaling-resources">AutoScaling Resources</a></li>
<li><a href="#events-resources">Events Resources</a></li>
<li><a href="#iam-resources">IAM Resources</a></li>
<li><a href="#lambda-resources">Lambda Resources</a></li>
<li><a href="#ec2-resources">EC2 Resources</a></li>
<li><a href="#logs-resources">Logs Resources</a></li>
<li><a href="#sqs-resources">SQS Resources</a></li>
</ul>
<h4 id="cloudwatch-resources"><a href="#lava-workercfnjson">CloudWatch Resources</a><a class="headerlink" href="#cloudwatch-resources" title="Permanent link">&para;</a></h4>
<table>
<thead>
<tr>
<th>Id</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="#alarmlavaheartbeat">alarmLavaHeartbeat</a></td>
<td>Alarm</td>
<td>Heartbeat alarm for Lava worker.</td>
</tr>
<tr>
<td><a href="#alarmlavaworker">alarmLavaWorker</a></td>
<td>Alarm</td>
<td>Status check failed alarm for Lava worker.</td>
</tr>
<tr>
<td><a href="#alarmqueuedepth">alarmQueueDepth</a></td>
<td>Alarm</td>
<td>Queue depth alarm for Lava worker.</td>
</tr>
</tbody>
</table>
<h4 id="autoscaling-resources"><a href="#lava-workercfnjson">AutoScaling Resources</a><a class="headerlink" href="#autoscaling-resources" title="Permanent link">&para;</a></h4>
<table>
<thead>
<tr>
<th>Id</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="#asglavaworker">asgLavaWorker</a></td>
<td>AutoScalingGroup</td>
<td>Auto scaling group for Lava worker</td>
</tr>
<tr>
<td><a href="#asgworkerscalingpolicy">asgWorkerScalingPolicy</a></td>
<td>ScalingPolicy</td>
<td>Target tracking scaling policy for worker</td>
</tr>
</tbody>
</table>
<h4 id="events-resources_1"><a href="#lava-workercfnjson">Events Resources</a><a class="headerlink" href="#events-resources_1" title="Permanent link">&para;</a></h4>
<table>
<thead>
<tr>
<th>Id</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="#eventsworkerterminating">eventsWorkerTerminating</a></td>
<td>Rule</td>
<td>EventBridge rule for terminating worker.</td>
</tr>
</tbody>
</table>
<h4 id="iam-resources_1"><a href="#lava-workercfnjson">IAM Resources</a><a class="headerlink" href="#iam-resources_1" title="Permanent link">&para;</a></h4>
<table>
<thead>
<tr>
<th>Id</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="#iamlavaworkerrole">iamLavaWorkerRole</a></td>
<td>Role</td>
<td>IAM role for worker instances.</td>
</tr>
<tr>
<td><a href="#iamworkerinstanceprofile">iamWorkerInstanceProfile</a></td>
<td>InstanceProfile</td>
<td></td>
</tr>
</tbody>
</table>
<h4 id="lambda-resources_1"><a href="#lava-workercfnjson">Lambda Resources</a><a class="headerlink" href="#lambda-resources_1" title="Permanent link">&para;</a></h4>
<table>
<thead>
<tr>
<th>Id</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="#lambdalavastoppermission">lambdaLavaStopPermission</a></td>
<td>Permission</td>
<td>Allow EventBridge to run the stop lambda.</td>
</tr>
</tbody>
</table>
<h4 id="ec2-resources"><a href="#lava-workercfnjson">EC2 Resources</a><a class="headerlink" href="#ec2-resources" title="Permanent link">&para;</a></h4>
<table>
<thead>
<tr>
<th>Id</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="#launchtemplatelavaworker">launchtemplateLavaWorker</a></td>
<td>LaunchTemplate</td>
<td>Launch template for Lava worker.</td>
</tr>
</tbody>
</table>
<h4 id="logs-resources_1"><a href="#lava-workercfnjson">Logs Resources</a><a class="headerlink" href="#logs-resources_1" title="Permanent link">&para;</a></h4>
<table>
<thead>
<tr>
<th>Id</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="#logfilterworkerheartbeat">logFilterWorkerHeartbeat</a></td>
<td>MetricFilter</td>
<td>Metric filter on /var/log/lava/&lt;REALM&gt; log group to find heartbeat messages.</td>
</tr>
</tbody>
</table>
<h4 id="sqs-resources"><a href="#lava-workercfnjson">SQS Resources</a><a class="headerlink" href="#sqs-resources" title="Permanent link">&para;</a></h4>
<table>
<thead>
<tr>
<th>Id</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="#sqsworkerqueue">sqsWorkerQueue</a></td>
<td>Queue</td>
<td>SQS queue for the lava worker to receive dispatched jobs.</td>
</tr>
</tbody>
</table>
<h3 id="resource-details_2"><a href="#lava-workercfnjson">Resource Details</a><a class="headerlink" href="#resource-details_2" title="Permanent link">&para;</a></h3>
<h4 id="alarmlavaheartbeat"><a href="#cloudwatch-resources">alarmLavaHeartbeat</a><a class="headerlink" href="#alarmlavaheartbeat" title="Permanent link">&para;</a></h4>
<div class="tabbed-set tabbed-alternate" data-tabs="42:2"><input checked="checked" id="__tabbed_42_1" name="__tabbed_42" type="radio" /><input id="__tabbed_42_2" name="__tabbed_42" type="radio" /><div class="tabbed-labels"><label for="__tabbed_42_1">Details</label><label for="__tabbed_42_2">Source</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<table>
<thead>
<tr>
<th>Property</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Type</td>
<td><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-cloudwatch-alarm.html" title="AWS documentation for this resource type">AWS::CloudWatch::Alarm</a></td>
</tr>
<tr>
<td>Group</td>
<td><a href="#cloudwatch-resources">CloudWatch Resources</a> (<a href="#cloudwatch-resources">CloudWatch</a>)</td>
</tr>
<tr>
<td>Description</td>
<td>Heartbeat alarm for Lava worker.</td>
</tr>
</tbody>
</table>
</div>
<div class="tabbed-block">
<div class="language-json highlight"><pre><span></span><code><span id="__span-41-1"><span class="p">{</span>
</span><span id="__span-41-2"><span class="w">    </span><span class="nt">&quot;Condition&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ifCreateHeatbeatAlarm&quot;</span><span class="p">,</span>
</span><span id="__span-41-3"><span class="w">    </span><span class="nt">&quot;Properties&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-41-4"><span class="w">        </span><span class="nt">&quot;ActionsEnabled&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;true&quot;</span><span class="p">,</span>
</span><span id="__span-41-5"><span class="w">        </span><span class="nt">&quot;AlarmActions&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-41-6"><span class="w">            </span><span class="p">{</span>
</span><span id="__span-41-7"><span class="w">                </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;arn:aws:sns:${AWS::Region}:${AWS::AccountId}:${alarmTopic}&quot;</span>
</span><span id="__span-41-8"><span class="w">            </span><span class="p">}</span>
</span><span id="__span-41-9"><span class="w">        </span><span class="p">],</span>
</span><span id="__span-41-10"><span class="w">        </span><span class="nt">&quot;AlarmDescription&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-41-11"><span class="w">            </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;No heartbeat for lava-${realm}-${worker}&quot;</span>
</span><span id="__span-41-12"><span class="w">        </span><span class="p">},</span>
</span><span id="__span-41-13"><span class="w">        </span><span class="nt">&quot;AlarmName&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-41-14"><span class="w">            </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;lava-${realm}-${worker}-heartbeat&quot;</span>
</span><span id="__span-41-15"><span class="w">        </span><span class="p">},</span>
</span><span id="__span-41-16"><span class="w">        </span><span class="nt">&quot;ComparisonOperator&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;LessThanThreshold&quot;</span><span class="p">,</span>
</span><span id="__span-41-17"><span class="w">        </span><span class="nt">&quot;DatapointsToAlarm&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span>
</span><span id="__span-41-18"><span class="w">        </span><span class="nt">&quot;Dimensions&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span>
</span><span id="__span-41-19"><span class="w">        </span><span class="nt">&quot;EvaluationPeriods&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span>
</span><span id="__span-41-20"><span class="w">        </span><span class="nt">&quot;InsufficientDataActions&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span>
</span><span id="__span-41-21"><span class="w">        </span><span class="nt">&quot;MetricName&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-41-22"><span class="w">            </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;lava-${realm}-${worker}-heartbeat&quot;</span>
</span><span id="__span-41-23"><span class="w">        </span><span class="p">},</span>
</span><span id="__span-41-24"><span class="w">        </span><span class="nt">&quot;Namespace&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;LogMetrics&quot;</span><span class="p">,</span>
</span><span id="__span-41-25"><span class="w">        </span><span class="nt">&quot;OKActions&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-41-26"><span class="w">            </span><span class="p">{</span>
</span><span id="__span-41-27"><span class="w">                </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;arn:aws:sns:${AWS::Region}:${AWS::AccountId}:${alarmTopic}&quot;</span>
</span><span id="__span-41-28"><span class="w">            </span><span class="p">}</span>
</span><span id="__span-41-29"><span class="w">        </span><span class="p">],</span>
</span><span id="__span-41-30"><span class="w">        </span><span class="nt">&quot;Period&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">60</span><span class="p">,</span>
</span><span id="__span-41-31"><span class="w">        </span><span class="nt">&quot;Statistic&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;SampleCount&quot;</span><span class="p">,</span>
</span><span id="__span-41-32"><span class="w">        </span><span class="nt">&quot;Threshold&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1.0&quot;</span><span class="p">,</span>
</span><span id="__span-41-33"><span class="w">        </span><span class="nt">&quot;TreatMissingData&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;breaching&quot;</span>
</span><span id="__span-41-34"><span class="w">    </span><span class="p">},</span>
</span><span id="__span-41-35"><span class="w">    </span><span class="nt">&quot;Type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AWS::CloudWatch::Alarm&quot;</span>
</span><span id="__span-41-36"><span class="p">}</span>
</span></code></pre></div>
</div>
</div>
</div>
<h4 id="alarmlavaworker"><a href="#cloudwatch-resources">alarmLavaWorker</a><a class="headerlink" href="#alarmlavaworker" title="Permanent link">&para;</a></h4>
<div class="tabbed-set tabbed-alternate" data-tabs="43:2"><input checked="checked" id="__tabbed_43_1" name="__tabbed_43" type="radio" /><input id="__tabbed_43_2" name="__tabbed_43" type="radio" /><div class="tabbed-labels"><label for="__tabbed_43_1">Details</label><label for="__tabbed_43_2">Source</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<table>
<thead>
<tr>
<th>Property</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Type</td>
<td><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-cloudwatch-alarm.html" title="AWS documentation for this resource type">AWS::CloudWatch::Alarm</a></td>
</tr>
<tr>
<td>Group</td>
<td><a href="#cloudwatch-resources">CloudWatch Resources</a> (<a href="#cloudwatch-resources">CloudWatch</a>)</td>
</tr>
<tr>
<td>Description</td>
<td>Status check failed alarm for Lava worker.</td>
</tr>
</tbody>
</table>
</div>
<div class="tabbed-block">
<div class="language-json highlight"><pre><span></span><code><span id="__span-42-1"><span class="p">{</span>
</span><span id="__span-42-2"><span class="w">    </span><span class="nt">&quot;Condition&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ifCreateInstance&quot;</span><span class="p">,</span>
</span><span id="__span-42-3"><span class="w">    </span><span class="nt">&quot;Properties&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-42-4"><span class="w">        </span><span class="nt">&quot;ActionsEnabled&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;true&quot;</span><span class="p">,</span>
</span><span id="__span-42-5"><span class="w">        </span><span class="nt">&quot;AlarmActions&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-42-6"><span class="w">            </span><span class="p">{</span>
</span><span id="__span-42-7"><span class="w">                </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;arn:aws:sns:${AWS::Region}:${AWS::AccountId}:${alarmTopic}&quot;</span>
</span><span id="__span-42-8"><span class="w">            </span><span class="p">}</span>
</span><span id="__span-42-9"><span class="w">        </span><span class="p">],</span>
</span><span id="__span-42-10"><span class="w">        </span><span class="nt">&quot;AlarmDescription&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-42-11"><span class="w">            </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Lava realm ${realm}, worker ${worker} status check failed for 2 minutes&quot;</span>
</span><span id="__span-42-12"><span class="w">        </span><span class="p">},</span>
</span><span id="__span-42-13"><span class="w">        </span><span class="nt">&quot;AlarmName&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-42-14"><span class="w">            </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;lava-${realm}-${worker} Status Check Failed&quot;</span>
</span><span id="__span-42-15"><span class="w">        </span><span class="p">},</span>
</span><span id="__span-42-16"><span class="w">        </span><span class="nt">&quot;ComparisonOperator&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;GreaterThanThreshold&quot;</span><span class="p">,</span>
</span><span id="__span-42-17"><span class="w">        </span><span class="nt">&quot;Dimensions&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-42-18"><span class="w">            </span><span class="p">{</span>
</span><span id="__span-42-19"><span class="w">                </span><span class="nt">&quot;Name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AutoScalingGroupName&quot;</span><span class="p">,</span>
</span><span id="__span-42-20"><span class="w">                </span><span class="nt">&quot;Value&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-42-21"><span class="w">                    </span><span class="nt">&quot;Ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;asgLavaWorker&quot;</span>
</span><span id="__span-42-22"><span class="w">                </span><span class="p">}</span>
</span><span id="__span-42-23"><span class="w">            </span><span class="p">}</span>
</span><span id="__span-42-24"><span class="w">        </span><span class="p">],</span>
</span><span id="__span-42-25"><span class="w">        </span><span class="nt">&quot;EvaluationPeriods&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span>
</span><span id="__span-42-26"><span class="w">        </span><span class="nt">&quot;InsufficientDataActions&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span>
</span><span id="__span-42-27"><span class="w">        </span><span class="nt">&quot;MetricName&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;StatusCheckFailed&quot;</span><span class="p">,</span>
</span><span id="__span-42-28"><span class="w">        </span><span class="nt">&quot;Namespace&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AWS/EC2&quot;</span><span class="p">,</span>
</span><span id="__span-42-29"><span class="w">        </span><span class="nt">&quot;OKActions&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-42-30"><span class="w">            </span><span class="p">{</span>
</span><span id="__span-42-31"><span class="w">                </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;arn:aws:sns:${AWS::Region}:${AWS::AccountId}:${alarmTopic}&quot;</span>
</span><span id="__span-42-32"><span class="w">            </span><span class="p">}</span>
</span><span id="__span-42-33"><span class="w">        </span><span class="p">],</span>
</span><span id="__span-42-34"><span class="w">        </span><span class="nt">&quot;Period&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">60</span><span class="p">,</span>
</span><span id="__span-42-35"><span class="w">        </span><span class="nt">&quot;Statistic&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Average&quot;</span><span class="p">,</span>
</span><span id="__span-42-36"><span class="w">        </span><span class="nt">&quot;Threshold&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;0.0&quot;</span><span class="p">,</span>
</span><span id="__span-42-37"><span class="w">        </span><span class="nt">&quot;TreatMissingData&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;notBreaching&quot;</span>
</span><span id="__span-42-38"><span class="w">    </span><span class="p">},</span>
</span><span id="__span-42-39"><span class="w">    </span><span class="nt">&quot;Type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AWS::CloudWatch::Alarm&quot;</span>
</span><span id="__span-42-40"><span class="p">}</span>
</span></code></pre></div>
</div>
</div>
</div>
<h4 id="alarmqueuedepth"><a href="#cloudwatch-resources">alarmQueueDepth</a><a class="headerlink" href="#alarmqueuedepth" title="Permanent link">&para;</a></h4>
<div class="tabbed-set tabbed-alternate" data-tabs="44:2"><input checked="checked" id="__tabbed_44_1" name="__tabbed_44" type="radio" /><input id="__tabbed_44_2" name="__tabbed_44" type="radio" /><div class="tabbed-labels"><label for="__tabbed_44_1">Details</label><label for="__tabbed_44_2">Source</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<table>
<thead>
<tr>
<th>Property</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Type</td>
<td><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-cloudwatch-alarm.html" title="AWS documentation for this resource type">AWS::CloudWatch::Alarm</a></td>
</tr>
<tr>
<td>Group</td>
<td><a href="#cloudwatch-resources">CloudWatch Resources</a> (<a href="#cloudwatch-resources">CloudWatch</a>)</td>
</tr>
<tr>
<td>Description</td>
<td>Queue depth alarm for Lava worker.</td>
</tr>
</tbody>
</table>
</div>
<div class="tabbed-block">
<div class="language-json highlight"><pre><span></span><code><span id="__span-43-1"><span class="p">{</span>
</span><span id="__span-43-2"><span class="w">    </span><span class="nt">&quot;Condition&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ifCreateQueueDepthAlarm&quot;</span><span class="p">,</span>
</span><span id="__span-43-3"><span class="w">    </span><span class="nt">&quot;Properties&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-43-4"><span class="w">        </span><span class="nt">&quot;ActionsEnabled&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;true&quot;</span><span class="p">,</span>
</span><span id="__span-43-5"><span class="w">        </span><span class="nt">&quot;AlarmActions&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-43-6"><span class="w">            </span><span class="p">{</span>
</span><span id="__span-43-7"><span class="w">                </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;arn:aws:sns:${AWS::Region}:${AWS::AccountId}:${alarmTopic}&quot;</span>
</span><span id="__span-43-8"><span class="w">            </span><span class="p">}</span>
</span><span id="__span-43-9"><span class="w">        </span><span class="p">],</span>
</span><span id="__span-43-10"><span class="w">        </span><span class="nt">&quot;AlarmDescription&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-43-11"><span class="w">            </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Too many messages queued for lava-${realm}-${worker}&quot;</span>
</span><span id="__span-43-12"><span class="w">        </span><span class="p">},</span>
</span><span id="__span-43-13"><span class="w">        </span><span class="nt">&quot;AlarmName&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-43-14"><span class="w">            </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;lava-${realm}-${worker}-queue-depth&quot;</span>
</span><span id="__span-43-15"><span class="w">        </span><span class="p">},</span>
</span><span id="__span-43-16"><span class="w">        </span><span class="nt">&quot;ComparisonOperator&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;GreaterThanThreshold&quot;</span><span class="p">,</span>
</span><span id="__span-43-17"><span class="w">        </span><span class="nt">&quot;DatapointsToAlarm&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-43-18"><span class="w">            </span><span class="nt">&quot;Ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;queueDepthMinutes&quot;</span>
</span><span id="__span-43-19"><span class="w">        </span><span class="p">},</span>
</span><span id="__span-43-20"><span class="w">        </span><span class="nt">&quot;Dimensions&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-43-21"><span class="w">            </span><span class="p">{</span>
</span><span id="__span-43-22"><span class="w">                </span><span class="nt">&quot;Name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;QueueName&quot;</span><span class="p">,</span>
</span><span id="__span-43-23"><span class="w">                </span><span class="nt">&quot;Value&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-43-24"><span class="w">                    </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;lava-${realm}-${worker}&quot;</span>
</span><span id="__span-43-25"><span class="w">                </span><span class="p">}</span>
</span><span id="__span-43-26"><span class="w">            </span><span class="p">}</span>
</span><span id="__span-43-27"><span class="w">        </span><span class="p">],</span>
</span><span id="__span-43-28"><span class="w">        </span><span class="nt">&quot;EvaluationPeriods&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-43-29"><span class="w">            </span><span class="nt">&quot;Ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;queueDepthMinutes&quot;</span>
</span><span id="__span-43-30"><span class="w">        </span><span class="p">},</span>
</span><span id="__span-43-31"><span class="w">        </span><span class="nt">&quot;InsufficientDataActions&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span>
</span><span id="__span-43-32"><span class="w">        </span><span class="nt">&quot;MetricName&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ApproximateNumberOfMessagesVisible&quot;</span><span class="p">,</span>
</span><span id="__span-43-33"><span class="w">        </span><span class="nt">&quot;Namespace&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AWS/SQS&quot;</span><span class="p">,</span>
</span><span id="__span-43-34"><span class="w">        </span><span class="nt">&quot;OKActions&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-43-35"><span class="w">            </span><span class="p">{</span>
</span><span id="__span-43-36"><span class="w">                </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;arn:aws:sns:${AWS::Region}:${AWS::AccountId}:${alarmTopic}&quot;</span>
</span><span id="__span-43-37"><span class="w">            </span><span class="p">}</span>
</span><span id="__span-43-38"><span class="w">        </span><span class="p">],</span>
</span><span id="__span-43-39"><span class="w">        </span><span class="nt">&quot;Period&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">60</span><span class="p">,</span>
</span><span id="__span-43-40"><span class="w">        </span><span class="nt">&quot;Statistic&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Maximum&quot;</span><span class="p">,</span>
</span><span id="__span-43-41"><span class="w">        </span><span class="nt">&quot;Threshold&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-43-42"><span class="w">            </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;${maxAllowedQueueDepth}.0&quot;</span>
</span><span id="__span-43-43"><span class="w">        </span><span class="p">},</span>
</span><span id="__span-43-44"><span class="w">        </span><span class="nt">&quot;TreatMissingData&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ignore&quot;</span>
</span><span id="__span-43-45"><span class="w">    </span><span class="p">},</span>
</span><span id="__span-43-46"><span class="w">    </span><span class="nt">&quot;Type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AWS::CloudWatch::Alarm&quot;</span>
</span><span id="__span-43-47"><span class="p">}</span>
</span></code></pre></div>
</div>
</div>
</div>
<h4 id="asglavaworker"><a href="#autoscaling-resources">asgLavaWorker</a><a class="headerlink" href="#asglavaworker" title="Permanent link">&para;</a></h4>
<div class="tabbed-set tabbed-alternate" data-tabs="45:2"><input checked="checked" id="__tabbed_45_1" name="__tabbed_45" type="radio" /><input id="__tabbed_45_2" name="__tabbed_45" type="radio" /><div class="tabbed-labels"><label for="__tabbed_45_1">Details</label><label for="__tabbed_45_2">Source</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<table>
<thead>
<tr>
<th>Property</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Type</td>
<td><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-autoscaling-autoscalinggroup.html" title="AWS documentation for this resource type">AWS::AutoScaling::AutoScalingGroup</a></td>
</tr>
<tr>
<td>Group</td>
<td><a href="#autoscaling-resources">AutoScaling Resources</a> (<a href="#autoscaling-resources">AutoScaling</a>)</td>
</tr>
<tr>
<td>Description</td>
<td>Auto scaling group for Lava worker</td>
</tr>
</tbody>
</table>
</div>
<div class="tabbed-block">
<div class="language-json highlight"><pre><span></span><code><span id="__span-44-1"><span class="p">{</span>
</span><span id="__span-44-2"><span class="w">    </span><span class="nt">&quot;Condition&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ifCreateInstance&quot;</span><span class="p">,</span>
</span><span id="__span-44-3"><span class="w">    </span><span class="nt">&quot;Properties&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-44-4"><span class="w">        </span><span class="nt">&quot;AutoScalingGroupName&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-44-5"><span class="w">            </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;lava-${realm}-${worker}&quot;</span>
</span><span id="__span-44-6"><span class="w">        </span><span class="p">},</span>
</span><span id="__span-44-7"><span class="w">        </span><span class="nt">&quot;DesiredCapacity&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-44-8"><span class="w">            </span><span class="nt">&quot;Ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;workerInstancesDesired&quot;</span>
</span><span id="__span-44-9"><span class="w">        </span><span class="p">},</span>
</span><span id="__span-44-10"><span class="w">        </span><span class="nt">&quot;HealthCheckGracePeriod&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">300</span><span class="p">,</span>
</span><span id="__span-44-11"><span class="w">        </span><span class="nt">&quot;LaunchTemplate&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-44-12"><span class="w">            </span><span class="nt">&quot;Fn::If&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-44-13"><span class="w">                </span><span class="s2">&quot;ifInstanceType&quot;</span><span class="p">,</span>
</span><span id="__span-44-14"><span class="w">                </span><span class="p">{</span>
</span><span id="__span-44-15"><span class="w">                    </span><span class="nt">&quot;LaunchTemplateId&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-44-16"><span class="w">                        </span><span class="nt">&quot;Ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;launchtemplateLavaWorker&quot;</span>
</span><span id="__span-44-17"><span class="w">                    </span><span class="p">},</span>
</span><span id="__span-44-18"><span class="w">                    </span><span class="nt">&quot;Version&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-44-19"><span class="w">                        </span><span class="nt">&quot;Fn::GetAtt&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-44-20"><span class="w">                            </span><span class="s2">&quot;launchtemplateLavaWorker&quot;</span><span class="p">,</span>
</span><span id="__span-44-21"><span class="w">                            </span><span class="s2">&quot;LatestVersionNumber&quot;</span>
</span><span id="__span-44-22"><span class="w">                        </span><span class="p">]</span>
</span><span id="__span-44-23"><span class="w">                    </span><span class="p">}</span>
</span><span id="__span-44-24"><span class="w">                </span><span class="p">},</span>
</span><span id="__span-44-25"><span class="w">                </span><span class="p">{</span>
</span><span id="__span-44-26"><span class="w">                    </span><span class="nt">&quot;Ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AWS::NoValue&quot;</span>
</span><span id="__span-44-27"><span class="w">                </span><span class="p">}</span>
</span><span id="__span-44-28"><span class="w">            </span><span class="p">]</span>
</span><span id="__span-44-29"><span class="w">        </span><span class="p">},</span>
</span><span id="__span-44-30"><span class="w">        </span><span class="nt">&quot;LifecycleHookSpecificationList&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-44-31"><span class="w">            </span><span class="p">{</span>
</span><span id="__span-44-32"><span class="w">                </span><span class="nt">&quot;DefaultResult&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;CONTINUE&quot;</span><span class="p">,</span>
</span><span id="__span-44-33"><span class="w">                </span><span class="nt">&quot;HeartbeatTimeout&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1800</span><span class="p">,</span>
</span><span id="__span-44-34"><span class="w">                </span><span class="nt">&quot;LifecycleHookName&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;terminate&quot;</span><span class="p">,</span>
</span><span id="__span-44-35"><span class="w">                </span><span class="nt">&quot;LifecycleTransition&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;autoscaling:EC2_INSTANCE_TERMINATING&quot;</span><span class="p">,</span>
</span><span id="__span-44-36"><span class="w">                </span><span class="nt">&quot;NotificationMetadata&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-44-37"><span class="w">                    </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;{\&quot;realm\&quot;: \&quot;${realm}\&quot;,\&quot;worker\&quot;:\&quot;${worker}\&quot;}&quot;</span>
</span><span id="__span-44-38"><span class="w">                </span><span class="p">}</span>
</span><span id="__span-44-39"><span class="w">            </span><span class="p">}</span>
</span><span id="__span-44-40"><span class="w">        </span><span class="p">],</span>
</span><span id="__span-44-41"><span class="w">        </span><span class="nt">&quot;MaxSize&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-44-42"><span class="w">            </span><span class="nt">&quot;Ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;workerInstancesMax&quot;</span>
</span><span id="__span-44-43"><span class="w">        </span><span class="p">},</span>
</span><span id="__span-44-44"><span class="w">        </span><span class="nt">&quot;MetricsCollection&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-44-45"><span class="w">            </span><span class="p">{</span>
</span><span id="__span-44-46"><span class="w">                </span><span class="nt">&quot;Granularity&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1Minute&quot;</span>
</span><span id="__span-44-47"><span class="w">            </span><span class="p">}</span>
</span><span id="__span-44-48"><span class="w">        </span><span class="p">],</span>
</span><span id="__span-44-49"><span class="w">        </span><span class="nt">&quot;MinSize&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-44-50"><span class="w">            </span><span class="nt">&quot;Ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;workerInstancesMin&quot;</span>
</span><span id="__span-44-51"><span class="w">        </span><span class="p">},</span>
</span><span id="__span-44-52"><span class="w">        </span><span class="nt">&quot;MixedInstancesPolicy&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-44-53"><span class="w">            </span><span class="nt">&quot;Fn::If&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-44-54"><span class="w">                </span><span class="s2">&quot;ifInstanceType&quot;</span><span class="p">,</span>
</span><span id="__span-44-55"><span class="w">                </span><span class="p">{</span>
</span><span id="__span-44-56"><span class="w">                    </span><span class="nt">&quot;Ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AWS::NoValue&quot;</span>
</span><span id="__span-44-57"><span class="w">                </span><span class="p">},</span>
</span><span id="__span-44-58"><span class="w">                </span><span class="p">{</span>
</span><span id="__span-44-59"><span class="w">                    </span><span class="nt">&quot;InstancesDistribution&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-44-60"><span class="w">                        </span><span class="nt">&quot;OnDemandAllocationStrategy&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;lowest-price&quot;</span><span class="p">,</span>
</span><span id="__span-44-61"><span class="w">                        </span><span class="nt">&quot;OnDemandBaseCapacity&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
</span><span id="__span-44-62"><span class="w">                        </span><span class="nt">&quot;OnDemandPercentageAboveBaseCapacity&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span>
</span><span id="__span-44-63"><span class="w">                    </span><span class="p">},</span>
</span><span id="__span-44-64"><span class="w">                    </span><span class="nt">&quot;LaunchTemplate&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-44-65"><span class="w">                        </span><span class="nt">&quot;LaunchTemplateSpecification&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-44-66"><span class="w">                            </span><span class="nt">&quot;LaunchTemplateId&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-44-67"><span class="w">                                </span><span class="nt">&quot;Ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;launchtemplateLavaWorker&quot;</span>
</span><span id="__span-44-68"><span class="w">                            </span><span class="p">},</span>
</span><span id="__span-44-69"><span class="w">                            </span><span class="nt">&quot;Version&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-44-70"><span class="w">                                </span><span class="nt">&quot;Fn::GetAtt&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-44-71"><span class="w">                                    </span><span class="s2">&quot;launchtemplateLavaWorker&quot;</span><span class="p">,</span>
</span><span id="__span-44-72"><span class="w">                                    </span><span class="s2">&quot;LatestVersionNumber&quot;</span>
</span><span id="__span-44-73"><span class="w">                                </span><span class="p">]</span>
</span><span id="__span-44-74"><span class="w">                            </span><span class="p">}</span>
</span><span id="__span-44-75"><span class="w">                        </span><span class="p">},</span>
</span><span id="__span-44-76"><span class="w">                        </span><span class="nt">&quot;Overrides&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-44-77"><span class="w">                            </span><span class="p">{</span>
</span><span id="__span-44-78"><span class="w">                                </span><span class="nt">&quot;InstanceRequirements&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-44-79"><span class="w">                                    </span><span class="nt">&quot;AllowedInstanceTypes&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-44-80"><span class="w">                                        </span><span class="nt">&quot;Ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;workerAllowedInstances&quot;</span>
</span><span id="__span-44-81"><span class="w">                                    </span><span class="p">},</span>
</span><span id="__span-44-82"><span class="w">                                    </span><span class="nt">&quot;BurstablePerformance&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-44-83"><span class="w">                                        </span><span class="nt">&quot;Ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;workerBurstable&quot;</span>
</span><span id="__span-44-84"><span class="w">                                    </span><span class="p">},</span>
</span><span id="__span-44-85"><span class="w">                                    </span><span class="nt">&quot;InstanceGenerations&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-44-86"><span class="w">                                        </span><span class="s2">&quot;current&quot;</span><span class="p">,</span>
</span><span id="__span-44-87"><span class="w">                                        </span><span class="s2">&quot;previous&quot;</span>
</span><span id="__span-44-88"><span class="w">                                    </span><span class="p">],</span>
</span><span id="__span-44-89"><span class="w">                                    </span><span class="nt">&quot;LocalStorage&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-44-90"><span class="w">                                        </span><span class="nt">&quot;Ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;workerLocalStorage&quot;</span>
</span><span id="__span-44-91"><span class="w">                                    </span><span class="p">},</span>
</span><span id="__span-44-92"><span class="w">                                    </span><span class="nt">&quot;MemoryMiB&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-44-93"><span class="w">                                        </span><span class="nt">&quot;Max&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-44-94"><span class="w">                                            </span><span class="nt">&quot;Fn::If&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-44-95"><span class="w">                                                </span><span class="s2">&quot;ifMaxMemory&quot;</span><span class="p">,</span>
</span><span id="__span-44-96"><span class="w">                                                </span><span class="p">{</span>
</span><span id="__span-44-97"><span class="w">                                                    </span><span class="nt">&quot;Ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;workerMemoryMax&quot;</span>
</span><span id="__span-44-98"><span class="w">                                                </span><span class="p">},</span>
</span><span id="__span-44-99"><span class="w">                                                </span><span class="p">{</span>
</span><span id="__span-44-100"><span class="w">                                                    </span><span class="nt">&quot;Ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AWS::NoValue&quot;</span>
</span><span id="__span-44-101"><span class="w">                                                </span><span class="p">}</span>
</span><span id="__span-44-102"><span class="w">                                            </span><span class="p">]</span>
</span><span id="__span-44-103"><span class="w">                                        </span><span class="p">},</span>
</span><span id="__span-44-104"><span class="w">                                        </span><span class="nt">&quot;Min&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-44-105"><span class="w">                                            </span><span class="nt">&quot;Ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;workerMemoryMin&quot;</span>
</span><span id="__span-44-106"><span class="w">                                        </span><span class="p">}</span>
</span><span id="__span-44-107"><span class="w">                                    </span><span class="p">},</span>
</span><span id="__span-44-108"><span class="w">                                    </span><span class="nt">&quot;VCpuCount&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-44-109"><span class="w">                                        </span><span class="nt">&quot;Max&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-44-110"><span class="w">                                            </span><span class="nt">&quot;Fn::If&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-44-111"><span class="w">                                                </span><span class="s2">&quot;ifMaxVCpu&quot;</span><span class="p">,</span>
</span><span id="__span-44-112"><span class="w">                                                </span><span class="p">{</span>
</span><span id="__span-44-113"><span class="w">                                                    </span><span class="nt">&quot;Ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;workerVCpuMax&quot;</span>
</span><span id="__span-44-114"><span class="w">                                                </span><span class="p">},</span>
</span><span id="__span-44-115"><span class="w">                                                </span><span class="p">{</span>
</span><span id="__span-44-116"><span class="w">                                                    </span><span class="nt">&quot;Ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AWS::NoValue&quot;</span>
</span><span id="__span-44-117"><span class="w">                                                </span><span class="p">}</span>
</span><span id="__span-44-118"><span class="w">                                            </span><span class="p">]</span>
</span><span id="__span-44-119"><span class="w">                                        </span><span class="p">},</span>
</span><span id="__span-44-120"><span class="w">                                        </span><span class="nt">&quot;Min&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-44-121"><span class="w">                                            </span><span class="nt">&quot;Ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;workerVCpuMin&quot;</span>
</span><span id="__span-44-122"><span class="w">                                        </span><span class="p">}</span>
</span><span id="__span-44-123"><span class="w">                                    </span><span class="p">}</span>
</span><span id="__span-44-124"><span class="w">                                </span><span class="p">}</span>
</span><span id="__span-44-125"><span class="w">                            </span><span class="p">}</span>
</span><span id="__span-44-126"><span class="w">                        </span><span class="p">]</span>
</span><span id="__span-44-127"><span class="w">                    </span><span class="p">}</span>
</span><span id="__span-44-128"><span class="w">                </span><span class="p">}</span>
</span><span id="__span-44-129"><span class="w">            </span><span class="p">]</span>
</span><span id="__span-44-130"><span class="w">        </span><span class="p">},</span>
</span><span id="__span-44-131"><span class="w">        </span><span class="nt">&quot;NotificationConfigurations&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-44-132"><span class="w">            </span><span class="p">{</span>
</span><span id="__span-44-133"><span class="w">                </span><span class="nt">&quot;NotificationTypes&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-44-134"><span class="w">                    </span><span class="s2">&quot;autoscaling:EC2_INSTANCE_LAUNCH_ERROR&quot;</span><span class="p">,</span>
</span><span id="__span-44-135"><span class="w">                    </span><span class="s2">&quot;autoscaling:EC2_INSTANCE_TERMINATE_ERROR&quot;</span><span class="p">,</span>
</span><span id="__span-44-136"><span class="w">                    </span><span class="s2">&quot;autoscaling:TEST_NOTIFICATION&quot;</span>
</span><span id="__span-44-137"><span class="w">                </span><span class="p">],</span>
</span><span id="__span-44-138"><span class="w">                </span><span class="nt">&quot;TopicARN&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-44-139"><span class="w">                    </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;arn:aws:sns:${AWS::Region}:${AWS::AccountId}:${alarmTopic}&quot;</span>
</span><span id="__span-44-140"><span class="w">                </span><span class="p">}</span>
</span><span id="__span-44-141"><span class="w">            </span><span class="p">},</span>
</span><span id="__span-44-142"><span class="w">            </span><span class="p">{</span>
</span><span id="__span-44-143"><span class="w">                </span><span class="nt">&quot;NotificationTypes&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-44-144"><span class="w">                    </span><span class="s2">&quot;autoscaling:EC2_INSTANCE_LAUNCH&quot;</span><span class="p">,</span>
</span><span id="__span-44-145"><span class="w">                    </span><span class="s2">&quot;autoscaling:EC2_INSTANCE_TERMINATE&quot;</span><span class="p">,</span>
</span><span id="__span-44-146"><span class="w">                    </span><span class="s2">&quot;autoscaling:TEST_NOTIFICATION&quot;</span>
</span><span id="__span-44-147"><span class="w">                </span><span class="p">],</span>
</span><span id="__span-44-148"><span class="w">                </span><span class="nt">&quot;TopicARN&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-44-149"><span class="w">                    </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;arn:aws:sns:${AWS::Region}:${AWS::AccountId}:${autoscalingActionTopic}&quot;</span>
</span><span id="__span-44-150"><span class="w">                </span><span class="p">}</span>
</span><span id="__span-44-151"><span class="w">            </span><span class="p">}</span>
</span><span id="__span-44-152"><span class="w">        </span><span class="p">],</span>
</span><span id="__span-44-153"><span class="w">        </span><span class="nt">&quot;Tags&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-44-154"><span class="w">            </span><span class="p">{</span>
</span><span id="__span-44-155"><span class="w">                </span><span class="nt">&quot;Key&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Name&quot;</span><span class="p">,</span>
</span><span id="__span-44-156"><span class="w">                </span><span class="nt">&quot;PropagateAtLaunch&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;true&quot;</span><span class="p">,</span>
</span><span id="__span-44-157"><span class="w">                </span><span class="nt">&quot;Value&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-44-158"><span class="w">                    </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;lava-${realm}-${worker}&quot;</span>
</span><span id="__span-44-159"><span class="w">                </span><span class="p">}</span>
</span><span id="__span-44-160"><span class="w">            </span><span class="p">},</span>
</span><span id="__span-44-161"><span class="w">            </span><span class="p">{</span>
</span><span id="__span-44-162"><span class="w">                </span><span class="nt">&quot;Key&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;LavaRealm&quot;</span><span class="p">,</span>
</span><span id="__span-44-163"><span class="w">                </span><span class="nt">&quot;PropagateAtLaunch&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;true&quot;</span><span class="p">,</span>
</span><span id="__span-44-164"><span class="w">                </span><span class="nt">&quot;Value&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-44-165"><span class="w">                    </span><span class="nt">&quot;Ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;realm&quot;</span>
</span><span id="__span-44-166"><span class="w">                </span><span class="p">}</span>
</span><span id="__span-44-167"><span class="w">            </span><span class="p">},</span>
</span><span id="__span-44-168"><span class="w">            </span><span class="p">{</span>
</span><span id="__span-44-169"><span class="w">                </span><span class="nt">&quot;Key&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;LavaWorker&quot;</span><span class="p">,</span>
</span><span id="__span-44-170"><span class="w">                </span><span class="nt">&quot;PropagateAtLaunch&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;true&quot;</span><span class="p">,</span>
</span><span id="__span-44-171"><span class="w">                </span><span class="nt">&quot;Value&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-44-172"><span class="w">                    </span><span class="nt">&quot;Ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;worker&quot;</span>
</span><span id="__span-44-173"><span class="w">                </span><span class="p">}</span>
</span><span id="__span-44-174"><span class="w">            </span><span class="p">}</span>
</span><span id="__span-44-175"><span class="w">        </span><span class="p">],</span>
</span><span id="__span-44-176"><span class="w">        </span><span class="nt">&quot;VPCZoneIdentifier&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-44-177"><span class="w">            </span><span class="nt">&quot;Ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;subnets&quot;</span>
</span><span id="__span-44-178"><span class="w">        </span><span class="p">}</span>
</span><span id="__span-44-179"><span class="w">    </span><span class="p">},</span>
</span><span id="__span-44-180"><span class="w">    </span><span class="nt">&quot;Type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AWS::AutoScaling::AutoScalingGroup&quot;</span>
</span><span id="__span-44-181"><span class="p">}</span>
</span></code></pre></div>
</div>
</div>
</div>
<h4 id="asgworkerscalingpolicy"><a href="#autoscaling-resources">asgWorkerScalingPolicy</a><a class="headerlink" href="#asgworkerscalingpolicy" title="Permanent link">&para;</a></h4>
<div class="tabbed-set tabbed-alternate" data-tabs="46:2"><input checked="checked" id="__tabbed_46_1" name="__tabbed_46" type="radio" /><input id="__tabbed_46_2" name="__tabbed_46" type="radio" /><div class="tabbed-labels"><label for="__tabbed_46_1">Details</label><label for="__tabbed_46_2">Source</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<table>
<thead>
<tr>
<th>Property</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Type</td>
<td><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-autoscaling-scalingpolicy.html" title="AWS documentation for this resource type">AWS::AutoScaling::ScalingPolicy</a></td>
</tr>
<tr>
<td>Group</td>
<td><a href="#autoscaling-resources">AutoScaling Resources</a> (<a href="#autoscaling-resources">AutoScaling</a>)</td>
</tr>
<tr>
<td>Description</td>
<td>Target tracking scaling policy for worker</td>
</tr>
</tbody>
</table>
</div>
<div class="tabbed-block">
<div class="language-json highlight"><pre><span></span><code><span id="__span-45-1"><span class="p">{</span>
</span><span id="__span-45-2"><span class="w">    </span><span class="nt">&quot;Condition&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ifWorkerBacklogScaling&quot;</span><span class="p">,</span>
</span><span id="__span-45-3"><span class="w">    </span><span class="nt">&quot;Properties&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-45-4"><span class="w">        </span><span class="nt">&quot;AutoScalingGroupName&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-45-5"><span class="w">            </span><span class="nt">&quot;Ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;asgLavaWorker&quot;</span>
</span><span id="__span-45-6"><span class="w">        </span><span class="p">},</span>
</span><span id="__span-45-7"><span class="w">        </span><span class="nt">&quot;EstimatedInstanceWarmup&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">240</span><span class="p">,</span>
</span><span id="__span-45-8"><span class="w">        </span><span class="nt">&quot;PolicyType&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;TargetTrackingScaling&quot;</span><span class="p">,</span>
</span><span id="__span-45-9"><span class="w">        </span><span class="nt">&quot;TargetTrackingConfiguration&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-45-10"><span class="w">            </span><span class="nt">&quot;CustomizedMetricSpecification&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-45-11"><span class="w">                </span><span class="nt">&quot;Dimensions&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-45-12"><span class="w">                    </span><span class="p">{</span>
</span><span id="__span-45-13"><span class="w">                        </span><span class="nt">&quot;Name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Realm&quot;</span><span class="p">,</span>
</span><span id="__span-45-14"><span class="w">                        </span><span class="nt">&quot;Value&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-45-15"><span class="w">                            </span><span class="nt">&quot;Ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;realm&quot;</span>
</span><span id="__span-45-16"><span class="w">                        </span><span class="p">}</span>
</span><span id="__span-45-17"><span class="w">                    </span><span class="p">},</span>
</span><span id="__span-45-18"><span class="w">                    </span><span class="p">{</span>
</span><span id="__span-45-19"><span class="w">                        </span><span class="nt">&quot;Name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Worker&quot;</span><span class="p">,</span>
</span><span id="__span-45-20"><span class="w">                        </span><span class="nt">&quot;Value&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-45-21"><span class="w">                            </span><span class="nt">&quot;Ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;worker&quot;</span>
</span><span id="__span-45-22"><span class="w">                        </span><span class="p">}</span>
</span><span id="__span-45-23"><span class="w">                    </span><span class="p">}</span>
</span><span id="__span-45-24"><span class="w">                </span><span class="p">],</span>
</span><span id="__span-45-25"><span class="w">                </span><span class="nt">&quot;MetricName&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;WorkerBacklog&quot;</span><span class="p">,</span>
</span><span id="__span-45-26"><span class="w">                </span><span class="nt">&quot;Namespace&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Lava&quot;</span><span class="p">,</span>
</span><span id="__span-45-27"><span class="w">                </span><span class="nt">&quot;Statistic&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Average&quot;</span>
</span><span id="__span-45-28"><span class="w">            </span><span class="p">},</span>
</span><span id="__span-45-29"><span class="w">            </span><span class="nt">&quot;TargetValue&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-45-30"><span class="w">                </span><span class="nt">&quot;Ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;workerBacklogScalingTarget&quot;</span>
</span><span id="__span-45-31"><span class="w">            </span><span class="p">}</span>
</span><span id="__span-45-32"><span class="w">        </span><span class="p">}</span>
</span><span id="__span-45-33"><span class="w">    </span><span class="p">},</span>
</span><span id="__span-45-34"><span class="w">    </span><span class="nt">&quot;Type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AWS::AutoScaling::ScalingPolicy&quot;</span>
</span><span id="__span-45-35"><span class="p">}</span>
</span></code></pre></div>
</div>
</div>
</div>
<h4 id="eventsworkerterminating"><a href="#events-resources">eventsWorkerTerminating</a><a class="headerlink" href="#eventsworkerterminating" title="Permanent link">&para;</a></h4>
<div class="tabbed-set tabbed-alternate" data-tabs="47:2"><input checked="checked" id="__tabbed_47_1" name="__tabbed_47" type="radio" /><input id="__tabbed_47_2" name="__tabbed_47" type="radio" /><div class="tabbed-labels"><label for="__tabbed_47_1">Details</label><label for="__tabbed_47_2">Source</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<table>
<thead>
<tr>
<th>Property</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Type</td>
<td><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-events-rule.html" title="AWS documentation for this resource type">AWS::Events::Rule</a></td>
</tr>
<tr>
<td>Group</td>
<td><a href="#events-resources">Events Resources</a> (<a href="#events-resources">Events</a>)</td>
</tr>
<tr>
<td>Description</td>
<td>EventBridge rule for terminating worker.</td>
</tr>
</tbody>
</table>
</div>
<div class="tabbed-block">
<div class="language-json highlight"><pre><span></span><code><span id="__span-46-1"><span class="p">{</span>
</span><span id="__span-46-2"><span class="w">    </span><span class="nt">&quot;Condition&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ifRealmLambdasDeployed&quot;</span><span class="p">,</span>
</span><span id="__span-46-3"><span class="w">    </span><span class="nt">&quot;Properties&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-46-4"><span class="w">        </span><span class="nt">&quot;Description&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-46-5"><span class="w">            </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;lava-${realm}-${worker} worker node is terminating&quot;</span>
</span><span id="__span-46-6"><span class="w">        </span><span class="p">},</span>
</span><span id="__span-46-7"><span class="w">        </span><span class="nt">&quot;EventBusName&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;default&quot;</span><span class="p">,</span>
</span><span id="__span-46-8"><span class="w">        </span><span class="nt">&quot;EventPattern&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-46-9"><span class="w">            </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;{\&quot;source\&quot;: [\&quot;aws.autoscaling\&quot;], \&quot;detail-type\&quot;: [\&quot;EC2 Instance-terminate Lifecycle Action\&quot;], \&quot;detail\&quot;: {\&quot;AutoScalingGroupName\&quot;: [\&quot;lava-${realm}-${worker}\&quot;] }}&quot;</span>
</span><span id="__span-46-10"><span class="w">        </span><span class="p">},</span>
</span><span id="__span-46-11"><span class="w">        </span><span class="nt">&quot;Name&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-46-12"><span class="w">            </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;lava-${realm}-${worker}-terminating&quot;</span>
</span><span id="__span-46-13"><span class="w">        </span><span class="p">},</span>
</span><span id="__span-46-14"><span class="w">        </span><span class="nt">&quot;State&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-46-15"><span class="w">            </span><span class="nt">&quot;Ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;autoscalingControlledTermination&quot;</span>
</span><span id="__span-46-16"><span class="w">        </span><span class="p">},</span>
</span><span id="__span-46-17"><span class="w">        </span><span class="nt">&quot;Targets&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-46-18"><span class="w">            </span><span class="p">{</span>
</span><span id="__span-46-19"><span class="w">                </span><span class="nt">&quot;Arn&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-46-20"><span class="w">                    </span><span class="nt">&quot;Fn::ImportValue&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-46-21"><span class="w">                        </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;lava:${realm}:lambdaLavaStop&quot;</span>
</span><span id="__span-46-22"><span class="w">                    </span><span class="p">}</span>
</span><span id="__span-46-23"><span class="w">                </span><span class="p">},</span>
</span><span id="__span-46-24"><span class="w">                </span><span class="nt">&quot;Id&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-46-25"><span class="w">                    </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;lava-${realm}-${worker}-stop-lambda&quot;</span>
</span><span id="__span-46-26"><span class="w">                </span><span class="p">},</span>
</span><span id="__span-46-27"><span class="w">                </span><span class="nt">&quot;InputPath&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;$.detail&quot;</span>
</span><span id="__span-46-28"><span class="w">            </span><span class="p">},</span>
</span><span id="__span-46-29"><span class="w">            </span><span class="p">{</span>
</span><span id="__span-46-30"><span class="w">                </span><span class="nt">&quot;Arn&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-46-31"><span class="w">                    </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;arn:aws:logs:${AWS::Region}:${AWS::AccountId}:log-group:/aws/events/lava&quot;</span>
</span><span id="__span-46-32"><span class="w">                </span><span class="p">},</span>
</span><span id="__span-46-33"><span class="w">                </span><span class="nt">&quot;Id&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-46-34"><span class="w">                    </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;lava-${realm}-${worker}-log-events&quot;</span>
</span><span id="__span-46-35"><span class="w">                </span><span class="p">}</span>
</span><span id="__span-46-36"><span class="w">            </span><span class="p">}</span>
</span><span id="__span-46-37"><span class="w">        </span><span class="p">]</span>
</span><span id="__span-46-38"><span class="w">    </span><span class="p">},</span>
</span><span id="__span-46-39"><span class="w">    </span><span class="nt">&quot;Type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AWS::Events::Rule&quot;</span>
</span><span id="__span-46-40"><span class="p">}</span>
</span></code></pre></div>
</div>
</div>
</div>
<h4 id="iamlavaworkerrole"><a href="#iam-resources">iamLavaWorkerRole</a><a class="headerlink" href="#iamlavaworkerrole" title="Permanent link">&para;</a></h4>
<div class="tabbed-set tabbed-alternate" data-tabs="48:2"><input checked="checked" id="__tabbed_48_1" name="__tabbed_48" type="radio" /><input id="__tabbed_48_2" name="__tabbed_48" type="radio" /><div class="tabbed-labels"><label for="__tabbed_48_1">Details</label><label for="__tabbed_48_2">Source</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<table>
<thead>
<tr>
<th>Property</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Type</td>
<td><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-iam-role.html" title="AWS documentation for this resource type">AWS::IAM::Role</a></td>
</tr>
<tr>
<td>Group</td>
<td><a href="#iam-resources">IAM Resources</a> (<a href="#iam-resources">IAM</a>)</td>
</tr>
<tr>
<td>Description</td>
<td>IAM role for worker instances.</td>
</tr>
</tbody>
</table>
</div>
<div class="tabbed-block">
<div class="language-json highlight"><pre><span></span><code><span id="__span-47-1"><span class="p">{</span>
</span><span id="__span-47-2"><span class="w">    </span><span class="nt">&quot;Condition&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ifCreateInstance&quot;</span><span class="p">,</span>
</span><span id="__span-47-3"><span class="w">    </span><span class="nt">&quot;Properties&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-47-4"><span class="w">        </span><span class="nt">&quot;AssumeRolePolicyDocument&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-47-5"><span class="w">            </span><span class="nt">&quot;Statement&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-47-6"><span class="w">                </span><span class="p">{</span>
</span><span id="__span-47-7"><span class="w">                    </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;sts:AssumeRole&quot;</span><span class="p">,</span>
</span><span id="__span-47-8"><span class="w">                    </span><span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
</span><span id="__span-47-9"><span class="w">                    </span><span class="nt">&quot;Principal&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-47-10"><span class="w">                        </span><span class="nt">&quot;Service&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ec2.amazonaws.com&quot;</span>
</span><span id="__span-47-11"><span class="w">                    </span><span class="p">}</span>
</span><span id="__span-47-12"><span class="w">                </span><span class="p">}</span>
</span><span id="__span-47-13"><span class="w">            </span><span class="p">],</span>
</span><span id="__span-47-14"><span class="w">            </span><span class="nt">&quot;Version&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2012-10-17&quot;</span>
</span><span id="__span-47-15"><span class="w">        </span><span class="p">},</span>
</span><span id="__span-47-16"><span class="w">        </span><span class="nt">&quot;ManagedPolicyArns&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-47-17"><span class="w">            </span><span class="p">{</span>
</span><span id="__span-47-18"><span class="w">                </span><span class="nt">&quot;Fn::ImportValue&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-47-19"><span class="w">                    </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;lava:${realm}:iamLavaWorkerPolicyArn&quot;</span>
</span><span id="__span-47-20"><span class="w">                </span><span class="p">}</span>
</span><span id="__span-47-21"><span class="w">            </span><span class="p">},</span>
</span><span id="__span-47-22"><span class="w">            </span><span class="s2">&quot;arn:aws:iam::aws:policy/CloudWatchAgentServerPolicy&quot;</span><span class="p">,</span>
</span><span id="__span-47-23"><span class="w">            </span><span class="s2">&quot;arn:aws:iam::aws:policy/AmazonSSMManagedInstanceCore&quot;</span>
</span><span id="__span-47-24"><span class="w">        </span><span class="p">],</span>
</span><span id="__span-47-25"><span class="w">        </span><span class="nt">&quot;RoleName&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-47-26"><span class="w">            </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;lava-${realm}-worker-${worker}&quot;</span>
</span><span id="__span-47-27"><span class="w">        </span><span class="p">}</span>
</span><span id="__span-47-28"><span class="w">    </span><span class="p">},</span>
</span><span id="__span-47-29"><span class="w">    </span><span class="nt">&quot;Type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AWS::IAM::Role&quot;</span>
</span><span id="__span-47-30"><span class="p">}</span>
</span></code></pre></div>
</div>
</div>
</div>
<h4 id="iamworkerinstanceprofile"><a href="#iam-resources">iamWorkerInstanceProfile</a><a class="headerlink" href="#iamworkerinstanceprofile" title="Permanent link">&para;</a></h4>
<div class="tabbed-set tabbed-alternate" data-tabs="49:2"><input checked="checked" id="__tabbed_49_1" name="__tabbed_49" type="radio" /><input id="__tabbed_49_2" name="__tabbed_49" type="radio" /><div class="tabbed-labels"><label for="__tabbed_49_1">Details</label><label for="__tabbed_49_2">Source</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<table>
<thead>
<tr>
<th>Property</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Type</td>
<td><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-iam-instanceprofile.html" title="AWS documentation for this resource type">AWS::IAM::InstanceProfile</a></td>
</tr>
<tr>
<td>Group</td>
<td><a href="#iam-resources">IAM Resources</a> (<a href="#iam-resources">IAM</a>)</td>
</tr>
</tbody>
</table>
</div>
<div class="tabbed-block">
<div class="language-json highlight"><pre><span></span><code><span id="__span-48-1"><span class="p">{</span>
</span><span id="__span-48-2"><span class="w">    </span><span class="nt">&quot;Condition&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ifCreateInstance&quot;</span><span class="p">,</span>
</span><span id="__span-48-3"><span class="w">    </span><span class="nt">&quot;Properties&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-48-4"><span class="w">        </span><span class="nt">&quot;Roles&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-48-5"><span class="w">            </span><span class="p">{</span>
</span><span id="__span-48-6"><span class="w">                </span><span class="nt">&quot;Ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;iamLavaWorkerRole&quot;</span>
</span><span id="__span-48-7"><span class="w">            </span><span class="p">}</span>
</span><span id="__span-48-8"><span class="w">        </span><span class="p">]</span>
</span><span id="__span-48-9"><span class="w">    </span><span class="p">},</span>
</span><span id="__span-48-10"><span class="w">    </span><span class="nt">&quot;Type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AWS::IAM::InstanceProfile&quot;</span>
</span><span id="__span-48-11"><span class="p">}</span>
</span></code></pre></div>
</div>
</div>
</div>
<h4 id="lambdalavastoppermission"><a href="#lambda-resources">lambdaLavaStopPermission</a><a class="headerlink" href="#lambdalavastoppermission" title="Permanent link">&para;</a></h4>
<div class="tabbed-set tabbed-alternate" data-tabs="50:2"><input checked="checked" id="__tabbed_50_1" name="__tabbed_50" type="radio" /><input id="__tabbed_50_2" name="__tabbed_50" type="radio" /><div class="tabbed-labels"><label for="__tabbed_50_1">Details</label><label for="__tabbed_50_2">Source</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<table>
<thead>
<tr>
<th>Property</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Type</td>
<td><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-lambda-permission.html" title="AWS documentation for this resource type">AWS::Lambda::Permission</a></td>
</tr>
<tr>
<td>Group</td>
<td><a href="#lambda-resources">Lambda Resources</a> (<a href="#lambda-resources">Lambda</a>)</td>
</tr>
<tr>
<td>Description</td>
<td>Allow EventBridge to run the stop lambda.</td>
</tr>
</tbody>
</table>
</div>
<div class="tabbed-block">
<div class="language-json highlight"><pre><span></span><code><span id="__span-49-1"><span class="p">{</span>
</span><span id="__span-49-2"><span class="w">    </span><span class="nt">&quot;Condition&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ifRealmLambdasDeployed&quot;</span><span class="p">,</span>
</span><span id="__span-49-3"><span class="w">    </span><span class="nt">&quot;Properties&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-49-4"><span class="w">        </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;lambda:InvokeFunction&quot;</span><span class="p">,</span>
</span><span id="__span-49-5"><span class="w">        </span><span class="nt">&quot;FunctionName&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-49-6"><span class="w">            </span><span class="nt">&quot;Fn::ImportValue&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-49-7"><span class="w">                </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;lava:${realm}:lambdaLavaStop&quot;</span>
</span><span id="__span-49-8"><span class="w">            </span><span class="p">}</span>
</span><span id="__span-49-9"><span class="w">        </span><span class="p">},</span>
</span><span id="__span-49-10"><span class="w">        </span><span class="nt">&quot;Principal&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;events.amazonaws.com&quot;</span><span class="p">,</span>
</span><span id="__span-49-11"><span class="w">        </span><span class="nt">&quot;SourceArn&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-49-12"><span class="w">            </span><span class="nt">&quot;Fn::GetAtt&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-49-13"><span class="w">                </span><span class="s2">&quot;eventsWorkerTerminating&quot;</span><span class="p">,</span>
</span><span id="__span-49-14"><span class="w">                </span><span class="s2">&quot;Arn&quot;</span>
</span><span id="__span-49-15"><span class="w">            </span><span class="p">]</span>
</span><span id="__span-49-16"><span class="w">        </span><span class="p">}</span>
</span><span id="__span-49-17"><span class="w">    </span><span class="p">},</span>
</span><span id="__span-49-18"><span class="w">    </span><span class="nt">&quot;Type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AWS::Lambda::Permission&quot;</span>
</span><span id="__span-49-19"><span class="p">}</span>
</span></code></pre></div>
</div>
</div>
</div>
<h4 id="launchtemplatelavaworker"><a href="#ec2-resources">launchtemplateLavaWorker</a><a class="headerlink" href="#launchtemplatelavaworker" title="Permanent link">&para;</a></h4>
<div class="tabbed-set tabbed-alternate" data-tabs="51:2"><input checked="checked" id="__tabbed_51_1" name="__tabbed_51" type="radio" /><input id="__tabbed_51_2" name="__tabbed_51" type="radio" /><div class="tabbed-labels"><label for="__tabbed_51_1">Details</label><label for="__tabbed_51_2">Source</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<table>
<thead>
<tr>
<th>Property</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Type</td>
<td><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-ec2-launchtemplate.html" title="AWS documentation for this resource type">AWS::EC2::LaunchTemplate</a></td>
</tr>
<tr>
<td>Group</td>
<td><a href="#ec2-resources">EC2 Resources</a> (<a href="#ec2-resources">EC2</a>)</td>
</tr>
<tr>
<td>Description</td>
<td>Launch template for Lava worker.</td>
</tr>
</tbody>
</table>
</div>
<div class="tabbed-block">
<div class="language-json highlight"><pre><span></span><code><span id="__span-50-1"><span class="p">{</span>
</span><span id="__span-50-2"><span class="w">    </span><span class="nt">&quot;Condition&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ifCreateInstance&quot;</span><span class="p">,</span>
</span><span id="__span-50-3"><span class="w">    </span><span class="nt">&quot;Properties&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-50-4"><span class="w">        </span><span class="nt">&quot;LaunchTemplateData&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-50-5"><span class="w">            </span><span class="nt">&quot;BlockDeviceMappings&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-50-6"><span class="w">                </span><span class="p">{</span>
</span><span id="__span-50-7"><span class="w">                    </span><span class="nt">&quot;Fn::If&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-50-8"><span class="w">                        </span><span class="s2">&quot;ifSetSizeRootVol&quot;</span><span class="p">,</span>
</span><span id="__span-50-9"><span class="w">                        </span><span class="p">{</span>
</span><span id="__span-50-10"><span class="w">                            </span><span class="nt">&quot;DeviceName&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/dev/xvda&quot;</span><span class="p">,</span>
</span><span id="__span-50-11"><span class="w">                            </span><span class="nt">&quot;Ebs&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-50-12"><span class="w">                                </span><span class="nt">&quot;DeleteOnTermination&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;true&quot;</span><span class="p">,</span>
</span><span id="__span-50-13"><span class="w">                                </span><span class="nt">&quot;Encrypted&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;true&quot;</span><span class="p">,</span>
</span><span id="__span-50-14"><span class="w">                                </span><span class="nt">&quot;VolumeSize&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-50-15"><span class="w">                                    </span><span class="nt">&quot;Ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;rootVolumeSize&quot;</span>
</span><span id="__span-50-16"><span class="w">                                </span><span class="p">}</span>
</span><span id="__span-50-17"><span class="w">                            </span><span class="p">}</span>
</span><span id="__span-50-18"><span class="w">                        </span><span class="p">},</span>
</span><span id="__span-50-19"><span class="w">                        </span><span class="p">{</span>
</span><span id="__span-50-20"><span class="w">                            </span><span class="nt">&quot;Ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AWS::NoValue&quot;</span>
</span><span id="__span-50-21"><span class="w">                        </span><span class="p">}</span>
</span><span id="__span-50-22"><span class="w">                    </span><span class="p">]</span>
</span><span id="__span-50-23"><span class="w">                </span><span class="p">},</span>
</span><span id="__span-50-24"><span class="w">                </span><span class="p">{</span>
</span><span id="__span-50-25"><span class="w">                    </span><span class="nt">&quot;Fn::If&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-50-26"><span class="w">                        </span><span class="s2">&quot;ifCreateTmpVol&quot;</span><span class="p">,</span>
</span><span id="__span-50-27"><span class="w">                        </span><span class="p">{</span>
</span><span id="__span-50-28"><span class="w">                            </span><span class="nt">&quot;DeviceName&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/dev/xvdb&quot;</span><span class="p">,</span>
</span><span id="__span-50-29"><span class="w">                            </span><span class="nt">&quot;Ebs&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-50-30"><span class="w">                                </span><span class="nt">&quot;DeleteOnTermination&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;true&quot;</span><span class="p">,</span>
</span><span id="__span-50-31"><span class="w">                                </span><span class="nt">&quot;Encrypted&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;true&quot;</span><span class="p">,</span>
</span><span id="__span-50-32"><span class="w">                                </span><span class="nt">&quot;VolumeSize&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-50-33"><span class="w">                                    </span><span class="nt">&quot;Ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;tmpVolumeSize&quot;</span>
</span><span id="__span-50-34"><span class="w">                                </span><span class="p">}</span>
</span><span id="__span-50-35"><span class="w">                            </span><span class="p">}</span>
</span><span id="__span-50-36"><span class="w">                        </span><span class="p">},</span>
</span><span id="__span-50-37"><span class="w">                        </span><span class="p">{</span>
</span><span id="__span-50-38"><span class="w">                            </span><span class="nt">&quot;Ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AWS::NoValue&quot;</span>
</span><span id="__span-50-39"><span class="w">                        </span><span class="p">}</span>
</span><span id="__span-50-40"><span class="w">                    </span><span class="p">]</span>
</span><span id="__span-50-41"><span class="w">                </span><span class="p">},</span>
</span><span id="__span-50-42"><span class="w">                </span><span class="p">{</span>
</span><span id="__span-50-43"><span class="w">                    </span><span class="nt">&quot;Fn::If&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-50-44"><span class="w">                        </span><span class="s2">&quot;ifCreateDockerVol&quot;</span><span class="p">,</span>
</span><span id="__span-50-45"><span class="w">                        </span><span class="p">{</span>
</span><span id="__span-50-46"><span class="w">                            </span><span class="nt">&quot;DeviceName&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/dev/xvdc&quot;</span><span class="p">,</span>
</span><span id="__span-50-47"><span class="w">                            </span><span class="nt">&quot;Ebs&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-50-48"><span class="w">                                </span><span class="nt">&quot;DeleteOnTermination&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;true&quot;</span><span class="p">,</span>
</span><span id="__span-50-49"><span class="w">                                </span><span class="nt">&quot;Encrypted&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;true&quot;</span><span class="p">,</span>
</span><span id="__span-50-50"><span class="w">                                </span><span class="nt">&quot;VolumeSize&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-50-51"><span class="w">                                    </span><span class="nt">&quot;Ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;dockerVolumeSize&quot;</span>
</span><span id="__span-50-52"><span class="w">                                </span><span class="p">}</span>
</span><span id="__span-50-53"><span class="w">                            </span><span class="p">}</span>
</span><span id="__span-50-54"><span class="w">                        </span><span class="p">},</span>
</span><span id="__span-50-55"><span class="w">                        </span><span class="p">{</span>
</span><span id="__span-50-56"><span class="w">                            </span><span class="nt">&quot;Ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AWS::NoValue&quot;</span>
</span><span id="__span-50-57"><span class="w">                        </span><span class="p">}</span>
</span><span id="__span-50-58"><span class="w">                    </span><span class="p">]</span>
</span><span id="__span-50-59"><span class="w">                </span><span class="p">}</span>
</span><span id="__span-50-60"><span class="w">            </span><span class="p">],</span>
</span><span id="__span-50-61"><span class="w">            </span><span class="nt">&quot;IamInstanceProfile&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-50-62"><span class="w">                </span><span class="nt">&quot;Name&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-50-63"><span class="w">                    </span><span class="nt">&quot;Ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;iamWorkerInstanceProfile&quot;</span>
</span><span id="__span-50-64"><span class="w">                </span><span class="p">}</span>
</span><span id="__span-50-65"><span class="w">            </span><span class="p">},</span>
</span><span id="__span-50-66"><span class="w">            </span><span class="nt">&quot;ImageId&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-50-67"><span class="w">                </span><span class="nt">&quot;Ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;amiId&quot;</span>
</span><span id="__span-50-68"><span class="w">            </span><span class="p">},</span>
</span><span id="__span-50-69"><span class="w">            </span><span class="nt">&quot;InstanceType&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-50-70"><span class="w">                </span><span class="nt">&quot;Fn::If&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-50-71"><span class="w">                    </span><span class="s2">&quot;ifInstanceType&quot;</span><span class="p">,</span>
</span><span id="__span-50-72"><span class="w">                    </span><span class="p">{</span>
</span><span id="__span-50-73"><span class="w">                        </span><span class="nt">&quot;Ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;workerInstanceType&quot;</span>
</span><span id="__span-50-74"><span class="w">                    </span><span class="p">},</span>
</span><span id="__span-50-75"><span class="w">                    </span><span class="p">{</span>
</span><span id="__span-50-76"><span class="w">                        </span><span class="nt">&quot;Ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AWS::NoValue&quot;</span>
</span><span id="__span-50-77"><span class="w">                    </span><span class="p">}</span>
</span><span id="__span-50-78"><span class="w">                </span><span class="p">]</span>
</span><span id="__span-50-79"><span class="w">            </span><span class="p">},</span>
</span><span id="__span-50-80"><span class="w">            </span><span class="nt">&quot;KeyName&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-50-81"><span class="w">                </span><span class="nt">&quot;Fn::If&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-50-82"><span class="w">                    </span><span class="s2">&quot;ifKeyPair&quot;</span><span class="p">,</span>
</span><span id="__span-50-83"><span class="w">                    </span><span class="p">{</span>
</span><span id="__span-50-84"><span class="w">                        </span><span class="nt">&quot;Ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;keyPairName&quot;</span>
</span><span id="__span-50-85"><span class="w">                    </span><span class="p">},</span>
</span><span id="__span-50-86"><span class="w">                    </span><span class="p">{</span>
</span><span id="__span-50-87"><span class="w">                        </span><span class="nt">&quot;Ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AWS::NoValue&quot;</span>
</span><span id="__span-50-88"><span class="w">                    </span><span class="p">}</span>
</span><span id="__span-50-89"><span class="w">                </span><span class="p">]</span>
</span><span id="__span-50-90"><span class="w">            </span><span class="p">},</span>
</span><span id="__span-50-91"><span class="w">            </span><span class="nt">&quot;Monitoring&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-50-92"><span class="w">                </span><span class="nt">&quot;Enabled&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-50-93"><span class="w">            </span><span class="p">},</span>
</span><span id="__span-50-94"><span class="w">            </span><span class="nt">&quot;NetworkInterfaces&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-50-95"><span class="w">                </span><span class="p">{</span>
</span><span id="__span-50-96"><span class="w">                    </span><span class="nt">&quot;AssociatePublicIpAddress&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-50-97"><span class="w">                        </span><span class="nt">&quot;Ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;workerPublicIp&quot;</span>
</span><span id="__span-50-98"><span class="w">                    </span><span class="p">},</span>
</span><span id="__span-50-99"><span class="w">                    </span><span class="nt">&quot;Description&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-50-100"><span class="w">                        </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;lava-${realm}-${worker} eth0&quot;</span>
</span><span id="__span-50-101"><span class="w">                    </span><span class="p">},</span>
</span><span id="__span-50-102"><span class="w">                    </span><span class="nt">&quot;DeviceIndex&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
</span><span id="__span-50-103"><span class="w">                    </span><span class="nt">&quot;Groups&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-50-104"><span class="w">                        </span><span class="nt">&quot;Ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;secGroups&quot;</span>
</span><span id="__span-50-105"><span class="w">                    </span><span class="p">}</span>
</span><span id="__span-50-106"><span class="w">                </span><span class="p">}</span>
</span><span id="__span-50-107"><span class="w">            </span><span class="p">],</span>
</span><span id="__span-50-108"><span class="w">            </span><span class="nt">&quot;UserData&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-50-109"><span class="w">                </span><span class="nt">&quot;Fn::Base64&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-50-110"><span class="w">                    </span><span class="nt">&quot;Fn::Join&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-50-111"><span class="w">                        </span><span class="s2">&quot;\n&quot;</span><span class="p">,</span>
</span><span id="__span-50-112"><span class="w">                        </span><span class="p">[</span>
</span><span id="__span-50-113"><span class="w">                            </span><span class="s2">&quot;{&quot;</span><span class="p">,</span>
</span><span id="__span-50-114"><span class="w">                            </span><span class="p">{</span>
</span><span id="__span-50-115"><span class="w">                                </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-50-116"><span class="w">                                    </span><span class="s2">&quot;\&quot;shell0\&quot;: \&quot;/usr/local/bin/s3run s3://${s3CodeBucket}/${s3CodePrefix}/${realm}/${worker}/root.boot0.sh s3://${s3CodeBucket}/${s3CodePrefix} ${realm} ${worker}\&quot;&quot;</span><span class="p">,</span>
</span><span id="__span-50-117"><span class="w">                                    </span><span class="p">{</span>
</span><span id="__span-50-118"><span class="w">                                        </span><span class="nt">&quot;s3CodeBucket&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-50-119"><span class="w">                                            </span><span class="nt">&quot;Fn::ImportValue&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-50-120"><span class="w">                                                </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;lava:${realm}:s3CodeBucket&quot;</span>
</span><span id="__span-50-121"><span class="w">                                            </span><span class="p">}</span>
</span><span id="__span-50-122"><span class="w">                                        </span><span class="p">},</span>
</span><span id="__span-50-123"><span class="w">                                        </span><span class="nt">&quot;s3CodePrefix&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-50-124"><span class="w">                                            </span><span class="nt">&quot;Fn::ImportValue&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-50-125"><span class="w">                                                </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;lava:${realm}:s3CodePrefix&quot;</span>
</span><span id="__span-50-126"><span class="w">                                            </span><span class="p">}</span>
</span><span id="__span-50-127"><span class="w">                                        </span><span class="p">}</span>
</span><span id="__span-50-128"><span class="w">                                    </span><span class="p">}</span>
</span><span id="__span-50-129"><span class="w">                                </span><span class="p">]</span>
</span><span id="__span-50-130"><span class="w">                            </span><span class="p">},</span>
</span><span id="__span-50-131"><span class="w">                            </span><span class="s2">&quot;,&quot;</span><span class="p">,</span>
</span><span id="__span-50-132"><span class="w">                            </span><span class="p">{</span>
</span><span id="__span-50-133"><span class="w">                                </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-50-134"><span class="w">                                    </span><span class="s2">&quot;\&quot;shell\&quot;: \&quot;/usr/local/bin/s3run s3://${s3CodeBucket}/${s3CodePrefix}/${realm}/${worker}/root.boot.sh s3://${s3CodeBucket}/${s3CodePrefix} ${realm} ${worker}\&quot;&quot;</span><span class="p">,</span>
</span><span id="__span-50-135"><span class="w">                                    </span><span class="p">{</span>
</span><span id="__span-50-136"><span class="w">                                        </span><span class="nt">&quot;s3CodeBucket&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-50-137"><span class="w">                                            </span><span class="nt">&quot;Fn::ImportValue&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-50-138"><span class="w">                                                </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;lava:${realm}:s3CodeBucket&quot;</span>
</span><span id="__span-50-139"><span class="w">                                            </span><span class="p">}</span>
</span><span id="__span-50-140"><span class="w">                                        </span><span class="p">},</span>
</span><span id="__span-50-141"><span class="w">                                        </span><span class="nt">&quot;s3CodePrefix&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-50-142"><span class="w">                                            </span><span class="nt">&quot;Fn::ImportValue&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-50-143"><span class="w">                                                </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;lava:${realm}:s3CodePrefix&quot;</span>
</span><span id="__span-50-144"><span class="w">                                            </span><span class="p">}</span>
</span><span id="__span-50-145"><span class="w">                                        </span><span class="p">}</span>
</span><span id="__span-50-146"><span class="w">                                    </span><span class="p">}</span>
</span><span id="__span-50-147"><span class="w">                                </span><span class="p">]</span>
</span><span id="__span-50-148"><span class="w">                            </span><span class="p">},</span>
</span><span id="__span-50-149"><span class="w">                            </span><span class="s2">&quot;,&quot;</span><span class="p">,</span>
</span><span id="__span-50-150"><span class="w">                            </span><span class="p">{</span>
</span><span id="__span-50-151"><span class="w">                                </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;\&quot;import-users\&quot;: { \&quot;users\&quot;: \&quot;lava-${realm}-admin\&quot;, \&quot;sudoers\&quot;: \&quot;lava-${realm}-admin\&quot; }&quot;</span>
</span><span id="__span-50-152"><span class="w">                            </span><span class="p">},</span>
</span><span id="__span-50-153"><span class="w">                            </span><span class="s2">&quot;,&quot;</span><span class="p">,</span>
</span><span id="__span-50-154"><span class="w">                            </span><span class="p">{</span>
</span><span id="__span-50-155"><span class="w">                                </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;\&quot;swap\&quot;: { \&quot;size\&quot;: ${swapSize} }&quot;</span>
</span><span id="__span-50-156"><span class="w">                            </span><span class="p">},</span>
</span><span id="__span-50-157"><span class="w">                            </span><span class="s2">&quot;}&quot;</span>
</span><span id="__span-50-158"><span class="w">                        </span><span class="p">]</span>
</span><span id="__span-50-159"><span class="w">                    </span><span class="p">]</span>
</span><span id="__span-50-160"><span class="w">                </span><span class="p">}</span>
</span><span id="__span-50-161"><span class="w">            </span><span class="p">}</span>
</span><span id="__span-50-162"><span class="w">        </span><span class="p">},</span>
</span><span id="__span-50-163"><span class="w">        </span><span class="nt">&quot;TagSpecifications&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-50-164"><span class="w">            </span><span class="p">{</span>
</span><span id="__span-50-165"><span class="w">                </span><span class="nt">&quot;ResourceType&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;launch-template&quot;</span><span class="p">,</span>
</span><span id="__span-50-166"><span class="w">                </span><span class="nt">&quot;Tags&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-50-167"><span class="w">                    </span><span class="p">{</span>
</span><span id="__span-50-168"><span class="w">                        </span><span class="nt">&quot;Key&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;LavaRealm&quot;</span><span class="p">,</span>
</span><span id="__span-50-169"><span class="w">                        </span><span class="nt">&quot;Value&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-50-170"><span class="w">                            </span><span class="nt">&quot;Ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;realm&quot;</span>
</span><span id="__span-50-171"><span class="w">                        </span><span class="p">}</span>
</span><span id="__span-50-172"><span class="w">                    </span><span class="p">},</span>
</span><span id="__span-50-173"><span class="w">                    </span><span class="p">{</span>
</span><span id="__span-50-174"><span class="w">                        </span><span class="nt">&quot;Key&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;LavaWorker&quot;</span><span class="p">,</span>
</span><span id="__span-50-175"><span class="w">                        </span><span class="nt">&quot;Value&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-50-176"><span class="w">                            </span><span class="nt">&quot;Ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;worker&quot;</span>
</span><span id="__span-50-177"><span class="w">                        </span><span class="p">}</span>
</span><span id="__span-50-178"><span class="w">                    </span><span class="p">}</span>
</span><span id="__span-50-179"><span class="w">                </span><span class="p">]</span>
</span><span id="__span-50-180"><span class="w">            </span><span class="p">}</span>
</span><span id="__span-50-181"><span class="w">        </span><span class="p">]</span>
</span><span id="__span-50-182"><span class="w">    </span><span class="p">},</span>
</span><span id="__span-50-183"><span class="w">    </span><span class="nt">&quot;Type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AWS::EC2::LaunchTemplate&quot;</span>
</span><span id="__span-50-184"><span class="p">}</span>
</span></code></pre></div>
</div>
</div>
</div>
<h4 id="logfilterworkerheartbeat"><a href="#logs-resources">logFilterWorkerHeartbeat</a><a class="headerlink" href="#logfilterworkerheartbeat" title="Permanent link">&para;</a></h4>
<div class="tabbed-set tabbed-alternate" data-tabs="52:2"><input checked="checked" id="__tabbed_52_1" name="__tabbed_52" type="radio" /><input id="__tabbed_52_2" name="__tabbed_52" type="radio" /><div class="tabbed-labels"><label for="__tabbed_52_1">Details</label><label for="__tabbed_52_2">Source</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<table>
<thead>
<tr>
<th>Property</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Type</td>
<td><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-logs-metricfilter.html" title="AWS documentation for this resource type">AWS::Logs::MetricFilter</a></td>
</tr>
<tr>
<td>Group</td>
<td><a href="#logs-resources">Logs Resources</a> (<a href="#logs-resources">Logs</a>)</td>
</tr>
<tr>
<td>Description</td>
<td>Metric filter on /var/log/lava/&lt;REALM&gt; log group to find heartbeat messages.</td>
</tr>
</tbody>
</table>
</div>
<div class="tabbed-block">
<div class="language-json highlight"><pre><span></span><code><span id="__span-51-1"><span class="p">{</span>
</span><span id="__span-51-2"><span class="w">    </span><span class="nt">&quot;Condition&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ifCreateHeatbeatAlarm&quot;</span><span class="p">,</span>
</span><span id="__span-51-3"><span class="w">    </span><span class="nt">&quot;Properties&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-51-4"><span class="w">        </span><span class="nt">&quot;FilterPattern&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-51-5"><span class="w">            </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;{$.event_source=\&quot;lava-worker\&quot; &amp;&amp; $.event_type=\&quot;heartbeat\&quot; &amp;&amp; $.realm=\&quot;${realm}\&quot; &amp;&amp; $.worker=\&quot;${worker}\&quot;}&quot;</span>
</span><span id="__span-51-6"><span class="w">        </span><span class="p">},</span>
</span><span id="__span-51-7"><span class="w">        </span><span class="nt">&quot;LogGroupName&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-51-8"><span class="w">            </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/var/log/lava/${realm}&quot;</span>
</span><span id="__span-51-9"><span class="w">        </span><span class="p">},</span>
</span><span id="__span-51-10"><span class="w">        </span><span class="nt">&quot;MetricTransformations&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-51-11"><span class="w">            </span><span class="p">{</span>
</span><span id="__span-51-12"><span class="w">                </span><span class="nt">&quot;MetricName&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-51-13"><span class="w">                    </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;lava-${realm}-${worker}-heartbeat&quot;</span>
</span><span id="__span-51-14"><span class="w">                </span><span class="p">},</span>
</span><span id="__span-51-15"><span class="w">                </span><span class="nt">&quot;MetricNamespace&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;LogMetrics&quot;</span><span class="p">,</span>
</span><span id="__span-51-16"><span class="w">                </span><span class="nt">&quot;MetricValue&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1&quot;</span>
</span><span id="__span-51-17"><span class="w">            </span><span class="p">}</span>
</span><span id="__span-51-18"><span class="w">        </span><span class="p">]</span>
</span><span id="__span-51-19"><span class="w">    </span><span class="p">},</span>
</span><span id="__span-51-20"><span class="w">    </span><span class="nt">&quot;Type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AWS::Logs::MetricFilter&quot;</span>
</span><span id="__span-51-21"><span class="p">}</span>
</span></code></pre></div>
</div>
</div>
</div>
<h4 id="sqsworkerqueue"><a href="#sqs-resources">sqsWorkerQueue</a><a class="headerlink" href="#sqsworkerqueue" title="Permanent link">&para;</a></h4>
<div class="tabbed-set tabbed-alternate" data-tabs="53:2"><input checked="checked" id="__tabbed_53_1" name="__tabbed_53" type="radio" /><input id="__tabbed_53_2" name="__tabbed_53" type="radio" /><div class="tabbed-labels"><label for="__tabbed_53_1">Details</label><label for="__tabbed_53_2">Source</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<table>
<thead>
<tr>
<th>Property</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Type</td>
<td><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-sqs-queue.html" title="AWS documentation for this resource type">AWS::SQS::Queue</a></td>
</tr>
<tr>
<td>Group</td>
<td><a href="#sqs-resources">SQS Resources</a> (<a href="#sqs-resources">SQS</a>)</td>
</tr>
<tr>
<td>Description</td>
<td>SQS queue for the lava worker to receive dispatched jobs.</td>
</tr>
</tbody>
</table>
</div>
<div class="tabbed-block">
<div class="language-json highlight"><pre><span></span><code><span id="__span-52-1"><span class="p">{</span>
</span><span id="__span-52-2"><span class="w">    </span><span class="nt">&quot;Properties&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-52-3"><span class="w">        </span><span class="nt">&quot;KmsMasterKeyId&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-52-4"><span class="w">            </span><span class="nt">&quot;Fn::ImportValue&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-52-5"><span class="w">                </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;lava:${realm}:kmsUserKeyAlias&quot;</span>
</span><span id="__span-52-6"><span class="w">            </span><span class="p">}</span>
</span><span id="__span-52-7"><span class="w">        </span><span class="p">},</span>
</span><span id="__span-52-8"><span class="w">        </span><span class="nt">&quot;MessageRetentionPeriod&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-52-9"><span class="w">            </span><span class="nt">&quot;Ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;messageRetentionPeriod&quot;</span>
</span><span id="__span-52-10"><span class="w">        </span><span class="p">},</span>
</span><span id="__span-52-11"><span class="w">        </span><span class="nt">&quot;QueueName&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-52-12"><span class="w">            </span><span class="nt">&quot;Fn::Sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;lava-${realm}-${worker}&quot;</span>
</span><span id="__span-52-13"><span class="w">        </span><span class="p">},</span>
</span><span id="__span-52-14"><span class="w">        </span><span class="nt">&quot;Tags&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-52-15"><span class="w">            </span><span class="p">{</span>
</span><span id="__span-52-16"><span class="w">                </span><span class="nt">&quot;Key&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;lava:function&quot;</span><span class="p">,</span>
</span><span id="__span-52-17"><span class="w">                </span><span class="nt">&quot;Value&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;worker.dispatch&quot;</span>
</span><span id="__span-52-18"><span class="w">            </span><span class="p">}</span>
</span><span id="__span-52-19"><span class="w">        </span><span class="p">],</span>
</span><span id="__span-52-20"><span class="w">        </span><span class="nt">&quot;VisibilityTimeout&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-52-21"><span class="w">            </span><span class="nt">&quot;Ref&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;visibilityTimeout&quot;</span>
</span><span id="__span-52-22"><span class="w">        </span><span class="p">}</span>
</span><span id="__span-52-23"><span class="w">    </span><span class="p">},</span>
</span><span id="__span-52-24"><span class="w">    </span><span class="nt">&quot;Type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AWS::SQS::Queue&quot;</span>
</span><span id="__span-52-25"><span class="p">}</span>
</span></code></pre></div>
</div>
</div>
</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      &copy; Origin Energy 2025
    </div>
  
</div>
      <div class="md-footer-social">
        <div class="md-copyright">
          <div class="md-copyright__highlight">
            v8.2.0 (Kilauea)
          </div>
        </div>
      </div>
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": ".", "features": ["navigation.instant", "content.code.copy", {"icon": {"repo": "material/github"}}], "search": "assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="assets/javascripts/bundle.f55a23d4.min.js"></script>
      
    
  </body>
</html>