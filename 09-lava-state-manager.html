
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="AWS based distributed scheduler and job runner">
      
      
        <meta name="author" content="Murray Andrews">
      
      
      
        <link rel="prev" href="08-job-actions.html">
      
      
        <link rel="next" href="10-installation-operation.html">
      
      
      <link rel="icon" href="img/lava-icons/png/256/lava-icon-256-transparent.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.23">
    
    
      
        <title>Lava State Manager - Lava User Guide</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.84d31ad4.min.css">
      
        
        <link rel="stylesheet" href="assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="css/extra.css">
    
    <script>__md_scope=new URL(".",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#the-lava-state-manager" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="." title="Lava User Guide" class="md-header__button md-logo" aria-label="Lava User Guide" data-md-component="logo">
      
  <img src="img/lava-icons/svg/256/lava-icon-256-opaque.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Lava User Guide
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Lava State Manager
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="custom" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        

<a href="https://github.com/jin-gizmo/lava" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    Lava on GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="." title="Lava User Guide" class="md-nav__button md-logo" aria-label="Lava User Guide" data-md-component="logo">
      
  <img src="img/lava-icons/svg/256/lava-icon-256-opaque.svg" alt="logo">

    </a>
    Lava User Guide
  </label>
  
    <div class="md-nav__source">
      

<a href="https://github.com/jin-gizmo/lava" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    Lava on GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="01-about-lava.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    About Lava
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="02-concepts.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Concepts
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="03-architecture.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Architecture
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="04-dynamodb-tables.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    DynamoDB Tables
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="05-job-dispatch.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Job Dispatch
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="06-jobs-job-types.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Jobs & Job Types
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="07-connectors.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Connectors
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="08-job-actions.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Job Actions
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Lava State Manager
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="09-lava-state-manager.html" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Lava State Manager
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#posting-state-items" class="md-nav__link">
    <span class="md-ellipsis">
      Posting State Items
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#retrieving-state-items" class="md-nav__link">
    <span class="md-ellipsis">
      Retrieving State Items
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Retrieving State Items">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#state-item-retrieval-during-job-initialisation" class="md-nav__link">
    <span class="md-ellipsis">
      Retrieval During Job Initialisation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example-usage-of-the-state-manager" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-lava-state-api" class="md-nav__link">
    <span class="md-ellipsis">
      The Lava State API
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="10-installation-operation.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Installation & Operation
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="11-lava-job-framework.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lava Job Framework
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="12-developing-lava-jobs.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Developing Lava Jobs
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="13-jinja-rendering-in-lava.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Jinja Rendering in Lava
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="14-enhancing-lava.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Enhancing Lava
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="15-lava-and-docker.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lava and Docker
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="16-commands-utilities.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Commands & Utilities
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="17-job-framework-samples.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Job Framework Samples
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="18-api.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    API
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="19-cloudformation-templates.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CloudFormation Templates
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="20-faq.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    FAQ
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="21-release-notes.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Release Notes
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="22-credits.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Credits
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="23-known-issues.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Known Issues
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#posting-state-items" class="md-nav__link">
    <span class="md-ellipsis">
      Posting State Items
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#retrieving-state-items" class="md-nav__link">
    <span class="md-ellipsis">
      Retrieving State Items
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Retrieving State Items">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#state-item-retrieval-during-job-initialisation" class="md-nav__link">
    <span class="md-ellipsis">
      Retrieval During Job Initialisation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example-usage-of-the-state-manager" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-lava-state-api" class="md-nav__link">
    <span class="md-ellipsis">
      The Lava State API
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="the-lava-state-manager" x-nav="Lava State Manager">The Lava State Manager<a class="headerlink" href="#the-lava-state-manager" title="Permanent link">&para;</a></h1>
<p>Lava jobs generally act in isolation from each other or within the scope of a
controlling master job that can pass global variables to the child jobs. In
some situations, it is useful for one job to be able to pass state information
directly to other jobs in a peer to peer fashion.</p>
<p>The <strong>lava state manager</strong> provides the ability for a job to publish state
information (state items) for subsequent use by another job or by an authorised
external entity. <strong>State items</strong> are persistent, structured data elements with a
defined expiry time. State items are stored in the <a href="04-dynamodb-tables.html#the-state-table">state</a>
DynamoDB table.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The state manager is intended for use with small amounts of data (e.g.
control parameters, job status information etc.). Where large amounts of
data need to be exchanged between jobs, S3 is the preferred solution.</p>
</div>
<p>The state manager supports the following capabilities:</p>
<ul>
<li>
<p>Ability to <a href="#posting-state-items">post state items</a> from lava jobs and
    external actors with appropriate authorisation.</p>
</li>
<li>
<p>Ability to <a href="#retrieving-state-items">read state items</a> by both lava
    jobs and external actors with appropriate authorisation.</p>
</li>
<li>
<p>Support for Jinja rendering of state item values into job specifications at
    run-time.</p>
</li>
</ul>
<p>The state manager handles any encoding / decoding required during the posting /
retrieval process.</p>
<h2 id="posting-state-items">Posting State Items<a class="headerlink" href="#posting-state-items" title="Permanent link">&para;</a></h2>
<p>State items can be posted via the following mechanisms:</p>
<ul>
<li>
<p>The <a href="08-job-actions.html#action-type-state">state</a> action type.</p>
</li>
<li>
<p>The <a href="#the-lava-state-api">lava state API</a>.</p>
</li>
<li>
<p>The <a href="16-commands-utilities.html#lava-state-utility">lava state utility</a>.</p>
</li>
</ul>
<p>Posting an item will create a new item or completely replace an existing item,
as appropriate.</p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>Do not create state items with a <code>state_id</code> starting with <code>lava</code>.
This prefix is reserved.</p>
</div>
<p>The lava state manager does not support incremental update of an existing state
item.</p>
<h2 id="retrieving-state-items">Retrieving State Items<a class="headerlink" href="#retrieving-state-items" title="Permanent link">&para;</a></h2>
<p>State items can be retrieved via the following mechanisms:</p>
<ul>
<li>
<p><a href="#state-item-retrieval-during-job-initialisation">Real-time retrieval during job initialisation</a>.</p>
</li>
<li>
<p>The <a href="#the-lava-state-api">lava state API</a>.</p>
</li>
<li>
<p>The <a href="16-commands-utilities.html#lava-state-utility">lava state utility</a>.</p>
</li>
</ul>
<p>The retrieval process uses DynamoDB <a href="https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/HowItWorks.ReadConsistency.html">strongly consistent reads</a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>While this gives more reliability in state item availability, it does require
higher throughput on the <a href="04-dynamodb-tables.html#the-state-table">state table</a>.</p>
</div>
<h3 id="state-item-retrieval-during-job-initialisation">State Item Retrieval During Job Initialisation<a class="headerlink" href="#state-item-retrieval-during-job-initialisation" title="Permanent link">&para;</a></h3>
<p>When a job is run, an initialisation procedure populates elements of the
<a href="04-dynamodb-tables.html#the-jobs-table">job specification</a> to produce the
<a href="13-jinja-rendering-in-lava.html#the-augmented-job-specification">augmented job specification</a>. As part of this
process, lava expands the <code>state</code> element of the job specification, if present.
This element is a map of state item IDs (state_id) and default values. If a
state_id is present in the <a href="04-dynamodb-tables.html#the-state-table">state</a> table, the value will be
extracted and used to replace the default value in the job specification. The
resulting map is then made available to the <a href="13-jinja-rendering-in-lava.html#jinja-rendering-in-lava">Jinja rendering
process</a> used to prepare the job.</p>
<p>This means, for example, that one job can post a state item (e.g. using an
<a href="08-job-actions.html#job-actions">on_success</a> job action) that lava will then automatically make
available to another job via the Jinja renderer.</p>
<p>Neat eh?</p>
<p>The state map can be referenced in a Jinja expression as <code>job.state</code> or via the
shorthand <code>state</code>. A state item with a <code>state_id</code> of <code>my_state_id</code> can then be
referenced in a Jinja expression using any of the following equivalents:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-0-1">{{ job.state.my_state_id }}
</span><span id="__span-0-2">{{ job.state[&#39;my_state_id&#39;] }}
</span><span id="__span-0-3">{{ state.my_state_id }}
</span><span id="__span-0-4">{{ state[&#39;my_state_id&#39;] }}
</span></code></pre></div>
<p>The square brackets variant is required when <code>my_state_id</code> is not a valid
Python identifier.</p>
<h2 id="example-usage-of-the-state-manager">Example Usage of the State Manager<a class="headerlink" href="#example-usage-of-the-state-manager" title="Permanent link">&para;</a></h2>
<p>Consider the following simple job that gets triggered by an object creation in
S3 (via s3trigger). The job simply counts the number of lines in the file and
stores the result as a state item with ID <code>sid</code>.</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-1-1"><span class="p">{</span>
</span><span id="__span-1-2"><span class="w">  </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Count lines in file from S3&quot;</span><span class="p">,</span>
</span><span id="__span-1-3"><span class="w">  </span><span class="nt">&quot;enabled&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-1-4"><span class="w">  </span><span class="nt">&quot;globals&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-1-5"><span class="w">    </span><span class="nt">&quot;bucket&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;-- provided by s3trigger --&quot;</span><span class="p">,</span>
</span><span id="__span-1-6"><span class="w">    </span><span class="nt">&quot;key&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;-- provided by s3trigger --&quot;</span>
</span><span id="__span-1-7"><span class="w">  </span><span class="p">},</span>
</span><span id="__span-1-8"><span class="w">  </span><span class="nt">&quot;job_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo/line-counter&quot;</span><span class="p">,</span>
</span><span id="__span-1-9"><span class="w">  </span><span class="nt">&quot;parameters&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-1-10"><span class="w">    </span><span class="nt">&quot;args&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-1-11"><span class="w">      </span><span class="s2">&quot;lava-state put sid -p lines=$(aws s3 cp &#39;s3://{{globals.bucket}}/{{globals.key}}&#39; - | wc -l)&quot;</span>
</span><span id="__span-1-12"><span class="w">    </span><span class="p">]</span>
</span><span id="__span-1-13"><span class="w">  </span><span class="p">},</span>
</span><span id="__span-1-14"><span class="w">  </span><span class="nt">&quot;payload&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/bin/sh -c&quot;</span><span class="p">,</span>
</span><span id="__span-1-15"><span class="w">  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;cmd&quot;</span><span class="p">,</span>
</span><span id="__span-1-16"><span class="w">  </span><span class="nt">&quot;worker&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;core&quot;</span>
</span><span id="__span-1-17"><span class="p">}</span>
</span></code></pre></div>
<p>The resulting state item will look like this:</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-2-1"><span class="p">{</span>
</span><span id="__span-2-2"><span class="w">  </span><span class="nt">&quot;publisher&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo/line-counter&quot;</span><span class="p">,</span>
</span><span id="__span-2-3"><span class="w">  </span><span class="nt">&quot;state_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;sid&quot;</span><span class="p">,</span>
</span><span id="__span-2-4"><span class="w">  </span><span class="nt">&quot;timestamp&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2022-03-26T12:18:04+11:00&quot;</span><span class="p">,</span>
</span><span id="__span-2-5"><span class="w">  </span><span class="nt">&quot;ttl&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1648343884</span><span class="p">,</span>
</span><span id="__span-2-6"><span class="w">  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;json&quot;</span><span class="p">,</span>
</span><span id="__span-2-7"><span class="w">  </span><span class="nt">&quot;value&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;{\&quot;lines\&quot;: \&quot;45\&quot;}&quot;</span>
</span><span id="__span-2-8"><span class="p">}</span>
</span></code></pre></div>
<p>Another job can access this state item in the job spec rendering process or in
the job logic itself. Here is an example of the former.</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-3-1"><span class="p">{</span>
</span><span id="__span-3-2"><span class="w">  </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Print out how many lines there were&quot;</span><span class="p">,</span>
</span><span id="__span-3-3"><span class="w">  </span><span class="nt">&quot;dispatcher&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;...&quot;</span><span class="p">,</span>
</span><span id="__span-3-4"><span class="w">  </span><span class="nt">&quot;enabled&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-3-5"><span class="w">  </span><span class="nt">&quot;job_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo/line-reporter&quot;</span><span class="p">,</span>
</span><span id="__span-3-6"><span class="w">  </span><span class="nt">&quot;payload&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;echo The file contained {{state.sid}} lines&quot;</span><span class="p">,</span>
</span><span id="__span-3-7"><span class="w">  </span><span class="nt">&quot;state&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-3-8"><span class="w">    </span><span class="nt">&quot;sid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;-- default value to be replaced at run-time --&quot;</span>
</span><span id="__span-3-9"><span class="w">  </span><span class="p">},</span>
</span><span id="__span-3-10"><span class="w">  </span><span class="nt">&quot;schedule&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;...&quot;</span><span class="p">,</span>
</span><span id="__span-3-11"><span class="w">  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;cmd&quot;</span><span class="p">,</span>
</span><span id="__span-3-12"><span class="w">  </span><span class="nt">&quot;worker&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;core&quot;</span>
</span><span id="__span-3-13"><span class="p">}</span>
</span></code></pre></div>
<p>Note that the state item that is required at run-time has to be declared (with a
default value) so that it can be obtained from the state table and made
available to the Jinja renderer.</p>
<h2 id="the-lava-state-api">The Lava State API<a class="headerlink" href="#the-lava-state-api" title="Permanent link">&para;</a></h2>
<p>The lava state API provides for the posting and retrieval of state items.</p>
<p>The code to post a state item would look like this:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-4-1"><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
</span><span id="__span-4-2"><span class="kn">from</span><span class="w"> </span><span class="nn">lava.lib.state</span><span class="w"> </span><span class="kn">import</span> <span class="n">LavaStateItem</span>
</span><span id="__span-4-3">
</span><span id="__span-4-4"><span class="n">realm</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;LAVA_REALM&#39;</span><span class="p">]</span>
</span><span id="__span-4-5">
</span><span id="__span-4-6"><span class="n">value1</span> <span class="o">=</span> <span class="s2">&quot;Hello world&quot;</span>
</span><span id="__span-4-7"><span class="c1"># .. or maybe ...</span>
</span><span id="__span-4-8"><span class="n">value2</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-4-9">    <span class="s2">&quot;volcano_name&quot;</span><span class="p">:</span> <span class="s2">&quot;Tronador&quot;</span><span class="p">,</span>
</span><span id="__span-4-10">    <span class="s2">&quot;elevation&quot;</span><span class="p">:</span> <span class="mi">3491</span><span class="p">,</span>
</span><span id="__span-4-11">    <span class="s2">&quot;active&quot;</span><span class="p">:</span> <span class="kc">False</span>
</span><span id="__span-4-12"><span class="p">}</span>
</span><span id="__span-4-13">
</span><span id="__span-4-14"><span class="c1"># Create our item. This is a local operation so far.</span>
</span><span id="__span-4-15"><span class="n">my_state_item</span> <span class="o">=</span> <span class="n">LavaStateItem</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">&#39;json&#39;</span><span class="p">,</span> <span class="s1">&#39;my_state_id&#39;</span><span class="p">,</span> <span class="n">realm</span><span class="p">,</span> <span class="n">value1</span><span class="p">,</span> <span class="n">ttl</span><span class="o">=</span><span class="s1">&#39;2d&#39;</span><span class="p">)</span>
</span><span id="__span-4-16">
</span><span id="__span-4-17"><span class="c1"># Changed my mind</span>
</span><span id="__span-4-18"><span class="n">my_state_item</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value2</span>
</span><span id="__span-4-19">
</span><span id="__span-4-20"><span class="c1"># Post to DynamoDB</span>
</span><span id="__span-4-21"><span class="n">my_state_item</span><span class="o">.</span><span class="n">put</span><span class="p">()</span>
</span></code></pre></div>
<p>Secure state items are KMS encrypted for storage and automatically decrypted on
loading. An additional parameter, <code>kms_key</code>, specifies the KMS key to use, either
as a KMS key ARN or a key alias in the form <code>alias/key-id</code>. This defaults to the
<code>sys</code> key for the lava realm.</p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>Note that the use of KMS encryption imposes a maximum size limit of 4096 bytes
on the JSON encoded state item value.</p>
</div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-5-1"><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
</span><span id="__span-5-2"><span class="kn">from</span><span class="w"> </span><span class="nn">lava.lib.state</span><span class="w"> </span><span class="kn">import</span> <span class="n">LavaStateItem</span>
</span><span id="__span-5-3">
</span><span id="__span-5-4"><span class="n">realm</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;LAVA_REALM&#39;</span><span class="p">]</span>
</span><span id="__span-5-5"><span class="n">value</span> <span class="o">=</span> <span class="s1">&#39;Big Secret&#39;</span>
</span><span id="__span-5-6">
</span><span id="__span-5-7"><span class="c1"># Create a secure item with the default key.</span>
</span><span id="__span-5-8"><span class="n">my_state_item</span> <span class="o">=</span> <span class="n">LavaStateItem</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">&#39;secure&#39;</span><span class="p">,</span> <span class="s1">&#39;my_state_id&#39;</span><span class="p">,</span> <span class="n">realm</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</span><span id="__span-5-9">
</span><span id="__span-5-10"><span class="c1"># or</span>
</span><span id="__span-5-11"><span class="n">my_state_item</span> <span class="o">=</span> <span class="n">LavaStateItem</span><span class="o">.</span><span class="n">new</span><span class="p">(</span>
</span><span id="__span-5-12">    <span class="s1">&#39;secure&#39;</span><span class="p">,</span> <span class="s1">&#39;my_state_id&#39;</span><span class="p">,</span> <span class="n">realm</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">kms_key</span><span class="o">=</span><span class="s1">&#39;alias/my-key&#39;</span>
</span><span id="__span-5-13"><span class="p">)</span>
</span></code></pre></div>
<p>To retrieve a state item:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-6-1"><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
</span><span id="__span-6-2"><span class="kn">from</span><span class="w"> </span><span class="nn">lava.lib.state</span><span class="w"> </span><span class="kn">import</span> <span class="n">LavaStateItem</span>
</span><span id="__span-6-3">
</span><span id="__span-6-4"><span class="n">realm</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;LAVA_REALM&#39;</span><span class="p">]</span>
</span><span id="__span-6-5">
</span><span id="__span-6-6"><span class="n">value</span> <span class="o">=</span> <span class="n">LavaStateItem</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;my_state_id&#39;</span><span class="p">,</span> <span class="n">realm</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
</span></code></pre></div>
<p>The lava state manager handles all the encoding / decoding processes and the
interaction with DynamoDB.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      &copy; Origin Energy 2025
    </div>
  
</div>
      <div class="md-footer-social">
        <div class="md-copyright">
          <div class="md-copyright__highlight">
            v8.2.0 (Kilauea)
          </div>
        </div>
      </div>
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": ".", "features": ["navigation.instant", "content.code.copy", {"icon": {"repo": "material/github"}}], "search": "assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="assets/javascripts/bundle.f55a23d4.min.js"></script>
      
    
  </body>
</html>